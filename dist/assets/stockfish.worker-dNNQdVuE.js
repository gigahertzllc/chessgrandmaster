(function(){"use strict";let n=null,r=!1;const l="https://cdnjs.cloudflare.com/ajax/libs/stockfish.js/10.0.2/stockfish.js";function o(t){self.postMessage(t)}function i(t){o({type:"log",message:t}),console.log("[Stockfish Worker]",t)}async function f(){if(n)return n;i("Loading Stockfish from CDN...");try{if(importScripts(l),i("Stockfish script loaded"),typeof STOCKFISH>"u")throw new Error("STOCKFISH global not found after loading script");return n=STOCKFISH(),i("Stockfish engine initialized"),n.onmessage=t=>{const e=typeof t=="string"?t:String(t);o({type:"engine_line",line:e}),(e.startsWith("uciok")||e.startsWith("readyok")||e.startsWith("bestmove"))&&i("Engine: "+e.substring(0,50))},n}catch(t){const e="Failed to load Stockfish: "+t.message;throw i("ERROR: "+e),o({type:"error",message:e}),t}}function s(t){n?(i("Sending: "+t),n.postMessage(t)):i("Warning: Engine not loaded, cannot send: "+t)}function a(t){if(!t)return;const e=t.skillLevel??20;i("Setting skill level to: "+e),s(`setoption name Skill Level value ${e}`)}self.onmessage=async t=>{const e=t.data;if(i("Received message: "+e.type),e.type==="init"){try{await f(),s("uci"),s("isready"),r=!0,o({type:"ready"}),i("Engine ready!")}catch(c){o({type:"error",message:c.message})}return}if(!r){o({type:"error",message:"Engine not ready yet"});return}if(e.type==="set_profile"){a(e.profile),s("isready");return}if(e.type==="analyze"){e.profile&&a(e.profile),s("position fen "+e.fen),s("go movetime "+(e.movetimeMs??200));return}if(e.type==="stop"){s("stop");return}}})();
