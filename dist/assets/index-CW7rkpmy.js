var x1=Object.defineProperty;var y1=(t,e,n)=>e in t?x1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Dt=(t,e,n)=>y1(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();function v1(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var d0={exports:{}},Fc={},u0={exports:{}},gt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fo=Symbol.for("react.element"),b1=Symbol.for("react.portal"),_1=Symbol.for("react.fragment"),S1=Symbol.for("react.strict_mode"),w1=Symbol.for("react.profiler"),k1=Symbol.for("react.provider"),M1=Symbol.for("react.context"),R1=Symbol.for("react.forward_ref"),E1=Symbol.for("react.suspense"),C1=Symbol.for("react.memo"),T1=Symbol.for("react.lazy"),Ap=Symbol.iterator;function A1(t){return t===null||typeof t!="object"?null:(t=Ap&&t[Ap]||t["@@iterator"],typeof t=="function"?t:null)}var h0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f0=Object.assign,p0={};function Ca(t,e,n){this.props=t,this.context=e,this.refs=p0,this.updater=n||h0}Ca.prototype.isReactComponent={};Ca.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Ca.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function m0(){}m0.prototype=Ca.prototype;function xf(t,e,n){this.props=t,this.context=e,this.refs=p0,this.updater=n||h0}var yf=xf.prototype=new m0;yf.constructor=xf;f0(yf,Ca.prototype);yf.isPureReactComponent=!0;var Pp=Array.isArray,g0=Object.prototype.hasOwnProperty,vf={current:null},x0={key:!0,ref:!0,__self:!0,__source:!0};function y0(t,e,n){var i,r={},s=null,a=null;if(e!=null)for(i in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(s=""+e.key),e)g0.call(e,i)&&!x0.hasOwnProperty(i)&&(r[i]=e[i]);var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];r.children=c}if(t&&t.defaultProps)for(i in l=t.defaultProps,l)r[i]===void 0&&(r[i]=l[i]);return{$$typeof:Fo,type:t,key:s,ref:a,props:r,_owner:vf.current}}function P1(t,e){return{$$typeof:Fo,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function bf(t){return typeof t=="object"&&t!==null&&t.$$typeof===Fo}function N1(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Np=/\/+/g;function ad(t,e){return typeof t=="object"&&t!==null&&t.key!=null?N1(""+t.key):e.toString(36)}function Ol(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case Fo:case b1:a=!0}}if(a)return a=t,r=r(a),t=i===""?"."+ad(a,0):i,Pp(r)?(n="",t!=null&&(n=t.replace(Np,"$&/")+"/"),Ol(r,e,n,"",function(d){return d})):r!=null&&(bf(r)&&(r=P1(r,n+(!r.key||a&&a.key===r.key?"":(""+r.key).replace(Np,"$&/")+"/")+t)),e.push(r)),1;if(a=0,i=i===""?".":i+":",Pp(t))for(var l=0;l<t.length;l++){s=t[l];var c=i+ad(s,l);a+=Ol(s,e,n,c,r)}else if(c=A1(t),typeof c=="function")for(t=c.call(t),l=0;!(s=t.next()).done;)s=s.value,c=i+ad(s,l++),a+=Ol(s,e,n,c,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function Qo(t,e,n){if(t==null)return t;var i=[],r=0;return Ol(t,i,"","",function(s){return e.call(n,s,r++)}),i}function B1(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Mn={current:null},zl={transition:null},I1={ReactCurrentDispatcher:Mn,ReactCurrentBatchConfig:zl,ReactCurrentOwner:vf};function v0(){throw Error("act(...) is not supported in production builds of React.")}gt.Children={map:Qo,forEach:function(t,e,n){Qo(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Qo(t,function(){e++}),e},toArray:function(t){return Qo(t,function(e){return e})||[]},only:function(t){if(!bf(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};gt.Component=Ca;gt.Fragment=_1;gt.Profiler=w1;gt.PureComponent=xf;gt.StrictMode=S1;gt.Suspense=E1;gt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=I1;gt.act=v0;gt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=f0({},t.props),r=t.key,s=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,a=vf.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)g0.call(e,c)&&!x0.hasOwnProperty(c)&&(i[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)i.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];i.children=l}return{$$typeof:Fo,type:t.type,key:r,ref:s,props:i,_owner:a}};gt.createContext=function(t){return t={$$typeof:M1,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:k1,_context:t},t.Consumer=t};gt.createElement=y0;gt.createFactory=function(t){var e=y0.bind(null,t);return e.type=t,e};gt.createRef=function(){return{current:null}};gt.forwardRef=function(t){return{$$typeof:R1,render:t}};gt.isValidElement=bf;gt.lazy=function(t){return{$$typeof:T1,_payload:{_status:-1,_result:t},_init:B1}};gt.memo=function(t,e){return{$$typeof:C1,type:t,compare:e===void 0?null:e}};gt.startTransition=function(t){var e=zl.transition;zl.transition={};try{t()}finally{zl.transition=e}};gt.unstable_act=v0;gt.useCallback=function(t,e){return Mn.current.useCallback(t,e)};gt.useContext=function(t){return Mn.current.useContext(t)};gt.useDebugValue=function(){};gt.useDeferredValue=function(t){return Mn.current.useDeferredValue(t)};gt.useEffect=function(t,e){return Mn.current.useEffect(t,e)};gt.useId=function(){return Mn.current.useId()};gt.useImperativeHandle=function(t,e,n){return Mn.current.useImperativeHandle(t,e,n)};gt.useInsertionEffect=function(t,e){return Mn.current.useInsertionEffect(t,e)};gt.useLayoutEffect=function(t,e){return Mn.current.useLayoutEffect(t,e)};gt.useMemo=function(t,e){return Mn.current.useMemo(t,e)};gt.useReducer=function(t,e,n){return Mn.current.useReducer(t,e,n)};gt.useRef=function(t){return Mn.current.useRef(t)};gt.useState=function(t){return Mn.current.useState(t)};gt.useSyncExternalStore=function(t,e,n){return Mn.current.useSyncExternalStore(t,e,n)};gt.useTransition=function(){return Mn.current.useTransition()};gt.version="18.3.1";u0.exports=gt;var N=u0.exports;const _u=v1(N);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var D1=N,L1=Symbol.for("react.element"),F1=Symbol.for("react.fragment"),U1=Object.prototype.hasOwnProperty,O1=D1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,z1={key:!0,ref:!0,__self:!0,__source:!0};function b0(t,e,n){var i,r={},s=null,a=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(a=e.ref);for(i in e)U1.call(e,i)&&!z1.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:L1,type:t,key:s,ref:a,props:r,_owner:O1.current}}Fc.Fragment=F1;Fc.jsx=b0;Fc.jsxs=b0;d0.exports=Fc;var o=d0.exports,_0={exports:{}},Yn={},S0={exports:{}},w0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(V,ue){var F=V.length;V.push(ue);e:for(;0<F;){var de=F-1>>>1,Te=V[de];if(0<r(Te,ue))V[de]=ue,V[F]=Te,F=de;else break e}}function n(V){return V.length===0?null:V[0]}function i(V){if(V.length===0)return null;var ue=V[0],F=V.pop();if(F!==ue){V[0]=F;e:for(var de=0,Te=V.length,xe=Te>>>1;de<xe;){var le=2*(de+1)-1,Re=V[le],Q=le+1,ae=V[Q];if(0>r(Re,F))Q<Te&&0>r(ae,Re)?(V[de]=ae,V[Q]=F,de=Q):(V[de]=Re,V[le]=F,de=le);else if(Q<Te&&0>r(ae,F))V[de]=ae,V[Q]=F,de=Q;else break e}}return ue}function r(V,ue){var F=V.sortIndex-ue.sortIndex;return F!==0?F:V.id-ue.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],d=[],h=1,f=null,p=3,m=!1,y=!1,x=!1,g=typeof setTimeout=="function"?setTimeout:null,u=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(V){for(var ue=n(d);ue!==null;){if(ue.callback===null)i(d);else if(ue.startTime<=V)i(d),ue.sortIndex=ue.expirationTime,e(c,ue);else break;ue=n(d)}}function w(V){if(x=!1,b(V),!y)if(n(c)!==null)y=!0,q(R);else{var ue=n(d);ue!==null&&J(w,ue.startTime-V)}}function R(V,ue){y=!1,x&&(x=!1,u(B),B=-1),m=!0;var F=p;try{for(b(ue),f=n(c);f!==null&&(!(f.expirationTime>ue)||V&&!U());){var de=f.callback;if(typeof de=="function"){f.callback=null,p=f.priorityLevel;var Te=de(f.expirationTime<=ue);ue=t.unstable_now(),typeof Te=="function"?f.callback=Te:f===n(c)&&i(c),b(ue)}else i(c);f=n(c)}if(f!==null)var xe=!0;else{var le=n(d);le!==null&&J(w,le.startTime-ue),xe=!1}return xe}finally{f=null,p=F,m=!1}}var C=!1,A=null,B=-1,S=5,k=-1;function U(){return!(t.unstable_now()-k<S)}function O(){if(A!==null){var V=t.unstable_now();k=V;var ue=!0;try{ue=A(!0,V)}finally{ue?X():(C=!1,A=null)}}else C=!1}var X;if(typeof v=="function")X=function(){v(O)};else if(typeof MessageChannel<"u"){var K=new MessageChannel,$=K.port2;K.port1.onmessage=O,X=function(){$.postMessage(null)}}else X=function(){g(O,0)};function q(V){A=V,C||(C=!0,X())}function J(V,ue){B=g(function(){V(t.unstable_now())},ue)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(V){V.callback=null},t.unstable_continueExecution=function(){y||m||(y=!0,q(R))},t.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):S=0<V?Math.floor(1e3/V):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(V){switch(p){case 1:case 2:case 3:var ue=3;break;default:ue=p}var F=p;p=ue;try{return V()}finally{p=F}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(V,ue){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var F=p;p=V;try{return ue()}finally{p=F}},t.unstable_scheduleCallback=function(V,ue,F){var de=t.unstable_now();switch(typeof F=="object"&&F!==null?(F=F.delay,F=typeof F=="number"&&0<F?de+F:de):F=de,V){case 1:var Te=-1;break;case 2:Te=250;break;case 5:Te=1073741823;break;case 4:Te=1e4;break;default:Te=5e3}return Te=F+Te,V={id:h++,callback:ue,priorityLevel:V,startTime:F,expirationTime:Te,sortIndex:-1},F>de?(V.sortIndex=F,e(d,V),n(c)===null&&V===n(d)&&(x?(u(B),B=-1):x=!0,J(w,F-de))):(V.sortIndex=Te,e(c,V),y||m||(y=!0,q(R))),V},t.unstable_shouldYield=U,t.unstable_wrapCallback=function(V){var ue=p;return function(){var F=p;p=ue;try{return V.apply(this,arguments)}finally{p=F}}}})(w0);S0.exports=w0;var j1=S0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W1=N,Xn=j1;function Ne(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var k0=new Set,mo={};function ws(t,e){fa(t,e),fa(t+"Capture",e)}function fa(t,e){for(mo[t]=e,t=0;t<e.length;t++)k0.add(e[t])}var ir=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Su=Object.prototype.hasOwnProperty,G1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Bp={},Ip={};function H1(t){return Su.call(Ip,t)?!0:Su.call(Bp,t)?!1:G1.test(t)?Ip[t]=!0:(Bp[t]=!0,!1)}function V1(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function K1(t,e,n,i){if(e===null||typeof e>"u"||V1(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Rn(t,e,n,i,r,s,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=a}var cn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){cn[t]=new Rn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];cn[e]=new Rn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){cn[t]=new Rn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){cn[t]=new Rn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){cn[t]=new Rn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){cn[t]=new Rn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){cn[t]=new Rn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){cn[t]=new Rn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){cn[t]=new Rn(t,5,!1,t.toLowerCase(),null,!1,!1)});var _f=/[\-:]([a-z])/g;function Sf(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(_f,Sf);cn[e]=new Rn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(_f,Sf);cn[e]=new Rn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(_f,Sf);cn[e]=new Rn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){cn[t]=new Rn(t,1,!1,t.toLowerCase(),null,!1,!1)});cn.xlinkHref=new Rn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){cn[t]=new Rn(t,1,!1,t.toLowerCase(),null,!0,!0)});function wf(t,e,n,i){var r=cn.hasOwnProperty(e)?cn[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(K1(e,n,r,i)&&(n=null),i||r===null?H1(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var cr=W1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,qo=Symbol.for("react.element"),Hs=Symbol.for("react.portal"),Vs=Symbol.for("react.fragment"),kf=Symbol.for("react.strict_mode"),wu=Symbol.for("react.profiler"),M0=Symbol.for("react.provider"),R0=Symbol.for("react.context"),Mf=Symbol.for("react.forward_ref"),ku=Symbol.for("react.suspense"),Mu=Symbol.for("react.suspense_list"),Rf=Symbol.for("react.memo"),Sr=Symbol.for("react.lazy"),E0=Symbol.for("react.offscreen"),Dp=Symbol.iterator;function Da(t){return t===null||typeof t!="object"?null:(t=Dp&&t[Dp]||t["@@iterator"],typeof t=="function"?t:null)}var jt=Object.assign,od;function Ya(t){if(od===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);od=e&&e[1]||""}return`
`+od+t}var ld=!1;function cd(t,e){if(!t||ld)return"";ld=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var i=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){i=d}t.call(e.prototype)}else{try{throw Error()}catch(d){i=d}t()}}catch(d){if(d&&i&&typeof d.stack=="string"){for(var r=d.stack.split(`
`),s=i.stack.split(`
`),a=r.length-1,l=s.length-1;1<=a&&0<=l&&r[a]!==s[l];)l--;for(;1<=a&&0<=l;a--,l--)if(r[a]!==s[l]){if(a!==1||l!==1)do if(a--,l--,0>l||r[a]!==s[l]){var c=`
`+r[a].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=a&&0<=l);break}}}finally{ld=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Ya(t):""}function Q1(t){switch(t.tag){case 5:return Ya(t.type);case 16:return Ya("Lazy");case 13:return Ya("Suspense");case 19:return Ya("SuspenseList");case 0:case 2:case 15:return t=cd(t.type,!1),t;case 11:return t=cd(t.type.render,!1),t;case 1:return t=cd(t.type,!0),t;default:return""}}function Ru(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Vs:return"Fragment";case Hs:return"Portal";case wu:return"Profiler";case kf:return"StrictMode";case ku:return"Suspense";case Mu:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case R0:return(t.displayName||"Context")+".Consumer";case M0:return(t._context.displayName||"Context")+".Provider";case Mf:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Rf:return e=t.displayName||null,e!==null?e:Ru(t.type)||"Memo";case Sr:e=t._payload,t=t._init;try{return Ru(t(e))}catch{}}return null}function q1(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ru(e);case 8:return e===kf?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function jr(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function C0(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function $1(t){var e=C0(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(a){i=""+a,s.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(a){i=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function $o(t){t._valueTracker||(t._valueTracker=$1(t))}function T0(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=C0(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function lc(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Eu(t,e){var n=e.checked;return jt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Lp(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=jr(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function A0(t,e){e=e.checked,e!=null&&wf(t,"checked",e,!1)}function Cu(t,e){A0(t,e);var n=jr(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Tu(t,e.type,n):e.hasOwnProperty("defaultValue")&&Tu(t,e.type,jr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Fp(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Tu(t,e,n){(e!=="number"||lc(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Za=Array.isArray;function ra(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+jr(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function Au(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ne(91));return jt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Up(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Ne(92));if(Za(n)){if(1<n.length)throw Error(Ne(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:jr(n)}}function P0(t,e){var n=jr(e.value),i=jr(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function Op(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function N0(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Pu(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?N0(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Xo,B0=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Xo=Xo||document.createElement("div"),Xo.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Xo.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function go(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var so={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},X1=["Webkit","ms","Moz","O"];Object.keys(so).forEach(function(t){X1.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),so[e]=so[t]})});function I0(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||so.hasOwnProperty(t)&&so[t]?(""+e).trim():e+"px"}function D0(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=I0(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var Y1=jt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Nu(t,e){if(e){if(Y1[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ne(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ne(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ne(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ne(62))}}function Bu(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Iu=null;function Ef(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Du=null,sa=null,aa=null;function zp(t){if(t=zo(t)){if(typeof Du!="function")throw Error(Ne(280));var e=t.stateNode;e&&(e=Wc(e),Du(t.stateNode,t.type,e))}}function L0(t){sa?aa?aa.push(t):aa=[t]:sa=t}function F0(){if(sa){var t=sa,e=aa;if(aa=sa=null,zp(t),e)for(t=0;t<e.length;t++)zp(e[t])}}function U0(t,e){return t(e)}function O0(){}var dd=!1;function z0(t,e,n){if(dd)return t(e,n);dd=!0;try{return U0(t,e,n)}finally{dd=!1,(sa!==null||aa!==null)&&(O0(),F0())}}function xo(t,e){var n=t.stateNode;if(n===null)return null;var i=Wc(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Ne(231,e,typeof n));return n}var Lu=!1;if(ir)try{var La={};Object.defineProperty(La,"passive",{get:function(){Lu=!0}}),window.addEventListener("test",La,La),window.removeEventListener("test",La,La)}catch{Lu=!1}function Z1(t,e,n,i,r,s,a,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(h){this.onError(h)}}var ao=!1,cc=null,dc=!1,Fu=null,J1={onError:function(t){ao=!0,cc=t}};function ev(t,e,n,i,r,s,a,l,c){ao=!1,cc=null,Z1.apply(J1,arguments)}function tv(t,e,n,i,r,s,a,l,c){if(ev.apply(this,arguments),ao){if(ao){var d=cc;ao=!1,cc=null}else throw Error(Ne(198));dc||(dc=!0,Fu=d)}}function ks(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function j0(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function jp(t){if(ks(t)!==t)throw Error(Ne(188))}function nv(t){var e=t.alternate;if(!e){if(e=ks(t),e===null)throw Error(Ne(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return jp(r),t;if(s===i)return jp(r),e;s=s.sibling}throw Error(Ne(188))}if(n.return!==i.return)n=r,i=s;else{for(var a=!1,l=r.child;l;){if(l===n){a=!0,n=r,i=s;break}if(l===i){a=!0,i=r,n=s;break}l=l.sibling}if(!a){for(l=s.child;l;){if(l===n){a=!0,n=s,i=r;break}if(l===i){a=!0,i=s,n=r;break}l=l.sibling}if(!a)throw Error(Ne(189))}}if(n.alternate!==i)throw Error(Ne(190))}if(n.tag!==3)throw Error(Ne(188));return n.stateNode.current===n?t:e}function W0(t){return t=nv(t),t!==null?G0(t):null}function G0(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=G0(t);if(e!==null)return e;t=t.sibling}return null}var H0=Xn.unstable_scheduleCallback,Wp=Xn.unstable_cancelCallback,iv=Xn.unstable_shouldYield,rv=Xn.unstable_requestPaint,Ht=Xn.unstable_now,sv=Xn.unstable_getCurrentPriorityLevel,Cf=Xn.unstable_ImmediatePriority,V0=Xn.unstable_UserBlockingPriority,uc=Xn.unstable_NormalPriority,av=Xn.unstable_LowPriority,K0=Xn.unstable_IdlePriority,Uc=null,Di=null;function ov(t){if(Di&&typeof Di.onCommitFiberRoot=="function")try{Di.onCommitFiberRoot(Uc,t,void 0,(t.current.flags&128)===128)}catch{}}var _i=Math.clz32?Math.clz32:dv,lv=Math.log,cv=Math.LN2;function dv(t){return t>>>=0,t===0?32:31-(lv(t)/cv|0)|0}var Yo=64,Zo=4194304;function Ja(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function hc(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,a=n&268435455;if(a!==0){var l=a&~r;l!==0?i=Ja(l):(s&=a,s!==0&&(i=Ja(s)))}else a=n&~r,a!==0?i=Ja(a):s!==0&&(i=Ja(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-_i(e),r=1<<n,i|=t[n],e&=~r;return i}function uv(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function hv(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var a=31-_i(s),l=1<<a,c=r[a];c===-1?(!(l&n)||l&i)&&(r[a]=uv(l,e)):c<=e&&(t.expiredLanes|=l),s&=~l}}function Uu(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Q0(){var t=Yo;return Yo<<=1,!(Yo&4194240)&&(Yo=64),t}function ud(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Uo(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-_i(e),t[e]=n}function fv(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-_i(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function Tf(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-_i(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var Et=0;function q0(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var $0,Af,X0,Y0,Z0,Ou=!1,Jo=[],Nr=null,Br=null,Ir=null,yo=new Map,vo=new Map,Rr=[],pv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Gp(t,e){switch(t){case"focusin":case"focusout":Nr=null;break;case"dragenter":case"dragleave":Br=null;break;case"mouseover":case"mouseout":Ir=null;break;case"pointerover":case"pointerout":yo.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":vo.delete(e.pointerId)}}function Fa(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=zo(e),e!==null&&Af(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function mv(t,e,n,i,r){switch(e){case"focusin":return Nr=Fa(Nr,t,e,n,i,r),!0;case"dragenter":return Br=Fa(Br,t,e,n,i,r),!0;case"mouseover":return Ir=Fa(Ir,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return yo.set(s,Fa(yo.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,vo.set(s,Fa(vo.get(s)||null,t,e,n,i,r)),!0}return!1}function J0(t){var e=ls(t.target);if(e!==null){var n=ks(e);if(n!==null){if(e=n.tag,e===13){if(e=j0(n),e!==null){t.blockedOn=e,Z0(t.priority,function(){X0(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function jl(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=zu(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);Iu=i,n.target.dispatchEvent(i),Iu=null}else return e=zo(n),e!==null&&Af(e),t.blockedOn=n,!1;e.shift()}return!0}function Hp(t,e,n){jl(t)&&n.delete(e)}function gv(){Ou=!1,Nr!==null&&jl(Nr)&&(Nr=null),Br!==null&&jl(Br)&&(Br=null),Ir!==null&&jl(Ir)&&(Ir=null),yo.forEach(Hp),vo.forEach(Hp)}function Ua(t,e){t.blockedOn===e&&(t.blockedOn=null,Ou||(Ou=!0,Xn.unstable_scheduleCallback(Xn.unstable_NormalPriority,gv)))}function bo(t){function e(r){return Ua(r,t)}if(0<Jo.length){Ua(Jo[0],t);for(var n=1;n<Jo.length;n++){var i=Jo[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Nr!==null&&Ua(Nr,t),Br!==null&&Ua(Br,t),Ir!==null&&Ua(Ir,t),yo.forEach(e),vo.forEach(e),n=0;n<Rr.length;n++)i=Rr[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Rr.length&&(n=Rr[0],n.blockedOn===null);)J0(n),n.blockedOn===null&&Rr.shift()}var oa=cr.ReactCurrentBatchConfig,fc=!0;function xv(t,e,n,i){var r=Et,s=oa.transition;oa.transition=null;try{Et=1,Pf(t,e,n,i)}finally{Et=r,oa.transition=s}}function yv(t,e,n,i){var r=Et,s=oa.transition;oa.transition=null;try{Et=4,Pf(t,e,n,i)}finally{Et=r,oa.transition=s}}function Pf(t,e,n,i){if(fc){var r=zu(t,e,n,i);if(r===null)_d(t,e,i,pc,n),Gp(t,i);else if(mv(r,t,e,n,i))i.stopPropagation();else if(Gp(t,i),e&4&&-1<pv.indexOf(t)){for(;r!==null;){var s=zo(r);if(s!==null&&$0(s),s=zu(t,e,n,i),s===null&&_d(t,e,i,pc,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else _d(t,e,i,null,n)}}var pc=null;function zu(t,e,n,i){if(pc=null,t=Ef(i),t=ls(t),t!==null)if(e=ks(t),e===null)t=null;else if(n=e.tag,n===13){if(t=j0(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return pc=t,null}function ex(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(sv()){case Cf:return 1;case V0:return 4;case uc:case av:return 16;case K0:return 536870912;default:return 16}default:return 16}}var Tr=null,Nf=null,Wl=null;function tx(){if(Wl)return Wl;var t,e=Nf,n=e.length,i,r="value"in Tr?Tr.value:Tr.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var a=n-t;for(i=1;i<=a&&e[n-i]===r[s-i];i++);return Wl=r.slice(t,1<i?1-i:void 0)}function Gl(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function el(){return!0}function Vp(){return!1}function Zn(t){function e(n,i,r,s,a){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(s):s[l]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?el:Vp,this.isPropagationStopped=Vp,this}return jt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=el)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=el)},persist:function(){},isPersistent:el}),e}var Ta={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Bf=Zn(Ta),Oo=jt({},Ta,{view:0,detail:0}),vv=Zn(Oo),hd,fd,Oa,Oc=jt({},Oo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:If,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Oa&&(Oa&&t.type==="mousemove"?(hd=t.screenX-Oa.screenX,fd=t.screenY-Oa.screenY):fd=hd=0,Oa=t),hd)},movementY:function(t){return"movementY"in t?t.movementY:fd}}),Kp=Zn(Oc),bv=jt({},Oc,{dataTransfer:0}),_v=Zn(bv),Sv=jt({},Oo,{relatedTarget:0}),pd=Zn(Sv),wv=jt({},Ta,{animationName:0,elapsedTime:0,pseudoElement:0}),kv=Zn(wv),Mv=jt({},Ta,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Rv=Zn(Mv),Ev=jt({},Ta,{data:0}),Qp=Zn(Ev),Cv={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Tv={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Av={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pv(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Av[t])?!!e[t]:!1}function If(){return Pv}var Nv=jt({},Oo,{key:function(t){if(t.key){var e=Cv[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Gl(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Tv[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:If,charCode:function(t){return t.type==="keypress"?Gl(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Gl(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Bv=Zn(Nv),Iv=jt({},Oc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),qp=Zn(Iv),Dv=jt({},Oo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:If}),Lv=Zn(Dv),Fv=jt({},Ta,{propertyName:0,elapsedTime:0,pseudoElement:0}),Uv=Zn(Fv),Ov=jt({},Oc,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),zv=Zn(Ov),jv=[9,13,27,32],Df=ir&&"CompositionEvent"in window,oo=null;ir&&"documentMode"in document&&(oo=document.documentMode);var Wv=ir&&"TextEvent"in window&&!oo,nx=ir&&(!Df||oo&&8<oo&&11>=oo),$p=" ",Xp=!1;function ix(t,e){switch(t){case"keyup":return jv.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function rx(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Ks=!1;function Gv(t,e){switch(t){case"compositionend":return rx(e);case"keypress":return e.which!==32?null:(Xp=!0,$p);case"textInput":return t=e.data,t===$p&&Xp?null:t;default:return null}}function Hv(t,e){if(Ks)return t==="compositionend"||!Df&&ix(t,e)?(t=tx(),Wl=Nf=Tr=null,Ks=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return nx&&e.locale!=="ko"?null:e.data;default:return null}}var Vv={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Yp(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Vv[t.type]:e==="textarea"}function sx(t,e,n,i){L0(i),e=mc(e,"onChange"),0<e.length&&(n=new Bf("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var lo=null,_o=null;function Kv(t){gx(t,0)}function zc(t){var e=$s(t);if(T0(e))return t}function Qv(t,e){if(t==="change")return e}var ax=!1;if(ir){var md;if(ir){var gd="oninput"in document;if(!gd){var Zp=document.createElement("div");Zp.setAttribute("oninput","return;"),gd=typeof Zp.oninput=="function"}md=gd}else md=!1;ax=md&&(!document.documentMode||9<document.documentMode)}function Jp(){lo&&(lo.detachEvent("onpropertychange",ox),_o=lo=null)}function ox(t){if(t.propertyName==="value"&&zc(_o)){var e=[];sx(e,_o,t,Ef(t)),z0(Kv,e)}}function qv(t,e,n){t==="focusin"?(Jp(),lo=e,_o=n,lo.attachEvent("onpropertychange",ox)):t==="focusout"&&Jp()}function $v(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return zc(_o)}function Xv(t,e){if(t==="click")return zc(e)}function Yv(t,e){if(t==="input"||t==="change")return zc(e)}function Zv(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var wi=typeof Object.is=="function"?Object.is:Zv;function So(t,e){if(wi(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!Su.call(e,r)||!wi(t[r],e[r]))return!1}return!0}function em(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function tm(t,e){var n=em(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=em(n)}}function lx(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?lx(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function cx(){for(var t=window,e=lc();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=lc(t.document)}return e}function Lf(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Jv(t){var e=cx(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&lx(n.ownerDocument.documentElement,n)){if(i!==null&&Lf(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=tm(n,s);var a=tm(n,i);r&&a&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var eb=ir&&"documentMode"in document&&11>=document.documentMode,Qs=null,ju=null,co=null,Wu=!1;function nm(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Wu||Qs==null||Qs!==lc(i)||(i=Qs,"selectionStart"in i&&Lf(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),co&&So(co,i)||(co=i,i=mc(ju,"onSelect"),0<i.length&&(e=new Bf("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Qs)))}function tl(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var qs={animationend:tl("Animation","AnimationEnd"),animationiteration:tl("Animation","AnimationIteration"),animationstart:tl("Animation","AnimationStart"),transitionend:tl("Transition","TransitionEnd")},xd={},dx={};ir&&(dx=document.createElement("div").style,"AnimationEvent"in window||(delete qs.animationend.animation,delete qs.animationiteration.animation,delete qs.animationstart.animation),"TransitionEvent"in window||delete qs.transitionend.transition);function jc(t){if(xd[t])return xd[t];if(!qs[t])return t;var e=qs[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in dx)return xd[t]=e[n];return t}var ux=jc("animationend"),hx=jc("animationiteration"),fx=jc("animationstart"),px=jc("transitionend"),mx=new Map,im="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Vr(t,e){mx.set(t,e),ws(e,[t])}for(var yd=0;yd<im.length;yd++){var vd=im[yd],tb=vd.toLowerCase(),nb=vd[0].toUpperCase()+vd.slice(1);Vr(tb,"on"+nb)}Vr(ux,"onAnimationEnd");Vr(hx,"onAnimationIteration");Vr(fx,"onAnimationStart");Vr("dblclick","onDoubleClick");Vr("focusin","onFocus");Vr("focusout","onBlur");Vr(px,"onTransitionEnd");fa("onMouseEnter",["mouseout","mouseover"]);fa("onMouseLeave",["mouseout","mouseover"]);fa("onPointerEnter",["pointerout","pointerover"]);fa("onPointerLeave",["pointerout","pointerover"]);ws("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ws("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ws("onBeforeInput",["compositionend","keypress","textInput","paste"]);ws("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ws("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ws("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var eo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ib=new Set("cancel close invalid load scroll toggle".split(" ").concat(eo));function rm(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,tv(i,e,void 0,t),t.currentTarget=null}function gx(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var a=i.length-1;0<=a;a--){var l=i[a],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==s&&r.isPropagationStopped())break e;rm(r,l,d),s=c}else for(a=0;a<i.length;a++){if(l=i[a],c=l.instance,d=l.currentTarget,l=l.listener,c!==s&&r.isPropagationStopped())break e;rm(r,l,d),s=c}}}if(dc)throw t=Fu,dc=!1,Fu=null,t}function Nt(t,e){var n=e[Qu];n===void 0&&(n=e[Qu]=new Set);var i=t+"__bubble";n.has(i)||(xx(e,t,2,!1),n.add(i))}function bd(t,e,n){var i=0;e&&(i|=4),xx(n,t,i,e)}var nl="_reactListening"+Math.random().toString(36).slice(2);function wo(t){if(!t[nl]){t[nl]=!0,k0.forEach(function(n){n!=="selectionchange"&&(ib.has(n)||bd(n,!1,t),bd(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[nl]||(e[nl]=!0,bd("selectionchange",!1,e))}}function xx(t,e,n,i){switch(ex(e)){case 1:var r=xv;break;case 4:r=yv;break;default:r=Pf}n=r.bind(null,e,n,t),r=void 0,!Lu||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function _d(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var a=i.tag;if(a===3||a===4){var l=i.stateNode.containerInfo;if(l===r||l.nodeType===8&&l.parentNode===r)break;if(a===4)for(a=i.return;a!==null;){var c=a.tag;if((c===3||c===4)&&(c=a.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;a=a.return}for(;l!==null;){if(a=ls(l),a===null)return;if(c=a.tag,c===5||c===6){i=s=a;continue e}l=l.parentNode}}i=i.return}z0(function(){var d=s,h=Ef(n),f=[];e:{var p=mx.get(t);if(p!==void 0){var m=Bf,y=t;switch(t){case"keypress":if(Gl(n)===0)break e;case"keydown":case"keyup":m=Bv;break;case"focusin":y="focus",m=pd;break;case"focusout":y="blur",m=pd;break;case"beforeblur":case"afterblur":m=pd;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=Kp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=_v;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=Lv;break;case ux:case hx:case fx:m=kv;break;case px:m=Uv;break;case"scroll":m=vv;break;case"wheel":m=zv;break;case"copy":case"cut":case"paste":m=Rv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=qp}var x=(e&4)!==0,g=!x&&t==="scroll",u=x?p!==null?p+"Capture":null:p;x=[];for(var v=d,b;v!==null;){b=v;var w=b.stateNode;if(b.tag===5&&w!==null&&(b=w,u!==null&&(w=xo(v,u),w!=null&&x.push(ko(v,w,b)))),g)break;v=v.return}0<x.length&&(p=new m(p,y,null,n,h),f.push({event:p,listeners:x}))}}if(!(e&7)){e:{if(p=t==="mouseover"||t==="pointerover",m=t==="mouseout"||t==="pointerout",p&&n!==Iu&&(y=n.relatedTarget||n.fromElement)&&(ls(y)||y[rr]))break e;if((m||p)&&(p=h.window===h?h:(p=h.ownerDocument)?p.defaultView||p.parentWindow:window,m?(y=n.relatedTarget||n.toElement,m=d,y=y?ls(y):null,y!==null&&(g=ks(y),y!==g||y.tag!==5&&y.tag!==6)&&(y=null)):(m=null,y=d),m!==y)){if(x=Kp,w="onMouseLeave",u="onMouseEnter",v="mouse",(t==="pointerout"||t==="pointerover")&&(x=qp,w="onPointerLeave",u="onPointerEnter",v="pointer"),g=m==null?p:$s(m),b=y==null?p:$s(y),p=new x(w,v+"leave",m,n,h),p.target=g,p.relatedTarget=b,w=null,ls(h)===d&&(x=new x(u,v+"enter",y,n,h),x.target=b,x.relatedTarget=g,w=x),g=w,m&&y)t:{for(x=m,u=y,v=0,b=x;b;b=Ts(b))v++;for(b=0,w=u;w;w=Ts(w))b++;for(;0<v-b;)x=Ts(x),v--;for(;0<b-v;)u=Ts(u),b--;for(;v--;){if(x===u||u!==null&&x===u.alternate)break t;x=Ts(x),u=Ts(u)}x=null}else x=null;m!==null&&sm(f,p,m,x,!1),y!==null&&g!==null&&sm(f,g,y,x,!0)}}e:{if(p=d?$s(d):window,m=p.nodeName&&p.nodeName.toLowerCase(),m==="select"||m==="input"&&p.type==="file")var R=Qv;else if(Yp(p))if(ax)R=Yv;else{R=$v;var C=qv}else(m=p.nodeName)&&m.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(R=Xv);if(R&&(R=R(t,d))){sx(f,R,n,h);break e}C&&C(t,p,d),t==="focusout"&&(C=p._wrapperState)&&C.controlled&&p.type==="number"&&Tu(p,"number",p.value)}switch(C=d?$s(d):window,t){case"focusin":(Yp(C)||C.contentEditable==="true")&&(Qs=C,ju=d,co=null);break;case"focusout":co=ju=Qs=null;break;case"mousedown":Wu=!0;break;case"contextmenu":case"mouseup":case"dragend":Wu=!1,nm(f,n,h);break;case"selectionchange":if(eb)break;case"keydown":case"keyup":nm(f,n,h)}var A;if(Df)e:{switch(t){case"compositionstart":var B="onCompositionStart";break e;case"compositionend":B="onCompositionEnd";break e;case"compositionupdate":B="onCompositionUpdate";break e}B=void 0}else Ks?ix(t,n)&&(B="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(B="onCompositionStart");B&&(nx&&n.locale!=="ko"&&(Ks||B!=="onCompositionStart"?B==="onCompositionEnd"&&Ks&&(A=tx()):(Tr=h,Nf="value"in Tr?Tr.value:Tr.textContent,Ks=!0)),C=mc(d,B),0<C.length&&(B=new Qp(B,t,null,n,h),f.push({event:B,listeners:C}),A?B.data=A:(A=rx(n),A!==null&&(B.data=A)))),(A=Wv?Gv(t,n):Hv(t,n))&&(d=mc(d,"onBeforeInput"),0<d.length&&(h=new Qp("onBeforeInput","beforeinput",null,n,h),f.push({event:h,listeners:d}),h.data=A))}gx(f,e)})}function ko(t,e,n){return{instance:t,listener:e,currentTarget:n}}function mc(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=xo(t,n),s!=null&&i.unshift(ko(t,s,r)),s=xo(t,e),s!=null&&i.push(ko(t,s,r))),t=t.return}return i}function Ts(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function sm(t,e,n,i,r){for(var s=e._reactName,a=[];n!==null&&n!==i;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===i)break;l.tag===5&&d!==null&&(l=d,r?(c=xo(n,s),c!=null&&a.unshift(ko(n,c,l))):r||(c=xo(n,s),c!=null&&a.push(ko(n,c,l)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var rb=/\r\n?/g,sb=/\u0000|\uFFFD/g;function am(t){return(typeof t=="string"?t:""+t).replace(rb,`
`).replace(sb,"")}function il(t,e,n){if(e=am(e),am(t)!==e&&n)throw Error(Ne(425))}function gc(){}var Gu=null,Hu=null;function Vu(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Ku=typeof setTimeout=="function"?setTimeout:void 0,ab=typeof clearTimeout=="function"?clearTimeout:void 0,om=typeof Promise=="function"?Promise:void 0,ob=typeof queueMicrotask=="function"?queueMicrotask:typeof om<"u"?function(t){return om.resolve(null).then(t).catch(lb)}:Ku;function lb(t){setTimeout(function(){throw t})}function Sd(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),bo(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);bo(e)}function Dr(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function lm(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Aa=Math.random().toString(36).slice(2),Pi="__reactFiber$"+Aa,Mo="__reactProps$"+Aa,rr="__reactContainer$"+Aa,Qu="__reactEvents$"+Aa,cb="__reactListeners$"+Aa,db="__reactHandles$"+Aa;function ls(t){var e=t[Pi];if(e)return e;for(var n=t.parentNode;n;){if(e=n[rr]||n[Pi]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=lm(t);t!==null;){if(n=t[Pi])return n;t=lm(t)}return e}t=n,n=t.parentNode}return null}function zo(t){return t=t[Pi]||t[rr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function $s(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Ne(33))}function Wc(t){return t[Mo]||null}var qu=[],Xs=-1;function Kr(t){return{current:t}}function It(t){0>Xs||(t.current=qu[Xs],qu[Xs]=null,Xs--)}function At(t,e){Xs++,qu[Xs]=t.current,t.current=e}var Wr={},yn=Kr(Wr),Fn=Kr(!1),gs=Wr;function pa(t,e){var n=t.type.contextTypes;if(!n)return Wr;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function Un(t){return t=t.childContextTypes,t!=null}function xc(){It(Fn),It(yn)}function cm(t,e,n){if(yn.current!==Wr)throw Error(Ne(168));At(yn,e),At(Fn,n)}function yx(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(Ne(108,q1(t)||"Unknown",r));return jt({},n,i)}function yc(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Wr,gs=yn.current,At(yn,t),At(Fn,Fn.current),!0}function dm(t,e,n){var i=t.stateNode;if(!i)throw Error(Ne(169));n?(t=yx(t,e,gs),i.__reactInternalMemoizedMergedChildContext=t,It(Fn),It(yn),At(yn,t)):It(Fn),At(Fn,n)}var Xi=null,Gc=!1,wd=!1;function vx(t){Xi===null?Xi=[t]:Xi.push(t)}function ub(t){Gc=!0,vx(t)}function Qr(){if(!wd&&Xi!==null){wd=!0;var t=0,e=Et;try{var n=Xi;for(Et=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}Xi=null,Gc=!1}catch(r){throw Xi!==null&&(Xi=Xi.slice(t+1)),H0(Cf,Qr),r}finally{Et=e,wd=!1}}return null}var Ys=[],Zs=0,vc=null,bc=0,ii=[],ri=0,xs=null,Yi=1,Zi="";function rs(t,e){Ys[Zs++]=bc,Ys[Zs++]=vc,vc=t,bc=e}function bx(t,e,n){ii[ri++]=Yi,ii[ri++]=Zi,ii[ri++]=xs,xs=t;var i=Yi;t=Zi;var r=32-_i(i)-1;i&=~(1<<r),n+=1;var s=32-_i(e)+r;if(30<s){var a=r-r%5;s=(i&(1<<a)-1).toString(32),i>>=a,r-=a,Yi=1<<32-_i(e)+r|n<<r|i,Zi=s+t}else Yi=1<<s|n<<r|i,Zi=t}function Ff(t){t.return!==null&&(rs(t,1),bx(t,1,0))}function Uf(t){for(;t===vc;)vc=Ys[--Zs],Ys[Zs]=null,bc=Ys[--Zs],Ys[Zs]=null;for(;t===xs;)xs=ii[--ri],ii[ri]=null,Zi=ii[--ri],ii[ri]=null,Yi=ii[--ri],ii[ri]=null}var $n=null,qn=null,Lt=!1,xi=null;function _x(t,e){var n=ai(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function um(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,$n=t,qn=Dr(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,$n=t,qn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=xs!==null?{id:Yi,overflow:Zi}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=ai(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,$n=t,qn=null,!0):!1;default:return!1}}function $u(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Xu(t){if(Lt){var e=qn;if(e){var n=e;if(!um(t,e)){if($u(t))throw Error(Ne(418));e=Dr(n.nextSibling);var i=$n;e&&um(t,e)?_x(i,n):(t.flags=t.flags&-4097|2,Lt=!1,$n=t)}}else{if($u(t))throw Error(Ne(418));t.flags=t.flags&-4097|2,Lt=!1,$n=t}}}function hm(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;$n=t}function rl(t){if(t!==$n)return!1;if(!Lt)return hm(t),Lt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Vu(t.type,t.memoizedProps)),e&&(e=qn)){if($u(t))throw Sx(),Error(Ne(418));for(;e;)_x(t,e),e=Dr(e.nextSibling)}if(hm(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Ne(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){qn=Dr(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}qn=null}}else qn=$n?Dr(t.stateNode.nextSibling):null;return!0}function Sx(){for(var t=qn;t;)t=Dr(t.nextSibling)}function ma(){qn=$n=null,Lt=!1}function Of(t){xi===null?xi=[t]:xi.push(t)}var hb=cr.ReactCurrentBatchConfig;function za(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Ne(309));var i=n.stateNode}if(!i)throw Error(Ne(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(a){var l=r.refs;a===null?delete l[s]:l[s]=a},e._stringRef=s,e)}if(typeof t!="string")throw Error(Ne(284));if(!n._owner)throw Error(Ne(290,t))}return t}function sl(t,e){throw t=Object.prototype.toString.call(e),Error(Ne(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function fm(t){var e=t._init;return e(t._payload)}function wx(t){function e(u,v){if(t){var b=u.deletions;b===null?(u.deletions=[v],u.flags|=16):b.push(v)}}function n(u,v){if(!t)return null;for(;v!==null;)e(u,v),v=v.sibling;return null}function i(u,v){for(u=new Map;v!==null;)v.key!==null?u.set(v.key,v):u.set(v.index,v),v=v.sibling;return u}function r(u,v){return u=Or(u,v),u.index=0,u.sibling=null,u}function s(u,v,b){return u.index=b,t?(b=u.alternate,b!==null?(b=b.index,b<v?(u.flags|=2,v):b):(u.flags|=2,v)):(u.flags|=1048576,v)}function a(u){return t&&u.alternate===null&&(u.flags|=2),u}function l(u,v,b,w){return v===null||v.tag!==6?(v=Ad(b,u.mode,w),v.return=u,v):(v=r(v,b),v.return=u,v)}function c(u,v,b,w){var R=b.type;return R===Vs?h(u,v,b.props.children,w,b.key):v!==null&&(v.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===Sr&&fm(R)===v.type)?(w=r(v,b.props),w.ref=za(u,v,b),w.return=u,w):(w=Xl(b.type,b.key,b.props,null,u.mode,w),w.ref=za(u,v,b),w.return=u,w)}function d(u,v,b,w){return v===null||v.tag!==4||v.stateNode.containerInfo!==b.containerInfo||v.stateNode.implementation!==b.implementation?(v=Pd(b,u.mode,w),v.return=u,v):(v=r(v,b.children||[]),v.return=u,v)}function h(u,v,b,w,R){return v===null||v.tag!==7?(v=ps(b,u.mode,w,R),v.return=u,v):(v=r(v,b),v.return=u,v)}function f(u,v,b){if(typeof v=="string"&&v!==""||typeof v=="number")return v=Ad(""+v,u.mode,b),v.return=u,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case qo:return b=Xl(v.type,v.key,v.props,null,u.mode,b),b.ref=za(u,null,v),b.return=u,b;case Hs:return v=Pd(v,u.mode,b),v.return=u,v;case Sr:var w=v._init;return f(u,w(v._payload),b)}if(Za(v)||Da(v))return v=ps(v,u.mode,b,null),v.return=u,v;sl(u,v)}return null}function p(u,v,b,w){var R=v!==null?v.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return R!==null?null:l(u,v,""+b,w);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case qo:return b.key===R?c(u,v,b,w):null;case Hs:return b.key===R?d(u,v,b,w):null;case Sr:return R=b._init,p(u,v,R(b._payload),w)}if(Za(b)||Da(b))return R!==null?null:h(u,v,b,w,null);sl(u,b)}return null}function m(u,v,b,w,R){if(typeof w=="string"&&w!==""||typeof w=="number")return u=u.get(b)||null,l(v,u,""+w,R);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case qo:return u=u.get(w.key===null?b:w.key)||null,c(v,u,w,R);case Hs:return u=u.get(w.key===null?b:w.key)||null,d(v,u,w,R);case Sr:var C=w._init;return m(u,v,b,C(w._payload),R)}if(Za(w)||Da(w))return u=u.get(b)||null,h(v,u,w,R,null);sl(v,w)}return null}function y(u,v,b,w){for(var R=null,C=null,A=v,B=v=0,S=null;A!==null&&B<b.length;B++){A.index>B?(S=A,A=null):S=A.sibling;var k=p(u,A,b[B],w);if(k===null){A===null&&(A=S);break}t&&A&&k.alternate===null&&e(u,A),v=s(k,v,B),C===null?R=k:C.sibling=k,C=k,A=S}if(B===b.length)return n(u,A),Lt&&rs(u,B),R;if(A===null){for(;B<b.length;B++)A=f(u,b[B],w),A!==null&&(v=s(A,v,B),C===null?R=A:C.sibling=A,C=A);return Lt&&rs(u,B),R}for(A=i(u,A);B<b.length;B++)S=m(A,u,B,b[B],w),S!==null&&(t&&S.alternate!==null&&A.delete(S.key===null?B:S.key),v=s(S,v,B),C===null?R=S:C.sibling=S,C=S);return t&&A.forEach(function(U){return e(u,U)}),Lt&&rs(u,B),R}function x(u,v,b,w){var R=Da(b);if(typeof R!="function")throw Error(Ne(150));if(b=R.call(b),b==null)throw Error(Ne(151));for(var C=R=null,A=v,B=v=0,S=null,k=b.next();A!==null&&!k.done;B++,k=b.next()){A.index>B?(S=A,A=null):S=A.sibling;var U=p(u,A,k.value,w);if(U===null){A===null&&(A=S);break}t&&A&&U.alternate===null&&e(u,A),v=s(U,v,B),C===null?R=U:C.sibling=U,C=U,A=S}if(k.done)return n(u,A),Lt&&rs(u,B),R;if(A===null){for(;!k.done;B++,k=b.next())k=f(u,k.value,w),k!==null&&(v=s(k,v,B),C===null?R=k:C.sibling=k,C=k);return Lt&&rs(u,B),R}for(A=i(u,A);!k.done;B++,k=b.next())k=m(A,u,B,k.value,w),k!==null&&(t&&k.alternate!==null&&A.delete(k.key===null?B:k.key),v=s(k,v,B),C===null?R=k:C.sibling=k,C=k);return t&&A.forEach(function(O){return e(u,O)}),Lt&&rs(u,B),R}function g(u,v,b,w){if(typeof b=="object"&&b!==null&&b.type===Vs&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case qo:e:{for(var R=b.key,C=v;C!==null;){if(C.key===R){if(R=b.type,R===Vs){if(C.tag===7){n(u,C.sibling),v=r(C,b.props.children),v.return=u,u=v;break e}}else if(C.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===Sr&&fm(R)===C.type){n(u,C.sibling),v=r(C,b.props),v.ref=za(u,C,b),v.return=u,u=v;break e}n(u,C);break}else e(u,C);C=C.sibling}b.type===Vs?(v=ps(b.props.children,u.mode,w,b.key),v.return=u,u=v):(w=Xl(b.type,b.key,b.props,null,u.mode,w),w.ref=za(u,v,b),w.return=u,u=w)}return a(u);case Hs:e:{for(C=b.key;v!==null;){if(v.key===C)if(v.tag===4&&v.stateNode.containerInfo===b.containerInfo&&v.stateNode.implementation===b.implementation){n(u,v.sibling),v=r(v,b.children||[]),v.return=u,u=v;break e}else{n(u,v);break}else e(u,v);v=v.sibling}v=Pd(b,u.mode,w),v.return=u,u=v}return a(u);case Sr:return C=b._init,g(u,v,C(b._payload),w)}if(Za(b))return y(u,v,b,w);if(Da(b))return x(u,v,b,w);sl(u,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,v!==null&&v.tag===6?(n(u,v.sibling),v=r(v,b),v.return=u,u=v):(n(u,v),v=Ad(b,u.mode,w),v.return=u,u=v),a(u)):n(u,v)}return g}var ga=wx(!0),kx=wx(!1),_c=Kr(null),Sc=null,Js=null,zf=null;function jf(){zf=Js=Sc=null}function Wf(t){var e=_c.current;It(_c),t._currentValue=e}function Yu(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function la(t,e){Sc=t,zf=Js=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Ln=!0),t.firstContext=null)}function li(t){var e=t._currentValue;if(zf!==t)if(t={context:t,memoizedValue:e,next:null},Js===null){if(Sc===null)throw Error(Ne(308));Js=t,Sc.dependencies={lanes:0,firstContext:t}}else Js=Js.next=t;return e}var cs=null;function Gf(t){cs===null?cs=[t]:cs.push(t)}function Mx(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,Gf(e)):(n.next=r.next,r.next=n),e.interleaved=n,sr(t,i)}function sr(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var wr=!1;function Hf(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Rx(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function er(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Lr(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,_t&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,sr(t,n)}return r=i.interleaved,r===null?(e.next=e,Gf(i)):(e.next=r.next,r.next=e),i.interleaved=e,sr(t,n)}function Hl(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Tf(t,n)}}function pm(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=a:s=s.next=a,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function wc(t,e,n,i){var r=t.updateQueue;wr=!1;var s=r.firstBaseUpdate,a=r.lastBaseUpdate,l=r.shared.pending;if(l!==null){r.shared.pending=null;var c=l,d=c.next;c.next=null,a===null?s=d:a.next=d,a=c;var h=t.alternate;h!==null&&(h=h.updateQueue,l=h.lastBaseUpdate,l!==a&&(l===null?h.firstBaseUpdate=d:l.next=d,h.lastBaseUpdate=c))}if(s!==null){var f=r.baseState;a=0,h=d=c=null,l=s;do{var p=l.lane,m=l.eventTime;if((i&p)===p){h!==null&&(h=h.next={eventTime:m,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var y=t,x=l;switch(p=e,m=n,x.tag){case 1:if(y=x.payload,typeof y=="function"){f=y.call(m,f,p);break e}f=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=x.payload,p=typeof y=="function"?y.call(m,f,p):y,p==null)break e;f=jt({},f,p);break e;case 2:wr=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,p=r.effects,p===null?r.effects=[l]:p.push(l))}else m={eventTime:m,lane:p,tag:l.tag,payload:l.payload,callback:l.callback,next:null},h===null?(d=h=m,c=f):h=h.next=m,a|=p;if(l=l.next,l===null){if(l=r.shared.pending,l===null)break;p=l,l=p.next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}while(!0);if(h===null&&(c=f),r.baseState=c,r.firstBaseUpdate=d,r.lastBaseUpdate=h,e=r.shared.interleaved,e!==null){r=e;do a|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);vs|=a,t.lanes=a,t.memoizedState=f}}function mm(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(Ne(191,r));r.call(i)}}}var jo={},Li=Kr(jo),Ro=Kr(jo),Eo=Kr(jo);function ds(t){if(t===jo)throw Error(Ne(174));return t}function Vf(t,e){switch(At(Eo,e),At(Ro,t),At(Li,jo),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Pu(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Pu(e,t)}It(Li),At(Li,e)}function xa(){It(Li),It(Ro),It(Eo)}function Ex(t){ds(Eo.current);var e=ds(Li.current),n=Pu(e,t.type);e!==n&&(At(Ro,t),At(Li,n))}function Kf(t){Ro.current===t&&(It(Li),It(Ro))}var Ut=Kr(0);function kc(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var kd=[];function Qf(){for(var t=0;t<kd.length;t++)kd[t]._workInProgressVersionPrimary=null;kd.length=0}var Vl=cr.ReactCurrentDispatcher,Md=cr.ReactCurrentBatchConfig,ys=0,Ot=null,Xt=null,nn=null,Mc=!1,uo=!1,Co=0,fb=0;function dn(){throw Error(Ne(321))}function qf(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!wi(t[n],e[n]))return!1;return!0}function $f(t,e,n,i,r,s){if(ys=s,Ot=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Vl.current=t===null||t.memoizedState===null?xb:yb,t=n(i,r),uo){s=0;do{if(uo=!1,Co=0,25<=s)throw Error(Ne(301));s+=1,nn=Xt=null,e.updateQueue=null,Vl.current=vb,t=n(i,r)}while(uo)}if(Vl.current=Rc,e=Xt!==null&&Xt.next!==null,ys=0,nn=Xt=Ot=null,Mc=!1,e)throw Error(Ne(300));return t}function Xf(){var t=Co!==0;return Co=0,t}function Ti(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return nn===null?Ot.memoizedState=nn=t:nn=nn.next=t,nn}function ci(){if(Xt===null){var t=Ot.alternate;t=t!==null?t.memoizedState:null}else t=Xt.next;var e=nn===null?Ot.memoizedState:nn.next;if(e!==null)nn=e,Xt=t;else{if(t===null)throw Error(Ne(310));Xt=t,t={memoizedState:Xt.memoizedState,baseState:Xt.baseState,baseQueue:Xt.baseQueue,queue:Xt.queue,next:null},nn===null?Ot.memoizedState=nn=t:nn=nn.next=t}return nn}function To(t,e){return typeof e=="function"?e(t):e}function Rd(t){var e=ci(),n=e.queue;if(n===null)throw Error(Ne(311));n.lastRenderedReducer=t;var i=Xt,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var a=r.next;r.next=s.next,s.next=a}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var l=a=null,c=null,d=s;do{var h=d.lane;if((ys&h)===h)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),i=d.hasEagerState?d.eagerState:t(i,d.action);else{var f={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=f,a=i):c=c.next=f,Ot.lanes|=h,vs|=h}d=d.next}while(d!==null&&d!==s);c===null?a=i:c.next=l,wi(i,e.memoizedState)||(Ln=!0),e.memoizedState=i,e.baseState=a,e.baseQueue=c,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,Ot.lanes|=s,vs|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Ed(t){var e=ci(),n=e.queue;if(n===null)throw Error(Ne(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var a=r=r.next;do s=t(s,a.action),a=a.next;while(a!==r);wi(s,e.memoizedState)||(Ln=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function Cx(){}function Tx(t,e){var n=Ot,i=ci(),r=e(),s=!wi(i.memoizedState,r);if(s&&(i.memoizedState=r,Ln=!0),i=i.queue,Yf(Nx.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||nn!==null&&nn.memoizedState.tag&1){if(n.flags|=2048,Ao(9,Px.bind(null,n,i,r,e),void 0,null),rn===null)throw Error(Ne(349));ys&30||Ax(n,e,r)}return r}function Ax(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Ot.updateQueue,e===null?(e={lastEffect:null,stores:null},Ot.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Px(t,e,n,i){e.value=n,e.getSnapshot=i,Bx(e)&&Ix(t)}function Nx(t,e,n){return n(function(){Bx(e)&&Ix(t)})}function Bx(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!wi(t,n)}catch{return!0}}function Ix(t){var e=sr(t,1);e!==null&&Si(e,t,1,-1)}function gm(t){var e=Ti();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:To,lastRenderedState:t},e.queue=t,t=t.dispatch=gb.bind(null,Ot,t),[e.memoizedState,t]}function Ao(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=Ot.updateQueue,e===null?(e={lastEffect:null,stores:null},Ot.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function Dx(){return ci().memoizedState}function Kl(t,e,n,i){var r=Ti();Ot.flags|=t,r.memoizedState=Ao(1|e,n,void 0,i===void 0?null:i)}function Hc(t,e,n,i){var r=ci();i=i===void 0?null:i;var s=void 0;if(Xt!==null){var a=Xt.memoizedState;if(s=a.destroy,i!==null&&qf(i,a.deps)){r.memoizedState=Ao(e,n,s,i);return}}Ot.flags|=t,r.memoizedState=Ao(1|e,n,s,i)}function xm(t,e){return Kl(8390656,8,t,e)}function Yf(t,e){return Hc(2048,8,t,e)}function Lx(t,e){return Hc(4,2,t,e)}function Fx(t,e){return Hc(4,4,t,e)}function Ux(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Ox(t,e,n){return n=n!=null?n.concat([t]):null,Hc(4,4,Ux.bind(null,e,t),n)}function Zf(){}function zx(t,e){var n=ci();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&qf(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function jx(t,e){var n=ci();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&qf(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function Wx(t,e,n){return ys&21?(wi(n,e)||(n=Q0(),Ot.lanes|=n,vs|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Ln=!0),t.memoizedState=n)}function pb(t,e){var n=Et;Et=n!==0&&4>n?n:4,t(!0);var i=Md.transition;Md.transition={};try{t(!1),e()}finally{Et=n,Md.transition=i}}function Gx(){return ci().memoizedState}function mb(t,e,n){var i=Ur(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Hx(t))Vx(e,n);else if(n=Mx(t,e,n,i),n!==null){var r=Sn();Si(n,t,i,r),Kx(n,e,i)}}function gb(t,e,n){var i=Ur(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Hx(t))Vx(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var a=e.lastRenderedState,l=s(a,n);if(r.hasEagerState=!0,r.eagerState=l,wi(l,a)){var c=e.interleaved;c===null?(r.next=r,Gf(e)):(r.next=c.next,c.next=r),e.interleaved=r;return}}catch{}finally{}n=Mx(t,e,r,i),n!==null&&(r=Sn(),Si(n,t,i,r),Kx(n,e,i))}}function Hx(t){var e=t.alternate;return t===Ot||e!==null&&e===Ot}function Vx(t,e){uo=Mc=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Kx(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Tf(t,n)}}var Rc={readContext:li,useCallback:dn,useContext:dn,useEffect:dn,useImperativeHandle:dn,useInsertionEffect:dn,useLayoutEffect:dn,useMemo:dn,useReducer:dn,useRef:dn,useState:dn,useDebugValue:dn,useDeferredValue:dn,useTransition:dn,useMutableSource:dn,useSyncExternalStore:dn,useId:dn,unstable_isNewReconciler:!1},xb={readContext:li,useCallback:function(t,e){return Ti().memoizedState=[t,e===void 0?null:e],t},useContext:li,useEffect:xm,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Kl(4194308,4,Ux.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Kl(4194308,4,t,e)},useInsertionEffect:function(t,e){return Kl(4,2,t,e)},useMemo:function(t,e){var n=Ti();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=Ti();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=mb.bind(null,Ot,t),[i.memoizedState,t]},useRef:function(t){var e=Ti();return t={current:t},e.memoizedState=t},useState:gm,useDebugValue:Zf,useDeferredValue:function(t){return Ti().memoizedState=t},useTransition:function(){var t=gm(!1),e=t[0];return t=pb.bind(null,t[1]),Ti().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=Ot,r=Ti();if(Lt){if(n===void 0)throw Error(Ne(407));n=n()}else{if(n=e(),rn===null)throw Error(Ne(349));ys&30||Ax(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,xm(Nx.bind(null,i,s,t),[t]),i.flags|=2048,Ao(9,Px.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=Ti(),e=rn.identifierPrefix;if(Lt){var n=Zi,i=Yi;n=(i&~(1<<32-_i(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=Co++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=fb++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},yb={readContext:li,useCallback:zx,useContext:li,useEffect:Yf,useImperativeHandle:Ox,useInsertionEffect:Lx,useLayoutEffect:Fx,useMemo:jx,useReducer:Rd,useRef:Dx,useState:function(){return Rd(To)},useDebugValue:Zf,useDeferredValue:function(t){var e=ci();return Wx(e,Xt.memoizedState,t)},useTransition:function(){var t=Rd(To)[0],e=ci().memoizedState;return[t,e]},useMutableSource:Cx,useSyncExternalStore:Tx,useId:Gx,unstable_isNewReconciler:!1},vb={readContext:li,useCallback:zx,useContext:li,useEffect:Yf,useImperativeHandle:Ox,useInsertionEffect:Lx,useLayoutEffect:Fx,useMemo:jx,useReducer:Ed,useRef:Dx,useState:function(){return Ed(To)},useDebugValue:Zf,useDeferredValue:function(t){var e=ci();return Xt===null?e.memoizedState=t:Wx(e,Xt.memoizedState,t)},useTransition:function(){var t=Ed(To)[0],e=ci().memoizedState;return[t,e]},useMutableSource:Cx,useSyncExternalStore:Tx,useId:Gx,unstable_isNewReconciler:!1};function mi(t,e){if(t&&t.defaultProps){e=jt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Zu(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:jt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Vc={isMounted:function(t){return(t=t._reactInternals)?ks(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Sn(),r=Ur(t),s=er(i,r);s.payload=e,n!=null&&(s.callback=n),e=Lr(t,s,r),e!==null&&(Si(e,t,r,i),Hl(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Sn(),r=Ur(t),s=er(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Lr(t,s,r),e!==null&&(Si(e,t,r,i),Hl(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Sn(),i=Ur(t),r=er(n,i);r.tag=2,e!=null&&(r.callback=e),e=Lr(t,r,i),e!==null&&(Si(e,t,i,n),Hl(e,t,i))}};function ym(t,e,n,i,r,s,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,a):e.prototype&&e.prototype.isPureReactComponent?!So(n,i)||!So(r,s):!0}function Qx(t,e,n){var i=!1,r=Wr,s=e.contextType;return typeof s=="object"&&s!==null?s=li(s):(r=Un(e)?gs:yn.current,i=e.contextTypes,s=(i=i!=null)?pa(t,r):Wr),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Vc,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function vm(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&Vc.enqueueReplaceState(e,e.state,null)}function Ju(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},Hf(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=li(s):(s=Un(e)?gs:yn.current,r.context=pa(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Zu(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Vc.enqueueReplaceState(r,r.state,null),wc(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function ya(t,e){try{var n="",i=e;do n+=Q1(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function Cd(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function eh(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var bb=typeof WeakMap=="function"?WeakMap:Map;function qx(t,e,n){n=er(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){Cc||(Cc=!0,dh=i),eh(t,e)},n}function $x(t,e,n){n=er(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){eh(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){eh(t,e),typeof i!="function"&&(Fr===null?Fr=new Set([this]):Fr.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),n}function bm(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new bb;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=Ib.bind(null,t,e,n),e.then(t,t))}function _m(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Sm(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=er(-1,1),e.tag=2,Lr(n,e,1))),n.lanes|=1),t)}var _b=cr.ReactCurrentOwner,Ln=!1;function _n(t,e,n,i){e.child=t===null?kx(e,null,n,i):ga(e,t.child,n,i)}function wm(t,e,n,i,r){n=n.render;var s=e.ref;return la(e,r),i=$f(t,e,n,i,s,r),n=Xf(),t!==null&&!Ln?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,ar(t,e,r)):(Lt&&n&&Ff(e),e.flags|=1,_n(t,e,i,r),e.child)}function km(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!ap(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,Xx(t,e,s,i,r)):(t=Xl(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var a=s.memoizedProps;if(n=n.compare,n=n!==null?n:So,n(a,i)&&t.ref===e.ref)return ar(t,e,r)}return e.flags|=1,t=Or(s,i),t.ref=e.ref,t.return=e,e.child=t}function Xx(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(So(s,i)&&t.ref===e.ref)if(Ln=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&(Ln=!0);else return e.lanes=t.lanes,ar(t,e,r)}return th(t,e,n,i,r)}function Yx(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},At(ta,Kn),Kn|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,At(ta,Kn),Kn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,At(ta,Kn),Kn|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,At(ta,Kn),Kn|=i;return _n(t,e,r,n),e.child}function Zx(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function th(t,e,n,i,r){var s=Un(n)?gs:yn.current;return s=pa(e,s),la(e,r),n=$f(t,e,n,i,s,r),i=Xf(),t!==null&&!Ln?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,ar(t,e,r)):(Lt&&i&&Ff(e),e.flags|=1,_n(t,e,n,r),e.child)}function Mm(t,e,n,i,r){if(Un(n)){var s=!0;yc(e)}else s=!1;if(la(e,r),e.stateNode===null)Ql(t,e),Qx(e,n,i),Ju(e,n,i,r),i=!0;else if(t===null){var a=e.stateNode,l=e.memoizedProps;a.props=l;var c=a.context,d=n.contextType;typeof d=="object"&&d!==null?d=li(d):(d=Un(n)?gs:yn.current,d=pa(e,d));var h=n.getDerivedStateFromProps,f=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function";f||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==i||c!==d)&&vm(e,a,i,d),wr=!1;var p=e.memoizedState;a.state=p,wc(e,i,a,r),c=e.memoizedState,l!==i||p!==c||Fn.current||wr?(typeof h=="function"&&(Zu(e,n,h,i),c=e.memoizedState),(l=wr||ym(e,n,l,i,p,c,d))?(f||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=c),a.props=i,a.state=c,a.context=d,i=l):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{a=e.stateNode,Rx(t,e),l=e.memoizedProps,d=e.type===e.elementType?l:mi(e.type,l),a.props=d,f=e.pendingProps,p=a.context,c=n.contextType,typeof c=="object"&&c!==null?c=li(c):(c=Un(n)?gs:yn.current,c=pa(e,c));var m=n.getDerivedStateFromProps;(h=typeof m=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==f||p!==c)&&vm(e,a,i,c),wr=!1,p=e.memoizedState,a.state=p,wc(e,i,a,r);var y=e.memoizedState;l!==f||p!==y||Fn.current||wr?(typeof m=="function"&&(Zu(e,n,m,i),y=e.memoizedState),(d=wr||ym(e,n,d,i,p,y,c)||!1)?(h||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(i,y,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(i,y,c)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=y),a.props=i,a.state=y,a.context=c,i=d):(typeof a.componentDidUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),i=!1)}return nh(t,e,n,i,s,r)}function nh(t,e,n,i,r,s){Zx(t,e);var a=(e.flags&128)!==0;if(!i&&!a)return r&&dm(e,n,!1),ar(t,e,s);i=e.stateNode,_b.current=e;var l=a&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&a?(e.child=ga(e,t.child,null,s),e.child=ga(e,null,l,s)):_n(t,e,l,s),e.memoizedState=i.state,r&&dm(e,n,!0),e.child}function Jx(t){var e=t.stateNode;e.pendingContext?cm(t,e.pendingContext,e.pendingContext!==e.context):e.context&&cm(t,e.context,!1),Vf(t,e.containerInfo)}function Rm(t,e,n,i,r){return ma(),Of(r),e.flags|=256,_n(t,e,n,i),e.child}var ih={dehydrated:null,treeContext:null,retryLane:0};function rh(t){return{baseLanes:t,cachePool:null,transitions:null}}function ey(t,e,n){var i=e.pendingProps,r=Ut.current,s=!1,a=(e.flags&128)!==0,l;if((l=a)||(l=t!==null&&t.memoizedState===null?!1:(r&2)!==0),l?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),At(Ut,r&1),t===null)return Xu(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=i.children,t=i.fallback,s?(i=e.mode,s=e.child,a={mode:"hidden",children:a},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=qc(a,i,0,null),t=ps(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=rh(n),e.memoizedState=ih,t):Jf(e,a));if(r=t.memoizedState,r!==null&&(l=r.dehydrated,l!==null))return Sb(t,e,a,i,l,r,n);if(s){s=i.fallback,a=e.mode,r=t.child,l=r.sibling;var c={mode:"hidden",children:i.children};return!(a&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=c,e.deletions=null):(i=Or(r,c),i.subtreeFlags=r.subtreeFlags&14680064),l!==null?s=Or(l,s):(s=ps(s,a,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,a=t.child.memoizedState,a=a===null?rh(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=t.childLanes&~n,e.memoizedState=ih,i}return s=t.child,t=s.sibling,i=Or(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function Jf(t,e){return e=qc({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function al(t,e,n,i){return i!==null&&Of(i),ga(e,t.child,null,n),t=Jf(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Sb(t,e,n,i,r,s,a){if(n)return e.flags&256?(e.flags&=-257,i=Cd(Error(Ne(422))),al(t,e,a,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=qc({mode:"visible",children:i.children},r,0,null),s=ps(s,r,a,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&ga(e,t.child,null,a),e.child.memoizedState=rh(a),e.memoizedState=ih,s);if(!(e.mode&1))return al(t,e,a,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var l=i.dgst;return i=l,s=Error(Ne(419)),i=Cd(s,i,void 0),al(t,e,a,i)}if(l=(a&t.childLanes)!==0,Ln||l){if(i=rn,i!==null){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|a)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,sr(t,r),Si(i,t,r,-1))}return sp(),i=Cd(Error(Ne(421))),al(t,e,a,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=Db.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,qn=Dr(r.nextSibling),$n=e,Lt=!0,xi=null,t!==null&&(ii[ri++]=Yi,ii[ri++]=Zi,ii[ri++]=xs,Yi=t.id,Zi=t.overflow,xs=e),e=Jf(e,i.children),e.flags|=4096,e)}function Em(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),Yu(t.return,e,n)}function Td(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function ty(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(_n(t,e,i.children,n),i=Ut.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Em(t,n,e);else if(t.tag===19)Em(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(At(Ut,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&kc(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),Td(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&kc(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}Td(e,!0,n,null,s);break;case"together":Td(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ql(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function ar(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),vs|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Ne(153));if(e.child!==null){for(t=e.child,n=Or(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Or(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function wb(t,e,n){switch(e.tag){case 3:Jx(e),ma();break;case 5:Ex(e);break;case 1:Un(e.type)&&yc(e);break;case 4:Vf(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;At(_c,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(At(Ut,Ut.current&1),e.flags|=128,null):n&e.child.childLanes?ey(t,e,n):(At(Ut,Ut.current&1),t=ar(t,e,n),t!==null?t.sibling:null);At(Ut,Ut.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return ty(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),At(Ut,Ut.current),i)break;return null;case 22:case 23:return e.lanes=0,Yx(t,e,n)}return ar(t,e,n)}var ny,sh,iy,ry;ny=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};sh=function(){};iy=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,ds(Li.current);var s=null;switch(n){case"input":r=Eu(t,r),i=Eu(t,i),s=[];break;case"select":r=jt({},r,{value:void 0}),i=jt({},i,{value:void 0}),s=[];break;case"textarea":r=Au(t,r),i=Au(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=gc)}Nu(n,i);var a;n=null;for(d in r)if(!i.hasOwnProperty(d)&&r.hasOwnProperty(d)&&r[d]!=null)if(d==="style"){var l=r[d];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(mo.hasOwnProperty(d)?s||(s=[]):(s=s||[]).push(d,null));for(d in i){var c=i[d];if(l=r!=null?r[d]:void 0,i.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(s||(s=[]),s.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(s=s||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(mo.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Nt("scroll",t),s||l===c||(s=[])):(s=s||[]).push(d,c))}n&&(s=s||[]).push("style",n);var d=s;(e.updateQueue=d)&&(e.flags|=4)}};ry=function(t,e,n,i){n!==i&&(e.flags|=4)};function ja(t,e){if(!Lt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function un(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function kb(t,e,n){var i=e.pendingProps;switch(Uf(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return un(e),null;case 1:return Un(e.type)&&xc(),un(e),null;case 3:return i=e.stateNode,xa(),It(Fn),It(yn),Qf(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(rl(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,xi!==null&&(fh(xi),xi=null))),sh(t,e),un(e),null;case 5:Kf(e);var r=ds(Eo.current);if(n=e.type,t!==null&&e.stateNode!=null)iy(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(Ne(166));return un(e),null}if(t=ds(Li.current),rl(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[Pi]=e,i[Mo]=s,t=(e.mode&1)!==0,n){case"dialog":Nt("cancel",i),Nt("close",i);break;case"iframe":case"object":case"embed":Nt("load",i);break;case"video":case"audio":for(r=0;r<eo.length;r++)Nt(eo[r],i);break;case"source":Nt("error",i);break;case"img":case"image":case"link":Nt("error",i),Nt("load",i);break;case"details":Nt("toggle",i);break;case"input":Lp(i,s),Nt("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},Nt("invalid",i);break;case"textarea":Up(i,s),Nt("invalid",i)}Nu(n,s),r=null;for(var a in s)if(s.hasOwnProperty(a)){var l=s[a];a==="children"?typeof l=="string"?i.textContent!==l&&(s.suppressHydrationWarning!==!0&&il(i.textContent,l,t),r=["children",l]):typeof l=="number"&&i.textContent!==""+l&&(s.suppressHydrationWarning!==!0&&il(i.textContent,l,t),r=["children",""+l]):mo.hasOwnProperty(a)&&l!=null&&a==="onScroll"&&Nt("scroll",i)}switch(n){case"input":$o(i),Fp(i,s,!0);break;case"textarea":$o(i),Op(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=gc)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{a=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=N0(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=a.createElement(n,{is:i.is}):(t=a.createElement(n),n==="select"&&(a=t,i.multiple?a.multiple=!0:i.size&&(a.size=i.size))):t=a.createElementNS(t,n),t[Pi]=e,t[Mo]=i,ny(t,e,!1,!1),e.stateNode=t;e:{switch(a=Bu(n,i),n){case"dialog":Nt("cancel",t),Nt("close",t),r=i;break;case"iframe":case"object":case"embed":Nt("load",t),r=i;break;case"video":case"audio":for(r=0;r<eo.length;r++)Nt(eo[r],t);r=i;break;case"source":Nt("error",t),r=i;break;case"img":case"image":case"link":Nt("error",t),Nt("load",t),r=i;break;case"details":Nt("toggle",t),r=i;break;case"input":Lp(t,i),r=Eu(t,i),Nt("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=jt({},i,{value:void 0}),Nt("invalid",t);break;case"textarea":Up(t,i),r=Au(t,i),Nt("invalid",t);break;default:r=i}Nu(n,r),l=r;for(s in l)if(l.hasOwnProperty(s)){var c=l[s];s==="style"?D0(t,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&B0(t,c)):s==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&go(t,c):typeof c=="number"&&go(t,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(mo.hasOwnProperty(s)?c!=null&&s==="onScroll"&&Nt("scroll",t):c!=null&&wf(t,s,c,a))}switch(n){case"input":$o(t),Fp(t,i,!1);break;case"textarea":$o(t),Op(t);break;case"option":i.value!=null&&t.setAttribute("value",""+jr(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?ra(t,!!i.multiple,s,!1):i.defaultValue!=null&&ra(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=gc)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return un(e),null;case 6:if(t&&e.stateNode!=null)ry(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(Ne(166));if(n=ds(Eo.current),ds(Li.current),rl(e)){if(i=e.stateNode,n=e.memoizedProps,i[Pi]=e,(s=i.nodeValue!==n)&&(t=$n,t!==null))switch(t.tag){case 3:il(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&il(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[Pi]=e,e.stateNode=i}return un(e),null;case 13:if(It(Ut),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Lt&&qn!==null&&e.mode&1&&!(e.flags&128))Sx(),ma(),e.flags|=98560,s=!1;else if(s=rl(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(Ne(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(Ne(317));s[Pi]=e}else ma(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;un(e),s=!1}else xi!==null&&(fh(xi),xi=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||Ut.current&1?Yt===0&&(Yt=3):sp())),e.updateQueue!==null&&(e.flags|=4),un(e),null);case 4:return xa(),sh(t,e),t===null&&wo(e.stateNode.containerInfo),un(e),null;case 10:return Wf(e.type._context),un(e),null;case 17:return Un(e.type)&&xc(),un(e),null;case 19:if(It(Ut),s=e.memoizedState,s===null)return un(e),null;if(i=(e.flags&128)!==0,a=s.rendering,a===null)if(i)ja(s,!1);else{if(Yt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=kc(t),a!==null){for(e.flags|=128,ja(s,!1),i=a.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,t=a.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return At(Ut,Ut.current&1|2),e.child}t=t.sibling}s.tail!==null&&Ht()>va&&(e.flags|=128,i=!0,ja(s,!1),e.lanes=4194304)}else{if(!i)if(t=kc(a),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),ja(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!Lt)return un(e),null}else 2*Ht()-s.renderingStartTime>va&&n!==1073741824&&(e.flags|=128,i=!0,ja(s,!1),e.lanes=4194304);s.isBackwards?(a.sibling=e.child,e.child=a):(n=s.last,n!==null?n.sibling=a:e.child=a,s.last=a)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Ht(),e.sibling=null,n=Ut.current,At(Ut,i?n&1|2:n&1),e):(un(e),null);case 22:case 23:return rp(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Kn&1073741824&&(un(e),e.subtreeFlags&6&&(e.flags|=8192)):un(e),null;case 24:return null;case 25:return null}throw Error(Ne(156,e.tag))}function Mb(t,e){switch(Uf(e),e.tag){case 1:return Un(e.type)&&xc(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return xa(),It(Fn),It(yn),Qf(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Kf(e),null;case 13:if(It(Ut),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Ne(340));ma()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return It(Ut),null;case 4:return xa(),null;case 10:return Wf(e.type._context),null;case 22:case 23:return rp(),null;case 24:return null;default:return null}}var ol=!1,mn=!1,Rb=typeof WeakSet=="function"?WeakSet:Set,Qe=null;function ea(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){Wt(t,e,i)}else n.current=null}function ah(t,e,n){try{n()}catch(i){Wt(t,e,i)}}var Cm=!1;function Eb(t,e){if(Gu=fc,t=cx(),Lf(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var a=0,l=-1,c=-1,d=0,h=0,f=t,p=null;t:for(;;){for(var m;f!==n||r!==0&&f.nodeType!==3||(l=a+r),f!==s||i!==0&&f.nodeType!==3||(c=a+i),f.nodeType===3&&(a+=f.nodeValue.length),(m=f.firstChild)!==null;)p=f,f=m;for(;;){if(f===t)break t;if(p===n&&++d===r&&(l=a),p===s&&++h===i&&(c=a),(m=f.nextSibling)!==null)break;f=p,p=f.parentNode}f=m}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Hu={focusedElem:t,selectionRange:n},fc=!1,Qe=e;Qe!==null;)if(e=Qe,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Qe=t;else for(;Qe!==null;){e=Qe;try{var y=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var x=y.memoizedProps,g=y.memoizedState,u=e.stateNode,v=u.getSnapshotBeforeUpdate(e.elementType===e.type?x:mi(e.type,x),g);u.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ne(163))}}catch(w){Wt(e,e.return,w)}if(t=e.sibling,t!==null){t.return=e.return,Qe=t;break}Qe=e.return}return y=Cm,Cm=!1,y}function ho(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&ah(e,n,s)}r=r.next}while(r!==i)}}function Kc(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function oh(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function sy(t){var e=t.alternate;e!==null&&(t.alternate=null,sy(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Pi],delete e[Mo],delete e[Qu],delete e[cb],delete e[db])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function ay(t){return t.tag===5||t.tag===3||t.tag===4}function Tm(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||ay(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function lh(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=gc));else if(i!==4&&(t=t.child,t!==null))for(lh(t,e,n),t=t.sibling;t!==null;)lh(t,e,n),t=t.sibling}function ch(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(ch(t,e,n),t=t.sibling;t!==null;)ch(t,e,n),t=t.sibling}var an=null,gi=!1;function hr(t,e,n){for(n=n.child;n!==null;)oy(t,e,n),n=n.sibling}function oy(t,e,n){if(Di&&typeof Di.onCommitFiberUnmount=="function")try{Di.onCommitFiberUnmount(Uc,n)}catch{}switch(n.tag){case 5:mn||ea(n,e);case 6:var i=an,r=gi;an=null,hr(t,e,n),an=i,gi=r,an!==null&&(gi?(t=an,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):an.removeChild(n.stateNode));break;case 18:an!==null&&(gi?(t=an,n=n.stateNode,t.nodeType===8?Sd(t.parentNode,n):t.nodeType===1&&Sd(t,n),bo(t)):Sd(an,n.stateNode));break;case 4:i=an,r=gi,an=n.stateNode.containerInfo,gi=!0,hr(t,e,n),an=i,gi=r;break;case 0:case 11:case 14:case 15:if(!mn&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&ah(n,e,a),r=r.next}while(r!==i)}hr(t,e,n);break;case 1:if(!mn&&(ea(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(l){Wt(n,e,l)}hr(t,e,n);break;case 21:hr(t,e,n);break;case 22:n.mode&1?(mn=(i=mn)||n.memoizedState!==null,hr(t,e,n),mn=i):hr(t,e,n);break;default:hr(t,e,n)}}function Am(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Rb),e.forEach(function(i){var r=Lb.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function ui(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,a=e,l=a;e:for(;l!==null;){switch(l.tag){case 5:an=l.stateNode,gi=!1;break e;case 3:an=l.stateNode.containerInfo,gi=!0;break e;case 4:an=l.stateNode.containerInfo,gi=!0;break e}l=l.return}if(an===null)throw Error(Ne(160));oy(s,a,r),an=null,gi=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(d){Wt(r,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)ly(e,t),e=e.sibling}function ly(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(ui(e,t),Ri(t),i&4){try{ho(3,t,t.return),Kc(3,t)}catch(x){Wt(t,t.return,x)}try{ho(5,t,t.return)}catch(x){Wt(t,t.return,x)}}break;case 1:ui(e,t),Ri(t),i&512&&n!==null&&ea(n,n.return);break;case 5:if(ui(e,t),Ri(t),i&512&&n!==null&&ea(n,n.return),t.flags&32){var r=t.stateNode;try{go(r,"")}catch(x){Wt(t,t.return,x)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,a=n!==null?n.memoizedProps:s,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&s.type==="radio"&&s.name!=null&&A0(r,s),Bu(l,a);var d=Bu(l,s);for(a=0;a<c.length;a+=2){var h=c[a],f=c[a+1];h==="style"?D0(r,f):h==="dangerouslySetInnerHTML"?B0(r,f):h==="children"?go(r,f):wf(r,h,f,d)}switch(l){case"input":Cu(r,s);break;case"textarea":P0(r,s);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var m=s.value;m!=null?ra(r,!!s.multiple,m,!1):p!==!!s.multiple&&(s.defaultValue!=null?ra(r,!!s.multiple,s.defaultValue,!0):ra(r,!!s.multiple,s.multiple?[]:"",!1))}r[Mo]=s}catch(x){Wt(t,t.return,x)}}break;case 6:if(ui(e,t),Ri(t),i&4){if(t.stateNode===null)throw Error(Ne(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(x){Wt(t,t.return,x)}}break;case 3:if(ui(e,t),Ri(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{bo(e.containerInfo)}catch(x){Wt(t,t.return,x)}break;case 4:ui(e,t),Ri(t);break;case 13:ui(e,t),Ri(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(np=Ht())),i&4&&Am(t);break;case 22:if(h=n!==null&&n.memoizedState!==null,t.mode&1?(mn=(d=mn)||h,ui(e,t),mn=d):ui(e,t),Ri(t),i&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!h&&t.mode&1)for(Qe=t,h=t.child;h!==null;){for(f=Qe=h;Qe!==null;){switch(p=Qe,m=p.child,p.tag){case 0:case 11:case 14:case 15:ho(4,p,p.return);break;case 1:ea(p,p.return);var y=p.stateNode;if(typeof y.componentWillUnmount=="function"){i=p,n=p.return;try{e=i,y.props=e.memoizedProps,y.state=e.memoizedState,y.componentWillUnmount()}catch(x){Wt(i,n,x)}}break;case 5:ea(p,p.return);break;case 22:if(p.memoizedState!==null){Nm(f);continue}}m!==null?(m.return=p,Qe=m):Nm(f)}h=h.sibling}e:for(h=null,f=t;;){if(f.tag===5){if(h===null){h=f;try{r=f.stateNode,d?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(l=f.stateNode,c=f.memoizedProps.style,a=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=I0("display",a))}catch(x){Wt(t,t.return,x)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=d?"":f.memoizedProps}catch(x){Wt(t,t.return,x)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:ui(e,t),Ri(t),i&4&&Am(t);break;case 21:break;default:ui(e,t),Ri(t)}}function Ri(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(ay(n)){var i=n;break e}n=n.return}throw Error(Ne(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(go(r,""),i.flags&=-33);var s=Tm(t);ch(t,s,r);break;case 3:case 4:var a=i.stateNode.containerInfo,l=Tm(t);lh(t,l,a);break;default:throw Error(Ne(161))}}catch(c){Wt(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Cb(t,e,n){Qe=t,cy(t)}function cy(t,e,n){for(var i=(t.mode&1)!==0;Qe!==null;){var r=Qe,s=r.child;if(r.tag===22&&i){var a=r.memoizedState!==null||ol;if(!a){var l=r.alternate,c=l!==null&&l.memoizedState!==null||mn;l=ol;var d=mn;if(ol=a,(mn=c)&&!d)for(Qe=r;Qe!==null;)a=Qe,c=a.child,a.tag===22&&a.memoizedState!==null?Bm(r):c!==null?(c.return=a,Qe=c):Bm(r);for(;s!==null;)Qe=s,cy(s),s=s.sibling;Qe=r,ol=l,mn=d}Pm(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,Qe=s):Pm(t)}}function Pm(t){for(;Qe!==null;){var e=Qe;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:mn||Kc(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!mn)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:mi(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&mm(e,s,i);break;case 3:var a=e.updateQueue;if(a!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}mm(e,a,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&bo(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ne(163))}mn||e.flags&512&&oh(e)}catch(p){Wt(e,e.return,p)}}if(e===t){Qe=null;break}if(n=e.sibling,n!==null){n.return=e.return,Qe=n;break}Qe=e.return}}function Nm(t){for(;Qe!==null;){var e=Qe;if(e===t){Qe=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Qe=n;break}Qe=e.return}}function Bm(t){for(;Qe!==null;){var e=Qe;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Kc(4,e)}catch(c){Wt(e,n,c)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(c){Wt(e,r,c)}}var s=e.return;try{oh(e)}catch(c){Wt(e,s,c)}break;case 5:var a=e.return;try{oh(e)}catch(c){Wt(e,a,c)}}}catch(c){Wt(e,e.return,c)}if(e===t){Qe=null;break}var l=e.sibling;if(l!==null){l.return=e.return,Qe=l;break}Qe=e.return}}var Tb=Math.ceil,Ec=cr.ReactCurrentDispatcher,ep=cr.ReactCurrentOwner,oi=cr.ReactCurrentBatchConfig,_t=0,rn=null,Qt=null,ln=0,Kn=0,ta=Kr(0),Yt=0,Po=null,vs=0,Qc=0,tp=0,fo=null,In=null,np=0,va=1/0,$i=null,Cc=!1,dh=null,Fr=null,ll=!1,Ar=null,Tc=0,po=0,uh=null,ql=-1,$l=0;function Sn(){return _t&6?Ht():ql!==-1?ql:ql=Ht()}function Ur(t){return t.mode&1?_t&2&&ln!==0?ln&-ln:hb.transition!==null?($l===0&&($l=Q0()),$l):(t=Et,t!==0||(t=window.event,t=t===void 0?16:ex(t.type)),t):1}function Si(t,e,n,i){if(50<po)throw po=0,uh=null,Error(Ne(185));Uo(t,n,i),(!(_t&2)||t!==rn)&&(t===rn&&(!(_t&2)&&(Qc|=n),Yt===4&&Er(t,ln)),On(t,i),n===1&&_t===0&&!(e.mode&1)&&(va=Ht()+500,Gc&&Qr()))}function On(t,e){var n=t.callbackNode;hv(t,e);var i=hc(t,t===rn?ln:0);if(i===0)n!==null&&Wp(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&Wp(n),e===1)t.tag===0?ub(Im.bind(null,t)):vx(Im.bind(null,t)),ob(function(){!(_t&6)&&Qr()}),n=null;else{switch(q0(i)){case 1:n=Cf;break;case 4:n=V0;break;case 16:n=uc;break;case 536870912:n=K0;break;default:n=uc}n=xy(n,dy.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function dy(t,e){if(ql=-1,$l=0,_t&6)throw Error(Ne(327));var n=t.callbackNode;if(ca()&&t.callbackNode!==n)return null;var i=hc(t,t===rn?ln:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=Ac(t,i);else{e=i;var r=_t;_t|=2;var s=hy();(rn!==t||ln!==e)&&($i=null,va=Ht()+500,fs(t,e));do try{Nb();break}catch(l){uy(t,l)}while(!0);jf(),Ec.current=s,_t=r,Qt!==null?e=0:(rn=null,ln=0,e=Yt)}if(e!==0){if(e===2&&(r=Uu(t),r!==0&&(i=r,e=hh(t,r))),e===1)throw n=Po,fs(t,0),Er(t,i),On(t,Ht()),n;if(e===6)Er(t,i);else{if(r=t.current.alternate,!(i&30)&&!Ab(r)&&(e=Ac(t,i),e===2&&(s=Uu(t),s!==0&&(i=s,e=hh(t,s))),e===1))throw n=Po,fs(t,0),Er(t,i),On(t,Ht()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(Ne(345));case 2:ss(t,In,$i);break;case 3:if(Er(t,i),(i&130023424)===i&&(e=np+500-Ht(),10<e)){if(hc(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){Sn(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=Ku(ss.bind(null,t,In,$i),e);break}ss(t,In,$i);break;case 4:if(Er(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var a=31-_i(i);s=1<<a,a=e[a],a>r&&(r=a),i&=~s}if(i=r,i=Ht()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Tb(i/1960))-i,10<i){t.timeoutHandle=Ku(ss.bind(null,t,In,$i),i);break}ss(t,In,$i);break;case 5:ss(t,In,$i);break;default:throw Error(Ne(329))}}}return On(t,Ht()),t.callbackNode===n?dy.bind(null,t):null}function hh(t,e){var n=fo;return t.current.memoizedState.isDehydrated&&(fs(t,e).flags|=256),t=Ac(t,e),t!==2&&(e=In,In=n,e!==null&&fh(e)),t}function fh(t){In===null?In=t:In.push.apply(In,t)}function Ab(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!wi(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Er(t,e){for(e&=~tp,e&=~Qc,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-_i(e),i=1<<n;t[n]=-1,e&=~i}}function Im(t){if(_t&6)throw Error(Ne(327));ca();var e=hc(t,0);if(!(e&1))return On(t,Ht()),null;var n=Ac(t,e);if(t.tag!==0&&n===2){var i=Uu(t);i!==0&&(e=i,n=hh(t,i))}if(n===1)throw n=Po,fs(t,0),Er(t,e),On(t,Ht()),n;if(n===6)throw Error(Ne(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ss(t,In,$i),On(t,Ht()),null}function ip(t,e){var n=_t;_t|=1;try{return t(e)}finally{_t=n,_t===0&&(va=Ht()+500,Gc&&Qr())}}function bs(t){Ar!==null&&Ar.tag===0&&!(_t&6)&&ca();var e=_t;_t|=1;var n=oi.transition,i=Et;try{if(oi.transition=null,Et=1,t)return t()}finally{Et=i,oi.transition=n,_t=e,!(_t&6)&&Qr()}}function rp(){Kn=ta.current,It(ta)}function fs(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,ab(n)),Qt!==null)for(n=Qt.return;n!==null;){var i=n;switch(Uf(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&xc();break;case 3:xa(),It(Fn),It(yn),Qf();break;case 5:Kf(i);break;case 4:xa();break;case 13:It(Ut);break;case 19:It(Ut);break;case 10:Wf(i.type._context);break;case 22:case 23:rp()}n=n.return}if(rn=t,Qt=t=Or(t.current,null),ln=Kn=e,Yt=0,Po=null,tp=Qc=vs=0,In=fo=null,cs!==null){for(e=0;e<cs.length;e++)if(n=cs[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var a=s.next;s.next=r,i.next=a}n.pending=i}cs=null}return t}function uy(t,e){do{var n=Qt;try{if(jf(),Vl.current=Rc,Mc){for(var i=Ot.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}Mc=!1}if(ys=0,nn=Xt=Ot=null,uo=!1,Co=0,ep.current=null,n===null||n.return===null){Yt=1,Po=e,Qt=null;break}e:{var s=t,a=n.return,l=n,c=e;if(e=ln,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,h=l,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var m=_m(a);if(m!==null){m.flags&=-257,Sm(m,a,l,s,e),m.mode&1&&bm(s,d,e),e=m,c=d;var y=e.updateQueue;if(y===null){var x=new Set;x.add(c),e.updateQueue=x}else y.add(c);break e}else{if(!(e&1)){bm(s,d,e),sp();break e}c=Error(Ne(426))}}else if(Lt&&l.mode&1){var g=_m(a);if(g!==null){!(g.flags&65536)&&(g.flags|=256),Sm(g,a,l,s,e),Of(ya(c,l));break e}}s=c=ya(c,l),Yt!==4&&(Yt=2),fo===null?fo=[s]:fo.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var u=qx(s,c,e);pm(s,u);break e;case 1:l=c;var v=s.type,b=s.stateNode;if(!(s.flags&128)&&(typeof v.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Fr===null||!Fr.has(b)))){s.flags|=65536,e&=-e,s.lanes|=e;var w=$x(s,l,e);pm(s,w);break e}}s=s.return}while(s!==null)}py(n)}catch(R){e=R,Qt===n&&n!==null&&(Qt=n=n.return);continue}break}while(!0)}function hy(){var t=Ec.current;return Ec.current=Rc,t===null?Rc:t}function sp(){(Yt===0||Yt===3||Yt===2)&&(Yt=4),rn===null||!(vs&268435455)&&!(Qc&268435455)||Er(rn,ln)}function Ac(t,e){var n=_t;_t|=2;var i=hy();(rn!==t||ln!==e)&&($i=null,fs(t,e));do try{Pb();break}catch(r){uy(t,r)}while(!0);if(jf(),_t=n,Ec.current=i,Qt!==null)throw Error(Ne(261));return rn=null,ln=0,Yt}function Pb(){for(;Qt!==null;)fy(Qt)}function Nb(){for(;Qt!==null&&!iv();)fy(Qt)}function fy(t){var e=gy(t.alternate,t,Kn);t.memoizedProps=t.pendingProps,e===null?py(t):Qt=e,ep.current=null}function py(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Mb(n,e),n!==null){n.flags&=32767,Qt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Yt=6,Qt=null;return}}else if(n=kb(n,e,Kn),n!==null){Qt=n;return}if(e=e.sibling,e!==null){Qt=e;return}Qt=e=t}while(e!==null);Yt===0&&(Yt=5)}function ss(t,e,n){var i=Et,r=oi.transition;try{oi.transition=null,Et=1,Bb(t,e,n,i)}finally{oi.transition=r,Et=i}return null}function Bb(t,e,n,i){do ca();while(Ar!==null);if(_t&6)throw Error(Ne(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Ne(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(fv(t,s),t===rn&&(Qt=rn=null,ln=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||ll||(ll=!0,xy(uc,function(){return ca(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=oi.transition,oi.transition=null;var a=Et;Et=1;var l=_t;_t|=4,ep.current=null,Eb(t,n),ly(n,t),Jv(Hu),fc=!!Gu,Hu=Gu=null,t.current=n,Cb(n),rv(),_t=l,Et=a,oi.transition=s}else t.current=n;if(ll&&(ll=!1,Ar=t,Tc=r),s=t.pendingLanes,s===0&&(Fr=null),ov(n.stateNode),On(t,Ht()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Cc)throw Cc=!1,t=dh,dh=null,t;return Tc&1&&t.tag!==0&&ca(),s=t.pendingLanes,s&1?t===uh?po++:(po=0,uh=t):po=0,Qr(),null}function ca(){if(Ar!==null){var t=q0(Tc),e=oi.transition,n=Et;try{if(oi.transition=null,Et=16>t?16:t,Ar===null)var i=!1;else{if(t=Ar,Ar=null,Tc=0,_t&6)throw Error(Ne(331));var r=_t;for(_t|=4,Qe=t.current;Qe!==null;){var s=Qe,a=s.child;if(Qe.flags&16){var l=s.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(Qe=d;Qe!==null;){var h=Qe;switch(h.tag){case 0:case 11:case 15:ho(8,h,s)}var f=h.child;if(f!==null)f.return=h,Qe=f;else for(;Qe!==null;){h=Qe;var p=h.sibling,m=h.return;if(sy(h),h===d){Qe=null;break}if(p!==null){p.return=m,Qe=p;break}Qe=m}}}var y=s.alternate;if(y!==null){var x=y.child;if(x!==null){y.child=null;do{var g=x.sibling;x.sibling=null,x=g}while(x!==null)}}Qe=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,Qe=a;else e:for(;Qe!==null;){if(s=Qe,s.flags&2048)switch(s.tag){case 0:case 11:case 15:ho(9,s,s.return)}var u=s.sibling;if(u!==null){u.return=s.return,Qe=u;break e}Qe=s.return}}var v=t.current;for(Qe=v;Qe!==null;){a=Qe;var b=a.child;if(a.subtreeFlags&2064&&b!==null)b.return=a,Qe=b;else e:for(a=v;Qe!==null;){if(l=Qe,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Kc(9,l)}}catch(R){Wt(l,l.return,R)}if(l===a){Qe=null;break e}var w=l.sibling;if(w!==null){w.return=l.return,Qe=w;break e}Qe=l.return}}if(_t=r,Qr(),Di&&typeof Di.onPostCommitFiberRoot=="function")try{Di.onPostCommitFiberRoot(Uc,t)}catch{}i=!0}return i}finally{Et=n,oi.transition=e}}return!1}function Dm(t,e,n){e=ya(n,e),e=qx(t,e,1),t=Lr(t,e,1),e=Sn(),t!==null&&(Uo(t,1,e),On(t,e))}function Wt(t,e,n){if(t.tag===3)Dm(t,t,n);else for(;e!==null;){if(e.tag===3){Dm(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Fr===null||!Fr.has(i))){t=ya(n,t),t=$x(e,t,1),e=Lr(e,t,1),t=Sn(),e!==null&&(Uo(e,1,t),On(e,t));break}}e=e.return}}function Ib(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=Sn(),t.pingedLanes|=t.suspendedLanes&n,rn===t&&(ln&n)===n&&(Yt===4||Yt===3&&(ln&130023424)===ln&&500>Ht()-np?fs(t,0):tp|=n),On(t,e)}function my(t,e){e===0&&(t.mode&1?(e=Zo,Zo<<=1,!(Zo&130023424)&&(Zo=4194304)):e=1);var n=Sn();t=sr(t,e),t!==null&&(Uo(t,e,n),On(t,n))}function Db(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),my(t,n)}function Lb(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(Ne(314))}i!==null&&i.delete(e),my(t,n)}var gy;gy=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Fn.current)Ln=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Ln=!1,wb(t,e,n);Ln=!!(t.flags&131072)}else Ln=!1,Lt&&e.flags&1048576&&bx(e,bc,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Ql(t,e),t=e.pendingProps;var r=pa(e,yn.current);la(e,n),r=$f(null,e,i,t,r,n);var s=Xf();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Un(i)?(s=!0,yc(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Hf(e),r.updater=Vc,e.stateNode=r,r._reactInternals=e,Ju(e,i,t,n),e=nh(null,e,i,!0,s,n)):(e.tag=0,Lt&&s&&Ff(e),_n(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(Ql(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=Ub(i),t=mi(i,t),r){case 0:e=th(null,e,i,t,n);break e;case 1:e=Mm(null,e,i,t,n);break e;case 11:e=wm(null,e,i,t,n);break e;case 14:e=km(null,e,i,mi(i.type,t),n);break e}throw Error(Ne(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:mi(i,r),th(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:mi(i,r),Mm(t,e,i,r,n);case 3:e:{if(Jx(e),t===null)throw Error(Ne(387));i=e.pendingProps,s=e.memoizedState,r=s.element,Rx(t,e),wc(e,i,null,n);var a=e.memoizedState;if(i=a.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=ya(Error(Ne(423)),e),e=Rm(t,e,i,n,r);break e}else if(i!==r){r=ya(Error(Ne(424)),e),e=Rm(t,e,i,n,r);break e}else for(qn=Dr(e.stateNode.containerInfo.firstChild),$n=e,Lt=!0,xi=null,n=kx(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(ma(),i===r){e=ar(t,e,n);break e}_n(t,e,i,n)}e=e.child}return e;case 5:return Ex(e),t===null&&Xu(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,a=r.children,Vu(i,r)?a=null:s!==null&&Vu(i,s)&&(e.flags|=32),Zx(t,e),_n(t,e,a,n),e.child;case 6:return t===null&&Xu(e),null;case 13:return ey(t,e,n);case 4:return Vf(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=ga(e,null,i,n):_n(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:mi(i,r),wm(t,e,i,r,n);case 7:return _n(t,e,e.pendingProps,n),e.child;case 8:return _n(t,e,e.pendingProps.children,n),e.child;case 12:return _n(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,a=r.value,At(_c,i._currentValue),i._currentValue=a,s!==null)if(wi(s.value,a)){if(s.children===r.children&&!Fn.current){e=ar(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var l=s.dependencies;if(l!==null){a=s.child;for(var c=l.firstContext;c!==null;){if(c.context===i){if(s.tag===1){c=er(-1,n&-n),c.tag=2;var d=s.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?c.next=c:(c.next=h.next,h.next=c),d.pending=c}}s.lanes|=n,c=s.alternate,c!==null&&(c.lanes|=n),Yu(s.return,n,e),l.lanes|=n;break}c=c.next}}else if(s.tag===10)a=s.type===e.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(Ne(341));a.lanes|=n,l=a.alternate,l!==null&&(l.lanes|=n),Yu(a,n,e),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===e){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}_n(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,la(e,n),r=li(r),i=i(r),e.flags|=1,_n(t,e,i,n),e.child;case 14:return i=e.type,r=mi(i,e.pendingProps),r=mi(i.type,r),km(t,e,i,r,n);case 15:return Xx(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:mi(i,r),Ql(t,e),e.tag=1,Un(i)?(t=!0,yc(e)):t=!1,la(e,n),Qx(e,i,r),Ju(e,i,r,n),nh(null,e,i,!0,t,n);case 19:return ty(t,e,n);case 22:return Yx(t,e,n)}throw Error(Ne(156,e.tag))};function xy(t,e){return H0(t,e)}function Fb(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ai(t,e,n,i){return new Fb(t,e,n,i)}function ap(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Ub(t){if(typeof t=="function")return ap(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Mf)return 11;if(t===Rf)return 14}return 2}function Or(t,e){var n=t.alternate;return n===null?(n=ai(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Xl(t,e,n,i,r,s){var a=2;if(i=t,typeof t=="function")ap(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case Vs:return ps(n.children,r,s,e);case kf:a=8,r|=8;break;case wu:return t=ai(12,n,e,r|2),t.elementType=wu,t.lanes=s,t;case ku:return t=ai(13,n,e,r),t.elementType=ku,t.lanes=s,t;case Mu:return t=ai(19,n,e,r),t.elementType=Mu,t.lanes=s,t;case E0:return qc(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case M0:a=10;break e;case R0:a=9;break e;case Mf:a=11;break e;case Rf:a=14;break e;case Sr:a=16,i=null;break e}throw Error(Ne(130,t==null?t:typeof t,""))}return e=ai(a,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function ps(t,e,n,i){return t=ai(7,t,i,e),t.lanes=n,t}function qc(t,e,n,i){return t=ai(22,t,i,e),t.elementType=E0,t.lanes=n,t.stateNode={isHidden:!1},t}function Ad(t,e,n){return t=ai(6,t,null,e),t.lanes=n,t}function Pd(t,e,n){return e=ai(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Ob(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ud(0),this.expirationTimes=ud(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ud(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function op(t,e,n,i,r,s,a,l,c){return t=new Ob(t,e,n,l,c),e===1?(e=1,s===!0&&(e|=8)):e=0,s=ai(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Hf(s),t}function zb(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Hs,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function yy(t){if(!t)return Wr;t=t._reactInternals;e:{if(ks(t)!==t||t.tag!==1)throw Error(Ne(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Un(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ne(171))}if(t.tag===1){var n=t.type;if(Un(n))return yx(t,n,e)}return e}function vy(t,e,n,i,r,s,a,l,c){return t=op(n,i,!0,t,r,s,a,l,c),t.context=yy(null),n=t.current,i=Sn(),r=Ur(n),s=er(i,r),s.callback=e??null,Lr(n,s,r),t.current.lanes=r,Uo(t,r,i),On(t,i),t}function $c(t,e,n,i){var r=e.current,s=Sn(),a=Ur(r);return n=yy(n),e.context===null?e.context=n:e.pendingContext=n,e=er(s,a),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Lr(r,e,a),t!==null&&(Si(t,r,a,s),Hl(t,r,a)),a}function Pc(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Lm(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function lp(t,e){Lm(t,e),(t=t.alternate)&&Lm(t,e)}function jb(){return null}var by=typeof reportError=="function"?reportError:function(t){console.error(t)};function cp(t){this._internalRoot=t}Xc.prototype.render=cp.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Ne(409));$c(t,e,null,null)};Xc.prototype.unmount=cp.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;bs(function(){$c(null,t,null,null)}),e[rr]=null}};function Xc(t){this._internalRoot=t}Xc.prototype.unstable_scheduleHydration=function(t){if(t){var e=Y0();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Rr.length&&e!==0&&e<Rr[n].priority;n++);Rr.splice(n,0,t),n===0&&J0(t)}};function dp(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Yc(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Fm(){}function Wb(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var d=Pc(a);s.call(d)}}var a=vy(e,i,t,0,null,!1,!1,"",Fm);return t._reactRootContainer=a,t[rr]=a.current,wo(t.nodeType===8?t.parentNode:t),bs(),a}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var l=i;i=function(){var d=Pc(c);l.call(d)}}var c=op(t,0,!1,null,null,!1,!1,"",Fm);return t._reactRootContainer=c,t[rr]=c.current,wo(t.nodeType===8?t.parentNode:t),bs(function(){$c(e,c,n,i)}),c}function Zc(t,e,n,i,r){var s=n._reactRootContainer;if(s){var a=s;if(typeof r=="function"){var l=r;r=function(){var c=Pc(a);l.call(c)}}$c(e,a,t,r)}else a=Wb(n,e,t,r,i);return Pc(a)}$0=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Ja(e.pendingLanes);n!==0&&(Tf(e,n|1),On(e,Ht()),!(_t&6)&&(va=Ht()+500,Qr()))}break;case 13:bs(function(){var i=sr(t,1);if(i!==null){var r=Sn();Si(i,t,1,r)}}),lp(t,1)}};Af=function(t){if(t.tag===13){var e=sr(t,134217728);if(e!==null){var n=Sn();Si(e,t,134217728,n)}lp(t,134217728)}};X0=function(t){if(t.tag===13){var e=Ur(t),n=sr(t,e);if(n!==null){var i=Sn();Si(n,t,e,i)}lp(t,e)}};Y0=function(){return Et};Z0=function(t,e){var n=Et;try{return Et=t,e()}finally{Et=n}};Du=function(t,e,n){switch(e){case"input":if(Cu(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=Wc(i);if(!r)throw Error(Ne(90));T0(i),Cu(i,r)}}}break;case"textarea":P0(t,n);break;case"select":e=n.value,e!=null&&ra(t,!!n.multiple,e,!1)}};U0=ip;O0=bs;var Gb={usingClientEntryPoint:!1,Events:[zo,$s,Wc,L0,F0,ip]},Wa={findFiberByHostInstance:ls,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Hb={bundleType:Wa.bundleType,version:Wa.version,rendererPackageName:Wa.rendererPackageName,rendererConfig:Wa.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:cr.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=W0(t),t===null?null:t.stateNode},findFiberByHostInstance:Wa.findFiberByHostInstance||jb,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cl.isDisabled&&cl.supportsFiber)try{Uc=cl.inject(Hb),Di=cl}catch{}}Yn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Gb;Yn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!dp(e))throw Error(Ne(200));return zb(t,e,null,n)};Yn.createRoot=function(t,e){if(!dp(t))throw Error(Ne(299));var n=!1,i="",r=by;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=op(t,1,!1,null,null,n,!1,i,r),t[rr]=e.current,wo(t.nodeType===8?t.parentNode:t),new cp(e)};Yn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Ne(188)):(t=Object.keys(t).join(","),Error(Ne(268,t)));return t=W0(e),t=t===null?null:t.stateNode,t};Yn.flushSync=function(t){return bs(t)};Yn.hydrate=function(t,e,n){if(!Yc(e))throw Error(Ne(200));return Zc(null,t,e,!0,n)};Yn.hydrateRoot=function(t,e,n){if(!dp(t))throw Error(Ne(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",a=by;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),e=vy(e,null,t,1,n??null,r,!1,s,a),t[rr]=e.current,wo(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new Xc(e)};Yn.render=function(t,e,n){if(!Yc(e))throw Error(Ne(200));return Zc(null,t,e,!1,n)};Yn.unmountComponentAtNode=function(t){if(!Yc(t))throw Error(Ne(40));return t._reactRootContainer?(bs(function(){Zc(null,null,t,!1,function(){t._reactRootContainer=null,t[rr]=null})}),!0):!1};Yn.unstable_batchedUpdates=ip;Yn.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!Yc(n))throw Error(Ne(200));if(t==null||t._reactInternals===void 0)throw Error(Ne(38));return Zc(t,e,n,!1,i)};Yn.version="18.3.1-next-f1338f8080-20240426";function _y(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(_y)}catch(t){console.error(t)}}_y(),_0.exports=Yn;var Vb=_0.exports,Sy,Um=Vb;Sy=Um.createRoot,Um.hydrateRoot;function Kb(t){return t!==null?{comment:t,variations:[]}:{variations:[]}}function Qb(t,e,n,i,r){const s={move:t,variations:r};return e&&(s.suffix=e),n&&(s.nag=n),i!==null&&(s.comment=i),s}function qb(...t){const[e,...n]=t;let i=e;for(const r of n)r!==null&&(i.variations=[r,...r.variations],r.variations=[],i=r);return e}function $b(t,e){if(e.marker&&e.marker.comment){let n=e.root;for(;;){const i=n.variations[0];if(!i){n.comment=e.marker.comment;break}n=i}}return{headers:t,root:e.root,result:(e.marker&&e.marker.result)??void 0}}function Xb(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}function ba(t,e,n,i){var r=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(r,ba.prototype),r.expected=e,r.found=n,r.location=i,r.name="SyntaxError",r}Xb(ba,Error);function Nd(t,e,n){return n=n||" ",t.length>e?t:(e-=t.length,n+=n.repeat(e),t+n.slice(0,e))}ba.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var n=null,i;for(i=0;i<t.length;i++)if(t[i].source===this.location.source){n=t[i].text.split(/\r\n|\n|\r/g);break}var r=this.location.start,s=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(r):r,a=this.location.source+":"+s.line+":"+s.column;if(n){var l=this.location.end,c=Nd("",s.line.toString().length," "),d=n[r.line-1],h=r.line===l.line?l.column:d.length+1,f=h-r.column||1;e+=`
 --> `+a+`
`+c+` |
`+s.line+" | "+d+`
`+c+" | "+Nd("",r.column-1," ")+Nd("",f,"^")}else e+=`
 at `+a}return e};ba.buildMessage=function(t,e){var n={literal:function(d){return'"'+r(d.text)+'"'},class:function(d){var h=d.parts.map(function(f){return Array.isArray(f)?s(f[0])+"-"+s(f[1]):s(f)});return"["+(d.inverted?"^":"")+h.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(d){return d.description}};function i(d){return d.charCodeAt(0).toString(16).toUpperCase()}function r(d){return d.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(h){return"\\x0"+i(h)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(h){return"\\x"+i(h)})}function s(d){return d.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(h){return"\\x0"+i(h)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(h){return"\\x"+i(h)})}function a(d){return n[d.type](d)}function l(d){var h=d.map(a),f,p;if(h.sort(),h.length>0){for(f=1,p=1;f<h.length;f++)h[f-1]!==h[f]&&(h[p]=h[f],p++);h.length=p}switch(h.length){case 1:return h[0];case 2:return h[0]+" or "+h[1];default:return h.slice(0,-1).join(", ")+", or "+h[h.length-1]}}function c(d){return d?'"'+r(d)+'"':"end of input"}return"Expected "+l(t)+" but "+c(e)+" found."};function Yb(t,e){e=e!==void 0?e:{};var n={},i=e.grammarSource,r={pgn:Jn},s=Jn,a="[",l='"',c="]",d=".",h="O-O-O",f="O-O",p="0-0-0",m="0-0",y="$",x="{",g="}",u=";",v="(",b=")",w="1-0",R="0-1",C="1/2-1/2",A="*",B=/^[a-zA-Z]/,S=/^[^"]/,k=/^[0-9]/,U=/^[.]/,O=/^[a-zA-Z1-8\-=]/,X=/^[+#]/,K=/^[!?]/,$=/^[^}]/,q=/^[^\r\n]/,J=/^[ \t\r\n]/,V=kt("tag pair"),ue=Le("[",!1),F=Le('"',!1),de=Le("]",!1),Te=kt("tag name"),xe=Pt([["a","z"],["A","Z"]],!1,!1),le=kt("tag value"),Re=Pt(['"'],!0,!1),Q=kt("move number"),ae=Pt([["0","9"]],!1,!1),Me=Le(".",!1),ze=Pt(["."],!1,!1),se=kt("standard algebraic notation"),ke=Le("O-O-O",!1),Ge=Le("O-O",!1),Oe=Le("0-0-0",!1),Ve=Le("0-0",!1),Ze=Pt([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),Ue=Pt(["+","#"],!1,!1),tt=kt("suffix annotation"),z=Pt(["!","?"],!1,!1),ht=kt("NAG"),Xe=Le("$",!1),Je=kt("brace comment"),ee=Le("{",!1),P=Pt(["}"],!0,!1),_=Le("}",!1),W=kt("rest of line comment"),M=Le(";",!1),_e=Pt(["\r",`
`],!0,!1),ne=kt("variation"),Ie=Le("(",!1),ie=Le(")",!1),Se=kt("game termination marker"),we=Le("1-0",!1),ve=Le("0-1",!1),Ee=Le("1/2-1/2",!1),he=Le("*",!1),Z=kt("whitespace"),me=Pt([" ","	","\r",`
`],!1,!1),Ke=function(L,H){return $b(L,H)},G=function(L){return Object.fromEntries(L)},Be=function(L,H){return[L,H]},Pe=function(L,H){return{root:L,marker:H}},je=function(L,H){return qb(Kb(L),...H.flat())},Ae=function(L,H,j,ge,De){return Qb(L,H,j,ge,De)},fe=function(L){return L},Fe=function(L){return L.replace(/[\r\n]+/g," ")},nt=function(L){return L.trim()},yt=function(L){return L},mt=function(L,H){return{result:L,comment:H}},E=e.peg$currPos|0,be=[{line:1,column:1}],qe=E,at=e.peg$maxFailExpected||[],I=e.peg$silentFails|0,St;if(e.startRule){if(!(e.startRule in r))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');s=r[e.startRule]}function Le(L,H){return{type:"literal",text:L,ignoreCase:H}}function Pt(L,H,j){return{type:"class",parts:L,inverted:H,ignoreCase:j}}function Ft(){return{type:"end"}}function kt(L){return{type:"other",description:L}}function En(L){var H=be[L],j;if(H)return H;if(L>=be.length)j=be.length-1;else for(j=L;!be[--j];);for(H=be[j],H={line:H.line,column:H.column};j<L;)t.charCodeAt(j)===10?(H.line++,H.column=1):H.column++,j++;return be[L]=H,H}function di(L,H,j){var ge=En(L),De=En(H),Ye={source:i,start:{offset:L,line:ge.line,column:ge.column},end:{offset:H,line:De.line,column:De.column}};return Ye}function $e(L){E<qe||(E>qe&&(qe=E,at=[]),at.push(L))}function dr(L,H,j){return new ba(ba.buildMessage(L,H),L,H,j)}function Jn(){var L,H,j;return L=E,H=Cn(),j=Es(),L=Ke(H,j),L}function Cn(){var L,H,j;for(L=E,H=[],j=ur();j!==n;)H.push(j),j=ur();return j=ye(),L=G(H),L}function ur(){var L,H,j,ge,De,Ye,xt;return I++,L=E,ye(),t.charCodeAt(E)===91?(H=a,E++):(H=n,I===0&&$e(ue)),H!==n?(ye(),j=Rs(),j!==n?(ye(),t.charCodeAt(E)===34?(ge=l,E++):(ge=n,I===0&&$e(F)),ge!==n?(De=Na(),t.charCodeAt(E)===34?(Ye=l,E++):(Ye=n,I===0&&$e(F)),Ye!==n?(ye(),t.charCodeAt(E)===93?(xt=c,E++):(xt=n,I===0&&$e(de)),xt!==n?L=Be(j,De):(E=L,L=n)):(E=L,L=n)):(E=L,L=n)):(E=L,L=n)):(E=L,L=n),I--,L===n&&I===0&&$e(V),L}function Rs(){var L,H,j;if(I++,L=E,H=[],j=t.charAt(E),B.test(j)?E++:(j=n,I===0&&$e(xe)),j!==n)for(;j!==n;)H.push(j),j=t.charAt(E),B.test(j)?E++:(j=n,I===0&&$e(xe));else H=n;return H!==n?L=t.substring(L,E):L=H,I--,L===n&&(H=n,I===0&&$e(Te)),L}function Na(){var L,H,j;for(I++,L=E,H=[],j=t.charAt(E),S.test(j)?E++:(j=n,I===0&&$e(Re));j!==n;)H.push(j),j=t.charAt(E),S.test(j)?E++:(j=n,I===0&&$e(Re));return L=t.substring(L,E),I--,H=n,I===0&&$e(le),L}function Es(){var L,H,j;return L=E,H=qr(),ye(),j=oe(),j===n&&(j=null),ye(),L=Pe(H,j),L}function qr(){var L,H,j,ge;for(L=E,H=ce(),H===n&&(H=null),j=[],ge=Mi();ge!==n;)j.push(ge),ge=Mi();return L=je(H,j),L}function Mi(){var L,H,j,ge,De,Ye,xt,pt;if(L=E,ye(),Ba(),ye(),H=T(),H!==n){for(j=Y(),j===n&&(j=null),ge=[],De=pe();De!==n;)ge.push(De),De=pe();for(De=ye(),Ye=ce(),Ye===n&&(Ye=null),xt=[],pt=D();pt!==n;)xt.push(pt),pt=D();L=Ae(H,j,ge,Ye,xt)}else E=L,L=n;return L}function Ba(){var L,H,j,ge,De,Ye;for(I++,L=E,H=[],j=t.charAt(E),k.test(j)?E++:(j=n,I===0&&$e(ae));j!==n;)H.push(j),j=t.charAt(E),k.test(j)?E++:(j=n,I===0&&$e(ae));if(t.charCodeAt(E)===46?(j=d,E++):(j=n,I===0&&$e(Me)),j!==n){for(ge=ye(),De=[],Ye=t.charAt(E),U.test(Ye)?E++:(Ye=n,I===0&&$e(ze));Ye!==n;)De.push(Ye),Ye=t.charAt(E),U.test(Ye)?E++:(Ye=n,I===0&&$e(ze));H=[H,j,ge,De],L=H}else E=L,L=n;return I--,L===n&&(H=n,I===0&&$e(Q)),L}function T(){var L,H,j,ge,De,Ye;if(I++,L=E,H=E,t.substr(E,5)===h?(j=h,E+=5):(j=n,I===0&&$e(ke)),j===n&&(t.substr(E,3)===f?(j=f,E+=3):(j=n,I===0&&$e(Ge)),j===n&&(t.substr(E,5)===p?(j=p,E+=5):(j=n,I===0&&$e(Oe)),j===n&&(t.substr(E,3)===m?(j=m,E+=3):(j=n,I===0&&$e(Ve)),j===n))))if(j=E,ge=t.charAt(E),B.test(ge)?E++:(ge=n,I===0&&$e(xe)),ge!==n){if(De=[],Ye=t.charAt(E),O.test(Ye)?E++:(Ye=n,I===0&&$e(Ze)),Ye!==n)for(;Ye!==n;)De.push(Ye),Ye=t.charAt(E),O.test(Ye)?E++:(Ye=n,I===0&&$e(Ze));else De=n;De!==n?(ge=[ge,De],j=ge):(E=j,j=n)}else E=j,j=n;return j!==n?(ge=t.charAt(E),X.test(ge)?E++:(ge=n,I===0&&$e(Ue)),ge===n&&(ge=null),j=[j,ge],H=j):(E=H,H=n),H!==n?L=t.substring(L,E):L=H,I--,L===n&&(H=n,I===0&&$e(se)),L}function Y(){var L,H,j;for(I++,L=E,H=[],j=t.charAt(E),K.test(j)?E++:(j=n,I===0&&$e(z));j!==n;)H.push(j),H.length>=2?j=n:(j=t.charAt(E),K.test(j)?E++:(j=n,I===0&&$e(z)));return H.length<1?(E=L,L=n):L=H,I--,L===n&&(H=n,I===0&&$e(tt)),L}function pe(){var L,H,j,ge,De;if(I++,L=E,ye(),t.charCodeAt(E)===36?(H=y,E++):(H=n,I===0&&$e(Xe)),H!==n){if(j=E,ge=[],De=t.charAt(E),k.test(De)?E++:(De=n,I===0&&$e(ae)),De!==n)for(;De!==n;)ge.push(De),De=t.charAt(E),k.test(De)?E++:(De=n,I===0&&$e(ae));else ge=n;ge!==n?j=t.substring(j,E):j=ge,j!==n?L=fe(j):(E=L,L=n)}else E=L,L=n;return I--,L===n&&I===0&&$e(ht),L}function ce(){var L;return L=te(),L===n&&(L=We()),L}function te(){var L,H,j,ge,De;if(I++,L=E,t.charCodeAt(E)===123?(H=x,E++):(H=n,I===0&&$e(ee)),H!==n){for(j=E,ge=[],De=t.charAt(E),$.test(De)?E++:(De=n,I===0&&$e(P));De!==n;)ge.push(De),De=t.charAt(E),$.test(De)?E++:(De=n,I===0&&$e(P));j=t.substring(j,E),t.charCodeAt(E)===125?(ge=g,E++):(ge=n,I===0&&$e(_)),ge!==n?L=Fe(j):(E=L,L=n)}else E=L,L=n;return I--,L===n&&(H=n,I===0&&$e(Je)),L}function We(){var L,H,j,ge,De;if(I++,L=E,t.charCodeAt(E)===59?(H=u,E++):(H=n,I===0&&$e(M)),H!==n){for(j=E,ge=[],De=t.charAt(E),q.test(De)?E++:(De=n,I===0&&$e(_e));De!==n;)ge.push(De),De=t.charAt(E),q.test(De)?E++:(De=n,I===0&&$e(_e));j=t.substring(j,E),L=nt(j)}else E=L,L=n;return I--,L===n&&(H=n,I===0&&$e(W)),L}function D(){var L,H,j,ge;return I++,L=E,ye(),t.charCodeAt(E)===40?(H=v,E++):(H=n,I===0&&$e(Ie)),H!==n?(j=qr(),j!==n?(ye(),t.charCodeAt(E)===41?(ge=b,E++):(ge=n,I===0&&$e(ie)),ge!==n?L=yt(j):(E=L,L=n)):(E=L,L=n)):(E=L,L=n),I--,L===n&&I===0&&$e(ne),L}function oe(){var L,H,j;return I++,L=E,t.substr(E,3)===w?(H=w,E+=3):(H=n,I===0&&$e(we)),H===n&&(t.substr(E,3)===R?(H=R,E+=3):(H=n,I===0&&$e(ve)),H===n&&(t.substr(E,7)===C?(H=C,E+=7):(H=n,I===0&&$e(Ee)),H===n&&(t.charCodeAt(E)===42?(H=A,E++):(H=n,I===0&&$e(he))))),H!==n?(ye(),j=ce(),j===n&&(j=null),L=mt(H,j)):(E=L,L=n),I--,L===n&&(H=n,I===0&&$e(Se)),L}function ye(){var L,H;for(I++,L=[],H=t.charAt(E),J.test(H)?E++:(H=n,I===0&&$e(me));H!==n;)L.push(H),H=t.charAt(E),J.test(H)?E++:(H=n,I===0&&$e(me));return I--,H=n,I===0&&$e(Z),L}if(St=s(),e.peg$library)return{peg$result:St,peg$currPos:E,peg$FAILED:n,peg$maxFailExpected:at,peg$maxFailPos:qe};if(St!==n&&E===t.length)return St;throw St!==n&&E<t.length&&$e(Ft()),dr(at,qe<t.length?t.charAt(qe):null,qe<t.length?di(qe,qe+1):di(qe,qe))}/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const Yl=0xffffffffffffffffn;function Bd(t,e){return(t<<e|t>>64n-e)&0xffffffffffffffffn}function Om(t,e){return t*e&Yl}function Zb(t){return function(){let e=BigInt(t&Yl),n=BigInt(t>>64n&Yl);const i=Om(Bd(Om(e,5n),7n),9n);return n^=e,e=(Bd(e,24n)^n^n<<16n)&Yl,n=Bd(n,37n),t=n<<64n|e,i}}const Jc=Zb(0xa187eb39cdcaed8f31c4b365b102e01en),Jb=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>Jc()))),e2=Array.from({length:8},()=>Jc()),t2=Array.from({length:16},()=>Jc()),Id=Jc(),pn="w",Vn="b",Kt="p",ph="n",Zl="b",to="r",kr="q",$t="k",Dd="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class dl{constructor(e,n){Dt(this,"color");Dt(this,"from");Dt(this,"to");Dt(this,"piece");Dt(this,"captured");Dt(this,"promotion");Dt(this,"flags");Dt(this,"san");Dt(this,"lan");Dt(this,"before");Dt(this,"after");const{color:i,piece:r,from:s,to:a,flags:l,captured:c,promotion:d}=n,h=tn(s),f=tn(a);this.color=i,this.piece=r,this.from=h,this.to=f,this.san=e._moveToSan(n,e._moves({legal:!0})),this.lan=h+f,this.before=e.fen(),e._makeMove(n),this.after=e.fen(),e._undoMove(),this.flags="";for(const p in ot)ot[p]&l&&(this.flags+=Xr[p]);c&&(this.captured=c),d&&(this.promotion=d,this.lan+=d)}isCapture(){return this.flags.indexOf(Xr.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(Xr.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(Xr.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(Xr.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(Xr.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(Xr.BIG_PAWN)>-1}}const sn=-1,Xr={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},ot={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},mh={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},n2={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},i2={...mh,...n2},st={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},Ld={b:[16,32,17,15],w:[-16,-32,-17,-15]},zm={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},r2=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],s2=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],a2={p:1,n:2,b:4,r:8,q:16,k:32},o2="pnbrqkPNBRQK",jm=[ph,Zl,to,kr],l2=7,c2=6,d2=1,u2=0,ul={[$t]:ot.KSIDE_CASTLE,[kr]:ot.QSIDE_CASTLE},fr={w:[{square:st.a1,flag:ot.QSIDE_CASTLE},{square:st.h1,flag:ot.KSIDE_CASTLE}],b:[{square:st.a8,flag:ot.QSIDE_CASTLE},{square:st.h8,flag:ot.KSIDE_CASTLE}]},h2={b:d2,w:c2},Fd="--";function ms(t){return t>>4}function No(t){return t&15}function wy(t){return"0123456789".indexOf(t)!==-1}function tn(t){const e=No(t),n=ms(t);return"abcdefgh".substring(e,e+1)+"87654321".substring(n,n+1)}function Ga(t){return t===pn?Vn:pn}function f2(t){const e=t.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const n=parseInt(e[5],10);if(isNaN(n)||n<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const i=parseInt(e[4],10);if(isNaN(i)||i<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const r=e[0].split("/");if(r.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let a=0;a<r.length;a++){let l=0,c=!1;for(let d=0;d<r[a].length;d++)if(wy(r[a][d])){if(c)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};l+=parseInt(r[a][d],10),c=!0}else{if(!/^[prnbqkPRNBQK]$/.test(r[a][d]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};l+=1,c=!1}if(l!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const s=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:a,regex:l}of s){if(!l.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${a} king`};if((e[0].match(l)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${a} kings`}}return Array.from(r[0]+r[7]).some(a=>a.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function p2(t,e){const n=t.from,i=t.to,r=t.piece;let s=0,a=0,l=0;for(let c=0,d=e.length;c<d;c++){const h=e[c].from,f=e[c].to,p=e[c].piece;r===p&&n!==h&&i===f&&(s++,ms(n)===ms(h)&&a++,No(n)===No(h)&&l++)}return s>0?a>0&&l>0?tn(n):l>0?tn(n).charAt(1):tn(n).charAt(0):""}function pr(t,e,n,i,r,s=void 0,a=ot.NORMAL){const l=ms(i);if(r===Kt&&(l===l2||l===u2))for(let c=0;c<jm.length;c++){const d=jm[c];t.push({color:e,from:n,to:i,piece:r,captured:s,promotion:d,flags:a|ot.PROMOTION})}else t.push({color:e,from:n,to:i,piece:r,captured:s,flags:a})}function Wm(t){let e=t.charAt(0);return e>="a"&&e<="h"?t.match(/[a-h]\d.*[a-h]\d/)?void 0:Kt:(e=e.toLowerCase(),e==="o"?$t:e)}function Ud(t){return t.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class Bt{constructor(e=Dd,{skipValidation:n=!1}={}){Dt(this,"_board",new Array(128));Dt(this,"_turn",pn);Dt(this,"_header",{});Dt(this,"_kings",{w:sn,b:sn});Dt(this,"_epSquare",-1);Dt(this,"_halfMoves",0);Dt(this,"_moveNumber",0);Dt(this,"_history",[]);Dt(this,"_comments",{});Dt(this,"_castling",{w:0,b:0});Dt(this,"_hash",0n);Dt(this,"_positionCount",new Map);this.load(e,{skipValidation:n})}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:sn,b:sn},this._turn=pn,this._castling={w:0,b:0},this._epSquare=sn,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{...i2},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(e,{skipValidation:n=!1,preserveHeaders:i=!1}={}){let r=e.split(/\s+/);if(r.length>=2&&r.length<6){const l=["-","-","0","1"];e=r.concat(l.slice(-(6-r.length))).join(" ")}if(r=e.split(/\s+/),!n){const{ok:l,error:c}=f2(e);if(!l)throw new Error(c)}const s=r[0];let a=0;this.clear({preserveHeaders:i});for(let l=0;l<s.length;l++){const c=s.charAt(l);if(c==="/")a+=8;else if(wy(c))a+=parseInt(c,10);else{const d=c<"a"?pn:Vn;this._put({type:c.toLowerCase(),color:d},tn(a)),a++}}this._turn=r[1],r[2].indexOf("K")>-1&&(this._castling.w|=ot.KSIDE_CASTLE),r[2].indexOf("Q")>-1&&(this._castling.w|=ot.QSIDE_CASTLE),r[2].indexOf("k")>-1&&(this._castling.b|=ot.KSIDE_CASTLE),r[2].indexOf("q")>-1&&(this._castling.b|=ot.QSIDE_CASTLE),this._epSquare=r[3]==="-"?sn:st[r[3]],this._halfMoves=parseInt(r[4],10),this._moveNumber=parseInt(r[5],10),this._hash=this._computeHash(),this._updateSetup(e),this._incPositionCount()}fen({forceEnpassantSquare:e=!1}={}){var a,l;let n=0,i="";for(let c=st.a8;c<=st.h1;c++){if(this._board[c]){n>0&&(i+=n,n=0);const{color:d,type:h}=this._board[c];i+=d===pn?h.toUpperCase():h.toLowerCase()}else n++;c+1&136&&(n>0&&(i+=n),c!==st.h1&&(i+="/"),n=0,c+=8)}let r="";this._castling[pn]&ot.KSIDE_CASTLE&&(r+="K"),this._castling[pn]&ot.QSIDE_CASTLE&&(r+="Q"),this._castling[Vn]&ot.KSIDE_CASTLE&&(r+="k"),this._castling[Vn]&ot.QSIDE_CASTLE&&(r+="q"),r=r||"-";let s="-";if(this._epSquare!==sn)if(e)s=tn(this._epSquare);else{const c=this._epSquare+(this._turn===pn?16:-16),d=[c+1,c-1];for(const h of d){if(h&136)continue;const f=this._turn;if(((a=this._board[h])==null?void 0:a.color)===f&&((l=this._board[h])==null?void 0:l.type)===Kt){this._makeMove({color:f,from:h,to:this._epSquare,piece:Kt,captured:Kt,flags:ot.EP_CAPTURE});const p=!this._isKingAttacked(f);if(this._undoMove(),p){s=tn(this._epSquare);break}}}}return[i,this._turn,r,s,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(e){if(!this._board[e])return 0n;const{color:n,type:i}=this._board[e],r={w:0,b:1}[n],s={p:0,n:1,b:2,r:3,q:4,k:5}[i];return Jb[r][s][e]}_epKey(){return this._epSquare===sn?0n:e2[this._epSquare&7]}_castlingKey(){const e=this._castling.w>>5|this._castling.b>>3;return t2[e]}_computeHash(){let e=0n;for(let n=st.a8;n<=st.h1;n++){if(n&136){n+=7;continue}this._board[n]&&(e^=this._pieceKey(n))}return e^=this._epKey(),e^=this._castlingKey(),this._turn==="b"&&(e^=Id),e}_updateSetup(e){this._history.length>0||(e!==Dd?(this._header.SetUp="1",this._header.FEN=e):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(Dd)}get(e){return this._board[st[e]]}findPiece(e){var i;const n=[];for(let r=st.a8;r<=st.h1;r++){if(r&136){r+=7;continue}!this._board[r]||((i=this._board[r])==null?void 0:i.color)!==e.color||this._board[r].color===e.color&&this._board[r].type===e.type&&n.push(tn(r))}return n}put({type:e,color:n},i){return this._put({type:e,color:n},i)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(e,n){this._hash^=this._pieceKey(e),this._board[e]=n,this._hash^=this._pieceKey(e)}_put({type:e,color:n},i){if(o2.indexOf(e.toLowerCase())===-1||!(i in st))return!1;const r=st[i];if(e==$t&&!(this._kings[n]==sn||this._kings[n]==r))return!1;const s=this._board[r];return s&&s.type===$t&&(this._kings[s.color]=sn),this._set(r,{type:e,color:n}),e===$t&&(this._kings[n]=r),!0}_clear(e){this._hash^=this._pieceKey(e),delete this._board[e]}remove(e){const n=this.get(e);return this._clear(st[e]),n&&n.type===$t&&(this._kings[n.color]=sn),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),n}_updateCastlingRights(){var i,r,s,a,l,c,d,h,f,p,m,y;this._hash^=this._castlingKey();const e=((i=this._board[st.e1])==null?void 0:i.type)===$t&&((r=this._board[st.e1])==null?void 0:r.color)===pn,n=((s=this._board[st.e8])==null?void 0:s.type)===$t&&((a=this._board[st.e8])==null?void 0:a.color)===Vn;(!e||((l=this._board[st.a1])==null?void 0:l.type)!==to||((c=this._board[st.a1])==null?void 0:c.color)!==pn)&&(this._castling.w&=-65),(!e||((d=this._board[st.h1])==null?void 0:d.type)!==to||((h=this._board[st.h1])==null?void 0:h.color)!==pn)&&(this._castling.w&=-33),(!n||((f=this._board[st.a8])==null?void 0:f.type)!==to||((p=this._board[st.a8])==null?void 0:p.color)!==Vn)&&(this._castling.b&=-65),(!n||((m=this._board[st.h8])==null?void 0:m.type)!==to||((y=this._board[st.h8])==null?void 0:y.color)!==Vn)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){var s,a;if(this._epSquare===sn)return;const e=this._epSquare+(this._turn===pn?-16:16),n=this._epSquare+(this._turn===pn?16:-16),i=[n+1,n-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||((s=this._board[n])==null?void 0:s.color)!==Ga(this._turn)||((a=this._board[n])==null?void 0:a.type)!==Kt){this._hash^=this._epKey(),this._epSquare=sn;return}const r=l=>{var c,d;return!(l&136)&&((c=this._board[l])==null?void 0:c.color)===this._turn&&((d=this._board[l])==null?void 0:d.type)===Kt};i.some(r)||(this._hash^=this._epKey(),this._epSquare=sn)}_attacked(e,n,i){const r=[];for(let s=st.a8;s<=st.h1;s++){if(s&136){s+=7;continue}if(this._board[s]===void 0||this._board[s].color!==e)continue;const a=this._board[s],l=s-n;if(l===0)continue;const c=l+119;if(r2[c]&a2[a.type]){if(a.type===Kt){if(l>0&&a.color===pn||l<=0&&a.color===Vn)if(i)r.push(tn(s));else return!0;continue}if(a.type==="n"||a.type==="k")if(i){r.push(tn(s));continue}else return!0;const d=s2[c];let h=s+d,f=!1;for(;h!==n;){if(this._board[h]!=null){f=!0;break}h+=d}if(!f)if(i){r.push(tn(s));continue}else return!0}}return i?r:!1}attackers(e,n){return n?this._attacked(n,st[e],!0):this._attacked(this._turn,st[e],!0)}_isKingAttacked(e){const n=this._kings[e];return n===-1?!1:this._attacked(Ga(e),n)}hash(){return this._hash.toString(16)}isAttacked(e,n){return this._attacked(n,st[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},n=[];let i=0,r=0;for(let s=st.a8;s<=st.h1;s++){if(r=(r+1)%2,s&136){s+=7;continue}const a=this._board[s];a&&(e[a.type]=a.type in e?e[a.type]+1:1,a.type===Zl&&n.push(r),i++)}if(i===2)return!0;if(i===3&&(e[Zl]===1||e[ph]===1))return!0;if(i===e[Zl]+2){let s=0;const a=n.length;for(let l=0;l<a;l++)s+=n[l];if(s===0||s===a)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:e=!1,square:n=void 0,piece:i=void 0}={}){const r=this._moves({square:n,piece:i});return e?r.map(s=>new dl(this,s)):r.map(s=>this._moveToSan(s,r))}_moves({legal:e=!0,piece:n=void 0,square:i=void 0}={}){var m;const r=i?i.toLowerCase():void 0,s=n==null?void 0:n.toLowerCase(),a=[],l=this._turn,c=Ga(l);let d=st.a8,h=st.h1,f=!1;if(r)if(r in st)d=h=st[r],f=!0;else return[];for(let y=d;y<=h;y++){if(y&136){y+=7;continue}if(!this._board[y]||this._board[y].color===c)continue;const{type:x}=this._board[y];let g;if(x===Kt){if(s&&s!==x)continue;g=y+Ld[l][0],this._board[g]||(pr(a,l,y,g,Kt),g=y+Ld[l][1],h2[l]===ms(y)&&!this._board[g]&&pr(a,l,y,g,Kt,void 0,ot.BIG_PAWN));for(let u=2;u<4;u++)g=y+Ld[l][u],!(g&136)&&(((m=this._board[g])==null?void 0:m.color)===c?pr(a,l,y,g,Kt,this._board[g].type,ot.CAPTURE):g===this._epSquare&&pr(a,l,y,g,Kt,Kt,ot.EP_CAPTURE))}else{if(s&&s!==x)continue;for(let u=0,v=zm[x].length;u<v;u++){const b=zm[x][u];for(g=y;g+=b,!(g&136);){if(!this._board[g])pr(a,l,y,g,x);else{if(this._board[g].color===l)break;pr(a,l,y,g,x,this._board[g].type,ot.CAPTURE);break}if(x===ph||x===$t)break}}}}if((s===void 0||s===$t)&&(!f||h===this._kings[l])){if(this._castling[l]&ot.KSIDE_CASTLE){const y=this._kings[l],x=y+2;!this._board[y+1]&&!this._board[x]&&!this._attacked(c,this._kings[l])&&!this._attacked(c,y+1)&&!this._attacked(c,x)&&pr(a,l,this._kings[l],x,$t,void 0,ot.KSIDE_CASTLE)}if(this._castling[l]&ot.QSIDE_CASTLE){const y=this._kings[l],x=y-2;!this._board[y-1]&&!this._board[y-2]&&!this._board[y-3]&&!this._attacked(c,this._kings[l])&&!this._attacked(c,y-1)&&!this._attacked(c,x)&&pr(a,l,this._kings[l],x,$t,void 0,ot.QSIDE_CASTLE)}}if(!e||this._kings[l]===-1)return a;const p=[];for(let y=0,x=a.length;y<x;y++)this._makeMove(a[y]),this._isKingAttacked(l)||p.push(a[y]),this._undoMove();return p}move(e,{strict:n=!1}={}){let i=null;if(typeof e=="string")i=this._moveFromSan(e,n);else if(e===null)i=this._moveFromSan(Fd,n);else if(typeof e=="object"){const s=this._moves();for(let a=0,l=s.length;a<l;a++)if(e.from===tn(s[a].from)&&e.to===tn(s[a].to)&&(!("promotion"in s[a])||e.promotion===s[a].promotion)){i=s[a];break}}if(!i)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);if(this.isCheck()&&i.flags&ot.NULL_MOVE)throw new Error("Null move not allowed when in check");const r=new dl(this,i);return this._makeMove(i),this._incPositionCount(),r}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(e,n){this._hash^=this._pieceKey(e),this._board[n]=this._board[e],delete this._board[e],this._hash^=this._pieceKey(n)}_makeMove(e){var r,s,a,l;const n=this._turn,i=Ga(n);if(this._push(e),e.flags&ot.NULL_MOVE){n===Vn&&this._moveNumber++,this._halfMoves++,this._turn=i,this._epSquare=sn;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),e.captured&&(this._hash^=this._pieceKey(e.to)),this._movePiece(e.from,e.to),e.flags&ot.EP_CAPTURE&&(this._turn===Vn?this._clear(e.to-16):this._clear(e.to+16)),e.promotion&&(this._clear(e.to),this._set(e.to,{type:e.promotion,color:n})),this._board[e.to].type===$t){if(this._kings[n]=e.to,e.flags&ot.KSIDE_CASTLE){const c=e.to-1,d=e.to+1;this._movePiece(d,c)}else if(e.flags&ot.QSIDE_CASTLE){const c=e.to+1,d=e.to-2;this._movePiece(d,c)}this._castling[n]=0}if(this._castling[n]){for(let c=0,d=fr[n].length;c<d;c++)if(e.from===fr[n][c].square&&this._castling[n]&fr[n][c].flag){this._castling[n]^=fr[n][c].flag;break}}if(this._castling[i]){for(let c=0,d=fr[i].length;c<d;c++)if(e.to===fr[i][c].square&&this._castling[i]&fr[i][c].flag){this._castling[i]^=fr[i][c].flag;break}}if(this._hash^=this._castlingKey(),e.flags&ot.BIG_PAWN){let c;n===Vn?c=e.to-16:c=e.to+16,!(e.to-1&136)&&((r=this._board[e.to-1])==null?void 0:r.type)===Kt&&((s=this._board[e.to-1])==null?void 0:s.color)===i||!(e.to+1&136)&&((a=this._board[e.to+1])==null?void 0:a.type)===Kt&&((l=this._board[e.to+1])==null?void 0:l.color)===i?(this._epSquare=c,this._hash^=this._epKey()):this._epSquare=sn}else this._epSquare=sn;e.piece===Kt?this._halfMoves=0:e.flags&(ot.CAPTURE|ot.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,n===Vn&&this._moveNumber++,this._turn=i,this._hash^=Id}undo(){const e=this._hash,n=this._undoMove();if(n){const i=new dl(this,n);return this._decPositionCount(e),i}return null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const n=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=Id;const i=this._turn,r=Ga(i);if(n.flags&ot.NULL_MOVE)return n;if(this._movePiece(n.to,n.from),n.piece&&(this._clear(n.from),this._set(n.from,{type:n.piece,color:i})),n.captured)if(n.flags&ot.EP_CAPTURE){let s;i===Vn?s=n.to-16:s=n.to+16,this._set(s,{type:Kt,color:r})}else this._set(n.to,{type:n.captured,color:r});if(n.flags&(ot.KSIDE_CASTLE|ot.QSIDE_CASTLE)){let s,a;n.flags&ot.KSIDE_CASTLE?(s=n.to+1,a=n.to-1):(s=n.to-2,a=n.to+1),this._movePiece(a,s)}return n}pgn({newline:e=`
`,maxWidth:n=0}={}){const i=[];let r=!1;for(const p in this._header)this._header[p]&&i.push(`[${p} "${this._header[p]}"]`+e),r=!0;r&&this._history.length&&i.push(e);const s=p=>{const m=this._comments[this.fen()];if(typeof m<"u"){const y=p.length>0?" ":"";p=`${p}${y}{${m}}`}return p},a=[];for(;this._history.length>0;)a.push(this._undoMove());const l=[];let c="";for(a.length===0&&l.push(s(""));a.length>0;){c=s(c);const p=a.pop();if(!p)break;if(!this._history.length&&p.color==="b"){const m=`${this._moveNumber}. ...`;c=c?`${c} ${m}`:m}else p.color==="w"&&(c.length&&l.push(c),c=this._moveNumber+".");c=c+" "+this._moveToSan(p,this._moves({legal:!0})),this._makeMove(p)}if(c.length&&l.push(s(c)),l.push(this._header.Result||"*"),n===0)return i.join("")+l.join(" ");const d=function(){return i.length>0&&i[i.length-1]===" "?(i.pop(),!0):!1},h=function(p,m){for(const y of m.split(" "))if(y){if(p+y.length>n){for(;d();)p--;i.push(e),p=0}i.push(y),p+=y.length,i.push(" "),p++}return d()&&p--,p};let f=0;for(let p=0;p<l.length;p++){if(f+l[p].length>n&&l[p].includes("{")){f=h(f,l[p]);continue}f+l[p].length>n&&p!==0?(i[i.length-1]===" "&&i.pop(),i.push(e),f=0):p!==0&&(i.push(" "),f++),i.push(l[p]),f+=l[p].length}return i.join("")}header(...e){for(let n=0;n<e.length;n+=2)typeof e[n]=="string"&&typeof e[n+1]=="string"&&(this._header[e[n]]=e[n+1]);return this._header}setHeader(e,n){return this._header[e]=n??mh[e]??null,this.getHeaders()}removeHeader(e){return e in this._header?(this._header[e]=mh[e]||null,!0):!1}getHeaders(){const e={};for(const[n,i]of Object.entries(this._header))i!==null&&(e[n]=i);return e}loadPgn(e,{strict:n=!1,newlineChar:i=`\r?
`}={}){i!==`\r?
`&&(e=e.replace(new RegExp(i,"g"),`
`));const r=Yb(e);this.reset();const s=r.headers;let a="";for(const d in s)d.toLowerCase()==="fen"&&(a=s[d]),this.header(d,s[d]);if(!n)a&&this.load(a,{preserveHeaders:!0});else if(s.SetUp==="1"){if(!("FEN"in s))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(s.FEN,{preserveHeaders:!0})}let l=r.root;for(;l;){if(l.move){const d=this._moveFromSan(l.move,n);if(d==null)throw new Error(`Invalid move in PGN: ${l.move}`);this._makeMove(d),this._incPositionCount()}l.comment!==void 0&&(this._comments[this.fen()]=l.comment),l=l.variations[0]}const c=r.result;c&&Object.keys(this._header).length&&this._header.Result!==c&&this.setHeader("Result",c)}_moveToSan(e,n){let i="";if(e.flags&ot.KSIDE_CASTLE)i="O-O";else if(e.flags&ot.QSIDE_CASTLE)i="O-O-O";else{if(e.flags&ot.NULL_MOVE)return Fd;if(e.piece!==Kt){const r=p2(e,n);i+=e.piece.toUpperCase()+r}e.flags&(ot.CAPTURE|ot.EP_CAPTURE)&&(e.piece===Kt&&(i+=tn(e.from)[0]),i+="x"),i+=tn(e.to),e.promotion&&(i+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?i+="#":i+="+"),this._undoMove(),i}_moveFromSan(e,n=!1){let i=Ud(e);if(n||(i==="0-0"?i="O-O":i==="0-0-0"&&(i="O-O-O")),i==Fd)return{color:this._turn,from:0,to:0,piece:"k",flags:ot.NULL_MOVE};let r=Wm(i),s=this._moves({legal:!0,piece:r});for(let p=0,m=s.length;p<m;p++)if(i===Ud(this._moveToSan(s[p],s)))return s[p];if(n)return null;let a,l,c,d,h,f=!1;if(l=i.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),l?(a=l[1],c=l[2],d=l[3],h=l[4],c.length==1&&(f=!0)):(l=i.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),l&&(a=l[1],c=l[2],d=l[3],h=l[4],c.length==1&&(f=!0))),r=Wm(i),s=this._moves({legal:!0,piece:a||r}),!d)return null;for(let p=0,m=s.length;p<m;p++)if(c){if((!a||a.toLowerCase()==s[p].piece)&&st[c]==s[p].from&&st[d]==s[p].to&&(!h||h.toLowerCase()==s[p].promotion))return s[p];if(f){const y=tn(s[p].from);if((!a||a.toLowerCase()==s[p].piece)&&st[d]==s[p].to&&(c==y[0]||c==y[1])&&(!h||h.toLowerCase()==s[p].promotion))return s[p]}}else if(i===Ud(this._moveToSan(s[p],s)).replace("x",""))return s[p];return null}ascii(){let e=`   +------------------------+
`;for(let n=st.a8;n<=st.h1;n++){if(No(n)===0&&(e+=" "+"87654321"[ms(n)]+" |"),this._board[n]){const i=this._board[n].type,s=this._board[n].color===pn?i.toUpperCase():i.toLowerCase();e+=" "+s+" "}else e+=" . ";n+1&136&&(e+=`|
`,n+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const n=this._moves({legal:!1});let i=0;const r=this._turn;for(let s=0,a=n.length;s<a;s++)this._makeMove(n[s]),this._isKingAttacked(r)||(e-1>0?i+=this.perft(e-1):i++),this._undoMove();return i}setTurn(e){return this._turn==e?!1:(this.move("--"),!0)}turn(){return this._turn}board(){const e=[];let n=[];for(let i=st.a8;i<=st.h1;i++)this._board[i]==null?n.push(null):n.push({square:tn(i),type:this._board[i].type,color:this._board[i].color}),i+1&136&&(e.push(n),n=[],i+=8);return e}squareColor(e){if(e in st){const n=st[e];return(ms(n)+No(n))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const n=[],i=[];for(;this._history.length>0;)n.push(this._undoMove());for(;;){const r=n.pop();if(!r)break;e?i.push(new dl(this,r)):i.push(this._moveToSan(r,this._moves())),this._makeMove(r)}return i}_getPositionCount(e){return this._positionCount.get(e)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(e){const n=this._positionCount.get(e)??0;n===1?this._positionCount.delete(e):this._positionCount.set(e,n-1)}_pruneComments(){const e=[],n={},i=r=>{r in this._comments&&(n[r]=this._comments[r])};for(;this._history.length>0;)e.push(this._undoMove());for(i(this.fen());;){const r=e.pop();if(!r)break;this._makeMove(r),i(this.fen())}this._comments=n}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const n=this._comments[e];return delete this._comments[e],{fen:e,comment:n}})}setCastlingRights(e,n){for(const r of[$t,kr])n[r]!==void 0&&(n[r]?this._castling[e]|=ul[r]:this._castling[e]&=~ul[r]);this._updateCastlingRights();const i=this.getCastlingRights(e);return(n[$t]===void 0||n[$t]===i[$t])&&(n[kr]===void 0||n[kr]===i[kr])}getCastlingRights(e){return{[$t]:(this._castling[e]&ul[$t])!==0,[kr]:(this._castling[e]&ul[kr])!==0}}moveNumber(){return this._moveNumber}}const gh=["a","b","c","d","e","f","g","h"],m2={wK:"https://lichess1.org/assets/_gefPZv/piece/cburnett/wK.svg",wQ:"https://lichess1.org/assets/_gefPZv/piece/cburnett/wQ.svg",wR:"https://lichess1.org/assets/_gefPZv/piece/cburnett/wR.svg",wB:"https://lichess1.org/assets/_gefPZv/piece/cburnett/wB.svg",wN:"https://lichess1.org/assets/_gefPZv/piece/cburnett/wN.svg",wP:"https://lichess1.org/assets/_gefPZv/piece/cburnett/wP.svg",bK:"https://lichess1.org/assets/_gefPZv/piece/cburnett/bK.svg",bQ:"https://lichess1.org/assets/_gefPZv/piece/cburnett/bQ.svg",bR:"https://lichess1.org/assets/_gefPZv/piece/cburnett/bR.svg",bB:"https://lichess1.org/assets/_gefPZv/piece/cburnett/bB.svg",bN:"https://lichess1.org/assets/_gefPZv/piece/cburnett/bN.svg",bP:"https://lichess1.org/assets/_gefPZv/piece/cburnett/bP.svg"};function g2(t){if(!t)return null;const e=t.color+t.type.toUpperCase();return m2[e]||null}function Gm(t,e){const n=gh[e],i=8-t;return`${n}${i}`}function Gr({chess:t,fen:e,orientation:n="w",interactive:i=!1,onMove:r=null,lastMove:s=null,disabled:a=!1,size:l=480}){var A;const[c]=N.useState(()=>new Bt),d=N.useMemo(()=>{if(e){try{c.load(e)}catch{}return c}return t||c},[e,t,c]),[h,f]=N.useState(null),p=d.board(),m=d.turn(),y=d.inCheck();N.useEffect(()=>{f(null)},[e,(A=t==null?void 0:t.fen)==null?void 0:A.call(t)]);const x=N.useMemo(()=>{if(!h||!i||a)return[];try{return d.moves({square:h,verbose:!0})}catch{return[]}},[d,h,i,a,e]),g=N.useMemo(()=>new Set(x.map(B=>B.to)),[x]),u=N.useMemo(()=>{if(!y)return null;for(let B=0;B<8;B++)for(let S=0;S<8;S++){const k=p[B][S];if(k&&k.type==="k"&&k.color===m)return Gm(B,S)}return null},[p,m,y]),v=N.useCallback(B=>{if(!i||a)return;const S=d.get(B);if(h)if(g.has(B)){const k=x.find(U=>U.to===B);if(k&&r){const U=k.flags.includes("p")?"q":void 0;r({from:h,to:B,promotion:U})}f(null)}else S&&S.color===m?f(B):f(null);else S&&S.color===m&&f(B)},[d,h,g,x,m,i,a,r]),b=l/8,w=()=>{const B=[];for(let S=0;S<8;S++)for(let k=0;k<8;k++){let U,O;n==="w"?(U=S,O=k):(U=7-S,O=7-k);const X=Gm(U,O),K=p[U][O],$=(U+O)%2===0,q=h===X,J=g.has(X),V=s&&(s.from===X||s.to===X),ue=u===X;let F;ue?F="#e57373":q?F="#aed581":V?F=$?"#f7f683":"#baca2b":F=$?"#f0d9b5":"#b58863";const de=g2(K);B.push(o.jsxs("div",{onClick:()=>v(X),style:{width:b,height:b,backgroundColor:F,display:"flex",alignItems:"center",justifyContent:"center",position:"relative",cursor:i&&!a?"pointer":"default",userSelect:"none"},children:[J&&!K&&o.jsx("div",{style:{width:b*.33,height:b*.33,borderRadius:"50%",backgroundColor:"rgba(0,0,0,0.12)"}}),J&&K&&o.jsx("div",{style:{position:"absolute",inset:2,borderRadius:"50%",border:"5px solid rgba(0,0,0,0.12)",pointerEvents:"none"}}),de&&o.jsx("img",{src:de,alt:"",draggable:!1,style:{width:b*.85,height:b*.85,filter:"drop-shadow(1px 2px 3px rgba(0,0,0,0.25))",pointerEvents:"none"}})]},X))}return B},R=n==="w"?gh:[...gh].reverse(),C=n==="w"?["8","7","6","5","4","3","2","1"]:["1","2","3","4","5","6","7","8"];return o.jsxs("div",{style:{display:"inline-block"},children:[o.jsxs("div",{style:{display:"flex"},children:[o.jsx("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-around",paddingRight:8,width:22},children:C.map((B,S)=>o.jsx("div",{style:{height:b,display:"flex",alignItems:"center",justifyContent:"center",fontSize:13,fontWeight:600,color:"rgba(255,255,255,0.5)"},children:B},S))}),o.jsx("div",{style:{width:l,height:l,display:"grid",gridTemplateColumns:`repeat(8, ${b}px)`,gridTemplateRows:`repeat(8, ${b}px)`,borderRadius:6,overflow:"hidden",boxShadow:"0 10px 30px rgba(0,0,0,0.4)"},children:w()})]}),o.jsx("div",{style:{display:"flex",marginLeft:30,width:l},children:R.map((B,S)=>o.jsx("div",{style:{width:b,textAlign:"center",fontSize:13,fontWeight:600,color:"rgba(255,255,255,0.5)",paddingTop:8},children:B},S))})]})}const _a={morphy:{id:"morphy",label:"Paul Morphy",subtitle:"Pride of New Orleans",description:"The original attacking genius. Morphy's chess was about rapid piece development, open lines, and relentless pressure on f7. He'd sacrifice anything for a lead in development, then deliver mate with shocking elegance.",era:"18371884",peakRating:"~2700 (estimated)",avatar:"",skillLevel:16,moveTimeMs:100,style:"romantic-attack",traits:["Rapid development","Open games","King hunts","Piece sacrifices"],weaknesses:["Closed positions","Modern defensive technique"],famousGames:["Opera Game vs Duke & Count (1858)","vs Paulsen - The Immortal Morphy Game (1857)"],quote:"Help your pieces so they can help you."},steinitz:{id:"steinitz",label:"Wilhelm Steinitz",subtitle:"Father of Modern Chess",description:"The first official World Champion who revolutionized chess theory. Steinitz proved that accumulating small advantages beats romantic sacrifices. He'd accept gambits, defend stubbornly, then win in the endgame.",era:"18361900",peakRating:"~2650 (estimated)",avatar:"",skillLevel:15,moveTimeMs:300,style:"scientific-positional",traits:["Pawn structure expert","Defensive technique","Endgame mastery","Theory pioneer"],weaknesses:["Sometimes too passive","Aging affected later games"],famousGames:["vs Zukertort, World Championship (1886)","vs Blackburne, London (1876)"],quote:"The king is a fighting piece. Use it!"},capablanca:{id:"capablanca",label:"Jos Ral Capablanca",subtitle:"The Chess Machine",description:"Natural genius who made chess look effortless. Capablanca's style was crystal-clear logic and flawless endgame technique. He rarely calculated deeply because his intuition was almost always right. Lost only 34 serious games in his career.",era:"18881942",peakRating:"~2725 (estimated)",avatar:"",skillLevel:18,moveTimeMs:150,style:"classical-simple",traits:["Endgame perfection","Simple clarity","Natural talent","Few mistakes"],weaknesses:["Opening preparation","Sometimes underestimated opponents"],famousGames:["vs Marshall - Immortal Capablanca Game (1918)","vs Tartakower, New York (1924)"],quote:"A good player is always lucky."},alekhine:{id:"alekhine",label:"Alexander Alekhine",subtitle:"The Sadist of Chess",description:"Ferocious attacker with bottomless tactical depth. Alekhine combined romantic attacking flair with modern positional understanding. He'd lure opponents into complications, then unleash devastating combinations they never saw coming.",era:"18921946",peakRating:"~2750 (estimated)",avatar:"",skillLevel:18,moveTimeMs:200,style:"dynamic-universal",traits:["Deep calculation","Attacking combinations","Opening innovation","Fighting spirit"],weaknesses:["Alcohol affected later career","Sometimes over-complicated"],famousGames:["vs Rti - Alekhine's Immortal (1925)","vs Capablanca, WCC Game 34 (1927)"],quote:"I think, therefore I blunder."},botvinnik:{id:"botvinnik",label:"Mikhail Botvinnik",subtitle:"The Patriarch",description:"The father of Soviet chess school. Botvinnik approached chess scientifically - deep preparation, iron discipline, and systematic improvement. He trained Kasparov, Karpov, and Kramnik. A machine before computers existed.",era:"19111995",peakRating:"2630",avatar:"",skillLevel:17,moveTimeMs:350,style:"scientific-strategic",traits:["Opening preparation","Self-analysis","Mental toughness","Strategic depth"],weaknesses:["Vulnerable to anti-positional play","Struggled vs unorthodox styles"],famousGames:["vs Capablanca, AVRO (1938)","vs Fischer, Varna Olympiad (1962)"],quote:"Chess is the art of analysis."},tal:{id:"tal",label:"Mikhail Tal",subtitle:"The Magician from Riga",description:"The greatest attacking player ever. Tal sacrificed pieces with abandon, often unsoundly, but his opponents cracked under the pressure. He once said the purpose of sacrifices is to make the opponent uncomfortable. Pure chaos incarnate.",era:"19361992",peakRating:"2705",avatar:"",skillLevel:17,moveTimeMs:80,style:"sacrificial-attack",traits:["Piece sacrifices","Initiative worship","Psychological warfare","Blitz genius"],weaknesses:["Objectively dubious sacrifices","Health issues"],famousGames:["vs Larsen - The Tal Attack (1965)","vs Botvinnik, WCC Game 6 (1960)"],quote:"You must take your opponent into a deep dark forest where 2+2=5, and the path leading out is only wide enough for one."},petrosian:{id:"petrosian",label:"Tigran Petrosian",subtitle:"Iron Tigran",description:"The ultimate defensive player. Petrosian could smell danger 10 moves away and would prevent it before it existed. His prophylactic style frustrated attacking players into submission. The hardest World Champion to beat.",era:"19291984",peakRating:"2655",avatar:"",skillLevel:17,moveTimeMs:400,style:"prophylactic-defensive",traits:["Exchange sacrifices","Prophylaxis master","Positional fortress","Draw artist"],weaknesses:["Sometimes too passive","Struggled to win against solid defense"],famousGames:["vs Reshevsky, Zurich (1953)","vs Spassky, WCC (1966)"],quote:"Some sacrifices are sound; the rest are mine."},fischer:{id:"fischer",label:"Bobby Fischer",subtitle:"The American Legend",description:"Perhaps the most complete player ever. Fischer combined concrete calculation, perfect opening preparation, and merciless technique. He crushed the Soviet chess machine single-handedly, winning 20 consecutive games against top GMs.",era:"19432008",peakRating:"2785",avatar:"",skillLevel:19,moveTimeMs:200,style:"universal-perfectionist",traits:["Opening perfection","Endgame technique","Psychological dominance","No draws mentality"],weaknesses:["Paranoia limited career","Struggled with politics"],famousGames:["Game of the Century vs D. Byrne (1956)","vs Spassky, Game 6, Reykjavik (1972)"],quote:"I don't believe in psychology. I believe in good moves."},karpov:{id:"karpov",label:"Anatoly Karpov",subtitle:"The Boa Constrictor",description:"Karpov slowly squeezed opponents to death. His style was prophylactic perfection - restricting counterplay while making tiny improvements until the position collapsed. Won more tournaments than anyone in history.",era:"1951present",peakRating:"2780",avatar:"",skillLevel:19,moveTimeMs:280,style:"prophylactic-positional",traits:["Space control","Piece maneuvering","Restriction","Technical endgames"],weaknesses:["Sharp tactical positions","Time pressure in complex positions"],famousGames:["vs Kasparov, WCC Game 9 (1985)","vs Topalov, Linares (1994)"],quote:"Chess is everything: art, science, and sport."},kasparov:{id:"kasparov",label:"Garry Kasparov",subtitle:"The Beast from Baku",description:"The most dominant champion ever. Kasparov combined unmatched preparation with ferocious attacking play. His opening novelties were nuclear weapons, and his middlegame attacks were relentless. Number 1 for 20 consecutive years.",era:"1963present",peakRating:"2851",avatar:"",skillLevel:20,moveTimeMs:180,style:"dynamic-universal",traits:["Opening preparation","Dynamic attacks","Energy","Computer-like calculation"],weaknesses:["Sometimes overconfident","Emotional in critical moments"],famousGames:["vs Topalov, Wijk aan Zee (1999) - Kasparov's Immortal","vs Karpov, WCC Game 16 (1985)"],quote:"Chess is mental torture."},kramnik:{id:"kramnik",label:"Vladimir Kramnik",subtitle:"The Berlin Wall",description:"The man who dethroned Kasparov without losing a game. Kramnik's style was solid, deep, and practically unbeatable. His Berlin Defense neutralized 1.e4 at the highest level, and his endgame technique was immaculate.",era:"1975present",peakRating:"2817",avatar:"",skillLevel:19,moveTimeMs:320,style:"solid-technical",traits:["Opening solidity","Endgame mastery","Deep strategy","Match player"],weaknesses:["Health issues","Sometimes too drawish"],famousGames:["vs Kasparov, WCC Game 2 (2000)","vs Aronian, Candidates (2018)"],quote:"I play honestly and try to avoid pre-arranged draws."},anand:{id:"anand",label:"Viswanathan Anand",subtitle:"The Lightning Kid",description:"The fastest World Champion. Anand's intuition is legendary - he sees tactics instantly and plays with infectious enthusiasm. A true universal player who adapted his style across decades at the top.",era:"1969present",peakRating:"2817",avatar:"",skillLevel:19,moveTimeMs:120,style:"intuitive-universal",traits:["Speed","Tactical vision","Rapid chess mastery","Adaptability"],weaknesses:["Sometimes plays too fast","Match pressure vs Carlsen"],famousGames:["vs Aronian, Wijk aan Zee (2013)","vs Topalov, WCC Game 4 (2010)"],quote:"I don't play like a girl, I play like a guy who learned chess at 6."},carlsen:{id:"carlsen",label:"Magnus Carlsen",subtitle:"The Mozart of Chess",description:"The highest-rated player in history. Carlsen grinds forever in positions others would draw, finds resources where none exist, and never gives up. His universal style and legendary endgame technique make him nearly unbeatable.",era:"1990present",peakRating:"2882",avatar:"",skillLevel:20,moveTimeMs:300,style:"universal-grinding",traits:["Endgame wizardry","Stamina","Universal openings","Practical play"],weaknesses:["Occasionally loses focus","Bored by too many World Championships"],famousGames:["vs Anand, WCC Game 6 (2013)","vs Caruana, WCC Tiebreaks (2018)"],quote:"Some people think that if their opponent plays a beautiful game, it's OK to lose. I don't."},nakamura:{id:"nakamura",label:"Hikaru Nakamura",subtitle:"The Speed Demon",description:"The King of Blitz. Nakamura's aggressive style and lightning calculation make him the most feared speed chess player alive. His h4-h5 pawn storms and creative attacks have crushed countless opponents online and over the board.",era:"1987present",peakRating:"2816",avatar:"",skillLevel:19,moveTimeMs:100,style:"aggressive-speed",traits:["Blitz dominance","h-pawn attacks","Streaming fame","Fighting spirit"],weaknesses:["Classical vs elite","Sometimes overextends"],famousGames:["vs Carlsen, Zurich (2014)","vs MVL, Speed Chess Championship (2017)"],quote:"I'm too lazy to calculate everything."},caruana:{id:"caruana",label:"Fabiano Caruana",subtitle:"Fabi the Fantastic",description:"The closest challenger to Carlsen's throne. Caruana combines deep preparation with solid technique. His 2014 streak of 7/7 at Sinquefield Cup was one of the greatest tournament performances in history.",era:"1992present",peakRating:"2844",avatar:"",skillLevel:20,moveTimeMs:250,style:"prepared-solid",traits:["Opening preparation","Calculation depth","Consistency","Classical strength"],weaknesses:["Rapid/blitz tiebreaks","Pressure in must-win situations"],famousGames:["vs Carlsen, WCC Game 1 (2018)","Sinquefield Cup 2014 - 7/7 start"],quote:"You have to be prepared to suffer in chess."},firouzja:{id:"firouzja",label:"Alireza Firouzja",subtitle:"The Prodigy",description:"The youngest player to break 2800. Firouzja plays fearless, aggressive chess with a swagger beyond his years. His rapid improvement trajectory suggests a future World Champion.",era:"2003present",peakRating:"2804",avatar:"",skillLevel:19,moveTimeMs:150,style:"fearless-aggressive",traits:["Fearless attacks","Rapid improvement","Youth energy","Creative play"],weaknesses:["Inexperience in long matches","Emotional volatility"],famousGames:["vs Carlsen, Norway Chess (2022)","Grand Swiss 2021 victory"],quote:"I just play chess. I don't think about records."},beginner_bot:{id:"beginner_bot",label:"Friendly Beginner",subtitle:"Just Learning",description:"A beginner-level opponent who makes occasional mistakes. Perfect for new players to practice basic tactics and piece coordination.",era:"Bot",peakRating:"~800",avatar:"",skillLevel:3,moveTimeMs:500,style:"random-basic",traits:["Makes blunders","Misses tactics","Good for learning"],weaknesses:["Everything"],famousGames:[],quote:"Let's have fun!"},intermediate_bot:{id:"intermediate_bot",label:"Club Player",subtitle:"Solid Amateur",description:"A solid club-level player. Knows basic openings, sees simple tactics, but can be outplayed positionally.",era:"Bot",peakRating:"~1400",avatar:"",skillLevel:8,moveTimeMs:400,style:"solid-basic",traits:["Sees basic tactics","Knows openings","Consistent"],weaknesses:["Deep calculation","Complex positions"],famousGames:[],quote:"Chess is a beautiful game."},advanced_bot:{id:"advanced_bot",label:"Tournament Player",subtitle:"Experienced Competitor",description:"A serious tournament player. Strong tactics, good opening knowledge, and solid endgames. Will punish mistakes quickly.",era:"Bot",peakRating:"~1800",avatar:"",skillLevel:12,moveTimeMs:300,style:"tactical-sound",traits:["Strong tactics","Good openings","Punishes errors"],weaknesses:["Elite-level strategy","Very deep calculation"],famousGames:[],quote:"Every game is a battle."},expert_bot:{id:"expert_bot",label:"Expert",subtitle:"Master Candidate",description:"Near-master strength. Excellent in all phases, makes very few mistakes. A real challenge for experienced players.",era:"Bot",peakRating:"~2200",avatar:"",skillLevel:15,moveTimeMs:250,style:"universal-strong",traits:["Few mistakes","Strong all phases","Dangerous"],weaknesses:["Elite GM-level play"],famousGames:[],quote:"Show me what you've got."},master_bot:{id:"master_bot",label:"Master",subtitle:"Titled Player",description:"Master-level play. Deep calculation, excellent intuition, and will crush anything but perfect play. Good luck.",era:"Bot",peakRating:"~2400",avatar:"",skillLevel:17,moveTimeMs:200,style:"precise-deadly",traits:["Deep calculation","Excellent intuition","Crushing attacks"],weaknesses:["Super-GM preparation"],famousGames:[],quote:"Chess mastery takes a lifetime."},grandmaster_bot:{id:"grandmaster_bot",label:"Grandmaster",subtitle:"Elite Level",description:"Full Grandmaster strength. Stockfish at near-maximum power. This is what playing a top-10 player feels like. Bring your A-game.",era:"Bot",peakRating:"~2700",avatar:"",skillLevel:20,moveTimeMs:300,style:"perfect-crushing",traits:["Near-perfect play","Deep preparation","No mercy"],weaknesses:["None at human level"],famousGames:[],quote:"I am silicon. I do not tire."}},ky=["morphy","steinitz","capablanca","alekhine","botvinnik","tal","petrosian","fischer","karpov","kasparov","kramnik","anand","carlsen"],My=["nakamura","caruana","firouzja"],up=["beginner_bot","intermediate_bot","advanced_bot","expert_bot","master_bot","grandmaster_bot"];function x2(){return ky.map(t=>_a[t])}function y2(){return My.map(t=>_a[t])}function v2(){return up.map(t=>_a[t])}function b2({profile:t,selected:e,onSelect:n,compact:i=!1}){var l,c;const r=ky.includes(t.id),s=My.includes(t.id);up.includes(t.id);const a=d=>d<=5?"#4CAF50":d<=10?"#FFC107":d<=15?"#FF9800":"#f44336";return o.jsxs("div",{onClick:()=>n(t.id),style:{padding:i?12:16,borderRadius:12,border:e?"2px solid #4CAF50":"2px solid transparent",background:e?"rgba(76,175,80,0.15)":"rgba(255,255,255,0.05)",cursor:"pointer",transition:"all 0.15s ease",display:"flex",flexDirection:"column",gap:i?6:10},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[o.jsx("span",{style:{fontSize:i?28:36},children:t.avatar}),o.jsxs("div",{style:{flex:1,minWidth:0},children:[o.jsx("div",{style:{fontWeight:700,fontSize:i?14:16},children:t.label}),t.subtitle&&o.jsx("div",{style:{fontSize:11,opacity:.6},children:t.subtitle})]}),o.jsx("div",{style:{width:36,height:36,borderRadius:"50%",background:`${a(t.skillLevel)}22`,border:`2px solid ${a(t.skillLevel)}`,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,fontSize:12,color:a(t.skillLevel)},children:t.skillLevel})]}),!i&&o.jsxs("div",{style:{fontSize:12,opacity:.75,lineHeight:1.5},children:[(l=t.description)==null?void 0:l.slice(0,120),((c=t.description)==null?void 0:c.length)>120?"...":""]}),o.jsxs("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:[t.peakRating&&o.jsx("span",{style:{fontSize:10,padding:"2px 8px",background:r||s?"rgba(255,193,7,0.2)":"rgba(255,255,255,0.1)",borderRadius:10,color:r||s?"#ffc107":"inherit"},children:t.peakRating}),o.jsx("span",{style:{fontSize:10,padding:"2px 8px",background:"rgba(255,255,255,0.1)",borderRadius:10},children:t.style})]})]})}function _2({selectedBotId:t,onSelect:e,onPlay:n}){const[i,r]=N.useState("legends"),s=x2(),a=y2(),l=v2(),c=_a[t],d=[{id:"legends",label:"World Champions",icon:"",count:s.length},{id:"modern",label:"Modern Elite",icon:"",count:a.length},{id:"bots",label:"Practice Bots",icon:"",count:l.length}],h=()=>{switch(i){case"legends":return s;case"modern":return a;case"bots":return l;default:return s}};return o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:20},children:[o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:26,fontWeight:800,marginBottom:6},children:"Choose Your Opponent"}),o.jsx("div",{style:{opacity:.6,fontSize:13},children:"Challenge chess legends or practice against bots of any skill level"})]}),o.jsx("div",{style:{display:"flex",gap:8,borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:12},children:d.map(f=>o.jsxs("button",{onClick:()=>r(f.id),style:{padding:"10px 18px",background:i===f.id?"rgba(76,175,80,0.2)":"transparent",border:i===f.id?"1px solid #4CAF50":"1px solid transparent",borderRadius:8,color:i===f.id?"#4CAF50":"#fff",cursor:"pointer",display:"flex",alignItems:"center",gap:8,fontSize:13,fontWeight:i===f.id?600:400},children:[o.jsx("span",{children:f.icon}),o.jsx("span",{children:f.label}),o.jsx("span",{style:{fontSize:11,opacity:.6,background:"rgba(255,255,255,0.1)",padding:"2px 6px",borderRadius:6},children:f.count})]},f.id))}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:i==="bots"?"repeat(3, 1fr)":"repeat(2, 1fr)",gap:12,maxHeight:420,overflowY:"auto",paddingRight:8},children:h().map(f=>o.jsx(b2,{profile:f,selected:t===f.id,onSelect:e,compact:i==="bots"},f.id))}),o.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:8},children:o.jsxs("button",{onClick:n,disabled:!c,style:{padding:"14px 48px",background:c?"#4CAF50":"#555",color:"white",border:"none",borderRadius:12,fontSize:16,fontWeight:700,cursor:c?"pointer":"default",display:"flex",alignItems:"center",gap:10,transition:"all 0.2s"},children:[c&&o.jsx("span",{style:{fontSize:22},children:c.avatar}),o.jsxs("span",{children:["Play vs ",(c==null?void 0:c.label)??"..."]})]})}),c&&o.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:12,padding:18},children:[o.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:14,marginBottom:12},children:[o.jsx("span",{style:{fontSize:44},children:c.avatar}),o.jsxs("div",{style:{flex:1},children:[o.jsx("div",{style:{fontWeight:700,fontSize:18},children:c.label}),o.jsxs("div",{style:{fontSize:13,opacity:.6,marginBottom:4},children:[c.subtitle,"  ",c.era]}),o.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[c.peakRating&&o.jsxs("span",{style:{fontSize:11,padding:"3px 10px",background:"rgba(255,193,7,0.2)",borderRadius:10,color:"#ffc107"},children:["Peak: ",c.peakRating]}),o.jsxs("span",{style:{fontSize:11,padding:"3px 10px",background:"rgba(255,255,255,0.1)",borderRadius:10},children:["Skill Level: ",c.skillLevel,"/20"]}),o.jsxs("span",{style:{fontSize:11,padding:"3px 10px",background:"rgba(255,255,255,0.1)",borderRadius:10},children:["Style: ",c.style]})]})]})]}),o.jsx("div",{style:{fontSize:13,lineHeight:1.6,marginBottom:12,opacity:.9},children:c.description}),c.traits&&c.traits.length>0&&o.jsxs("div",{style:{marginBottom:12},children:[o.jsx("div",{style:{fontWeight:600,fontSize:12,marginBottom:6,opacity:.7},children:"STRENGTHS"}),o.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:c.traits.map((f,p)=>o.jsx("span",{style:{fontSize:11,padding:"4px 10px",background:"rgba(76,175,80,0.15)",borderRadius:8,color:"#81c784"},children:f},p))})]}),c.weaknesses&&c.weaknesses.length>0&&!up.includes(c.id)&&o.jsxs("div",{style:{marginBottom:12},children:[o.jsx("div",{style:{fontWeight:600,fontSize:12,marginBottom:6,opacity:.7},children:"WEAKNESSES"}),o.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:c.weaknesses.map((f,p)=>o.jsx("span",{style:{fontSize:11,padding:"4px 10px",background:"rgba(244,67,54,0.15)",borderRadius:8,color:"#e57373"},children:f},p))})]}),c.quote&&o.jsxs("div",{style:{fontStyle:"italic",opacity:.75,borderLeft:"3px solid #4CAF50",paddingLeft:12,marginBottom:12,fontSize:13},children:['"',c.quote,'"']}),c.famousGames&&c.famousGames.length>0&&o.jsxs("div",{children:[o.jsx("div",{style:{fontWeight:600,fontSize:12,marginBottom:6,opacity:.7},children:"FAMOUS GAMES"}),o.jsx("ul",{style:{margin:0,paddingLeft:18,fontSize:12,opacity:.7},children:c.famousGames.map((f,p)=>o.jsx("li",{style:{marginBottom:3},children:f},p))})]})]})]})}function Hm(t){try{const e=new Audio(t?"/audio/capture.mp3":"/audio/move.mp3");e.volume=.3,e.play().catch(()=>{})}catch{}}function Vm(t){const e=Math.floor(t/60),n=t%60;return`${e}:${n.toString().padStart(2,"0")}`}function S2({profile:t,onBack:e}){const n=N.useRef(new Bt),i=N.useRef(null),r=N.useRef(!1),[s,a]=N.useState(n.current.fen()),[l,c]=N.useState([]),[d,h]=N.useState(null),[f,p]=N.useState("setup"),[m,y]=N.useState(null),[x,g]=N.useState("w"),[u,v]=N.useState("w"),[b,w]=N.useState(!1),[R,C]=N.useState(!1),[A,B]=N.useState(null),[S,k]=N.useState(!1),[U,O]=N.useState(600),[X,K]=N.useState(600);N.useEffect(()=>{const le=new Worker(new URL("/assets/stockfish.worker-dNNQdVuE.js",import.meta.url),{type:"classic"});return i.current=le,le.onmessage=Re=>{const Q=Re.data;if(Q.type==="ready"&&(console.log("[PlayVsBot] Stockfish ready"),C(!0),B(null)),Q.type==="log"&&console.log("[Stockfish]",Q.message),Q.type==="error"&&(console.error("Stockfish error:",Q.message),B(Q.message)),Q.type==="engine_line"){const ae=String(Q.line??"");if(ae.startsWith("bestmove ")&&r.current){r.current=!1;const ze=ae.split(" ")[1];if(ze&&ze!=="(none)"){const se=ze.slice(0,2),ke=ze.slice(2,4),Ge=ze.length>4?ze[4]:void 0,Oe=n.current;try{const Ve=Oe.move({from:se,to:ke,promotion:Ge});Ve&&(Hm(Ve.captured),a(Oe.fen()),c(Ze=>[...Ze,Ve.san]),h({from:se,to:ke}),$(Oe))}catch(Ve){console.error("Engine move failed:",Ve)}}w(!1)}}},le.postMessage({type:"init"}),()=>{le.terminate(),i.current=null}},[]),N.useEffect(()=>{if(!S||f!=="playing")return;const le=setInterval(()=>{n.current.turn()===x?O(ae=>ae<=1?(q(x==="w"?"0-1":"1-0","Time out"),0):ae-1):K(ae=>ae<=1?(q(x==="w"?"1-0":"0-1","Time out"),0):ae-1)},1e3);return()=>clearInterval(le)},[S,f,x]);const $=N.useCallback(le=>{if(le.isCheckmate()){const Re=le.turn()==="w"?"0-1":"1-0";return q(Re,"Checkmate"),!0}return le.isStalemate()?(q("-","Stalemate"),!0):le.isDraw()?(q("-","Draw"),!0):le.isThreefoldRepetition()?(q("-","Threefold repetition"),!0):le.isInsufficientMaterial()?(q("-","Insufficient material"),!0):!1},[]),q=N.useCallback((le,Re)=>{p("ended"),y({result:le,reason:Re})},[]),J=N.useCallback(()=>{if(!i.current||!R)return;const le=n.current;le.isGameOver()||(w(!0),r.current=!0,i.current.postMessage({type:"set_profile",profile:t}),i.current.postMessage({type:"analyze",fen:le.fen(),profile:t,movetimeMs:(t==null?void 0:t.moveTimeMs)??500}))},[t,R]);N.useEffect(()=>{if(f!=="playing"||!R)return;const le=n.current;if(le.turn()!==x&&!b&&!le.isGameOver()){const Q=setTimeout(J,300);return()=>clearTimeout(Q)}},[s,f,x,R,b,J]);const V=N.useCallback(le=>{if(f!=="playing"||b)return;const Re=n.current;if(Re.turn()===x)try{const Q=Re.move(le);Q&&(Hm(Q.captured),a(Re.fen()),h({from:le.from,to:le.to}),c(ae=>[...ae,Q.san]),$(Re))}catch{}},[f,b,x,$]),ue=N.useCallback(()=>{const le=n.current;le.reset(),a(le.fen()),c([]),h(null),y(null),p("playing"),O(600),K(600),v(x)},[x]),F=N.useCallback(()=>{q(x==="w"?"0-1":"1-0","Resignation")},[x,q]),de=N.useCallback(()=>{n.current.reset(),a(n.current.fen()),c([]),h(null),y(null),p("setup")},[]),Te=n.current,xe=Te.turn()===x;return o.jsxs("div",{style:{display:"flex",gap:24,background:"rgba(255,255,255,0.05)",borderRadius:16,padding:24},children:[o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:12,background:"rgba(0,0,0,0.2)",borderRadius:8},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[o.jsx("span",{style:{fontSize:32},children:t.avatar}),o.jsxs("div",{children:[o.jsx("div",{style:{fontWeight:700},children:t.label}),o.jsx("div",{style:{fontSize:12,opacity:.7},children:R?f==="playing"&&!xe&&b?"Thinking...":"":"Loading Stockfish..."})]})]}),S&&f==="playing"&&o.jsx("div",{style:{fontFamily:"monospace",fontSize:22,fontWeight:700,color:X<60?"#ff6b6b":"#fff"},children:Vm(X)})]}),o.jsx(Gr,{chess:Te,fen:s,orientation:u,interactive:f==="playing"&&xe&&!b,onMove:V,lastMove:d,disabled:f!=="playing"||!xe||b,size:480}),o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:12,background:"rgba(0,0,0,0.2)",borderRadius:8},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[o.jsx("span",{style:{fontSize:32},children:""}),o.jsxs("div",{children:[o.jsx("div",{style:{fontWeight:700},children:"You"}),o.jsx("div",{style:{fontSize:12,opacity:.7},children:f==="playing"&&xe&&!b?"Your turn":""})]})]}),S&&f==="playing"&&o.jsx("div",{style:{fontFamily:"monospace",fontSize:22,fontWeight:700,color:U<60?"#ff6b6b":"#fff"},children:Vm(U)})]}),f==="playing"&&o.jsx("button",{onClick:()=>v(le=>le==="w"?"b":"w"),style:{padding:"10px 16px",borderRadius:8,border:"none",background:"rgba(255,255,255,0.1)",color:"#fff",cursor:"pointer"},children:" Flip Board"})]}),o.jsxs("div",{style:{width:280,display:"flex",flexDirection:"column",gap:16},children:[A&&o.jsxs("div",{style:{background:"rgba(198,40,40,0.3)",borderRadius:8,padding:12,fontSize:13},children:[o.jsx("div",{style:{fontWeight:600,marginBottom:8},children:" Stockfish Error"}),o.jsx("div",{style:{opacity:.9,marginBottom:8},children:A}),o.jsx("div",{style:{fontSize:11,opacity:.7},children:"Try refreshing the page. If the issue persists, your browser may be blocking the Stockfish CDN."})]}),f==="setup"&&o.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:12,padding:20},children:[o.jsx("h3",{style:{margin:"0 0 16px 0"},children:"Game Setup"}),!R&&o.jsx("div",{style:{marginBottom:16,padding:12,background:"rgba(255,255,255,0.05)",borderRadius:8,fontSize:13},children:" Loading Stockfish engine..."}),o.jsxs("div",{style:{marginBottom:20},children:[o.jsx("div",{style:{fontSize:13,opacity:.7,marginBottom:8},children:"PLAY AS"}),o.jsx("div",{style:{display:"flex",gap:8},children:["w","b"].map(le=>o.jsx("button",{onClick:()=>g(le),style:{flex:1,padding:14,borderRadius:8,border:x===le?"2px solid #4CAF50":"2px solid transparent",background:x===le?"rgba(76,175,80,0.2)":"rgba(255,255,255,0.1)",color:"#fff",cursor:"pointer",fontSize:18},children:le==="w"?" White":" Black"},le))})]}),o.jsx("div",{style:{marginBottom:20},children:o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:10,cursor:"pointer",padding:"10px 12px",background:"rgba(255,255,255,0.05)",borderRadius:8},children:[o.jsx("input",{type:"checkbox",checked:S,onChange:le=>k(le.target.checked),style:{width:18,height:18}}),o.jsx("span",{children:"10 min clock"})]})}),o.jsx("button",{onClick:ue,disabled:!R,style:{width:"100%",padding:16,borderRadius:8,border:"none",background:R?"#4CAF50":"#666",color:"#fff",fontSize:16,fontWeight:700,cursor:R?"pointer":"not-allowed"},children:R?" Start Game":" Loading..."})]}),f==="playing"&&o.jsx("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:12,padding:16},children:o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsx("span",{style:{fontWeight:700},children:b?" Stockfish thinking...":" Playing"}),o.jsx("button",{onClick:F,style:{padding:"8px 16px",borderRadius:6,border:"none",background:"#c62828",color:"#fff",cursor:"pointer"},children:"Resign"})]})}),f==="ended"&&m&&o.jsxs("div",{style:{background:"rgba(0,0,0,0.3)",borderRadius:12,padding:20,border:"2px solid #4CAF50"},children:[o.jsx("h3",{style:{margin:0},children:"Game Over"}),o.jsx("div",{style:{fontSize:32,fontWeight:700,margin:"12px 0"},children:m.result}),o.jsx("div",{style:{opacity:.8,marginBottom:16},children:m.reason}),o.jsx("button",{onClick:de,style:{width:"100%",padding:12,borderRadius:8,border:"none",background:"#4CAF50",color:"#fff",cursor:"pointer",fontWeight:600},children:"New Game"})]}),o.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:12,padding:16,flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},children:[o.jsx("div",{style:{fontWeight:700,marginBottom:12,opacity:.7},children:"MOVES"}),o.jsx("div",{style:{flex:1,overflowY:"auto"},children:l.length===0?o.jsx("div",{style:{opacity:.5},children:"No moves"}):o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:4},children:l.map((le,Re)=>o.jsxs("span",{children:[Re%2===0&&o.jsxs("span",{style:{opacity:.5},children:[Math.floor(Re/2)+1,"."]})," ",le]},Re))})})]}),o.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:12,padding:16},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:8},children:[o.jsx("span",{style:{fontSize:32},children:t.avatar}),o.jsxs("div",{children:[o.jsx("div",{style:{fontWeight:700},children:t.label}),o.jsxs("div",{style:{fontSize:12,opacity:.6},children:["Skill: ",t.skillLevel,"/20  Stockfish"]})]})]}),o.jsx("div",{style:{fontSize:13,opacity:.8},children:t.description})]}),o.jsx("button",{onClick:e,style:{padding:12,borderRadius:8,border:"none",background:"rgba(255,255,255,0.1)",color:"#fff",cursor:"pointer",fontWeight:600},children:" Back"})]})]})}const Km=["a","b","c","d","e","f","g","h"];function xh(t="w"){const e=["1","2","3","4","5","6","7","8"];return t==="w"?e.slice().reverse().flatMap(n=>Km.map(i=>i+n)):e.flatMap(n=>Km.slice().reverse().map(i=>i+n))}function no(t){const e=t.charCodeAt(0)-97,n=parseInt(t[1],10)-1;return{file:e,rank:n}}function Ry(t){const{file:e,rank:n}=no(t);return(e+n)%2===1}const yh={classic_wood:{id:"classic_wood",name:"Classic Wood",light:"#f0d9b5",dark:"#b58863",frame:"#5d4037",accent:"rgba(212,175,55,0.85)",pattern:null},walnut_maple:{id:"walnut_maple",name:"Walnut & Maple",light:"#f5e6c8",dark:"#9e7a5a",frame:"#5c4030",accent:"rgba(212,175,55,0.8)",pattern:null},rosewood_ivory:{id:"rosewood_ivory",name:"Rosewood & Ivory",light:"#fffef0",dark:"#8b4513",frame:"#4a2511",accent:"rgba(212,175,55,0.85)",pattern:null},carrara_green:{id:"carrara_green",name:"Carrara & Green Marble",light:"#f5f5f0",dark:"#5d8a66",frame:"#2a4a30",accent:"rgba(212,175,55,0.85)",pattern:"marble",lightTexture:`
      linear-gradient(135deg, rgba(200,200,195,0.1) 0%, transparent 50%, rgba(200,200,195,0.1) 100%),
      linear-gradient(45deg, rgba(180,180,175,0.08) 25%, transparent 25%, transparent 75%, rgba(180,180,175,0.08) 75%)
    `,darkTexture:`
      linear-gradient(135deg, rgba(255,255,255,0.08) 0%, transparent 50%, rgba(255,255,255,0.08) 100%),
      linear-gradient(45deg, rgba(255,255,255,0.05) 25%, transparent 25%, transparent 75%, rgba(255,255,255,0.05) 75%)
    `},nero_pearl:{id:"nero_pearl",name:"Nero & Pearl Marble",light:"#f8f6f2",dark:"#4a4a52",frame:"#2a2a30",accent:"rgba(212,175,55,0.8)",pattern:"marble",lightTexture:`
      linear-gradient(135deg, rgba(200,195,190,0.12) 0%, transparent 50%, rgba(200,195,190,0.12) 100%)
    `,darkTexture:`
      linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%, rgba(255,255,255,0.1) 100%)
    `},white_blue_marble:{id:"white_blue_marble",name:"White & Blue Marble",light:"#f0f4f8",dark:"#4a6a8a",frame:"#2a3a4a",accent:"rgba(212,175,55,0.85)",pattern:"marble",lightTexture:`
      linear-gradient(135deg, rgba(180,190,200,0.1) 0%, transparent 50%, rgba(180,190,200,0.1) 100%)
    `,darkTexture:`
      linear-gradient(135deg, rgba(255,255,255,0.12) 0%, transparent 50%, rgba(255,255,255,0.12) 100%)
    `},travertine_brown:{id:"travertine_brown",name:"Travertine & Brown",light:"#e8dfd0",dark:"#7a5a40",frame:"#4a3020",accent:"rgba(212,175,55,0.85)",pattern:"marble",lightTexture:`
      linear-gradient(135deg, rgba(160,150,130,0.1) 0%, transparent 50%, rgba(160,150,130,0.1) 100%)
    `,darkTexture:`
      linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%, rgba(255,255,255,0.1) 100%)
    `},tournament_green:{id:"tournament_green",name:"Tournament Green",light:"#eeeed2",dark:"#769656",frame:"#4a5a3a",accent:"rgba(212,175,55,0.9)",pattern:null},lichess_brown:{id:"lichess_brown",name:"Lichess Brown",light:"#f0d9b5",dark:"#b58863",frame:"#8b6914",accent:"rgba(100,150,200,0.8)",pattern:null},chess_com_green:{id:"chess_com_green",name:"Chess.com Green",light:"#ebecd0",dark:"#779556",frame:"#312e2b",accent:"rgba(255,205,0,0.8)",pattern:null},slate_alabaster:{id:"slate_alabaster",name:"Slate & Alabaster",light:"#f0efe9",dark:"#5c6a72",frame:"#3a454b",accent:"rgba(212,175,55,0.75)",pattern:"stone",lightTexture:`
      linear-gradient(135deg, rgba(180,175,165,0.08) 0%, transparent 50%, rgba(180,175,165,0.08) 100%)
    `,darkTexture:`
      linear-gradient(135deg, rgba(255,255,255,0.08) 0%, transparent 50%, rgba(255,255,255,0.08) 100%)
    `},ice_obsidian:{id:"ice_obsidian",name:"Ice & Obsidian",light:"#e8f4f8",dark:"#3a3a4a",frame:"#1a1a2a",accent:"rgba(100,200,255,0.8)",pattern:"glass",lightTexture:`
      linear-gradient(135deg, rgba(200,220,240,0.15) 0%, transparent 50%, rgba(200,220,240,0.15) 100%)
    `,darkTexture:`
      linear-gradient(135deg, rgba(100,100,150,0.15) 0%, transparent 50%, rgba(100,100,150,0.15) 100%)
    `},coral_cream:{id:"coral_cream",name:"Coral & Cream",light:"#fff8f0",dark:"#c97a6a",frame:"#8a4a3a",accent:"rgba(212,175,55,0.85)",pattern:null},gold_ebony:{id:"gold_ebony",name:"Gold & Ebony",light:"#f5e8c8",dark:"#3a3532",frame:"#1a1815",accent:"rgba(212,175,55,1)",pattern:"luxury",lightTexture:`
      linear-gradient(135deg, rgba(212,175,55,0.08) 0%, transparent 50%, rgba(212,175,55,0.08) 100%)
    `,darkTexture:`
      linear-gradient(135deg, rgba(212,175,55,0.12) 0%, transparent 50%, rgba(212,175,55,0.12) 100%)
    `},purple_silver:{id:"purple_silver",name:"Purple & Silver",light:"#f0f0f5",dark:"#6a5a7a",frame:"#3a2a4a",accent:"rgba(192,192,210,0.9)",pattern:null}};function vh(){return Object.values(yh).map(t=>({id:t.id,name:t.name}))}function Ey(t){return yh[t]||yh.classic_wood}function w2(t,e){const n=e?t.dark:t.light,i=e?t.darkTexture:t.lightTexture;return i?`${i}, ${n}`:n}function k2({piece:t,square:e,boardPx:n,orientation:i,baseUrl:r="/pieces/classic/",isLifted:s=!1}){const a=N.useRef(null),l=N.useRef(e),c=n/8,d=p=>{const m=p.charCodeAt(0)-97,y=parseInt(p[1],10)-1;return i==="w"?[m,7-y]:[7-m,y]};N.useLayoutEffect(()=>{if(!a.current||l.current===e)return;const[p,m]=d(l.current),[y,x]=d(e),g=(p-y)*c,u=(m-x)*c;a.current.style.transition="none",a.current.style.transform=`translate(${g}px, ${u}px)`,requestAnimationFrame(()=>{a.current&&(a.current.style.transition="transform 220ms cubic-bezier(0.4, 0, 0.2, 1)",a.current.style.transform="translate(0px, 0px)")}),l.current=e},[e,c,i]);const h=t.type.toUpperCase(),f=`${r}${t.color}${h}.svg`;return o.jsx("img",{ref:a,className:"piece2d"+(s?" lifted":""),src:f,draggable:!1,alt:""})}function M2({chess:t,fen:e,size:n=520,orientation:i="w",interactive:r=!0,onMove:s,lastMove:a=null,themeId:l="classic_wood",vignette:c=!0,piece2DBaseUrl:d="/pieces/classic/"}){const h=Ey(l),[f,p]=N.useState(null),m=N.useMemo(()=>xh(i),[i]),y=N.useMemo(()=>{if(!f)return[];try{return t.moves({square:f,verbose:!0}).map(u=>u.to)}catch{return[]}},[f,t,e]),x=N.useMemo(()=>{try{if(!t.inCheck())return null;const u=t.turn();for(const v of xh("w")){const b=t.get(v);if(b&&b.type==="k"&&b.color===u)return v}return null}catch{return null}},[t,e]);N.useEffect(()=>{p(null)},[e]);const g=u=>{if(!r)return;const v=t.get(u);if(f&&y.includes(u)){s==null||s({from:f,to:u,promotion:"q"}),p(null);return}if(!v||v.color!==t.turn()){p(null);return}p(u)};return o.jsx("div",{className:"board2d"+(c?" vignette":""),style:{width:n,height:n,background:h.frame,boxShadow:`inset 0 0 0 2px ${h.accent}, 0 8px 32px rgba(0,0,0,0.4)`,"--accent":h.accent},children:m.map(u=>{const v=Ry(u),b=t.get(u),w=f===u,R=y.includes(u),C=a&&(u===a.from||u===a.to),A=x===u,B=w2(h,v);return o.jsx("div",{className:"square "+(v?"dark":"light")+(w?" selected":"")+(R?" legal":"")+(C?" lastmove":"")+(A?" check":""),style:{background:B},onClick:()=>g(u),children:b&&o.jsx(k2,{piece:b,square:u,boardPx:n,orientation:i,baseUrl:d,isLifted:w})},u)})})}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const hp="182",da={ROTATE:0,DOLLY:1,PAN:2},na={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},R2=0,Qm=1,E2=2,Jl=1,Cy=2,io=3,Hr=0,zn=1,Ni=2,tr=0,ua=1,qm=2,$m=3,Xm=4,C2=5,as=100,T2=101,A2=102,P2=103,N2=104,B2=200,I2=201,D2=202,L2=203,bh=204,_h=205,F2=206,U2=207,O2=208,z2=209,j2=210,W2=211,G2=212,H2=213,V2=214,Sh=0,wh=1,kh=2,Sa=3,Mh=4,Rh=5,Eh=6,Ch=7,Ty=0,K2=1,Q2=2,Fi=0,Ay=1,Py=2,Ny=3,By=4,Iy=5,Dy=6,Ly=7,Fy=300,_s=301,wa=302,Th=303,Ah=304,ed=306,Ph=1e3,Ji=1001,Nh=1002,on=1003,q2=1004,hl=1005,gn=1006,Od=1007,us=1008,Qn=1009,Uy=1010,Oy=1011,Bo=1012,fp=1013,zi=1014,Bi=1015,or=1016,pp=1017,mp=1018,Io=1020,zy=35902,jy=35899,Wy=1021,Gy=1022,vi=1023,lr=1026,hs=1027,Hy=1028,gp=1029,ka=1030,xp=1031,yp=1033,ec=33776,tc=33777,nc=33778,ic=33779,Bh=35840,Ih=35841,Dh=35842,Lh=35843,Fh=36196,Uh=37492,Oh=37496,zh=37488,jh=37489,Wh=37490,Gh=37491,Hh=37808,Vh=37809,Kh=37810,Qh=37811,qh=37812,$h=37813,Xh=37814,Yh=37815,Zh=37816,Jh=37817,ef=37818,tf=37819,nf=37820,rf=37821,sf=36492,af=36494,of=36495,lf=36283,cf=36284,df=36285,uf=36286,$2=3200,Vy=0,X2=1,Cr="",ni="srgb",Ma="srgb-linear",Nc="linear",Rt="srgb",As=7680,Ym=519,Y2=512,Z2=513,J2=514,vp=515,e_=516,t_=517,bp=518,n_=519,Zm=35044,Jm="300 es",Ii=2e3,Bc=2001;function Ky(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}function Ic(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function i_(){const t=Ic("canvas");return t.style.display="block",t}const eg={};function tg(...t){const e="THREE."+t.shift();console.log(e,...t)}function lt(...t){const e="THREE."+t.shift();console.warn(e,...t)}function vt(...t){const e="THREE."+t.shift();console.error(e,...t)}function Do(...t){const e=t.join(" ");e in eg||(eg[e]=!0,lt(...t))}function r_(t,e,n){return new Promise(function(i,r){function s(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:r();break;case t.TIMEOUT_EXPIRED:setTimeout(s,n);break;default:i()}}setTimeout(s,n)})}class Ms{addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(n)===-1&&i[e].push(n)}hasEventListener(e,n){const i=this._listeners;return i===void 0?!1:i[e]!==void 0&&i[e].indexOf(n)!==-1}removeEventListener(e,n){const i=this._listeners;if(i===void 0)return;const r=i[e];if(r!==void 0){const s=r.indexOf(n);s!==-1&&r.splice(s,1)}}dispatchEvent(e){const n=this._listeners;if(n===void 0)return;const i=n[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let s=0,a=r.length;s<a;s++)r[s].call(this,e);e.target=null}}}const hn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],rc=Math.PI/180,hf=180/Math.PI;function Wo(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(hn[t&255]+hn[t>>8&255]+hn[t>>16&255]+hn[t>>24&255]+"-"+hn[e&255]+hn[e>>8&255]+"-"+hn[e>>16&15|64]+hn[e>>24&255]+"-"+hn[n&63|128]+hn[n>>8&255]+"-"+hn[n>>16&255]+hn[n>>24&255]+hn[i&255]+hn[i>>8&255]+hn[i>>16&255]+hn[i>>24&255]).toLowerCase()}function ft(t,e,n){return Math.max(e,Math.min(n,t))}function s_(t,e){return(t%e+e)%e}function zd(t,e,n){return(1-n)*t+n*e}function Ha(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Pn(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(t*4294967295);case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int32Array:return Math.round(t*2147483647);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}const a_={DEG2RAD:rc};class it{constructor(e=0,n=0){it.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,i=this.y,r=e.elements;return this.x=r[0]*n+r[3]*i+r[6],this.y=r[1]*n+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=ft(this.x,e.x,n.x),this.y=ft(this.y,e.y,n.y),this}clampScalar(e,n){return this.x=ft(this.x,e,n),this.y=ft(this.y,e,n),this}clampLength(e,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(ft(i,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const i=this.dot(e)/n;return Math.acos(ft(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,i=this.y-e.y;return n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const i=Math.cos(n),r=Math.sin(n),s=this.x-e.x,a=this.y-e.y;return this.x=s*i-a*r+e.x,this.y=s*r+a*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ss{constructor(e=0,n=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=n,this._z=i,this._w=r}static slerpFlat(e,n,i,r,s,a,l){let c=i[r+0],d=i[r+1],h=i[r+2],f=i[r+3],p=s[a+0],m=s[a+1],y=s[a+2],x=s[a+3];if(l<=0){e[n+0]=c,e[n+1]=d,e[n+2]=h,e[n+3]=f;return}if(l>=1){e[n+0]=p,e[n+1]=m,e[n+2]=y,e[n+3]=x;return}if(f!==x||c!==p||d!==m||h!==y){let g=c*p+d*m+h*y+f*x;g<0&&(p=-p,m=-m,y=-y,x=-x,g=-g);let u=1-l;if(g<.9995){const v=Math.acos(g),b=Math.sin(v);u=Math.sin(u*v)/b,l=Math.sin(l*v)/b,c=c*u+p*l,d=d*u+m*l,h=h*u+y*l,f=f*u+x*l}else{c=c*u+p*l,d=d*u+m*l,h=h*u+y*l,f=f*u+x*l;const v=1/Math.sqrt(c*c+d*d+h*h+f*f);c*=v,d*=v,h*=v,f*=v}}e[n]=c,e[n+1]=d,e[n+2]=h,e[n+3]=f}static multiplyQuaternionsFlat(e,n,i,r,s,a){const l=i[r],c=i[r+1],d=i[r+2],h=i[r+3],f=s[a],p=s[a+1],m=s[a+2],y=s[a+3];return e[n]=l*y+h*f+c*m-d*p,e[n+1]=c*y+h*p+d*f-l*m,e[n+2]=d*y+h*m+l*p-c*f,e[n+3]=h*y-l*f-c*p-d*m,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,n,i,r){return this._x=e,this._y=n,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,n=!0){const i=e._x,r=e._y,s=e._z,a=e._order,l=Math.cos,c=Math.sin,d=l(i/2),h=l(r/2),f=l(s/2),p=c(i/2),m=c(r/2),y=c(s/2);switch(a){case"XYZ":this._x=p*h*f+d*m*y,this._y=d*m*f-p*h*y,this._z=d*h*y+p*m*f,this._w=d*h*f-p*m*y;break;case"YXZ":this._x=p*h*f+d*m*y,this._y=d*m*f-p*h*y,this._z=d*h*y-p*m*f,this._w=d*h*f+p*m*y;break;case"ZXY":this._x=p*h*f-d*m*y,this._y=d*m*f+p*h*y,this._z=d*h*y+p*m*f,this._w=d*h*f-p*m*y;break;case"ZYX":this._x=p*h*f-d*m*y,this._y=d*m*f+p*h*y,this._z=d*h*y-p*m*f,this._w=d*h*f+p*m*y;break;case"YZX":this._x=p*h*f+d*m*y,this._y=d*m*f+p*h*y,this._z=d*h*y-p*m*f,this._w=d*h*f-p*m*y;break;case"XZY":this._x=p*h*f-d*m*y,this._y=d*m*f-p*h*y,this._z=d*h*y+p*m*f,this._w=d*h*f+p*m*y;break;default:lt("Quaternion: .setFromEuler() encountered an unknown order: "+a)}return n===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,n){const i=n/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const n=e.elements,i=n[0],r=n[4],s=n[8],a=n[1],l=n[5],c=n[9],d=n[2],h=n[6],f=n[10],p=i+l+f;if(p>0){const m=.5/Math.sqrt(p+1);this._w=.25/m,this._x=(h-c)*m,this._y=(s-d)*m,this._z=(a-r)*m}else if(i>l&&i>f){const m=2*Math.sqrt(1+i-l-f);this._w=(h-c)/m,this._x=.25*m,this._y=(r+a)/m,this._z=(s+d)/m}else if(l>f){const m=2*Math.sqrt(1+l-i-f);this._w=(s-d)/m,this._x=(r+a)/m,this._y=.25*m,this._z=(c+h)/m}else{const m=2*Math.sqrt(1+f-i-l);this._w=(a-r)/m,this._x=(s+d)/m,this._y=(c+h)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(e,n){let i=e.dot(n)+1;return i<1e-8?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*n.z-e.z*n.y,this._y=e.z*n.x-e.x*n.z,this._z=e.x*n.y-e.y*n.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ft(this.dot(e),-1,1)))}rotateTowards(e,n){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,n/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,n){const i=e._x,r=e._y,s=e._z,a=e._w,l=n._x,c=n._y,d=n._z,h=n._w;return this._x=i*h+a*l+r*d-s*c,this._y=r*h+a*c+s*l-i*d,this._z=s*h+a*d+i*c-r*l,this._w=a*h-i*l-r*c-s*d,this._onChangeCallback(),this}slerp(e,n){if(n<=0)return this;if(n>=1)return this.copy(e);let i=e._x,r=e._y,s=e._z,a=e._w,l=this.dot(e);l<0&&(i=-i,r=-r,s=-s,a=-a,l=-l);let c=1-n;if(l<.9995){const d=Math.acos(l),h=Math.sin(d);c=Math.sin(c*d)/h,n=Math.sin(n*d)/h,this._x=this._x*c+i*n,this._y=this._y*c+r*n,this._z=this._z*c+s*n,this._w=this._w*c+a*n,this._onChangeCallback()}else this._x=this._x*c+i*n,this._y=this._y*c+r*n,this._z=this._z*c+s*n,this._w=this._w*c+a*n,this.normalize();return this}slerpQuaternions(e,n,i){return this.copy(e).slerp(n,i)}random(){const e=2*Math.PI*Math.random(),n=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(n),s*Math.cos(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,n=0){return this._x=e[n],this._y=e[n+1],this._z=e[n+2],this._w=e[n+3],this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._w,e}fromBufferAttribute(e,n){return this._x=e.getX(n),this._y=e.getY(n),this._z=e.getZ(n),this._w=e.getW(n),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class re{constructor(e=0,n=0,i=0){re.prototype.isVector3=!0,this.x=e,this.y=n,this.z=i}set(e,n,i){return i===void 0&&(i=this.z),this.x=e,this.y=n,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,n){return this.x=e.x*n.x,this.y=e.y*n.y,this.z=e.z*n.z,this}applyEuler(e){return this.applyQuaternion(ng.setFromEuler(e))}applyAxisAngle(e,n){return this.applyQuaternion(ng.setFromAxisAngle(e,n))}applyMatrix3(e){const n=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*n+s[3]*i+s[6]*r,this.y=s[1]*n+s[4]*i+s[7]*r,this.z=s[2]*n+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const n=this.x,i=this.y,r=this.z,s=e.elements,a=1/(s[3]*n+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*n+s[4]*i+s[8]*r+s[12])*a,this.y=(s[1]*n+s[5]*i+s[9]*r+s[13])*a,this.z=(s[2]*n+s[6]*i+s[10]*r+s[14])*a,this}applyQuaternion(e){const n=this.x,i=this.y,r=this.z,s=e.x,a=e.y,l=e.z,c=e.w,d=2*(a*r-l*i),h=2*(l*n-s*r),f=2*(s*i-a*n);return this.x=n+c*d+a*f-l*h,this.y=i+c*h+l*d-s*f,this.z=r+c*f+s*h-a*d,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const n=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*n+s[4]*i+s[8]*r,this.y=s[1]*n+s[5]*i+s[9]*r,this.z=s[2]*n+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,n){return this.x=ft(this.x,e.x,n.x),this.y=ft(this.y,e.y,n.y),this.z=ft(this.z,e.z,n.z),this}clampScalar(e,n){return this.x=ft(this.x,e,n),this.y=ft(this.y,e,n),this.z=ft(this.z,e,n),this}clampLength(e,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(ft(i,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this.z=e.z+(n.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,n){const i=e.x,r=e.y,s=e.z,a=n.x,l=n.y,c=n.z;return this.x=r*c-s*l,this.y=s*a-i*c,this.z=i*l-r*a,this}projectOnVector(e){const n=e.lengthSq();if(n===0)return this.set(0,0,0);const i=e.dot(this)/n;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return jd.copy(this).projectOnVector(e),this.sub(jd)}reflect(e){return this.sub(jd.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const i=this.dot(e)/n;return Math.acos(ft(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return n*n+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,n,i){const r=Math.sin(n)*e;return this.x=r*Math.sin(i),this.y=Math.cos(n)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,n,i){return this.x=e*Math.sin(n),this.y=i,this.z=e*Math.cos(n),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(e){const n=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=n,this.y=i,this.z=r,this}setFromMatrixColumn(e,n){return this.fromArray(e.elements,n*4)}setFromMatrix3Column(e,n){return this.fromArray(e.elements,n*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,n=Math.random()*2-1,i=Math.sqrt(1-n*n);return this.x=i*Math.cos(e),this.y=n,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const jd=new re,ng=new Ss;class ct{constructor(e,n,i,r,s,a,l,c,d){ct.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,i,r,s,a,l,c,d)}set(e,n,i,r,s,a,l,c,d){const h=this.elements;return h[0]=e,h[1]=r,h[2]=l,h[3]=n,h[4]=s,h[5]=c,h[6]=i,h[7]=a,h[8]=d,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,i=e.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],this}extractBasis(e,n,i){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const i=e.elements,r=n.elements,s=this.elements,a=i[0],l=i[3],c=i[6],d=i[1],h=i[4],f=i[7],p=i[2],m=i[5],y=i[8],x=r[0],g=r[3],u=r[6],v=r[1],b=r[4],w=r[7],R=r[2],C=r[5],A=r[8];return s[0]=a*x+l*v+c*R,s[3]=a*g+l*b+c*C,s[6]=a*u+l*w+c*A,s[1]=d*x+h*v+f*R,s[4]=d*g+h*b+f*C,s[7]=d*u+h*w+f*A,s[2]=p*x+m*v+y*R,s[5]=p*g+m*b+y*C,s[8]=p*u+m*w+y*A,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],i=e[1],r=e[2],s=e[3],a=e[4],l=e[5],c=e[6],d=e[7],h=e[8];return n*a*h-n*l*d-i*s*h+i*l*c+r*s*d-r*a*c}invert(){const e=this.elements,n=e[0],i=e[1],r=e[2],s=e[3],a=e[4],l=e[5],c=e[6],d=e[7],h=e[8],f=h*a-l*d,p=l*c-h*s,m=d*s-a*c,y=n*f+i*p+r*m;if(y===0)return this.set(0,0,0,0,0,0,0,0,0);const x=1/y;return e[0]=f*x,e[1]=(r*d-h*i)*x,e[2]=(l*i-r*a)*x,e[3]=p*x,e[4]=(h*n-r*c)*x,e[5]=(r*s-l*n)*x,e[6]=m*x,e[7]=(i*c-d*n)*x,e[8]=(a*n-i*s)*x,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,i,r,s,a,l){const c=Math.cos(s),d=Math.sin(s);return this.set(i*c,i*d,-i*(c*a+d*l)+a+e,-r*d,r*c,-r*(-d*a+c*l)+l+n,0,0,1),this}scale(e,n){return this.premultiply(Wd.makeScale(e,n)),this}rotate(e){return this.premultiply(Wd.makeRotation(-e)),this}translate(e,n){return this.premultiply(Wd.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),i=Math.sin(e);return this.set(n,-i,0,i,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,i=e.elements;for(let r=0;r<9;r++)if(n[r]!==i[r])return!1;return!0}fromArray(e,n=0){for(let i=0;i<9;i++)this.elements[i]=e[i+n];return this}toArray(e=[],n=0){const i=this.elements;return e[n]=i[0],e[n+1]=i[1],e[n+2]=i[2],e[n+3]=i[3],e[n+4]=i[4],e[n+5]=i[5],e[n+6]=i[6],e[n+7]=i[7],e[n+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Wd=new ct,ig=new ct().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),rg=new ct().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function o_(){const t={enabled:!0,workingColorSpace:Ma,spaces:{},convert:function(r,s,a){return this.enabled===!1||s===a||!s||!a||(this.spaces[s].transfer===Rt&&(r.r=nr(r.r),r.g=nr(r.g),r.b=nr(r.b)),this.spaces[s].primaries!==this.spaces[a].primaries&&(r.applyMatrix3(this.spaces[s].toXYZ),r.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===Rt&&(r.r=ha(r.r),r.g=ha(r.g),r.b=ha(r.b))),r},workingToColorSpace:function(r,s){return this.convert(r,this.workingColorSpace,s)},colorSpaceToWorking:function(r,s){return this.convert(r,s,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===Cr?Nc:this.spaces[r].transfer},getToneMappingMode:function(r){return this.spaces[r].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(r,s=this.workingColorSpace){return r.fromArray(this.spaces[s].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,s,a){return r.copy(this.spaces[s].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(r,s){return Do("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),t.workingToColorSpace(r,s)},toWorkingColorSpace:function(r,s){return Do("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),t.colorSpaceToWorking(r,s)}},e=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],i=[.3127,.329];return t.define({[Ma]:{primaries:e,whitePoint:i,transfer:Nc,toXYZ:ig,fromXYZ:rg,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:ni},outputColorSpaceConfig:{drawingBufferColorSpace:ni}},[ni]:{primaries:e,whitePoint:i,transfer:Rt,toXYZ:ig,fromXYZ:rg,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:ni}}}),t}const bt=o_();function nr(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function ha(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}let Ps;class l_{static getDataURL(e,n="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{Ps===void 0&&(Ps=Ic("canvas")),Ps.width=e.width,Ps.height=e.height;const r=Ps.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),i=Ps}return i.toDataURL(n)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const n=Ic("canvas");n.width=e.width,n.height=e.height;const i=n.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let a=0;a<s.length;a++)s[a]=nr(s[a]/255)*255;return i.putImageData(r,0,0),n}else if(e.data){const n=e.data.slice(0);for(let i=0;i<n.length;i++)n instanceof Uint8Array||n instanceof Uint8ClampedArray?n[i]=Math.floor(nr(n[i]/255)*255):n[i]=nr(n[i]);return{data:n,width:e.width,height:e.height}}else return lt("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let c_=0;class _p{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:c_++}),this.uuid=Wo(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const n=this.data;return typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement?e.set(n.videoWidth,n.videoHeight,0):typeof VideoFrame<"u"&&n instanceof VideoFrame?e.set(n.displayHeight,n.displayWidth,0):n!==null?e.set(n.width,n.height,n.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let a=0,l=r.length;a<l;a++)r[a].isDataTexture?s.push(Gd(r[a].image)):s.push(Gd(r[a]))}else s=Gd(r);i.url=s}return n||(e.images[this.uuid]=i),i}}function Gd(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?l_.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(lt("Texture: Unable to serialize Texture."),{})}let d_=0;const Hd=new re;class wn extends Ms{constructor(e=wn.DEFAULT_IMAGE,n=wn.DEFAULT_MAPPING,i=Ji,r=Ji,s=gn,a=us,l=vi,c=Qn,d=wn.DEFAULT_ANISOTROPY,h=Cr){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:d_++}),this.uuid=Wo(),this.name="",this.source=new _p(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=s,this.minFilter=a,this.anisotropy=d,this.format=l,this.internalFormat=null,this.type=c,this.offset=new it(0,0),this.repeat=new it(1,1),this.center=new it(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ct,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(Hd).x}get height(){return this.source.getSize(Hd).y}get depth(){return this.source.getSize(Hd).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const n in e){const i=e[n];if(i===void 0){lt(`Texture.setValues(): parameter '${n}' has value of undefined.`);continue}const r=this[n];if(r===void 0){lt(`Texture.setValues(): property '${n}' does not exist.`);continue}r&&i&&r.isVector2&&i.isVector2||r&&i&&r.isVector3&&i.isVector3||r&&i&&r.isMatrix3&&i.isMatrix3?r.copy(i):this[n]=i}}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),n||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Fy)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ph:e.x=e.x-Math.floor(e.x);break;case Ji:e.x=e.x<0?0:1;break;case Nh:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Ph:e.y=e.y-Math.floor(e.y);break;case Ji:e.y=e.y<0?0:1;break;case Nh:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}wn.DEFAULT_IMAGE=null;wn.DEFAULT_MAPPING=Fy;wn.DEFAULT_ANISOTROPY=1;class Gt{constructor(e=0,n=0,i=0,r=1){Gt.prototype.isVector4=!0,this.x=e,this.y=n,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,n,i,r){return this.x=e,this.y=n,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this.w=e.w+n.w,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this.w+=e.w*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this.w=e.w-n.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const n=this.x,i=this.y,r=this.z,s=this.w,a=e.elements;return this.x=a[0]*n+a[4]*i+a[8]*r+a[12]*s,this.y=a[1]*n+a[5]*i+a[9]*r+a[13]*s,this.z=a[2]*n+a[6]*i+a[10]*r+a[14]*s,this.w=a[3]*n+a[7]*i+a[11]*r+a[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const n=Math.sqrt(1-e.w*e.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/n,this.y=e.y/n,this.z=e.z/n),this}setAxisAngleFromRotationMatrix(e){let n,i,r,s;const c=e.elements,d=c[0],h=c[4],f=c[8],p=c[1],m=c[5],y=c[9],x=c[2],g=c[6],u=c[10];if(Math.abs(h-p)<.01&&Math.abs(f-x)<.01&&Math.abs(y-g)<.01){if(Math.abs(h+p)<.1&&Math.abs(f+x)<.1&&Math.abs(y+g)<.1&&Math.abs(d+m+u-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;const b=(d+1)/2,w=(m+1)/2,R=(u+1)/2,C=(h+p)/4,A=(f+x)/4,B=(y+g)/4;return b>w&&b>R?b<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(b),r=C/i,s=A/i):w>R?w<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(w),i=C/r,s=B/r):R<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(R),i=A/s,r=B/s),this.set(i,r,s,n),this}let v=Math.sqrt((g-y)*(g-y)+(f-x)*(f-x)+(p-h)*(p-h));return Math.abs(v)<.001&&(v=1),this.x=(g-y)/v,this.y=(f-x)/v,this.z=(p-h)/v,this.w=Math.acos((d+m+u-1)/2),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this.w=n[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,n){return this.x=ft(this.x,e.x,n.x),this.y=ft(this.y,e.y,n.y),this.z=ft(this.z,e.z,n.z),this.w=ft(this.w,e.w,n.w),this}clampScalar(e,n){return this.x=ft(this.x,e,n),this.y=ft(this.y,e,n),this.z=ft(this.z,e,n),this.w=ft(this.w,e,n),this}clampLength(e,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar(ft(i,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this.w+=(e.w-this.w)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this.z=e.z+(n.z-e.z)*i,this.w=e.w+(n.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this.w=e[n+3],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e[n+3]=this.w,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this.w=e.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class u_ extends Ms{constructor(e=1,n=1,i={}){super(),i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:gn,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},i),this.isRenderTarget=!0,this.width=e,this.height=n,this.depth=i.depth,this.scissor=new Gt(0,0,e,n),this.scissorTest=!1,this.viewport=new Gt(0,0,e,n);const r={width:e,height:n,depth:i.depth},s=new wn(r);this.textures=[];const a=i.count;for(let l=0;l<a;l++)this.textures[l]=s.clone(),this.textures[l].isRenderTargetTexture=!0,this.textures[l].renderTarget=this;this._setTextureOptions(i),this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=i.depthTexture,this.samples=i.samples,this.multiview=i.multiview}_setTextureOptions(e={}){const n={minFilter:gn,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(n.mapping=e.mapping),e.wrapS!==void 0&&(n.wrapS=e.wrapS),e.wrapT!==void 0&&(n.wrapT=e.wrapT),e.wrapR!==void 0&&(n.wrapR=e.wrapR),e.magFilter!==void 0&&(n.magFilter=e.magFilter),e.minFilter!==void 0&&(n.minFilter=e.minFilter),e.format!==void 0&&(n.format=e.format),e.type!==void 0&&(n.type=e.type),e.anisotropy!==void 0&&(n.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(n.colorSpace=e.colorSpace),e.flipY!==void 0&&(n.flipY=e.flipY),e.generateMipmaps!==void 0&&(n.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(n.internalFormat=e.internalFormat);for(let i=0;i<this.textures.length;i++)this.textures[i].setValues(n)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,n,i=1){if(this.width!==e||this.height!==n||this.depth!==i){this.width=e,this.height=n,this.depth=i;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=n,this.textures[r].image.depth=i,this.textures[r].isData3DTexture!==!0&&(this.textures[r].isArrayTexture=this.textures[r].image.depth>1);this.dispose()}this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let n=0,i=e.textures.length;n<i;n++){this.textures[n]=e.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0,this.textures[n].renderTarget=this;const r=Object.assign({},e.textures[n].image);this.textures[n].source=new _p(r)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Ui extends u_{constructor(e=1,n=1,i={}){super(e,n,i),this.isWebGLRenderTarget=!0}}class Qy extends wn{constructor(e=null,n=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:n,height:i,depth:r},this.magFilter=on,this.minFilter=on,this.wrapR=Ji,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class h_ extends wn{constructor(e=null,n=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:n,height:i,depth:r},this.magFilter=on,this.minFilter=on,this.wrapR=Ji,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Go{constructor(e=new re(1/0,1/0,1/0),n=new re(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromArray(e){this.makeEmpty();for(let n=0,i=e.length;n<i;n+=3)this.expandByPoint(hi.fromArray(e,n));return this}setFromBufferAttribute(e){this.makeEmpty();for(let n=0,i=e.count;n<i;n++)this.expandByPoint(hi.fromBufferAttribute(e,n));return this}setFromPoints(e){this.makeEmpty();for(let n=0,i=e.length;n<i;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const i=hi.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,n=!1){return this.makeEmpty(),this.expandByObject(e,n)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,n=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const s=i.getAttribute("position");if(n===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let a=0,l=s.count;a<l;a++)e.isMesh===!0?e.getVertexPosition(a,hi):hi.fromBufferAttribute(s,a),hi.applyMatrix4(e.matrixWorld),this.expandByPoint(hi);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),fl.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),fl.copy(i.boundingBox)),fl.applyMatrix4(e.matrixWorld),this.union(fl)}const r=e.children;for(let s=0,a=r.length;s<a;s++)this.expandByObject(r[s],n);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,hi),hi.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let n,i;return e.normal.x>0?(n=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(n=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(n+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(n+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(n+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(n+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),n<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Va),pl.subVectors(this.max,Va),Ns.subVectors(e.a,Va),Bs.subVectors(e.b,Va),Is.subVectors(e.c,Va),mr.subVectors(Bs,Ns),gr.subVectors(Is,Bs),Yr.subVectors(Ns,Is);let n=[0,-mr.z,mr.y,0,-gr.z,gr.y,0,-Yr.z,Yr.y,mr.z,0,-mr.x,gr.z,0,-gr.x,Yr.z,0,-Yr.x,-mr.y,mr.x,0,-gr.y,gr.x,0,-Yr.y,Yr.x,0];return!Vd(n,Ns,Bs,Is,pl)||(n=[1,0,0,0,1,0,0,0,1],!Vd(n,Ns,Bs,Is,pl))?!1:(ml.crossVectors(mr,gr),n=[ml.x,ml.y,ml.z],Vd(n,Ns,Bs,Is,pl))}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,hi).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(hi).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Gi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Gi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Gi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Gi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Gi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Gi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Gi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Gi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Gi),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const Gi=[new re,new re,new re,new re,new re,new re,new re,new re],hi=new re,fl=new Go,Ns=new re,Bs=new re,Is=new re,mr=new re,gr=new re,Yr=new re,Va=new re,pl=new re,ml=new re,Zr=new re;function Vd(t,e,n,i,r){for(let s=0,a=t.length-3;s<=a;s+=3){Zr.fromArray(t,s);const l=r.x*Math.abs(Zr.x)+r.y*Math.abs(Zr.y)+r.z*Math.abs(Zr.z),c=e.dot(Zr),d=n.dot(Zr),h=i.dot(Zr);if(Math.max(-Math.max(c,d,h),Math.min(c,d,h))>l)return!1}return!0}const f_=new Go,Ka=new re,Kd=new re;class Sp{constructor(e=new re,n=-1){this.isSphere=!0,this.center=e,this.radius=n}set(e,n){return this.center.copy(e),this.radius=n,this}setFromPoints(e,n){const i=this.center;n!==void 0?i.copy(n):f_.setFromPoints(e).getCenter(i);let r=0;for(let s=0,a=e.length;s<a;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const n=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=n*n}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,n){const i=this.center.distanceToSquared(e);return n.copy(e),i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Ka.subVectors(e,this.center);const n=Ka.lengthSq();if(n>this.radius*this.radius){const i=Math.sqrt(n),r=(i-this.radius)*.5;this.center.addScaledVector(Ka,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Kd.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Ka.copy(e.center).add(Kd)),this.expandByPoint(Ka.copy(e.center).sub(Kd))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const Hi=new re,Qd=new re,gl=new re,xr=new re,qd=new re,xl=new re,$d=new re;class wp{constructor(e=new re,n=new re(0,0,-1)){this.origin=e,this.direction=n}set(e,n){return this.origin.copy(e),this.direction.copy(n),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,n){return n.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Hi)),this}closestPointToPoint(e,n){n.subVectors(e,this.origin);const i=n.dot(this.direction);return i<0?n.copy(this.origin):n.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const n=Hi.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(Hi.copy(this.origin).addScaledVector(this.direction,n),Hi.distanceToSquared(e))}distanceSqToSegment(e,n,i,r){Qd.copy(e).add(n).multiplyScalar(.5),gl.copy(n).sub(e).normalize(),xr.copy(this.origin).sub(Qd);const s=e.distanceTo(n)*.5,a=-this.direction.dot(gl),l=xr.dot(this.direction),c=-xr.dot(gl),d=xr.lengthSq(),h=Math.abs(1-a*a);let f,p,m,y;if(h>0)if(f=a*c-l,p=a*l-c,y=s*h,f>=0)if(p>=-y)if(p<=y){const x=1/h;f*=x,p*=x,m=f*(f+a*p+2*l)+p*(a*f+p+2*c)+d}else p=s,f=Math.max(0,-(a*p+l)),m=-f*f+p*(p+2*c)+d;else p=-s,f=Math.max(0,-(a*p+l)),m=-f*f+p*(p+2*c)+d;else p<=-y?(f=Math.max(0,-(-a*s+l)),p=f>0?-s:Math.min(Math.max(-s,-c),s),m=-f*f+p*(p+2*c)+d):p<=y?(f=0,p=Math.min(Math.max(-s,-c),s),m=p*(p+2*c)+d):(f=Math.max(0,-(a*s+l)),p=f>0?s:Math.min(Math.max(-s,-c),s),m=-f*f+p*(p+2*c)+d);else p=a>0?-s:s,f=Math.max(0,-(a*p+l)),m=-f*f+p*(p+2*c)+d;return i&&i.copy(this.origin).addScaledVector(this.direction,f),r&&r.copy(Qd).addScaledVector(gl,p),m}intersectSphere(e,n){Hi.subVectors(e.center,this.origin);const i=Hi.dot(this.direction),r=Hi.dot(Hi)-i*i,s=e.radius*e.radius;if(r>s)return null;const a=Math.sqrt(s-r),l=i-a,c=i+a;return c<0?null:l<0?this.at(c,n):this.at(l,n)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const n=e.normal.dot(this.direction);if(n===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/n;return i>=0?i:null}intersectPlane(e,n){const i=this.distanceToPlane(e);return i===null?null:this.at(i,n)}intersectsPlane(e){const n=e.distanceToPoint(this.origin);return n===0||e.normal.dot(this.direction)*n<0}intersectBox(e,n){let i,r,s,a,l,c;const d=1/this.direction.x,h=1/this.direction.y,f=1/this.direction.z,p=this.origin;return d>=0?(i=(e.min.x-p.x)*d,r=(e.max.x-p.x)*d):(i=(e.max.x-p.x)*d,r=(e.min.x-p.x)*d),h>=0?(s=(e.min.y-p.y)*h,a=(e.max.y-p.y)*h):(s=(e.max.y-p.y)*h,a=(e.min.y-p.y)*h),i>a||s>r||((s>i||isNaN(i))&&(i=s),(a<r||isNaN(r))&&(r=a),f>=0?(l=(e.min.z-p.z)*f,c=(e.max.z-p.z)*f):(l=(e.max.z-p.z)*f,c=(e.min.z-p.z)*f),i>c||l>r)||((l>i||i!==i)&&(i=l),(c<r||r!==r)&&(r=c),r<0)?null:this.at(i>=0?i:r,n)}intersectsBox(e){return this.intersectBox(e,Hi)!==null}intersectTriangle(e,n,i,r,s){qd.subVectors(n,e),xl.subVectors(i,e),$d.crossVectors(qd,xl);let a=this.direction.dot($d),l;if(a>0){if(r)return null;l=1}else if(a<0)l=-1,a=-a;else return null;xr.subVectors(this.origin,e);const c=l*this.direction.dot(xl.crossVectors(xr,xl));if(c<0)return null;const d=l*this.direction.dot(qd.cross(xr));if(d<0||c+d>a)return null;const h=-l*xr.dot($d);return h<0?null:this.at(h/a,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class zt{constructor(e,n,i,r,s,a,l,c,d,h,f,p,m,y,x,g){zt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,n,i,r,s,a,l,c,d,h,f,p,m,y,x,g)}set(e,n,i,r,s,a,l,c,d,h,f,p,m,y,x,g){const u=this.elements;return u[0]=e,u[4]=n,u[8]=i,u[12]=r,u[1]=s,u[5]=a,u[9]=l,u[13]=c,u[2]=d,u[6]=h,u[10]=f,u[14]=p,u[3]=m,u[7]=y,u[11]=x,u[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new zt().fromArray(this.elements)}copy(e){const n=this.elements,i=e.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],this}copyPosition(e){const n=this.elements,i=e.elements;return n[12]=i[12],n[13]=i[13],n[14]=i[14],this}setFromMatrix3(e){const n=e.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(e,n,i){return this.determinant()===0?(e.set(1,0,0),n.set(0,1,0),i.set(0,0,1),this):(e.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this)}makeBasis(e,n,i){return this.set(e.x,n.x,i.x,0,e.y,n.y,i.y,0,e.z,n.z,i.z,0,0,0,0,1),this}extractRotation(e){if(e.determinant()===0)return this.identity();const n=this.elements,i=e.elements,r=1/Ds.setFromMatrixColumn(e,0).length(),s=1/Ds.setFromMatrixColumn(e,1).length(),a=1/Ds.setFromMatrixColumn(e,2).length();return n[0]=i[0]*r,n[1]=i[1]*r,n[2]=i[2]*r,n[3]=0,n[4]=i[4]*s,n[5]=i[5]*s,n[6]=i[6]*s,n[7]=0,n[8]=i[8]*a,n[9]=i[9]*a,n[10]=i[10]*a,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(e){const n=this.elements,i=e.x,r=e.y,s=e.z,a=Math.cos(i),l=Math.sin(i),c=Math.cos(r),d=Math.sin(r),h=Math.cos(s),f=Math.sin(s);if(e.order==="XYZ"){const p=a*h,m=a*f,y=l*h,x=l*f;n[0]=c*h,n[4]=-c*f,n[8]=d,n[1]=m+y*d,n[5]=p-x*d,n[9]=-l*c,n[2]=x-p*d,n[6]=y+m*d,n[10]=a*c}else if(e.order==="YXZ"){const p=c*h,m=c*f,y=d*h,x=d*f;n[0]=p+x*l,n[4]=y*l-m,n[8]=a*d,n[1]=a*f,n[5]=a*h,n[9]=-l,n[2]=m*l-y,n[6]=x+p*l,n[10]=a*c}else if(e.order==="ZXY"){const p=c*h,m=c*f,y=d*h,x=d*f;n[0]=p-x*l,n[4]=-a*f,n[8]=y+m*l,n[1]=m+y*l,n[5]=a*h,n[9]=x-p*l,n[2]=-a*d,n[6]=l,n[10]=a*c}else if(e.order==="ZYX"){const p=a*h,m=a*f,y=l*h,x=l*f;n[0]=c*h,n[4]=y*d-m,n[8]=p*d+x,n[1]=c*f,n[5]=x*d+p,n[9]=m*d-y,n[2]=-d,n[6]=l*c,n[10]=a*c}else if(e.order==="YZX"){const p=a*c,m=a*d,y=l*c,x=l*d;n[0]=c*h,n[4]=x-p*f,n[8]=y*f+m,n[1]=f,n[5]=a*h,n[9]=-l*h,n[2]=-d*h,n[6]=m*f+y,n[10]=p-x*f}else if(e.order==="XZY"){const p=a*c,m=a*d,y=l*c,x=l*d;n[0]=c*h,n[4]=-f,n[8]=d*h,n[1]=p*f+x,n[5]=a*h,n[9]=m*f-y,n[2]=y*f-m,n[6]=l*h,n[10]=x*f+p}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(e){return this.compose(p_,e,m_)}lookAt(e,n,i){const r=this.elements;return Gn.subVectors(e,n),Gn.lengthSq()===0&&(Gn.z=1),Gn.normalize(),yr.crossVectors(i,Gn),yr.lengthSq()===0&&(Math.abs(i.z)===1?Gn.x+=1e-4:Gn.z+=1e-4,Gn.normalize(),yr.crossVectors(i,Gn)),yr.normalize(),yl.crossVectors(Gn,yr),r[0]=yr.x,r[4]=yl.x,r[8]=Gn.x,r[1]=yr.y,r[5]=yl.y,r[9]=Gn.y,r[2]=yr.z,r[6]=yl.z,r[10]=Gn.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const i=e.elements,r=n.elements,s=this.elements,a=i[0],l=i[4],c=i[8],d=i[12],h=i[1],f=i[5],p=i[9],m=i[13],y=i[2],x=i[6],g=i[10],u=i[14],v=i[3],b=i[7],w=i[11],R=i[15],C=r[0],A=r[4],B=r[8],S=r[12],k=r[1],U=r[5],O=r[9],X=r[13],K=r[2],$=r[6],q=r[10],J=r[14],V=r[3],ue=r[7],F=r[11],de=r[15];return s[0]=a*C+l*k+c*K+d*V,s[4]=a*A+l*U+c*$+d*ue,s[8]=a*B+l*O+c*q+d*F,s[12]=a*S+l*X+c*J+d*de,s[1]=h*C+f*k+p*K+m*V,s[5]=h*A+f*U+p*$+m*ue,s[9]=h*B+f*O+p*q+m*F,s[13]=h*S+f*X+p*J+m*de,s[2]=y*C+x*k+g*K+u*V,s[6]=y*A+x*U+g*$+u*ue,s[10]=y*B+x*O+g*q+u*F,s[14]=y*S+x*X+g*J+u*de,s[3]=v*C+b*k+w*K+R*V,s[7]=v*A+b*U+w*$+R*ue,s[11]=v*B+b*O+w*q+R*F,s[15]=v*S+b*X+w*J+R*de,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[4]*=e,n[8]*=e,n[12]*=e,n[1]*=e,n[5]*=e,n[9]*=e,n[13]*=e,n[2]*=e,n[6]*=e,n[10]*=e,n[14]*=e,n[3]*=e,n[7]*=e,n[11]*=e,n[15]*=e,this}determinant(){const e=this.elements,n=e[0],i=e[4],r=e[8],s=e[12],a=e[1],l=e[5],c=e[9],d=e[13],h=e[2],f=e[6],p=e[10],m=e[14],y=e[3],x=e[7],g=e[11],u=e[15],v=c*m-d*p,b=l*m-d*f,w=l*p-c*f,R=a*m-d*h,C=a*p-c*h,A=a*f-l*h;return n*(x*v-g*b+u*w)-i*(y*v-g*R+u*C)+r*(y*b-x*R+u*A)-s*(y*w-x*C+g*A)}transpose(){const e=this.elements;let n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}setPosition(e,n,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=n,r[14]=i),this}invert(){const e=this.elements,n=e[0],i=e[1],r=e[2],s=e[3],a=e[4],l=e[5],c=e[6],d=e[7],h=e[8],f=e[9],p=e[10],m=e[11],y=e[12],x=e[13],g=e[14],u=e[15],v=f*g*d-x*p*d+x*c*m-l*g*m-f*c*u+l*p*u,b=y*p*d-h*g*d-y*c*m+a*g*m+h*c*u-a*p*u,w=h*x*d-y*f*d+y*l*m-a*x*m-h*l*u+a*f*u,R=y*f*c-h*x*c-y*l*p+a*x*p+h*l*g-a*f*g,C=n*v+i*b+r*w+s*R;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const A=1/C;return e[0]=v*A,e[1]=(x*p*s-f*g*s-x*r*m+i*g*m+f*r*u-i*p*u)*A,e[2]=(l*g*s-x*c*s+x*r*d-i*g*d-l*r*u+i*c*u)*A,e[3]=(f*c*s-l*p*s-f*r*d+i*p*d+l*r*m-i*c*m)*A,e[4]=b*A,e[5]=(h*g*s-y*p*s+y*r*m-n*g*m-h*r*u+n*p*u)*A,e[6]=(y*c*s-a*g*s-y*r*d+n*g*d+a*r*u-n*c*u)*A,e[7]=(a*p*s-h*c*s+h*r*d-n*p*d-a*r*m+n*c*m)*A,e[8]=w*A,e[9]=(y*f*s-h*x*s-y*i*m+n*x*m+h*i*u-n*f*u)*A,e[10]=(a*x*s-y*l*s+y*i*d-n*x*d-a*i*u+n*l*u)*A,e[11]=(h*l*s-a*f*s-h*i*d+n*f*d+a*i*m-n*l*m)*A,e[12]=R*A,e[13]=(h*x*r-y*f*r+y*i*p-n*x*p-h*i*g+n*f*g)*A,e[14]=(y*l*r-a*x*r-y*i*c+n*x*c+a*i*g-n*l*g)*A,e[15]=(a*f*r-h*l*r+h*i*c-n*f*c-a*i*p+n*l*p)*A,this}scale(e){const n=this.elements,i=e.x,r=e.y,s=e.z;return n[0]*=i,n[4]*=r,n[8]*=s,n[1]*=i,n[5]*=r,n[9]*=s,n[2]*=i,n[6]*=r,n[10]*=s,n[3]*=i,n[7]*=r,n[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(n,i,r))}makeTranslation(e,n,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,n,0,0,1,i,0,0,0,1),this}makeRotationX(e){const n=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,n,-i,0,0,i,n,0,0,0,0,1),this}makeRotationY(e){const n=Math.cos(e),i=Math.sin(e);return this.set(n,0,i,0,0,1,0,0,-i,0,n,0,0,0,0,1),this}makeRotationZ(e){const n=Math.cos(e),i=Math.sin(e);return this.set(n,-i,0,0,i,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,n){const i=Math.cos(n),r=Math.sin(n),s=1-i,a=e.x,l=e.y,c=e.z,d=s*a,h=s*l;return this.set(d*a+i,d*l-r*c,d*c+r*l,0,d*l+r*c,h*l+i,h*c-r*a,0,d*c-r*l,h*c+r*a,s*c*c+i,0,0,0,0,1),this}makeScale(e,n,i){return this.set(e,0,0,0,0,n,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,n,i,r,s,a){return this.set(1,i,s,0,e,1,a,0,n,r,1,0,0,0,0,1),this}compose(e,n,i){const r=this.elements,s=n._x,a=n._y,l=n._z,c=n._w,d=s+s,h=a+a,f=l+l,p=s*d,m=s*h,y=s*f,x=a*h,g=a*f,u=l*f,v=c*d,b=c*h,w=c*f,R=i.x,C=i.y,A=i.z;return r[0]=(1-(x+u))*R,r[1]=(m+w)*R,r[2]=(y-b)*R,r[3]=0,r[4]=(m-w)*C,r[5]=(1-(p+u))*C,r[6]=(g+v)*C,r[7]=0,r[8]=(y+b)*A,r[9]=(g-v)*A,r[10]=(1-(p+x))*A,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,n,i){const r=this.elements;if(e.x=r[12],e.y=r[13],e.z=r[14],this.determinant()===0)return i.set(1,1,1),n.identity(),this;let s=Ds.set(r[0],r[1],r[2]).length();const a=Ds.set(r[4],r[5],r[6]).length(),l=Ds.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),fi.copy(this);const d=1/s,h=1/a,f=1/l;return fi.elements[0]*=d,fi.elements[1]*=d,fi.elements[2]*=d,fi.elements[4]*=h,fi.elements[5]*=h,fi.elements[6]*=h,fi.elements[8]*=f,fi.elements[9]*=f,fi.elements[10]*=f,n.setFromRotationMatrix(fi),i.x=s,i.y=a,i.z=l,this}makePerspective(e,n,i,r,s,a,l=Ii,c=!1){const d=this.elements,h=2*s/(n-e),f=2*s/(i-r),p=(n+e)/(n-e),m=(i+r)/(i-r);let y,x;if(c)y=s/(a-s),x=a*s/(a-s);else if(l===Ii)y=-(a+s)/(a-s),x=-2*a*s/(a-s);else if(l===Bc)y=-a/(a-s),x=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+l);return d[0]=h,d[4]=0,d[8]=p,d[12]=0,d[1]=0,d[5]=f,d[9]=m,d[13]=0,d[2]=0,d[6]=0,d[10]=y,d[14]=x,d[3]=0,d[7]=0,d[11]=-1,d[15]=0,this}makeOrthographic(e,n,i,r,s,a,l=Ii,c=!1){const d=this.elements,h=2/(n-e),f=2/(i-r),p=-(n+e)/(n-e),m=-(i+r)/(i-r);let y,x;if(c)y=1/(a-s),x=a/(a-s);else if(l===Ii)y=-2/(a-s),x=-(a+s)/(a-s);else if(l===Bc)y=-1/(a-s),x=-s/(a-s);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);return d[0]=h,d[4]=0,d[8]=0,d[12]=p,d[1]=0,d[5]=f,d[9]=0,d[13]=m,d[2]=0,d[6]=0,d[10]=y,d[14]=x,d[3]=0,d[7]=0,d[11]=0,d[15]=1,this}equals(e){const n=this.elements,i=e.elements;for(let r=0;r<16;r++)if(n[r]!==i[r])return!1;return!0}fromArray(e,n=0){for(let i=0;i<16;i++)this.elements[i]=e[i+n];return this}toArray(e=[],n=0){const i=this.elements;return e[n]=i[0],e[n+1]=i[1],e[n+2]=i[2],e[n+3]=i[3],e[n+4]=i[4],e[n+5]=i[5],e[n+6]=i[6],e[n+7]=i[7],e[n+8]=i[8],e[n+9]=i[9],e[n+10]=i[10],e[n+11]=i[11],e[n+12]=i[12],e[n+13]=i[13],e[n+14]=i[14],e[n+15]=i[15],e}}const Ds=new re,fi=new zt,p_=new re(0,0,0),m_=new re(1,1,1),yr=new re,yl=new re,Gn=new re,sg=new zt,ag=new Ss;class ji{constructor(e=0,n=0,i=0,r=ji.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,n,i,r=this._order){return this._x=e,this._y=n,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,n=this._order,i=!0){const r=e.elements,s=r[0],a=r[4],l=r[8],c=r[1],d=r[5],h=r[9],f=r[2],p=r[6],m=r[10];switch(n){case"XYZ":this._y=Math.asin(ft(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,m),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(p,d),this._z=0);break;case"YXZ":this._x=Math.asin(-ft(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(l,m),this._z=Math.atan2(c,d)):(this._y=Math.atan2(-f,s),this._z=0);break;case"ZXY":this._x=Math.asin(ft(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-f,m),this._z=Math.atan2(-a,d)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-ft(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(p,m),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-a,d));break;case"YZX":this._z=Math.asin(ft(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-h,d),this._y=Math.atan2(-f,s)):(this._x=0,this._y=Math.atan2(l,m));break;case"XZY":this._z=Math.asin(-ft(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(p,d),this._y=Math.atan2(l,s)):(this._x=Math.atan2(-h,m),this._y=0);break;default:lt("Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,n,i){return sg.makeRotationFromQuaternion(e),this.setFromRotationMatrix(sg,n,i)}setFromVector3(e,n=this._order){return this.set(e.x,e.y,e.z,n)}reorder(e){return ag.setFromEuler(this),this.setFromQuaternion(ag,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}ji.DEFAULT_ORDER="XYZ";class kp{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let g_=0;const og=new re,Ls=new Ss,Vi=new zt,vl=new re,Qa=new re,x_=new re,y_=new Ss,lg=new re(1,0,0),cg=new re(0,1,0),dg=new re(0,0,1),ug={type:"added"},v_={type:"removed"},Fs={type:"childadded",child:null},Xd={type:"childremoved",child:null};class xn extends Ms{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:g_++}),this.uuid=Wo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=xn.DEFAULT_UP.clone();const e=new re,n=new ji,i=new Ss,r=new re(1,1,1);function s(){i.setFromEuler(n,!1)}function a(){n.setFromQuaternion(i,void 0,!1)}n._onChange(s),i._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new zt},normalMatrix:{value:new ct}}),this.matrix=new zt,this.matrixWorld=new zt,this.matrixAutoUpdate=xn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=xn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new kp,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,n){this.quaternion.setFromAxisAngle(e,n)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,n){return Ls.setFromAxisAngle(e,n),this.quaternion.multiply(Ls),this}rotateOnWorldAxis(e,n){return Ls.setFromAxisAngle(e,n),this.quaternion.premultiply(Ls),this}rotateX(e){return this.rotateOnAxis(lg,e)}rotateY(e){return this.rotateOnAxis(cg,e)}rotateZ(e){return this.rotateOnAxis(dg,e)}translateOnAxis(e,n){return og.copy(e).applyQuaternion(this.quaternion),this.position.add(og.multiplyScalar(n)),this}translateX(e){return this.translateOnAxis(lg,e)}translateY(e){return this.translateOnAxis(cg,e)}translateZ(e){return this.translateOnAxis(dg,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Vi.copy(this.matrixWorld).invert())}lookAt(e,n,i){e.isVector3?vl.copy(e):vl.set(e,n,i);const r=this.parent;this.updateWorldMatrix(!0,!1),Qa.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Vi.lookAt(Qa,vl,this.up):Vi.lookAt(vl,Qa,this.up),this.quaternion.setFromRotationMatrix(Vi),r&&(Vi.extractRotation(r.matrixWorld),Ls.setFromRotationMatrix(Vi),this.quaternion.premultiply(Ls.invert()))}add(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return e===this?(vt("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(ug),Fs.child=e,this.dispatchEvent(Fs),Fs.child=null):vt("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(v_),Xd.child=e,this.dispatchEvent(Xd),Xd.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Vi.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Vi.multiply(e.parent.matrixWorld)),e.applyMatrix4(Vi),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(ug),Fs.child=e,this.dispatchEvent(Fs),Fs.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,n){if(this[e]===n)return this;for(let i=0,r=this.children.length;i<r;i++){const a=this.children[i].getObjectByProperty(e,n);if(a!==void 0)return a}}getObjectsByProperty(e,n,i=[]){this[e]===n&&i.push(this);const r=this.children;for(let s=0,a=r.length;s<a;s++)r[s].getObjectsByProperty(e,n,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Qa,e,x_),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Qa,y_,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(e){e(this);const n=this.children;for(let i=0,r=n.length;i<r;i++)n[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const n=this.children;for(let i=0,r=n.length;i<r;i++)n[i].traverseVisible(e)}traverseAncestors(e){const n=this.parent;n!==null&&(e(n),n.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const n=this.children;for(let i=0,r=n.length;i<r;i++)n[i].updateMatrixWorld(e)}updateWorldMatrix(e,n){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),n===!0){const r=this.children;for(let s=0,a=r.length;s<a;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(e){const n=e===void 0||typeof e=="string",i={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.geometryInfo=this._geometryInfo.map(l=>({...l,boundingBox:l.boundingBox?l.boundingBox.toJSON():void 0,boundingSphere:l.boundingSphere?l.boundingSphere.toJSON():void 0})),r.instanceInfo=this._instanceInfo.map(l=>({...l})),r.availableInstanceIds=this._availableInstanceIds.slice(),r.availableGeometryIds=this._availableGeometryIds.slice(),r.nextIndexStart=this._nextIndexStart,r.nextVertexStart=this._nextVertexStart,r.geometryCount=this._geometryCount,r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.matricesTexture=this._matricesTexture.toJSON(e),r.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(r.boundingBox=this.boundingBox.toJSON()));function s(l,c){return l[c.uuid]===void 0&&(l[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){const c=l.shapes;if(Array.isArray(c))for(let d=0,h=c.length;d<h;d++){const f=c[d];s(e.shapes,f)}else s(e.shapes,c)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const l=[];for(let c=0,d=this.material.length;c<d;c++)l.push(s(e.materials,this.material[c]));r.material=l}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let l=0;l<this.children.length;l++)r.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let l=0;l<this.animations.length;l++){const c=this.animations[l];r.animations.push(s(e.animations,c))}}if(n){const l=a(e.geometries),c=a(e.materials),d=a(e.textures),h=a(e.images),f=a(e.shapes),p=a(e.skeletons),m=a(e.animations),y=a(e.nodes);l.length>0&&(i.geometries=l),c.length>0&&(i.materials=c),d.length>0&&(i.textures=d),h.length>0&&(i.images=h),f.length>0&&(i.shapes=f),p.length>0&&(i.skeletons=p),m.length>0&&(i.animations=m),y.length>0&&(i.nodes=y)}return i.object=r,i;function a(l){const c=[];for(const d in l){const h=l[d];delete h.metadata,c.push(h)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,n=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),n===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}}xn.DEFAULT_UP=new re(0,1,0);xn.DEFAULT_MATRIX_AUTO_UPDATE=!0;xn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const pi=new re,Ki=new re,Yd=new re,Qi=new re,Us=new re,Os=new re,hg=new re,Zd=new re,Jd=new re,eu=new re,tu=new Gt,nu=new Gt,iu=new Gt;class yi{constructor(e=new re,n=new re,i=new re){this.a=e,this.b=n,this.c=i}static getNormal(e,n,i,r){r.subVectors(i,n),pi.subVectors(e,n),r.cross(pi);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,n,i,r,s){pi.subVectors(r,n),Ki.subVectors(i,n),Yd.subVectors(e,n);const a=pi.dot(pi),l=pi.dot(Ki),c=pi.dot(Yd),d=Ki.dot(Ki),h=Ki.dot(Yd),f=a*d-l*l;if(f===0)return s.set(0,0,0),null;const p=1/f,m=(d*c-l*h)*p,y=(a*h-l*c)*p;return s.set(1-m-y,y,m)}static containsPoint(e,n,i,r){return this.getBarycoord(e,n,i,r,Qi)===null?!1:Qi.x>=0&&Qi.y>=0&&Qi.x+Qi.y<=1}static getInterpolation(e,n,i,r,s,a,l,c){return this.getBarycoord(e,n,i,r,Qi)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,Qi.x),c.addScaledVector(a,Qi.y),c.addScaledVector(l,Qi.z),c)}static getInterpolatedAttribute(e,n,i,r,s,a){return tu.setScalar(0),nu.setScalar(0),iu.setScalar(0),tu.fromBufferAttribute(e,n),nu.fromBufferAttribute(e,i),iu.fromBufferAttribute(e,r),a.setScalar(0),a.addScaledVector(tu,s.x),a.addScaledVector(nu,s.y),a.addScaledVector(iu,s.z),a}static isFrontFacing(e,n,i,r){return pi.subVectors(i,n),Ki.subVectors(e,n),pi.cross(Ki).dot(r)<0}set(e,n,i){return this.a.copy(e),this.b.copy(n),this.c.copy(i),this}setFromPointsAndIndices(e,n,i,r){return this.a.copy(e[n]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,n,i,r){return this.a.fromBufferAttribute(e,n),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return pi.subVectors(this.c,this.b),Ki.subVectors(this.a,this.b),pi.cross(Ki).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return yi.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return yi.getBarycoord(e,this.a,this.b,this.c,n)}getInterpolation(e,n,i,r,s){return yi.getInterpolation(e,this.a,this.b,this.c,n,i,r,s)}containsPoint(e){return yi.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return yi.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,n){const i=this.a,r=this.b,s=this.c;let a,l;Us.subVectors(r,i),Os.subVectors(s,i),Zd.subVectors(e,i);const c=Us.dot(Zd),d=Os.dot(Zd);if(c<=0&&d<=0)return n.copy(i);Jd.subVectors(e,r);const h=Us.dot(Jd),f=Os.dot(Jd);if(h>=0&&f<=h)return n.copy(r);const p=c*f-h*d;if(p<=0&&c>=0&&h<=0)return a=c/(c-h),n.copy(i).addScaledVector(Us,a);eu.subVectors(e,s);const m=Us.dot(eu),y=Os.dot(eu);if(y>=0&&m<=y)return n.copy(s);const x=m*d-c*y;if(x<=0&&d>=0&&y<=0)return l=d/(d-y),n.copy(i).addScaledVector(Os,l);const g=h*y-m*f;if(g<=0&&f-h>=0&&m-y>=0)return hg.subVectors(s,r),l=(f-h)/(f-h+(m-y)),n.copy(r).addScaledVector(hg,l);const u=1/(g+x+p);return a=x*u,l=p*u,n.copy(i).addScaledVector(Us,a).addScaledVector(Os,l)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const qy={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},vr={h:0,s:0,l:0},bl={h:0,s:0,l:0};function ru(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}class dt{constructor(e,n,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,i)}set(e,n,i){if(n===void 0&&i===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,n,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=ni){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,bt.colorSpaceToWorking(this,n),this}setRGB(e,n,i,r=bt.workingColorSpace){return this.r=e,this.g=n,this.b=i,bt.colorSpaceToWorking(this,r),this}setHSL(e,n,i,r=bt.workingColorSpace){if(e=s_(e,1),n=ft(n,0,1),i=ft(i,0,1),n===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+n):i+n-i*n,a=2*i-s;this.r=ru(a,s,e+1/3),this.g=ru(a,s,e),this.b=ru(a,s,e-1/3)}return bt.colorSpaceToWorking(this,r),this}setStyle(e,n=ni){function i(s){s!==void 0&&parseFloat(s)<1&&lt("Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=r[1],l=r[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:lt("Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(a===6)return this.setHex(parseInt(s,16),n);lt("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=ni){const i=qy[e.toLowerCase()];return i!==void 0?this.setHex(i,n):lt("Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=nr(e.r),this.g=nr(e.g),this.b=nr(e.b),this}copyLinearToSRGB(e){return this.r=ha(e.r),this.g=ha(e.g),this.b=ha(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ni){return bt.workingToColorSpace(fn.copy(this),e),Math.round(ft(fn.r*255,0,255))*65536+Math.round(ft(fn.g*255,0,255))*256+Math.round(ft(fn.b*255,0,255))}getHexString(e=ni){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=bt.workingColorSpace){bt.workingToColorSpace(fn.copy(this),n);const i=fn.r,r=fn.g,s=fn.b,a=Math.max(i,r,s),l=Math.min(i,r,s);let c,d;const h=(l+a)/2;if(l===a)c=0,d=0;else{const f=a-l;switch(d=h<=.5?f/(a+l):f/(2-a-l),a){case i:c=(r-s)/f+(r<s?6:0);break;case r:c=(s-i)/f+2;break;case s:c=(i-r)/f+4;break}c/=6}return e.h=c,e.s=d,e.l=h,e}getRGB(e,n=bt.workingColorSpace){return bt.workingToColorSpace(fn.copy(this),n),e.r=fn.r,e.g=fn.g,e.b=fn.b,e}getStyle(e=ni){bt.workingToColorSpace(fn.copy(this),e);const n=fn.r,i=fn.g,r=fn.b;return e!==ni?`color(${e} ${n.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(i*255)},${Math.round(r*255)})`}offsetHSL(e,n,i){return this.getHSL(vr),this.setHSL(vr.h+e,vr.s+n,vr.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,i){return this.r=e.r+(n.r-e.r)*i,this.g=e.g+(n.g-e.g)*i,this.b=e.b+(n.b-e.b)*i,this}lerpHSL(e,n){this.getHSL(vr),e.getHSL(bl);const i=zd(vr.h,bl.h,n),r=zd(vr.s,bl.s,n),s=zd(vr.l,bl.l,n);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,i=this.g,r=this.b,s=e.elements;return this.r=s[0]*n+s[3]*i+s[6]*r,this.g=s[1]*n+s[4]*i+s[7]*r,this.b=s[2]*n+s[5]*i+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const fn=new dt;dt.NAMES=qy;let b_=0;class Ho extends Ms{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:b_++}),this.uuid=Wo(),this.name="",this.type="Material",this.blending=ua,this.side=Hr,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=bh,this.blendDst=_h,this.blendEquation=as,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new dt(0,0,0),this.blendAlpha=0,this.depthFunc=Sa,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Ym,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=As,this.stencilZFail=As,this.stencilZPass=As,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const n in e){const i=e[n];if(i===void 0){lt(`Material: parameter '${n}' has value of undefined.`);continue}const r=this[n];if(r===void 0){lt(`Material: '${n}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[n]=i}}toJSON(e){const n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{}});const i={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(i.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(i.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==ua&&(i.blending=this.blending),this.side!==Hr&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==bh&&(i.blendSrc=this.blendSrc),this.blendDst!==_h&&(i.blendDst=this.blendDst),this.blendEquation!==as&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==Sa&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Ym&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==As&&(i.stencilFail=this.stencilFail),this.stencilZFail!==As&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==As&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.allowOverride===!1&&(i.allowOverride=!1),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(s){const a=[];for(const l in s){const c=s[l];delete c.metadata,a.push(c)}return a}if(n){const s=r(e.textures),a=r(e.images);s.length>0&&(i.textures=s),a.length>0&&(i.images=a)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const n=e.clippingPlanes;let i=null;if(n!==null){const r=n.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=n[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.allowOverride=e.allowOverride,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class Dc extends Ho{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new dt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ji,this.combine=Ty,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Vt=new re,_l=new it;let __=0;class Oi{constructor(e,n,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:__++}),this.name="",this.array=e,this.itemSize=n,this.count=e!==void 0?e.length/n:0,this.normalized=i,this.usage=Zm,this.updateRanges=[],this.gpuType=Bi,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,n,i){e*=this.itemSize,i*=n.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=n.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let n=0,i=this.count;n<i;n++)_l.fromBufferAttribute(this,n),_l.applyMatrix3(e),this.setXY(n,_l.x,_l.y);else if(this.itemSize===3)for(let n=0,i=this.count;n<i;n++)Vt.fromBufferAttribute(this,n),Vt.applyMatrix3(e),this.setXYZ(n,Vt.x,Vt.y,Vt.z);return this}applyMatrix4(e){for(let n=0,i=this.count;n<i;n++)Vt.fromBufferAttribute(this,n),Vt.applyMatrix4(e),this.setXYZ(n,Vt.x,Vt.y,Vt.z);return this}applyNormalMatrix(e){for(let n=0,i=this.count;n<i;n++)Vt.fromBufferAttribute(this,n),Vt.applyNormalMatrix(e),this.setXYZ(n,Vt.x,Vt.y,Vt.z);return this}transformDirection(e){for(let n=0,i=this.count;n<i;n++)Vt.fromBufferAttribute(this,n),Vt.transformDirection(e),this.setXYZ(n,Vt.x,Vt.y,Vt.z);return this}set(e,n=0){return this.array.set(e,n),this}getComponent(e,n){let i=this.array[e*this.itemSize+n];return this.normalized&&(i=Ha(i,this.array)),i}setComponent(e,n,i){return this.normalized&&(i=Pn(i,this.array)),this.array[e*this.itemSize+n]=i,this}getX(e){let n=this.array[e*this.itemSize];return this.normalized&&(n=Ha(n,this.array)),n}setX(e,n){return this.normalized&&(n=Pn(n,this.array)),this.array[e*this.itemSize]=n,this}getY(e){let n=this.array[e*this.itemSize+1];return this.normalized&&(n=Ha(n,this.array)),n}setY(e,n){return this.normalized&&(n=Pn(n,this.array)),this.array[e*this.itemSize+1]=n,this}getZ(e){let n=this.array[e*this.itemSize+2];return this.normalized&&(n=Ha(n,this.array)),n}setZ(e,n){return this.normalized&&(n=Pn(n,this.array)),this.array[e*this.itemSize+2]=n,this}getW(e){let n=this.array[e*this.itemSize+3];return this.normalized&&(n=Ha(n,this.array)),n}setW(e,n){return this.normalized&&(n=Pn(n,this.array)),this.array[e*this.itemSize+3]=n,this}setXY(e,n,i){return e*=this.itemSize,this.normalized&&(n=Pn(n,this.array),i=Pn(i,this.array)),this.array[e+0]=n,this.array[e+1]=i,this}setXYZ(e,n,i,r){return e*=this.itemSize,this.normalized&&(n=Pn(n,this.array),i=Pn(i,this.array),r=Pn(r,this.array)),this.array[e+0]=n,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,n,i,r,s){return e*=this.itemSize,this.normalized&&(n=Pn(n,this.array),i=Pn(i,this.array),r=Pn(r,this.array),s=Pn(s,this.array)),this.array[e+0]=n,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Zm&&(e.usage=this.usage),e}}class $y extends Oi{constructor(e,n,i){super(new Uint16Array(e),n,i)}}class Xy extends Oi{constructor(e,n,i){super(new Uint32Array(e),n,i)}}class kn extends Oi{constructor(e,n,i){super(new Float32Array(e),n,i)}}let S_=0;const ti=new zt,su=new xn,zs=new re,Hn=new Go,qa=new Go,en=new re;class ki extends Ms{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:S_++}),this.uuid=Wo(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.indirectOffset=0,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Ky(e)?Xy:$y)(e,1):this.index=e,this}setIndirect(e,n=0){return this.indirect=e,this.indirectOffset=n,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,n){return this.attributes[e]=n,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,n,i=0){this.groups.push({start:e,count:n,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,n){this.drawRange.start=e,this.drawRange.count=n}applyMatrix4(e){const n=this.attributes.position;n!==void 0&&(n.applyMatrix4(e),n.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new ct().getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return ti.makeRotationFromQuaternion(e),this.applyMatrix4(ti),this}rotateX(e){return ti.makeRotationX(e),this.applyMatrix4(ti),this}rotateY(e){return ti.makeRotationY(e),this.applyMatrix4(ti),this}rotateZ(e){return ti.makeRotationZ(e),this.applyMatrix4(ti),this}translate(e,n,i){return ti.makeTranslation(e,n,i),this.applyMatrix4(ti),this}scale(e,n,i){return ti.makeScale(e,n,i),this.applyMatrix4(ti),this}lookAt(e){return su.lookAt(e),su.updateMatrix(),this.applyMatrix4(su.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(zs).negate(),this.translate(zs.x,zs.y,zs.z),this}setFromPoints(e){const n=this.getAttribute("position");if(n===void 0){const i=[];for(let r=0,s=e.length;r<s;r++){const a=e[r];i.push(a.x,a.y,a.z||0)}this.setAttribute("position",new kn(i,3))}else{const i=Math.min(e.length,n.count);for(let r=0;r<i;r++){const s=e[r];n.setXYZ(r,s.x,s.y,s.z||0)}e.length>n.count&&lt("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),n.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Go);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){vt("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new re(-1/0,-1/0,-1/0),new re(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),n)for(let i=0,r=n.length;i<r;i++){const s=n[i];Hn.setFromBufferAttribute(s),this.morphTargetsRelative?(en.addVectors(this.boundingBox.min,Hn.min),this.boundingBox.expandByPoint(en),en.addVectors(this.boundingBox.max,Hn.max),this.boundingBox.expandByPoint(en)):(this.boundingBox.expandByPoint(Hn.min),this.boundingBox.expandByPoint(Hn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&vt('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sp);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){vt("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new re,1/0);return}if(e){const i=this.boundingSphere.center;if(Hn.setFromBufferAttribute(e),n)for(let s=0,a=n.length;s<a;s++){const l=n[s];qa.setFromBufferAttribute(l),this.morphTargetsRelative?(en.addVectors(Hn.min,qa.min),Hn.expandByPoint(en),en.addVectors(Hn.max,qa.max),Hn.expandByPoint(en)):(Hn.expandByPoint(qa.min),Hn.expandByPoint(qa.max))}Hn.getCenter(i);let r=0;for(let s=0,a=e.count;s<a;s++)en.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(en));if(n)for(let s=0,a=n.length;s<a;s++){const l=n[s],c=this.morphTargetsRelative;for(let d=0,h=l.count;d<h;d++)en.fromBufferAttribute(l,d),c&&(zs.fromBufferAttribute(e,d),en.add(zs)),r=Math.max(r,i.distanceToSquared(en))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&vt('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,n=this.attributes;if(e===null||n.position===void 0||n.normal===void 0||n.uv===void 0){vt("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=n.position,r=n.normal,s=n.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Oi(new Float32Array(4*i.count),4));const a=this.getAttribute("tangent"),l=[],c=[];for(let B=0;B<i.count;B++)l[B]=new re,c[B]=new re;const d=new re,h=new re,f=new re,p=new it,m=new it,y=new it,x=new re,g=new re;function u(B,S,k){d.fromBufferAttribute(i,B),h.fromBufferAttribute(i,S),f.fromBufferAttribute(i,k),p.fromBufferAttribute(s,B),m.fromBufferAttribute(s,S),y.fromBufferAttribute(s,k),h.sub(d),f.sub(d),m.sub(p),y.sub(p);const U=1/(m.x*y.y-y.x*m.y);isFinite(U)&&(x.copy(h).multiplyScalar(y.y).addScaledVector(f,-m.y).multiplyScalar(U),g.copy(f).multiplyScalar(m.x).addScaledVector(h,-y.x).multiplyScalar(U),l[B].add(x),l[S].add(x),l[k].add(x),c[B].add(g),c[S].add(g),c[k].add(g))}let v=this.groups;v.length===0&&(v=[{start:0,count:e.count}]);for(let B=0,S=v.length;B<S;++B){const k=v[B],U=k.start,O=k.count;for(let X=U,K=U+O;X<K;X+=3)u(e.getX(X+0),e.getX(X+1),e.getX(X+2))}const b=new re,w=new re,R=new re,C=new re;function A(B){R.fromBufferAttribute(r,B),C.copy(R);const S=l[B];b.copy(S),b.sub(R.multiplyScalar(R.dot(S))).normalize(),w.crossVectors(C,S);const U=w.dot(c[B])<0?-1:1;a.setXYZW(B,b.x,b.y,b.z,U)}for(let B=0,S=v.length;B<S;++B){const k=v[B],U=k.start,O=k.count;for(let X=U,K=U+O;X<K;X+=3)A(e.getX(X+0)),A(e.getX(X+1)),A(e.getX(X+2))}}computeVertexNormals(){const e=this.index,n=this.getAttribute("position");if(n!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Oi(new Float32Array(n.count*3),3),this.setAttribute("normal",i);else for(let p=0,m=i.count;p<m;p++)i.setXYZ(p,0,0,0);const r=new re,s=new re,a=new re,l=new re,c=new re,d=new re,h=new re,f=new re;if(e)for(let p=0,m=e.count;p<m;p+=3){const y=e.getX(p+0),x=e.getX(p+1),g=e.getX(p+2);r.fromBufferAttribute(n,y),s.fromBufferAttribute(n,x),a.fromBufferAttribute(n,g),h.subVectors(a,s),f.subVectors(r,s),h.cross(f),l.fromBufferAttribute(i,y),c.fromBufferAttribute(i,x),d.fromBufferAttribute(i,g),l.add(h),c.add(h),d.add(h),i.setXYZ(y,l.x,l.y,l.z),i.setXYZ(x,c.x,c.y,c.z),i.setXYZ(g,d.x,d.y,d.z)}else for(let p=0,m=n.count;p<m;p+=3)r.fromBufferAttribute(n,p+0),s.fromBufferAttribute(n,p+1),a.fromBufferAttribute(n,p+2),h.subVectors(a,s),f.subVectors(r,s),h.cross(f),i.setXYZ(p+0,h.x,h.y,h.z),i.setXYZ(p+1,h.x,h.y,h.z),i.setXYZ(p+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let n=0,i=e.count;n<i;n++)en.fromBufferAttribute(e,n),en.normalize(),e.setXYZ(n,en.x,en.y,en.z)}toNonIndexed(){function e(l,c){const d=l.array,h=l.itemSize,f=l.normalized,p=new d.constructor(c.length*h);let m=0,y=0;for(let x=0,g=c.length;x<g;x++){l.isInterleavedBufferAttribute?m=c[x]*l.data.stride+l.offset:m=c[x]*h;for(let u=0;u<h;u++)p[y++]=d[m++]}return new Oi(p,h,f)}if(this.index===null)return lt("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new ki,i=this.index.array,r=this.attributes;for(const l in r){const c=r[l],d=e(c,i);n.setAttribute(l,d)}const s=this.morphAttributes;for(const l in s){const c=[],d=s[l];for(let h=0,f=d.length;h<f;h++){const p=d[h],m=e(p,i);c.push(m)}n.morphAttributes[l]=c}n.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let l=0,c=a.length;l<c;l++){const d=a[l];n.addGroup(d.start,d.count,d.materialIndex)}return n}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const d in c)c[d]!==void 0&&(e[d]=c[d]);return e}e.data={attributes:{}};const n=this.index;n!==null&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});const i=this.attributes;for(const c in i){const d=i[c];e.data.attributes[c]=d.toJSON(e.data)}const r={};let s=!1;for(const c in this.morphAttributes){const d=this.morphAttributes[c],h=[];for(let f=0,p=d.length;f<p;f++){const m=d[f];h.push(m.toJSON(e.data))}h.length>0&&(r[c]=h,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const l=this.boundingSphere;return l!==null&&(e.data.boundingSphere=l.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const n={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone());const r=e.attributes;for(const d in r){const h=r[d];this.setAttribute(d,h.clone(n))}const s=e.morphAttributes;for(const d in s){const h=[],f=s[d];for(let p=0,m=f.length;p<m;p++)h.push(f[p].clone(n));this.morphAttributes[d]=h}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let d=0,h=a.length;d<h;d++){const f=a[d];this.addGroup(f.start,f.count,f.materialIndex)}const l=e.boundingBox;l!==null&&(this.boundingBox=l.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const fg=new zt,Jr=new wp,Sl=new Sp,pg=new re,wl=new re,kl=new re,Ml=new re,au=new re,Rl=new re,mg=new re,El=new re;class Dn extends xn{constructor(e=new ki,n=new Dc){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=n,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const n=this.geometry.morphAttributes,i=Object.keys(n);if(i.length>0){const r=n[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const l=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=s}}}}getVertexPosition(e,n){const i=this.geometry,r=i.attributes.position,s=i.morphAttributes.position,a=i.morphTargetsRelative;n.fromBufferAttribute(r,e);const l=this.morphTargetInfluences;if(s&&l){Rl.set(0,0,0);for(let c=0,d=s.length;c<d;c++){const h=l[c],f=s[c];h!==0&&(au.fromBufferAttribute(f,e),a?Rl.addScaledVector(au,h):Rl.addScaledVector(au.sub(n),h))}n.add(Rl)}return n}raycast(e,n){const i=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),Sl.copy(i.boundingSphere),Sl.applyMatrix4(s),Jr.copy(e.ray).recast(e.near),!(Sl.containsPoint(Jr.origin)===!1&&(Jr.intersectSphere(Sl,pg)===null||Jr.origin.distanceToSquared(pg)>(e.far-e.near)**2))&&(fg.copy(s).invert(),Jr.copy(e.ray).applyMatrix4(fg),!(i.boundingBox!==null&&Jr.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,n,Jr)))}_computeIntersections(e,n,i){let r;const s=this.geometry,a=this.material,l=s.index,c=s.attributes.position,d=s.attributes.uv,h=s.attributes.uv1,f=s.attributes.normal,p=s.groups,m=s.drawRange;if(l!==null)if(Array.isArray(a))for(let y=0,x=p.length;y<x;y++){const g=p[y],u=a[g.materialIndex],v=Math.max(g.start,m.start),b=Math.min(l.count,Math.min(g.start+g.count,m.start+m.count));for(let w=v,R=b;w<R;w+=3){const C=l.getX(w),A=l.getX(w+1),B=l.getX(w+2);r=Cl(this,u,e,i,d,h,f,C,A,B),r&&(r.faceIndex=Math.floor(w/3),r.face.materialIndex=g.materialIndex,n.push(r))}}else{const y=Math.max(0,m.start),x=Math.min(l.count,m.start+m.count);for(let g=y,u=x;g<u;g+=3){const v=l.getX(g),b=l.getX(g+1),w=l.getX(g+2);r=Cl(this,a,e,i,d,h,f,v,b,w),r&&(r.faceIndex=Math.floor(g/3),n.push(r))}}else if(c!==void 0)if(Array.isArray(a))for(let y=0,x=p.length;y<x;y++){const g=p[y],u=a[g.materialIndex],v=Math.max(g.start,m.start),b=Math.min(c.count,Math.min(g.start+g.count,m.start+m.count));for(let w=v,R=b;w<R;w+=3){const C=w,A=w+1,B=w+2;r=Cl(this,u,e,i,d,h,f,C,A,B),r&&(r.faceIndex=Math.floor(w/3),r.face.materialIndex=g.materialIndex,n.push(r))}}else{const y=Math.max(0,m.start),x=Math.min(c.count,m.start+m.count);for(let g=y,u=x;g<u;g+=3){const v=g,b=g+1,w=g+2;r=Cl(this,a,e,i,d,h,f,v,b,w),r&&(r.faceIndex=Math.floor(g/3),n.push(r))}}}}function w_(t,e,n,i,r,s,a,l){let c;if(e.side===zn?c=i.intersectTriangle(a,s,r,!0,l):c=i.intersectTriangle(r,s,a,e.side===Hr,l),c===null)return null;El.copy(l),El.applyMatrix4(t.matrixWorld);const d=n.ray.origin.distanceTo(El);return d<n.near||d>n.far?null:{distance:d,point:El.clone(),object:t}}function Cl(t,e,n,i,r,s,a,l,c,d){t.getVertexPosition(l,wl),t.getVertexPosition(c,kl),t.getVertexPosition(d,Ml);const h=w_(t,e,n,i,wl,kl,Ml,mg);if(h){const f=new re;yi.getBarycoord(mg,wl,kl,Ml,f),r&&(h.uv=yi.getInterpolatedAttribute(r,l,c,d,f,new it)),s&&(h.uv1=yi.getInterpolatedAttribute(s,l,c,d,f,new it)),a&&(h.normal=yi.getInterpolatedAttribute(a,l,c,d,f,new re),h.normal.dot(i.direction)>0&&h.normal.multiplyScalar(-1));const p={a:l,b:c,c:d,normal:new re,materialIndex:0};yi.getNormal(wl,kl,Ml,p.normal),h.face=p,h.barycoord=f}return h}class zr extends ki{constructor(e=1,n=1,i=1,r=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:i,widthSegments:r,heightSegments:s,depthSegments:a};const l=this;r=Math.floor(r),s=Math.floor(s),a=Math.floor(a);const c=[],d=[],h=[],f=[];let p=0,m=0;y("z","y","x",-1,-1,i,n,e,a,s,0),y("z","y","x",1,-1,i,n,-e,a,s,1),y("x","z","y",1,1,e,i,n,r,a,2),y("x","z","y",1,-1,e,i,-n,r,a,3),y("x","y","z",1,-1,e,n,i,r,s,4),y("x","y","z",-1,-1,e,n,-i,r,s,5),this.setIndex(c),this.setAttribute("position",new kn(d,3)),this.setAttribute("normal",new kn(h,3)),this.setAttribute("uv",new kn(f,2));function y(x,g,u,v,b,w,R,C,A,B,S){const k=w/A,U=R/B,O=w/2,X=R/2,K=C/2,$=A+1,q=B+1;let J=0,V=0;const ue=new re;for(let F=0;F<q;F++){const de=F*U-X;for(let Te=0;Te<$;Te++){const xe=Te*k-O;ue[x]=xe*v,ue[g]=de*b,ue[u]=K,d.push(ue.x,ue.y,ue.z),ue[x]=0,ue[g]=0,ue[u]=C>0?1:-1,h.push(ue.x,ue.y,ue.z),f.push(Te/A),f.push(1-F/B),J+=1}}for(let F=0;F<B;F++)for(let de=0;de<A;de++){const Te=p+de+$*F,xe=p+de+$*(F+1),le=p+(de+1)+$*(F+1),Re=p+(de+1)+$*F;c.push(Te,xe,Re),c.push(xe,le,Re),V+=6}l.addGroup(m,V,S),m+=V,p+=J}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new zr(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Ra(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(lt("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][i]=null):e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}function bn(t){const e={};for(let n=0;n<t.length;n++){const i=Ra(t[n]);for(const r in i)e[r]=i[r]}return e}function k_(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}function Yy(t){const e=t.getRenderTarget();return e===null?t.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:bt.workingColorSpace}const M_={clone:Ra,merge:bn};var R_=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,E_=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Wi extends Ho{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=R_,this.fragmentShader=E_,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ra(e.uniforms),this.uniformsGroups=k_(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this.defaultAttributeValues=Object.assign({},e.defaultAttributeValues),this.index0AttributeName=e.index0AttributeName,this.uniformsNeedUpdate=e.uniformsNeedUpdate,this}toJSON(e){const n=super.toJSON(e);n.glslVersion=this.glslVersion,n.uniforms={};for(const r in this.uniforms){const a=this.uniforms[r].value;a&&a.isTexture?n.uniforms[r]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?n.uniforms[r]={type:"c",value:a.getHex()}:a&&a.isVector2?n.uniforms[r]={type:"v2",value:a.toArray()}:a&&a.isVector3?n.uniforms[r]={type:"v3",value:a.toArray()}:a&&a.isVector4?n.uniforms[r]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?n.uniforms[r]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?n.uniforms[r]={type:"m4",value:a.toArray()}:n.uniforms[r]={value:a}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader,n.lights=this.lights,n.clipping=this.clipping;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(n.extensions=i),n}}class Zy extends xn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new zt,this.projectionMatrix=new zt,this.projectionMatrixInverse=new zt,this.coordinateSystem=Ii,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,n){return super.copy(e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,n){super.updateWorldMatrix(e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const br=new re,gg=new it,xg=new it;class si extends Zy{constructor(e=50,n=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const n=.5*this.getFilmHeight()/e;this.fov=hf*2*Math.atan(n),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(rc*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return hf*2*Math.atan(Math.tan(rc*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,n,i){br.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(br.x,br.y).multiplyScalar(-e/br.z),br.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(br.x,br.y).multiplyScalar(-e/br.z)}getViewSize(e,n){return this.getViewBounds(e,gg,xg),n.subVectors(xg,gg)}setViewOffset(e,n,i,r,s,a){this.aspect=e/n,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let n=e*Math.tan(rc*.5*this.fov)/this.zoom,i=2*n,r=this.aspect*i,s=-.5*r;const a=this.view;if(this.view!==null&&this.view.enabled){const c=a.fullWidth,d=a.fullHeight;s+=a.offsetX*r/c,n-=a.offsetY*i/d,r*=a.width/c,i*=a.height/d}const l=this.filmOffset;l!==0&&(s+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,n,n-i,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,this.view!==null&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}}const js=-90,Ws=1;class C_ extends xn{constructor(e,n,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new si(js,Ws,e,n);r.layers=this.layers,this.add(r);const s=new si(js,Ws,e,n);s.layers=this.layers,this.add(s);const a=new si(js,Ws,e,n);a.layers=this.layers,this.add(a);const l=new si(js,Ws,e,n);l.layers=this.layers,this.add(l);const c=new si(js,Ws,e,n);c.layers=this.layers,this.add(c);const d=new si(js,Ws,e,n);d.layers=this.layers,this.add(d)}updateCoordinateSystem(){const e=this.coordinateSystem,n=this.children.concat(),[i,r,s,a,l,c]=n;for(const d of n)this.remove(d);if(e===Ii)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),l.up.set(0,1,0),l.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===Bc)i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),l.up.set(0,-1,0),l.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const d of n)this.add(d),d.updateMatrixWorld()}update(e,n){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,a,l,c,d,h]=this.children,f=e.getRenderTarget(),p=e.getActiveCubeFace(),m=e.getActiveMipmapLevel(),y=e.xr.enabled;e.xr.enabled=!1;const x=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,r),e.render(n,s),e.setRenderTarget(i,1,r),e.render(n,a),e.setRenderTarget(i,2,r),e.render(n,l),e.setRenderTarget(i,3,r),e.render(n,c),e.setRenderTarget(i,4,r),e.render(n,d),i.texture.generateMipmaps=x,e.setRenderTarget(i,5,r),e.render(n,h),e.setRenderTarget(f,p,m),e.xr.enabled=y,i.texture.needsPMREMUpdate=!0}}class Jy extends wn{constructor(e=[],n=_s,i,r,s,a,l,c,d,h){super(e,n,i,r,s,a,l,c,d,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class e1 extends Ui{constructor(e=1,n={}){super(e,e,n),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new Jy(r),this._setTextureOptions(n),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,n){this.texture.type=n.type,this.texture.colorSpace=n.colorSpace,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new zr(5,5,5),s=new Wi({name:"CubemapFromEquirect",uniforms:Ra(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:zn,blending:tr});s.uniforms.tEquirect.value=n;const a=new Dn(r,s),l=n.minFilter;return n.minFilter===us&&(n.minFilter=gn),new C_(1,10,this).update(e,a),n.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(e,n=!0,i=!0,r=!0){const s=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(n,i,r);e.setRenderTarget(s)}}class ia extends xn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const T_={type:"move"};class ou{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ia,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ia,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new re,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new re),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ia,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new re,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new re),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const n=this._hand;if(n)for(const i of e.hand.values())this._getHandJoint(n,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,n,i){let r=null,s=null,a=null;const l=this._targetRay,c=this._grip,d=this._hand;if(e&&n.session.visibilityState!=="visible-blurred"){if(d&&e.hand){a=!0;for(const x of e.hand.values()){const g=n.getJointPose(x,i),u=this._getHandJoint(d,x);g!==null&&(u.matrix.fromArray(g.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.matrixWorldNeedsUpdate=!0,u.jointRadius=g.radius),u.visible=g!==null}const h=d.joints["index-finger-tip"],f=d.joints["thumb-tip"],p=h.position.distanceTo(f.position),m=.02,y=.005;d.inputState.pinching&&p>m+y?(d.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!d.inputState.pinching&&p<=m-y&&(d.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(s=n.getPose(e.gripSpace,i),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));l!==null&&(r=n.getPose(e.targetRaySpace,i),r===null&&s!==null&&(r=s),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1,this.dispatchEvent(T_)))}return l!==null&&(l.visible=r!==null),c!==null&&(c.visible=s!==null),d!==null&&(d.visible=a!==null),this}_getHandJoint(e,n){if(e.joints[n.jointName]===void 0){const i=new ia;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[n.jointName]=i,e.add(i)}return e.joints[n.jointName]}}class A_ extends xn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new ji,this.environmentIntensity=1,this.environmentRotation=new ji,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,n){return super.copy(e,n),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const n=super.toJSON(e);return this.fog!==null&&(n.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(n.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(n.object.backgroundIntensity=this.backgroundIntensity),n.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(n.object.environmentIntensity=this.environmentIntensity),n.object.environmentRotation=this.environmentRotation.toArray(),n}}class P_ extends wn{constructor(e=null,n=1,i=1,r,s,a,l,c,d=on,h=on,f,p){super(null,a,l,c,d,h,r,s,f,p),this.isDataTexture=!0,this.image={data:e,width:n,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const lu=new re,N_=new re,B_=new ct;class Mr{constructor(e=new re(1,0,0),n=0){this.isPlane=!0,this.normal=e,this.constant=n}set(e,n){return this.normal.copy(e),this.constant=n,this}setComponents(e,n,i,r){return this.normal.set(e,n,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,n){return this.normal.copy(e),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(e,n,i){const r=lu.subVectors(i,n).cross(N_.subVectors(e,n)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,n){return n.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,n){const i=e.delta(lu),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?n.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:n.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const n=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return n<0&&i>0||i<0&&n>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,n){const i=n||B_.getNormalMatrix(e),r=this.coplanarPoint(lu).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const es=new Sp,I_=new it(.5,.5),Tl=new re;class Mp{constructor(e=new Mr,n=new Mr,i=new Mr,r=new Mr,s=new Mr,a=new Mr){this.planes=[e,n,i,r,s,a]}set(e,n,i,r,s,a){const l=this.planes;return l[0].copy(e),l[1].copy(n),l[2].copy(i),l[3].copy(r),l[4].copy(s),l[5].copy(a),this}copy(e){const n=this.planes;for(let i=0;i<6;i++)n[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,n=Ii,i=!1){const r=this.planes,s=e.elements,a=s[0],l=s[1],c=s[2],d=s[3],h=s[4],f=s[5],p=s[6],m=s[7],y=s[8],x=s[9],g=s[10],u=s[11],v=s[12],b=s[13],w=s[14],R=s[15];if(r[0].setComponents(d-a,m-h,u-y,R-v).normalize(),r[1].setComponents(d+a,m+h,u+y,R+v).normalize(),r[2].setComponents(d+l,m+f,u+x,R+b).normalize(),r[3].setComponents(d-l,m-f,u-x,R-b).normalize(),i)r[4].setComponents(c,p,g,w).normalize(),r[5].setComponents(d-c,m-p,u-g,R-w).normalize();else if(r[4].setComponents(d-c,m-p,u-g,R-w).normalize(),n===Ii)r[5].setComponents(d+c,m+p,u+g,R+w).normalize();else if(n===Bc)r[5].setComponents(c,p,g,w).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+n);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),es.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const n=e.geometry;n.boundingSphere===null&&n.computeBoundingSphere(),es.copy(n.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(es)}intersectsSprite(e){es.center.set(0,0,0);const n=I_.distanceTo(e.center);return es.radius=.7071067811865476+n,es.applyMatrix4(e.matrixWorld),this.intersectsSphere(es)}intersectsSphere(e){const n=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(n[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const n=this.planes;for(let i=0;i<6;i++){const r=n[i];if(Tl.x=r.normal.x>0?e.max.x:e.min.x,Tl.y=r.normal.y>0?e.max.y:e.min.y,Tl.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Tl)<0)return!1}return!0}containsPoint(e){const n=this.planes;for(let i=0;i<6;i++)if(n[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class Lo extends wn{constructor(e,n,i=zi,r,s,a,l=on,c=on,d,h=lr,f=1){if(h!==lr&&h!==hs)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const p={width:e,height:n,depth:f};super(p,r,s,a,l,c,h,i,d),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new _p(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const n=super.toJSON(e);return this.compareFunction!==null&&(n.compareFunction=this.compareFunction),n}}class D_ extends Lo{constructor(e,n=zi,i=_s,r,s,a=on,l=on,c,d=lr){const h={width:e,height:e,depth:1},f=[h,h,h,h,h,h];super(e,e,n,i,r,s,a,l,c,d),this.image=f,this.isCubeDepthTexture=!0,this.isCubeTexture=!0}get images(){return this.image}set images(e){this.image=e}}class t1 extends wn{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class Rp extends ki{constructor(e=1,n=32,i=0,r=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:n,thetaStart:i,thetaLength:r},n=Math.max(3,n);const s=[],a=[],l=[],c=[],d=new re,h=new it;a.push(0,0,0),l.push(0,0,1),c.push(.5,.5);for(let f=0,p=3;f<=n;f++,p+=3){const m=i+f/n*r;d.x=e*Math.cos(m),d.y=e*Math.sin(m),a.push(d.x,d.y,d.z),l.push(0,0,1),h.x=(a[p]/e+1)/2,h.y=(a[p+1]/e+1)/2,c.push(h.x,h.y)}for(let f=1;f<=n;f++)s.push(f,f+1,0);this.setIndex(s),this.setAttribute("position",new kn(a,3)),this.setAttribute("normal",new kn(l,3)),this.setAttribute("uv",new kn(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Rp(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Ep extends ki{constructor(e=[new it(0,-.5),new it(.5,0),new it(0,.5)],n=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:n,phiStart:i,phiLength:r},n=Math.floor(n),r=ft(r,0,Math.PI*2);const s=[],a=[],l=[],c=[],d=[],h=1/n,f=new re,p=new it,m=new re,y=new re,x=new re;let g=0,u=0;for(let v=0;v<=e.length-1;v++)switch(v){case 0:g=e[v+1].x-e[v].x,u=e[v+1].y-e[v].y,m.x=u*1,m.y=-g,m.z=u*0,x.copy(m),m.normalize(),c.push(m.x,m.y,m.z);break;case e.length-1:c.push(x.x,x.y,x.z);break;default:g=e[v+1].x-e[v].x,u=e[v+1].y-e[v].y,m.x=u*1,m.y=-g,m.z=u*0,y.copy(m),m.x+=x.x,m.y+=x.y,m.z+=x.z,m.normalize(),c.push(m.x,m.y,m.z),x.copy(y)}for(let v=0;v<=n;v++){const b=i+v*h*r,w=Math.sin(b),R=Math.cos(b);for(let C=0;C<=e.length-1;C++){f.x=e[C].x*w,f.y=e[C].y,f.z=e[C].x*R,a.push(f.x,f.y,f.z),p.x=v/n,p.y=C/(e.length-1),l.push(p.x,p.y);const A=c[3*C+0]*w,B=c[3*C+1],S=c[3*C+0]*R;d.push(A,B,S)}}for(let v=0;v<n;v++)for(let b=0;b<e.length-1;b++){const w=b+v*e.length,R=w,C=w+e.length,A=w+e.length+1,B=w+1;s.push(R,C,B),s.push(A,B,C)}this.setIndex(s),this.setAttribute("position",new kn(a,3)),this.setAttribute("uv",new kn(l,2)),this.setAttribute("normal",new kn(d,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ep(e.points,e.segments,e.phiStart,e.phiLength)}}class Vo extends ki{constructor(e=1,n=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:n,widthSegments:i,heightSegments:r};const s=e/2,a=n/2,l=Math.floor(i),c=Math.floor(r),d=l+1,h=c+1,f=e/l,p=n/c,m=[],y=[],x=[],g=[];for(let u=0;u<h;u++){const v=u*p-a;for(let b=0;b<d;b++){const w=b*f-s;y.push(w,-v,0),x.push(0,0,1),g.push(b/l),g.push(1-u/c)}}for(let u=0;u<c;u++)for(let v=0;v<l;v++){const b=v+d*u,w=v+d*(u+1),R=v+1+d*(u+1),C=v+1+d*u;m.push(b,w,C),m.push(w,R,C)}this.setIndex(m),this.setAttribute("position",new kn(y,3)),this.setAttribute("normal",new kn(x,3)),this.setAttribute("uv",new kn(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Vo(e.width,e.height,e.widthSegments,e.heightSegments)}}class L_ extends Wi{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class sc extends Ho{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new dt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Vy,this.normalScale=new it(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ji,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class F_ extends sc{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new it(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ft(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(n){this.ior=(1+.4*n)/(1-.4*n)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new dt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new dt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new dt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class U_ extends Ho{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=$2,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class O_ extends Ho{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class n1 extends xn{constructor(e,n=1){super(),this.isLight=!0,this.type="Light",this.color=new dt(e),this.intensity=n}dispose(){this.dispatchEvent({type:"dispose"})}copy(e,n){return super.copy(e,n),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const n=super.toJSON(e);return n.object.color=this.color.getHex(),n.object.intensity=this.intensity,n}}const cu=new zt,yg=new re,vg=new re;class z_{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new it(512,512),this.mapType=Qn,this.map=null,this.mapPass=null,this.matrix=new zt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Mp,this._frameExtents=new it(1,1),this._viewportCount=1,this._viewports=[new Gt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const n=this.camera,i=this.matrix;yg.setFromMatrixPosition(e.matrixWorld),n.position.copy(yg),vg.setFromMatrixPosition(e.target.matrixWorld),n.lookAt(vg),n.updateMatrixWorld(),cu.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(cu,n.coordinateSystem,n.reversedDepth),n.reversedDepth?i.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(cu)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Cp extends Zy{constructor(e=-1,n=1,i=1,r=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=n,this.top=i,this.bottom=r,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,n,i,r,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,a=i+e,l=r+n,c=r-n;if(this.view!==null&&this.view.enabled){const d=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=d*this.view.offsetX,a=s+d*this.view.width,l-=h*this.view.offsetY,c=l-h*this.view.height}this.projectionMatrix.makeOrthographic(s,a,l,c,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n}}class j_ extends z_{constructor(){super(new Cp(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class du extends n1{constructor(e,n){super(e,n),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(xn.DEFAULT_UP),this.updateMatrix(),this.target=new xn,this.shadow=new j_}dispose(){super.dispose(),this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}toJSON(e){const n=super.toJSON(e);return n.object.shadow=this.shadow.toJSON(),n.object.target=this.target.uuid,n}}class W_ extends n1{constructor(e,n){super(e,n),this.isAmbientLight=!0,this.type="AmbientLight"}}class G_ extends si{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}const bg=new zt;class H_{constructor(e,n,i=0,r=1/0){this.ray=new wp(e,n),this.near=i,this.far=r,this.camera=null,this.layers=new kp,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,n){this.ray.set(e,n)}setFromCamera(e,n){n.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(n.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(n).sub(this.ray.origin).normalize(),this.camera=n):n.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(n.near+n.far)/(n.near-n.far)).unproject(n),this.ray.direction.set(0,0,-1).transformDirection(n.matrixWorld),this.camera=n):vt("Raycaster: Unsupported camera type: "+n.type)}setFromXRController(e){return bg.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(bg),this}intersectObject(e,n=!0,i=[]){return ff(e,this,i,n),i.sort(_g),i}intersectObjects(e,n=!0,i=[]){for(let r=0,s=e.length;r<s;r++)ff(e[r],this,i,n);return i.sort(_g),i}}function _g(t,e){return t.distance-e.distance}function ff(t,e,n,i){let r=!0;if(t.layers.test(e.layers)&&t.raycast(e,n)===!1&&(r=!1),r===!0&&i===!0){const s=t.children;for(let a=0,l=s.length;a<l;a++)ff(s[a],e,n,!0)}}class Sg{constructor(e=1,n=0,i=0){this.radius=e,this.phi=n,this.theta=i}set(e,n,i){return this.radius=e,this.phi=n,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=ft(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,n,i){return this.radius=Math.sqrt(e*e+n*n+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(ft(n/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class V_ extends Ms{constructor(e,n=null){super(),this.object=e,this.domElement=n,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){lt("Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function wg(t,e,n,i){const r=K_(i);switch(n){case Wy:return t*e;case Hy:return t*e/r.components*r.byteLength;case gp:return t*e/r.components*r.byteLength;case ka:return t*e*2/r.components*r.byteLength;case xp:return t*e*2/r.components*r.byteLength;case Gy:return t*e*3/r.components*r.byteLength;case vi:return t*e*4/r.components*r.byteLength;case yp:return t*e*4/r.components*r.byteLength;case ec:case tc:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case nc:case ic:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case Ih:case Lh:return Math.max(t,16)*Math.max(e,8)/4;case Bh:case Dh:return Math.max(t,8)*Math.max(e,8)/2;case Fh:case Uh:case zh:case jh:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case Oh:case Wh:case Gh:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case Hh:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case Vh:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case Kh:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case Qh:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case qh:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case $h:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case Xh:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case Yh:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case Zh:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case Jh:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case ef:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case tf:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case nf:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case rf:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case sf:case af:case of:return Math.ceil(t/4)*Math.ceil(e/4)*16;case lf:case cf:return Math.ceil(t/4)*Math.ceil(e/4)*8;case df:case uf:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}function K_(t){switch(t){case Qn:case Uy:return{byteLength:1,components:1};case Bo:case Oy:case or:return{byteLength:2,components:1};case pp:case mp:return{byteLength:2,components:4};case zi:case fp:case Bi:return{byteLength:4,components:1};case zy:case jy:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${t}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:hp}}));typeof window<"u"&&(window.__THREE__?lt("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=hp);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function i1(){let t=null,e=!1,n=null,i=null;function r(s,a){n(s,a),i=t.requestAnimationFrame(r)}return{start:function(){e!==!0&&n!==null&&(i=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){n=s},setContext:function(s){t=s}}}function Q_(t){const e=new WeakMap;function n(l,c){const d=l.array,h=l.usage,f=d.byteLength,p=t.createBuffer();t.bindBuffer(c,p),t.bufferData(c,d,h),l.onUploadCallback();let m;if(d instanceof Float32Array)m=t.FLOAT;else if(typeof Float16Array<"u"&&d instanceof Float16Array)m=t.HALF_FLOAT;else if(d instanceof Uint16Array)l.isFloat16BufferAttribute?m=t.HALF_FLOAT:m=t.UNSIGNED_SHORT;else if(d instanceof Int16Array)m=t.SHORT;else if(d instanceof Uint32Array)m=t.UNSIGNED_INT;else if(d instanceof Int32Array)m=t.INT;else if(d instanceof Int8Array)m=t.BYTE;else if(d instanceof Uint8Array)m=t.UNSIGNED_BYTE;else if(d instanceof Uint8ClampedArray)m=t.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);return{buffer:p,type:m,bytesPerElement:d.BYTES_PER_ELEMENT,version:l.version,size:f}}function i(l,c,d){const h=c.array,f=c.updateRanges;if(t.bindBuffer(d,l),f.length===0)t.bufferSubData(d,0,h);else{f.sort((m,y)=>m.start-y.start);let p=0;for(let m=1;m<f.length;m++){const y=f[p],x=f[m];x.start<=y.start+y.count+1?y.count=Math.max(y.count,x.start+x.count-y.start):(++p,f[p]=x)}f.length=p+1;for(let m=0,y=f.length;m<y;m++){const x=f[m];t.bufferSubData(d,x.start*h.BYTES_PER_ELEMENT,h,x.start,x.count)}c.clearUpdateRanges()}c.onUploadCallback()}function r(l){return l.isInterleavedBufferAttribute&&(l=l.data),e.get(l)}function s(l){l.isInterleavedBufferAttribute&&(l=l.data);const c=e.get(l);c&&(t.deleteBuffer(c.buffer),e.delete(l))}function a(l,c){if(l.isInterleavedBufferAttribute&&(l=l.data),l.isGLBufferAttribute){const h=e.get(l);(!h||h.version<l.version)&&e.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version});return}const d=e.get(l);if(d===void 0)e.set(l,n(l,c));else if(d.version<l.version){if(d.size!==l.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(d.buffer,l,c),d.version=l.version}}return{get:r,remove:s,update:a}}var q_=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,$_=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,X_=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,Y_=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Z_=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,J_=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,eS=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,tS=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,nS=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,iS=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,rS=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,sS=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,aS=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,oS=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,lS=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,cS=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,dS=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,uS=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,hS=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,fS=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,pS=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,mS=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,gS=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,xS=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,yS=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,vS=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,bS=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,_S=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,SS=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,wS=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,kS="gl_FragColor = linearToOutputTexel( gl_FragColor );",MS=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,RS=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,ES=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,CS=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,TS=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,AS=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,PS=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,NS=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,BS=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,IS=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,DS=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,LS=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,FS=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,US=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,OS=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,zS=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, pow4( roughness ) ) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,jS=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,WS=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,GS=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,HS=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,VS=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.diffuseContribution = diffuseColor.rgb * ( 1.0 - metalnessFactor );
material.metalness = metalnessFactor;
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor;
	material.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = vec3( 0.04 );
	material.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.0001, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,KS=`uniform sampler2D dfgLUT;
struct PhysicalMaterial {
	vec3 diffuseColor;
	vec3 diffuseContribution;
	vec3 specularColor;
	vec3 specularColorBlended;
	float roughness;
	float metalness;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
		vec3 iridescenceFresnelDielectric;
		vec3 iridescenceFresnelMetallic;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return v;
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColorBlended;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transpose( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float rInv = 1.0 / ( roughness + 0.1 );
	float a = -1.9362 + 1.0678 * roughness + 0.4573 * r2 - 0.8469 * rInv;
	float b = -0.6014 + 0.5538 * roughness - 0.4670 * r2 - 0.1255 * rInv;
	float DG = exp( a * dotNV + b );
	return saturate( DG );
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
vec3 BRDF_GGX_Multiscatter( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 singleScatter = BRDF_GGX( lightDir, viewDir, normal, material );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 dfgV = texture2D( dfgLUT, vec2( material.roughness, dotNV ) ).rg;
	vec2 dfgL = texture2D( dfgLUT, vec2( material.roughness, dotNL ) ).rg;
	vec3 FssEss_V = material.specularColorBlended * dfgV.x + material.specularF90 * dfgV.y;
	vec3 FssEss_L = material.specularColorBlended * dfgL.x + material.specularF90 * dfgL.y;
	float Ess_V = dfgV.x + dfgV.y;
	float Ess_L = dfgL.x + dfgL.y;
	float Ems_V = 1.0 - Ess_V;
	float Ems_L = 1.0 - Ess_L;
	vec3 Favg = material.specularColorBlended + ( 1.0 - material.specularColorBlended ) * 0.047619;
	vec3 Fms = FssEss_V * FssEss_L * Favg / ( 1.0 - Ems_V * Ems_L * Favg + EPSILON );
	float compensationFactor = Ems_V * Ems_L;
	vec3 multiScatter = Fms * compensationFactor;
	return singleScatter + multiScatter;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColorBlended * t2.x + ( vec3( 1.0 ) - material.specularColorBlended ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseContribution * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
 
 		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
 
 		float sheenAlbedoV = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
 		float sheenAlbedoL = IBLSheenBRDF( geometryNormal, directLight.direction, material.sheenRoughness );
 
 		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * max( sheenAlbedoV, sheenAlbedoL );
 
 		irradiance *= sheenEnergyComp;
 
 	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX_Multiscatter( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseContribution );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 diffuse = irradiance * BRDF_Lambert( material.diffuseContribution );
	#ifdef USE_SHEEN
		float sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;
		diffuse *= sheenEnergyComp;
	#endif
	reflectedLight.indirectDiffuse += diffuse;
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness ) * RECIPROCAL_PI;
 	#endif
	vec3 singleScatteringDielectric = vec3( 0.0 );
	vec3 multiScatteringDielectric = vec3( 0.0 );
	vec3 singleScatteringMetallic = vec3( 0.0 );
	vec3 multiScatteringMetallic = vec3( 0.0 );
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnelDielectric, material.roughness, singleScatteringDielectric, multiScatteringDielectric );
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.iridescence, material.iridescenceFresnelMetallic, material.roughness, singleScatteringMetallic, multiScatteringMetallic );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScatteringDielectric, multiScatteringDielectric );
		computeMultiscattering( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.roughness, singleScatteringMetallic, multiScatteringMetallic );
	#endif
	vec3 singleScattering = mix( singleScatteringDielectric, singleScatteringMetallic, material.metalness );
	vec3 multiScattering = mix( multiScatteringDielectric, multiScatteringMetallic, material.metalness );
	vec3 totalScatteringDielectric = singleScatteringDielectric + multiScatteringDielectric;
	vec3 diffuse = material.diffuseContribution * ( 1.0 - totalScatteringDielectric );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	vec3 indirectSpecular = radiance * singleScattering;
	indirectSpecular += multiScattering * cosineWeightedIrradiance;
	vec3 indirectDiffuse = diffuse * cosineWeightedIrradiance;
	#ifdef USE_SHEEN
		float sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;
		indirectSpecular *= sheenEnergyComp;
		indirectDiffuse *= sheenEnergyComp;
	#endif
	reflectedLight.indirectSpecular += indirectSpecular;
	reflectedLight.indirectDiffuse += indirectDiffuse;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,QS=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnelDielectric = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceFresnelMetallic = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.diffuseColor );
		material.iridescenceFresnel = mix( material.iridescenceFresnelDielectric, material.iridescenceFresnelMetallic, material.metalness );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS ) && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,qS=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,$S=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,XS=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,YS=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,ZS=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,JS=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,ew=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,tw=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,nw=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,iw=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,rw=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,sw=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,aw=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,ow=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,lw=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,cw=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,dw=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,uw=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,hw=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,fw=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,pw=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,mw=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,gw=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,xw=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,yw=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,vw=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,bw=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,_w=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Sw=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,ww=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,kw=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Mw=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Rw=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Ew=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Cw=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Tw=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform sampler2DShadow directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		#else
			uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		#endif
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform sampler2DShadow spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		#else
			uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		#endif
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform samplerCubeShadow pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		#elif defined( SHADOWMAP_TYPE_BASIC )
			uniform samplerCube pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		#endif
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	#if defined( SHADOWMAP_TYPE_PCF )
		float interleavedGradientNoise( vec2 position ) {
			return fract( 52.9829189 * fract( dot( position, vec2( 0.06711056, 0.00583715 ) ) ) );
		}
		vec2 vogelDiskSample( int sampleIndex, int samplesCount, float phi ) {
			const float goldenAngle = 2.399963229728653;
			float r = sqrt( ( float( sampleIndex ) + 0.5 ) / float( samplesCount ) );
			float theta = float( sampleIndex ) * goldenAngle + phi;
			return vec2( cos( theta ), sin( theta ) ) * r;
		}
	#endif
	#if defined( SHADOWMAP_TYPE_PCF )
		float getShadow( sampler2DShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
				float radius = shadowRadius * texelSize.x;
				float phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;
				shadow = (
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 0, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 1, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 2, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 3, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 4, 5, phi ) * radius, shadowCoord.z ) )
				) * 0.2;
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#elif defined( SHADOWMAP_TYPE_VSM )
		float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				vec2 distribution = texture2D( shadowMap, shadowCoord.xy ).rg;
				float mean = distribution.x;
				float variance = distribution.y * distribution.y;
				#ifdef USE_REVERSED_DEPTH_BUFFER
					float hard_shadow = step( mean, shadowCoord.z );
				#else
					float hard_shadow = step( shadowCoord.z, mean );
				#endif
				if ( hard_shadow == 1.0 ) {
					shadow = 1.0;
				} else {
					variance = max( variance, 0.0000001 );
					float d = shadowCoord.z - mean;
					float p_max = variance / ( variance + d * d );
					p_max = clamp( ( p_max - 0.3 ) / 0.65, 0.0, 1.0 );
					shadow = max( hard_shadow, p_max );
				}
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#else
		float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				float depth = texture2D( shadowMap, shadowCoord.xy ).r;
				#ifdef USE_REVERSED_DEPTH_BUFFER
					shadow = step( depth, shadowCoord.z );
				#else
					shadow = step( shadowCoord.z, depth );
				#endif
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#if defined( SHADOWMAP_TYPE_PCF )
	float getPointShadow( samplerCubeShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 bd3D = normalize( lightToPosition );
		vec3 absVec = abs( lightToPosition );
		float viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );
		if ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {
			float dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
			dp += shadowBias;
			float texelSize = shadowRadius / shadowMapSize.x;
			vec3 absDir = abs( bd3D );
			vec3 tangent = absDir.x > absDir.z ? vec3( 0.0, 1.0, 0.0 ) : vec3( 1.0, 0.0, 0.0 );
			tangent = normalize( cross( bd3D, tangent ) );
			vec3 bitangent = cross( bd3D, tangent );
			float phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;
			shadow = (
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 0, 5, phi ).x + bitangent * vogelDiskSample( 0, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 1, 5, phi ).x + bitangent * vogelDiskSample( 1, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 2, 5, phi ).x + bitangent * vogelDiskSample( 2, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 3, 5, phi ).x + bitangent * vogelDiskSample( 3, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 4, 5, phi ).x + bitangent * vogelDiskSample( 4, 5, phi ).y ) * texelSize, dp ) )
			) * 0.2;
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	#elif defined( SHADOWMAP_TYPE_BASIC )
	float getPointShadow( samplerCube shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 bd3D = normalize( lightToPosition );
		vec3 absVec = abs( lightToPosition );
		float viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );
		if ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {
			float dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
			dp += shadowBias;
			float depth = textureCube( shadowMap, bd3D ).r;
			#ifdef USE_REVERSED_DEPTH_BUFFER
				shadow = step( depth, dp );
			#else
				shadow = step( dp, depth );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	#endif
	#endif
#endif`,Aw=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Pw=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Nw=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0 && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Bw=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Iw=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Dw=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Lw=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Fw=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Uw=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Ow=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,zw=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,jw=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseContribution, material.specularColorBlended, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,Ww=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,Gw=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Hw=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Vw=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,Kw=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Qw=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,qw=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,$w=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Xw=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Yw=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Zw=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Jw=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,ek=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,tk=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,nk=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = vec4( dist, 0.0, 0.0, 1.0 );
}`,ik=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,rk=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,sk=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,ak=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,ok=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,lk=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ck=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,dk=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,uk=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,hk=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,fk=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,pk=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( normalize( normal ) * 0.5 + 0.5, diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,mk=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,gk=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,xk=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,yk=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
 
		outgoingLight = outgoingLight + sheenSpecularDirect + sheenSpecularIndirect;
 
 	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vk=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,bk=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_k=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Sk=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,wk=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,kk=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Mk=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Rk=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ut={alphahash_fragment:q_,alphahash_pars_fragment:$_,alphamap_fragment:X_,alphamap_pars_fragment:Y_,alphatest_fragment:Z_,alphatest_pars_fragment:J_,aomap_fragment:eS,aomap_pars_fragment:tS,batching_pars_vertex:nS,batching_vertex:iS,begin_vertex:rS,beginnormal_vertex:sS,bsdfs:aS,iridescence_fragment:oS,bumpmap_pars_fragment:lS,clipping_planes_fragment:cS,clipping_planes_pars_fragment:dS,clipping_planes_pars_vertex:uS,clipping_planes_vertex:hS,color_fragment:fS,color_pars_fragment:pS,color_pars_vertex:mS,color_vertex:gS,common:xS,cube_uv_reflection_fragment:yS,defaultnormal_vertex:vS,displacementmap_pars_vertex:bS,displacementmap_vertex:_S,emissivemap_fragment:SS,emissivemap_pars_fragment:wS,colorspace_fragment:kS,colorspace_pars_fragment:MS,envmap_fragment:RS,envmap_common_pars_fragment:ES,envmap_pars_fragment:CS,envmap_pars_vertex:TS,envmap_physical_pars_fragment:zS,envmap_vertex:AS,fog_vertex:PS,fog_pars_vertex:NS,fog_fragment:BS,fog_pars_fragment:IS,gradientmap_pars_fragment:DS,lightmap_pars_fragment:LS,lights_lambert_fragment:FS,lights_lambert_pars_fragment:US,lights_pars_begin:OS,lights_toon_fragment:jS,lights_toon_pars_fragment:WS,lights_phong_fragment:GS,lights_phong_pars_fragment:HS,lights_physical_fragment:VS,lights_physical_pars_fragment:KS,lights_fragment_begin:QS,lights_fragment_maps:qS,lights_fragment_end:$S,logdepthbuf_fragment:XS,logdepthbuf_pars_fragment:YS,logdepthbuf_pars_vertex:ZS,logdepthbuf_vertex:JS,map_fragment:ew,map_pars_fragment:tw,map_particle_fragment:nw,map_particle_pars_fragment:iw,metalnessmap_fragment:rw,metalnessmap_pars_fragment:sw,morphinstance_vertex:aw,morphcolor_vertex:ow,morphnormal_vertex:lw,morphtarget_pars_vertex:cw,morphtarget_vertex:dw,normal_fragment_begin:uw,normal_fragment_maps:hw,normal_pars_fragment:fw,normal_pars_vertex:pw,normal_vertex:mw,normalmap_pars_fragment:gw,clearcoat_normal_fragment_begin:xw,clearcoat_normal_fragment_maps:yw,clearcoat_pars_fragment:vw,iridescence_pars_fragment:bw,opaque_fragment:_w,packing:Sw,premultiplied_alpha_fragment:ww,project_vertex:kw,dithering_fragment:Mw,dithering_pars_fragment:Rw,roughnessmap_fragment:Ew,roughnessmap_pars_fragment:Cw,shadowmap_pars_fragment:Tw,shadowmap_pars_vertex:Aw,shadowmap_vertex:Pw,shadowmask_pars_fragment:Nw,skinbase_vertex:Bw,skinning_pars_vertex:Iw,skinning_vertex:Dw,skinnormal_vertex:Lw,specularmap_fragment:Fw,specularmap_pars_fragment:Uw,tonemapping_fragment:Ow,tonemapping_pars_fragment:zw,transmission_fragment:jw,transmission_pars_fragment:Ww,uv_pars_fragment:Gw,uv_pars_vertex:Hw,uv_vertex:Vw,worldpos_vertex:Kw,background_vert:Qw,background_frag:qw,backgroundCube_vert:$w,backgroundCube_frag:Xw,cube_vert:Yw,cube_frag:Zw,depth_vert:Jw,depth_frag:ek,distance_vert:tk,distance_frag:nk,equirect_vert:ik,equirect_frag:rk,linedashed_vert:sk,linedashed_frag:ak,meshbasic_vert:ok,meshbasic_frag:lk,meshlambert_vert:ck,meshlambert_frag:dk,meshmatcap_vert:uk,meshmatcap_frag:hk,meshnormal_vert:fk,meshnormal_frag:pk,meshphong_vert:mk,meshphong_frag:gk,meshphysical_vert:xk,meshphysical_frag:yk,meshtoon_vert:vk,meshtoon_frag:bk,points_vert:_k,points_frag:Sk,shadow_vert:wk,shadow_frag:kk,sprite_vert:Mk,sprite_frag:Rk},He={common:{diffuse:{value:new dt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new ct},alphaMap:{value:null},alphaMapTransform:{value:new ct},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new ct}},envmap:{envMap:{value:null},envMapRotation:{value:new ct},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},dfgLUT:{value:null}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new ct}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new ct}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new ct},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new ct},normalScale:{value:new it(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new ct},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new ct}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new ct}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new ct}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new dt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new dt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new ct},alphaTest:{value:0},uvTransform:{value:new ct}},sprite:{diffuse:{value:new dt(16777215)},opacity:{value:1},center:{value:new it(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new ct},alphaMap:{value:null},alphaMapTransform:{value:new ct},alphaTest:{value:0}}},Ai={basic:{uniforms:bn([He.common,He.specularmap,He.envmap,He.aomap,He.lightmap,He.fog]),vertexShader:ut.meshbasic_vert,fragmentShader:ut.meshbasic_frag},lambert:{uniforms:bn([He.common,He.specularmap,He.envmap,He.aomap,He.lightmap,He.emissivemap,He.bumpmap,He.normalmap,He.displacementmap,He.fog,He.lights,{emissive:{value:new dt(0)}}]),vertexShader:ut.meshlambert_vert,fragmentShader:ut.meshlambert_frag},phong:{uniforms:bn([He.common,He.specularmap,He.envmap,He.aomap,He.lightmap,He.emissivemap,He.bumpmap,He.normalmap,He.displacementmap,He.fog,He.lights,{emissive:{value:new dt(0)},specular:{value:new dt(1118481)},shininess:{value:30}}]),vertexShader:ut.meshphong_vert,fragmentShader:ut.meshphong_frag},standard:{uniforms:bn([He.common,He.envmap,He.aomap,He.lightmap,He.emissivemap,He.bumpmap,He.normalmap,He.displacementmap,He.roughnessmap,He.metalnessmap,He.fog,He.lights,{emissive:{value:new dt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ut.meshphysical_vert,fragmentShader:ut.meshphysical_frag},toon:{uniforms:bn([He.common,He.aomap,He.lightmap,He.emissivemap,He.bumpmap,He.normalmap,He.displacementmap,He.gradientmap,He.fog,He.lights,{emissive:{value:new dt(0)}}]),vertexShader:ut.meshtoon_vert,fragmentShader:ut.meshtoon_frag},matcap:{uniforms:bn([He.common,He.bumpmap,He.normalmap,He.displacementmap,He.fog,{matcap:{value:null}}]),vertexShader:ut.meshmatcap_vert,fragmentShader:ut.meshmatcap_frag},points:{uniforms:bn([He.points,He.fog]),vertexShader:ut.points_vert,fragmentShader:ut.points_frag},dashed:{uniforms:bn([He.common,He.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ut.linedashed_vert,fragmentShader:ut.linedashed_frag},depth:{uniforms:bn([He.common,He.displacementmap]),vertexShader:ut.depth_vert,fragmentShader:ut.depth_frag},normal:{uniforms:bn([He.common,He.bumpmap,He.normalmap,He.displacementmap,{opacity:{value:1}}]),vertexShader:ut.meshnormal_vert,fragmentShader:ut.meshnormal_frag},sprite:{uniforms:bn([He.sprite,He.fog]),vertexShader:ut.sprite_vert,fragmentShader:ut.sprite_frag},background:{uniforms:{uvTransform:{value:new ct},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ut.background_vert,fragmentShader:ut.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new ct}},vertexShader:ut.backgroundCube_vert,fragmentShader:ut.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ut.cube_vert,fragmentShader:ut.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ut.equirect_vert,fragmentShader:ut.equirect_frag},distance:{uniforms:bn([He.common,He.displacementmap,{referencePosition:{value:new re},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ut.distance_vert,fragmentShader:ut.distance_frag},shadow:{uniforms:bn([He.lights,He.fog,{color:{value:new dt(0)},opacity:{value:1}}]),vertexShader:ut.shadow_vert,fragmentShader:ut.shadow_frag}};Ai.physical={uniforms:bn([Ai.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new ct},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new ct},clearcoatNormalScale:{value:new it(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new ct},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new ct},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new ct},sheen:{value:0},sheenColor:{value:new dt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new ct},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new ct},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new ct},transmissionSamplerSize:{value:new it},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new ct},attenuationDistance:{value:0},attenuationColor:{value:new dt(0)},specularColor:{value:new dt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new ct},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new ct},anisotropyVector:{value:new it},anisotropyMap:{value:null},anisotropyMapTransform:{value:new ct}}]),vertexShader:ut.meshphysical_vert,fragmentShader:ut.meshphysical_frag};const Al={r:0,b:0,g:0},ts=new ji,Ek=new zt;function Ck(t,e,n,i,r,s,a){const l=new dt(0);let c=s===!0?0:1,d,h,f=null,p=0,m=null;function y(b){let w=b.isScene===!0?b.background:null;return w&&w.isTexture&&(w=(b.backgroundBlurriness>0?n:e).get(w)),w}function x(b){let w=!1;const R=y(b);R===null?u(l,c):R&&R.isColor&&(u(R,1),w=!0);const C=t.xr.getEnvironmentBlendMode();C==="additive"?i.buffers.color.setClear(0,0,0,1,a):C==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,a),(t.autoClear||w)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))}function g(b,w){const R=y(w);R&&(R.isCubeTexture||R.mapping===ed)?(h===void 0&&(h=new Dn(new zr(1,1,1),new Wi({name:"BackgroundCubeMaterial",uniforms:Ra(Ai.backgroundCube.uniforms),vertexShader:Ai.backgroundCube.vertexShader,fragmentShader:Ai.backgroundCube.fragmentShader,side:zn,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(C,A,B){this.matrixWorld.copyPosition(B.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(h)),ts.copy(w.backgroundRotation),ts.x*=-1,ts.y*=-1,ts.z*=-1,R.isCubeTexture&&R.isRenderTargetTexture===!1&&(ts.y*=-1,ts.z*=-1),h.material.uniforms.envMap.value=R,h.material.uniforms.flipEnvMap.value=R.isCubeTexture&&R.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=w.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=w.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(Ek.makeRotationFromEuler(ts)),h.material.toneMapped=bt.getTransfer(R.colorSpace)!==Rt,(f!==R||p!==R.version||m!==t.toneMapping)&&(h.material.needsUpdate=!0,f=R,p=R.version,m=t.toneMapping),h.layers.enableAll(),b.unshift(h,h.geometry,h.material,0,0,null)):R&&R.isTexture&&(d===void 0&&(d=new Dn(new Vo(2,2),new Wi({name:"BackgroundMaterial",uniforms:Ra(Ai.background.uniforms),vertexShader:Ai.background.vertexShader,fragmentShader:Ai.background.fragmentShader,side:Hr,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),d.geometry.deleteAttribute("normal"),Object.defineProperty(d.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(d)),d.material.uniforms.t2D.value=R,d.material.uniforms.backgroundIntensity.value=w.backgroundIntensity,d.material.toneMapped=bt.getTransfer(R.colorSpace)!==Rt,R.matrixAutoUpdate===!0&&R.updateMatrix(),d.material.uniforms.uvTransform.value.copy(R.matrix),(f!==R||p!==R.version||m!==t.toneMapping)&&(d.material.needsUpdate=!0,f=R,p=R.version,m=t.toneMapping),d.layers.enableAll(),b.unshift(d,d.geometry,d.material,0,0,null))}function u(b,w){b.getRGB(Al,Yy(t)),i.buffers.color.setClear(Al.r,Al.g,Al.b,w,a)}function v(){h!==void 0&&(h.geometry.dispose(),h.material.dispose(),h=void 0),d!==void 0&&(d.geometry.dispose(),d.material.dispose(),d=void 0)}return{getClearColor:function(){return l},setClearColor:function(b,w=1){l.set(b),c=w,u(l,c)},getClearAlpha:function(){return c},setClearAlpha:function(b){c=b,u(l,c)},render:x,addToRenderList:g,dispose:v}}function Tk(t,e){const n=t.getParameter(t.MAX_VERTEX_ATTRIBS),i={},r=p(null);let s=r,a=!1;function l(k,U,O,X,K){let $=!1;const q=f(X,O,U);s!==q&&(s=q,d(s.object)),$=m(k,X,O,K),$&&y(k,X,O,K),K!==null&&e.update(K,t.ELEMENT_ARRAY_BUFFER),($||a)&&(a=!1,w(k,U,O,X),K!==null&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(K).buffer))}function c(){return t.createVertexArray()}function d(k){return t.bindVertexArray(k)}function h(k){return t.deleteVertexArray(k)}function f(k,U,O){const X=O.wireframe===!0;let K=i[k.id];K===void 0&&(K={},i[k.id]=K);let $=K[U.id];$===void 0&&($={},K[U.id]=$);let q=$[X];return q===void 0&&(q=p(c()),$[X]=q),q}function p(k){const U=[],O=[],X=[];for(let K=0;K<n;K++)U[K]=0,O[K]=0,X[K]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:U,enabledAttributes:O,attributeDivisors:X,object:k,attributes:{},index:null}}function m(k,U,O,X){const K=s.attributes,$=U.attributes;let q=0;const J=O.getAttributes();for(const V in J)if(J[V].location>=0){const F=K[V];let de=$[V];if(de===void 0&&(V==="instanceMatrix"&&k.instanceMatrix&&(de=k.instanceMatrix),V==="instanceColor"&&k.instanceColor&&(de=k.instanceColor)),F===void 0||F.attribute!==de||de&&F.data!==de.data)return!0;q++}return s.attributesNum!==q||s.index!==X}function y(k,U,O,X){const K={},$=U.attributes;let q=0;const J=O.getAttributes();for(const V in J)if(J[V].location>=0){let F=$[V];F===void 0&&(V==="instanceMatrix"&&k.instanceMatrix&&(F=k.instanceMatrix),V==="instanceColor"&&k.instanceColor&&(F=k.instanceColor));const de={};de.attribute=F,F&&F.data&&(de.data=F.data),K[V]=de,q++}s.attributes=K,s.attributesNum=q,s.index=X}function x(){const k=s.newAttributes;for(let U=0,O=k.length;U<O;U++)k[U]=0}function g(k){u(k,0)}function u(k,U){const O=s.newAttributes,X=s.enabledAttributes,K=s.attributeDivisors;O[k]=1,X[k]===0&&(t.enableVertexAttribArray(k),X[k]=1),K[k]!==U&&(t.vertexAttribDivisor(k,U),K[k]=U)}function v(){const k=s.newAttributes,U=s.enabledAttributes;for(let O=0,X=U.length;O<X;O++)U[O]!==k[O]&&(t.disableVertexAttribArray(O),U[O]=0)}function b(k,U,O,X,K,$,q){q===!0?t.vertexAttribIPointer(k,U,O,K,$):t.vertexAttribPointer(k,U,O,X,K,$)}function w(k,U,O,X){x();const K=X.attributes,$=O.getAttributes(),q=U.defaultAttributeValues;for(const J in $){const V=$[J];if(V.location>=0){let ue=K[J];if(ue===void 0&&(J==="instanceMatrix"&&k.instanceMatrix&&(ue=k.instanceMatrix),J==="instanceColor"&&k.instanceColor&&(ue=k.instanceColor)),ue!==void 0){const F=ue.normalized,de=ue.itemSize,Te=e.get(ue);if(Te===void 0)continue;const xe=Te.buffer,le=Te.type,Re=Te.bytesPerElement,Q=le===t.INT||le===t.UNSIGNED_INT||ue.gpuType===fp;if(ue.isInterleavedBufferAttribute){const ae=ue.data,Me=ae.stride,ze=ue.offset;if(ae.isInstancedInterleavedBuffer){for(let se=0;se<V.locationSize;se++)u(V.location+se,ae.meshPerAttribute);k.isInstancedMesh!==!0&&X._maxInstanceCount===void 0&&(X._maxInstanceCount=ae.meshPerAttribute*ae.count)}else for(let se=0;se<V.locationSize;se++)g(V.location+se);t.bindBuffer(t.ARRAY_BUFFER,xe);for(let se=0;se<V.locationSize;se++)b(V.location+se,de/V.locationSize,le,F,Me*Re,(ze+de/V.locationSize*se)*Re,Q)}else{if(ue.isInstancedBufferAttribute){for(let ae=0;ae<V.locationSize;ae++)u(V.location+ae,ue.meshPerAttribute);k.isInstancedMesh!==!0&&X._maxInstanceCount===void 0&&(X._maxInstanceCount=ue.meshPerAttribute*ue.count)}else for(let ae=0;ae<V.locationSize;ae++)g(V.location+ae);t.bindBuffer(t.ARRAY_BUFFER,xe);for(let ae=0;ae<V.locationSize;ae++)b(V.location+ae,de/V.locationSize,le,F,de*Re,de/V.locationSize*ae*Re,Q)}}else if(q!==void 0){const F=q[J];if(F!==void 0)switch(F.length){case 2:t.vertexAttrib2fv(V.location,F);break;case 3:t.vertexAttrib3fv(V.location,F);break;case 4:t.vertexAttrib4fv(V.location,F);break;default:t.vertexAttrib1fv(V.location,F)}}}}v()}function R(){B();for(const k in i){const U=i[k];for(const O in U){const X=U[O];for(const K in X)h(X[K].object),delete X[K];delete U[O]}delete i[k]}}function C(k){if(i[k.id]===void 0)return;const U=i[k.id];for(const O in U){const X=U[O];for(const K in X)h(X[K].object),delete X[K];delete U[O]}delete i[k.id]}function A(k){for(const U in i){const O=i[U];if(O[k.id]===void 0)continue;const X=O[k.id];for(const K in X)h(X[K].object),delete X[K];delete O[k.id]}}function B(){S(),a=!0,s!==r&&(s=r,d(s.object))}function S(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:l,reset:B,resetDefaultState:S,dispose:R,releaseStatesOfGeometry:C,releaseStatesOfProgram:A,initAttributes:x,enableAttribute:g,disableUnusedAttributes:v}}function Ak(t,e,n){let i;function r(d){i=d}function s(d,h){t.drawArrays(i,d,h),n.update(h,i,1)}function a(d,h,f){f!==0&&(t.drawArraysInstanced(i,d,h,f),n.update(h,i,f))}function l(d,h,f){if(f===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,d,0,h,0,f);let m=0;for(let y=0;y<f;y++)m+=h[y];n.update(m,i,1)}function c(d,h,f,p){if(f===0)return;const m=e.get("WEBGL_multi_draw");if(m===null)for(let y=0;y<d.length;y++)a(d[y],h[y],p[y]);else{m.multiDrawArraysInstancedWEBGL(i,d,0,h,0,p,0,f);let y=0;for(let x=0;x<f;x++)y+=h[x]*p[x];n.update(y,i,1)}}this.setMode=r,this.render=s,this.renderInstances=a,this.renderMultiDraw=l,this.renderMultiDrawInstances=c}function Pk(t,e,n,i){let r;function s(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const A=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function a(A){return!(A!==vi&&i.convert(A)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT))}function l(A){const B=A===or&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(A!==Qn&&i.convert(A)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&A!==Bi&&!B)}function c(A){if(A==="highp"){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";A="mediump"}return A==="mediump"&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let d=n.precision!==void 0?n.precision:"highp";const h=c(d);h!==d&&(lt("WebGLRenderer:",d,"not supported, using",h,"instead."),d=h);const f=n.logarithmicDepthBuffer===!0,p=n.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),m=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),y=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),x=t.getParameter(t.MAX_TEXTURE_SIZE),g=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),u=t.getParameter(t.MAX_VERTEX_ATTRIBS),v=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),b=t.getParameter(t.MAX_VARYING_VECTORS),w=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),R=t.getParameter(t.MAX_SAMPLES),C=t.getParameter(t.SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:c,textureFormatReadable:a,textureTypeReadable:l,precision:d,logarithmicDepthBuffer:f,reversedDepthBuffer:p,maxTextures:m,maxVertexTextures:y,maxTextureSize:x,maxCubemapSize:g,maxAttributes:u,maxVertexUniforms:v,maxVaryings:b,maxFragmentUniforms:w,maxSamples:R,samples:C}}function Nk(t){const e=this;let n=null,i=0,r=!1,s=!1;const a=new Mr,l=new ct,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(f,p){const m=f.length!==0||p||i!==0||r;return r=p,i=f.length,m},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(f,p){n=h(f,p,0)},this.setState=function(f,p,m){const y=f.clippingPlanes,x=f.clipIntersection,g=f.clipShadows,u=t.get(f);if(!r||y===null||y.length===0||s&&!g)s?h(null):d();else{const v=s?0:i,b=v*4;let w=u.clippingState||null;c.value=w,w=h(y,p,b,m);for(let R=0;R!==b;++R)w[R]=n[R];u.clippingState=w,this.numIntersection=x?this.numPlanes:0,this.numPlanes+=v}};function d(){c.value!==n&&(c.value=n,c.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function h(f,p,m,y){const x=f!==null?f.length:0;let g=null;if(x!==0){if(g=c.value,y!==!0||g===null){const u=m+x*4,v=p.matrixWorldInverse;l.getNormalMatrix(v),(g===null||g.length<u)&&(g=new Float32Array(u));for(let b=0,w=m;b!==x;++b,w+=4)a.copy(f[b]).applyMatrix4(v,l),a.normal.toArray(g,w),g[w+3]=a.constant}c.value=g,c.needsUpdate=!0}return e.numPlanes=x,e.numIntersection=0,g}}function Bk(t){let e=new WeakMap;function n(a,l){return l===Th?a.mapping=_s:l===Ah&&(a.mapping=wa),a}function i(a){if(a&&a.isTexture){const l=a.mapping;if(l===Th||l===Ah)if(e.has(a)){const c=e.get(a).texture;return n(c,a.mapping)}else{const c=a.image;if(c&&c.height>0){const d=new e1(c.height);return d.fromEquirectangularTexture(t,a),e.set(a,d),a.addEventListener("dispose",r),n(d.texture,a.mapping)}else return null}}return a}function r(a){const l=a.target;l.removeEventListener("dispose",r);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function s(){e=new WeakMap}return{get:i,dispose:s}}const Pr=4,kg=[.125,.215,.35,.446,.526,.582],os=20,Ik=256,$a=new Cp,Mg=new dt;let uu=null,hu=0,fu=0,pu=!1;const Dk=new re;class Rg{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._backgroundBox=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._blurMaterial=null,this._ggxMaterial=null}fromScene(e,n=0,i=.1,r=100,s={}){const{size:a=256,position:l=Dk}=s;uu=this._renderer.getRenderTarget(),hu=this._renderer.getActiveCubeFace(),fu=this._renderer.getActiveMipmapLevel(),pu=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const c=this._allocateTargets();return c.depthBuffer=!0,this._sceneToCubeUV(e,i,r,c,l),n>0&&this._blur(c,0,0,n),this._applyPMREM(c),this._cleanup(c),c}fromEquirectangular(e,n=null){return this._fromTexture(e,n)}fromCubemap(e,n=null){return this._fromTexture(e,n)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Tg(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Cg(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(uu,hu,fu),this._renderer.xr.enabled=pu,e.scissorTest=!1,Gs(e,0,0,e.width,e.height)}_fromTexture(e,n){e.mapping===_s||e.mapping===wa?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),uu=this._renderer.getRenderTarget(),hu=this._renderer.getActiveCubeFace(),fu=this._renderer.getActiveMipmapLevel(),pu=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=n||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),n=4*this._cubeSize,i={magFilter:gn,minFilter:gn,generateMipmaps:!1,type:or,format:vi,colorSpace:Ma,depthBuffer:!1},r=Eg(e,n,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==n){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Eg(e,n,i);const{_lodMax:s}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=Lk(s)),this._blurMaterial=Uk(s,e,n),this._ggxMaterial=Fk(s,e,n)}return r}_compileMaterial(e){const n=new Dn(new ki,e);this._renderer.compile(n,$a)}_sceneToCubeUV(e,n,i,r,s){const c=new si(90,1,n,i),d=[1,-1,1,1,1,1],h=[1,1,1,-1,-1,-1],f=this._renderer,p=f.autoClear,m=f.toneMapping;f.getClearColor(Mg),f.toneMapping=Fi,f.autoClear=!1,f.state.buffers.depth.getReversed()&&(f.setRenderTarget(r),f.clearDepth(),f.setRenderTarget(null)),this._backgroundBox===null&&(this._backgroundBox=new Dn(new zr,new Dc({name:"PMREM.Background",side:zn,depthWrite:!1,depthTest:!1})));const x=this._backgroundBox,g=x.material;let u=!1;const v=e.background;v?v.isColor&&(g.color.copy(v),e.background=null,u=!0):(g.color.copy(Mg),u=!0);for(let b=0;b<6;b++){const w=b%3;w===0?(c.up.set(0,d[b],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x+h[b],s.y,s.z)):w===1?(c.up.set(0,0,d[b]),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y+h[b],s.z)):(c.up.set(0,d[b],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y,s.z+h[b]));const R=this._cubeSize;Gs(r,w*R,b>2?R:0,R,R),f.setRenderTarget(r),u&&f.render(x,c),f.render(e,c)}f.toneMapping=m,f.autoClear=p,e.background=v}_textureToCubeUV(e,n){const i=this._renderer,r=e.mapping===_s||e.mapping===wa;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=Tg()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Cg());const s=r?this._cubemapMaterial:this._equirectMaterial,a=this._lodMeshes[0];a.material=s;const l=s.uniforms;l.envMap.value=e;const c=this._cubeSize;Gs(n,0,0,3*c,2*c),i.setRenderTarget(n),i.render(a,$a)}_applyPMREM(e){const n=this._renderer,i=n.autoClear;n.autoClear=!1;const r=this._lodMeshes.length;for(let s=1;s<r;s++)this._applyGGXFilter(e,s-1,s);n.autoClear=i}_applyGGXFilter(e,n,i){const r=this._renderer,s=this._pingPongRenderTarget,a=this._ggxMaterial,l=this._lodMeshes[i];l.material=a;const c=a.uniforms,d=i/(this._lodMeshes.length-1),h=n/(this._lodMeshes.length-1),f=Math.sqrt(d*d-h*h),p=0+d*1.25,m=f*p,{_lodMax:y}=this,x=this._sizeLods[i],g=3*x*(i>y-Pr?i-y+Pr:0),u=4*(this._cubeSize-x);c.envMap.value=e.texture,c.roughness.value=m,c.mipInt.value=y-n,Gs(s,g,u,3*x,2*x),r.setRenderTarget(s),r.render(l,$a),c.envMap.value=s.texture,c.roughness.value=0,c.mipInt.value=y-i,Gs(e,g,u,3*x,2*x),r.setRenderTarget(e),r.render(l,$a)}_blur(e,n,i,r,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,n,i,r,"latitudinal",s),this._halfBlur(a,e,i,i,r,"longitudinal",s)}_halfBlur(e,n,i,r,s,a,l){const c=this._renderer,d=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&vt("blur direction must be either latitudinal or longitudinal!");const h=3,f=this._lodMeshes[r];f.material=d;const p=d.uniforms,m=this._sizeLods[i]-1,y=isFinite(s)?Math.PI/(2*m):2*Math.PI/(2*os-1),x=s/y,g=isFinite(s)?1+Math.floor(h*x):os;g>os&&lt(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${os}`);const u=[];let v=0;for(let A=0;A<os;++A){const B=A/x,S=Math.exp(-B*B/2);u.push(S),A===0?v+=S:A<g&&(v+=2*S)}for(let A=0;A<u.length;A++)u[A]=u[A]/v;p.envMap.value=e.texture,p.samples.value=g,p.weights.value=u,p.latitudinal.value=a==="latitudinal",l&&(p.poleAxis.value=l);const{_lodMax:b}=this;p.dTheta.value=y,p.mipInt.value=b-i;const w=this._sizeLods[r],R=3*w*(r>b-Pr?r-b+Pr:0),C=4*(this._cubeSize-w);Gs(n,R,C,3*w,2*w),c.setRenderTarget(n),c.render(f,$a)}}function Lk(t){const e=[],n=[],i=[];let r=t;const s=t-Pr+1+kg.length;for(let a=0;a<s;a++){const l=Math.pow(2,r);e.push(l);let c=1/l;a>t-Pr?c=kg[a-t+Pr-1]:a===0&&(c=0),n.push(c);const d=1/(l-2),h=-d,f=1+d,p=[h,h,f,h,f,f,h,h,f,f,h,f],m=6,y=6,x=3,g=2,u=1,v=new Float32Array(x*y*m),b=new Float32Array(g*y*m),w=new Float32Array(u*y*m);for(let C=0;C<m;C++){const A=C%3*2/3-1,B=C>2?0:-1,S=[A,B,0,A+2/3,B,0,A+2/3,B+1,0,A,B,0,A+2/3,B+1,0,A,B+1,0];v.set(S,x*y*C),b.set(p,g*y*C);const k=[C,C,C,C,C,C];w.set(k,u*y*C)}const R=new ki;R.setAttribute("position",new Oi(v,x)),R.setAttribute("uv",new Oi(b,g)),R.setAttribute("faceIndex",new Oi(w,u)),i.push(new Dn(R,null)),r>Pr&&r--}return{lodMeshes:i,sizeLods:e,sigmas:n}}function Eg(t,e,n){const i=new Ui(t,e,n);return i.texture.mapping=ed,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Gs(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function Fk(t,e,n){return new Wi({name:"PMREMGGXConvolution",defines:{GGX_SAMPLES:Ik,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},roughness:{value:0},mipInt:{value:0}},vertexShader:td(),fragmentShader:`

			precision highp float;
			precision highp int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform float roughness;
			uniform float mipInt;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			#define PI 3.14159265359

			// Van der Corput radical inverse
			float radicalInverse_VdC(uint bits) {
				bits = (bits << 16u) | (bits >> 16u);
				bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);
				bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);
				bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);
				bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);
				return float(bits) * 2.3283064365386963e-10; // / 0x100000000
			}

			// Hammersley sequence
			vec2 hammersley(uint i, uint N) {
				return vec2(float(i) / float(N), radicalInverse_VdC(i));
			}

			// GGX VNDF importance sampling (Eric Heitz 2018)
			// "Sampling the GGX Distribution of Visible Normals"
			// https://jcgt.org/published/0007/04/01/
			vec3 importanceSampleGGX_VNDF(vec2 Xi, vec3 V, float roughness) {
				float alpha = roughness * roughness;

				// Section 3.2: Transform view direction to hemisphere configuration
				vec3 Vh = normalize(vec3(alpha * V.x, alpha * V.y, V.z));

				// Section 4.1: Orthonormal basis
				float lensq = Vh.x * Vh.x + Vh.y * Vh.y;
				vec3 T1 = lensq > 0.0 ? vec3(-Vh.y, Vh.x, 0.0) / sqrt(lensq) : vec3(1.0, 0.0, 0.0);
				vec3 T2 = cross(Vh, T1);

				// Section 4.2: Parameterization of projected area
				float r = sqrt(Xi.x);
				float phi = 2.0 * PI * Xi.y;
				float t1 = r * cos(phi);
				float t2 = r * sin(phi);
				float s = 0.5 * (1.0 + Vh.z);
				t2 = (1.0 - s) * sqrt(1.0 - t1 * t1) + s * t2;

				// Section 4.3: Reprojection onto hemisphere
				vec3 Nh = t1 * T1 + t2 * T2 + sqrt(max(0.0, 1.0 - t1 * t1 - t2 * t2)) * Vh;

				// Section 3.4: Transform back to ellipsoid configuration
				return normalize(vec3(alpha * Nh.x, alpha * Nh.y, max(0.0, Nh.z)));
			}

			void main() {
				vec3 N = normalize(vOutputDirection);
				vec3 V = N; // Assume view direction equals normal for pre-filtering

				vec3 prefilteredColor = vec3(0.0);
				float totalWeight = 0.0;

				// For very low roughness, just sample the environment directly
				if (roughness < 0.001) {
					gl_FragColor = vec4(bilinearCubeUV(envMap, N, mipInt), 1.0);
					return;
				}

				// Tangent space basis for VNDF sampling
				vec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);
				vec3 tangent = normalize(cross(up, N));
				vec3 bitangent = cross(N, tangent);

				for(uint i = 0u; i < uint(GGX_SAMPLES); i++) {
					vec2 Xi = hammersley(i, uint(GGX_SAMPLES));

					// For PMREM, V = N, so in tangent space V is always (0, 0, 1)
					vec3 H_tangent = importanceSampleGGX_VNDF(Xi, vec3(0.0, 0.0, 1.0), roughness);

					// Transform H back to world space
					vec3 H = normalize(tangent * H_tangent.x + bitangent * H_tangent.y + N * H_tangent.z);
					vec3 L = normalize(2.0 * dot(V, H) * H - V);

					float NdotL = max(dot(N, L), 0.0);

					if(NdotL > 0.0) {
						// Sample environment at fixed mip level
						// VNDF importance sampling handles the distribution filtering
						vec3 sampleColor = bilinearCubeUV(envMap, L, mipInt);

						// Weight by NdotL for the split-sum approximation
						// VNDF PDF naturally accounts for the visible microfacet distribution
						prefilteredColor += sampleColor * NdotL;
						totalWeight += NdotL;
					}
				}

				if (totalWeight > 0.0) {
					prefilteredColor = prefilteredColor / totalWeight;
				}

				gl_FragColor = vec4(prefilteredColor, 1.0);
			}
		`,blending:tr,depthTest:!1,depthWrite:!1})}function Uk(t,e,n){const i=new Float32Array(os),r=new re(0,1,0);return new Wi({name:"SphericalGaussianBlur",defines:{n:os,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:td(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:tr,depthTest:!1,depthWrite:!1})}function Cg(){return new Wi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:td(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:tr,depthTest:!1,depthWrite:!1})}function Tg(){return new Wi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:td(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:tr,depthTest:!1,depthWrite:!1})}function td(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Ok(t){let e=new WeakMap,n=null;function i(l){if(l&&l.isTexture){const c=l.mapping,d=c===Th||c===Ah,h=c===_s||c===wa;if(d||h){let f=e.get(l);const p=f!==void 0?f.texture.pmremVersion:0;if(l.isRenderTargetTexture&&l.pmremVersion!==p)return n===null&&(n=new Rg(t)),f=d?n.fromEquirectangular(l,f):n.fromCubemap(l,f),f.texture.pmremVersion=l.pmremVersion,e.set(l,f),f.texture;if(f!==void 0)return f.texture;{const m=l.image;return d&&m&&m.height>0||h&&m&&r(m)?(n===null&&(n=new Rg(t)),f=d?n.fromEquirectangular(l):n.fromCubemap(l),f.texture.pmremVersion=l.pmremVersion,e.set(l,f),l.addEventListener("dispose",s),f.texture):null}}}return l}function r(l){let c=0;const d=6;for(let h=0;h<d;h++)l[h]!==void 0&&c++;return c===d}function s(l){const c=l.target;c.removeEventListener("dispose",s);const d=e.get(c);d!==void 0&&(e.delete(c),d.dispose())}function a(){e=new WeakMap,n!==null&&(n.dispose(),n=null)}return{get:i,dispose:a}}function zk(t){const e={};function n(i){if(e[i]!==void 0)return e[i];const r=t.getExtension(i);return e[i]=r,r}return{has:function(i){return n(i)!==null},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(i){const r=n(i);return r===null&&Do("WebGLRenderer: "+i+" extension not supported."),r}}}function jk(t,e,n,i){const r={},s=new WeakMap;function a(f){const p=f.target;p.index!==null&&e.remove(p.index);for(const y in p.attributes)e.remove(p.attributes[y]);p.removeEventListener("dispose",a),delete r[p.id];const m=s.get(p);m&&(e.remove(m),s.delete(p)),i.releaseStatesOfGeometry(p),p.isInstancedBufferGeometry===!0&&delete p._maxInstanceCount,n.memory.geometries--}function l(f,p){return r[p.id]===!0||(p.addEventListener("dispose",a),r[p.id]=!0,n.memory.geometries++),p}function c(f){const p=f.attributes;for(const m in p)e.update(p[m],t.ARRAY_BUFFER)}function d(f){const p=[],m=f.index,y=f.attributes.position;let x=0;if(m!==null){const v=m.array;x=m.version;for(let b=0,w=v.length;b<w;b+=3){const R=v[b+0],C=v[b+1],A=v[b+2];p.push(R,C,C,A,A,R)}}else if(y!==void 0){const v=y.array;x=y.version;for(let b=0,w=v.length/3-1;b<w;b+=3){const R=b+0,C=b+1,A=b+2;p.push(R,C,C,A,A,R)}}else return;const g=new(Ky(p)?Xy:$y)(p,1);g.version=x;const u=s.get(f);u&&e.remove(u),s.set(f,g)}function h(f){const p=s.get(f);if(p){const m=f.index;m!==null&&p.version<m.version&&d(f)}else d(f);return s.get(f)}return{get:l,update:c,getWireframeAttribute:h}}function Wk(t,e,n){let i;function r(p){i=p}let s,a;function l(p){s=p.type,a=p.bytesPerElement}function c(p,m){t.drawElements(i,m,s,p*a),n.update(m,i,1)}function d(p,m,y){y!==0&&(t.drawElementsInstanced(i,m,s,p*a,y),n.update(m,i,y))}function h(p,m,y){if(y===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,m,0,s,p,0,y);let g=0;for(let u=0;u<y;u++)g+=m[u];n.update(g,i,1)}function f(p,m,y,x){if(y===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let u=0;u<p.length;u++)d(p[u]/a,m[u],x[u]);else{g.multiDrawElementsInstancedWEBGL(i,m,0,s,p,0,x,0,y);let u=0;for(let v=0;v<y;v++)u+=m[v]*x[v];n.update(u,i,1)}}this.setMode=r,this.setIndex=l,this.render=c,this.renderInstances=d,this.renderMultiDraw=h,this.renderMultiDrawInstances=f}function Gk(t){const e={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,a,l){switch(n.calls++,a){case t.TRIANGLES:n.triangles+=l*(s/3);break;case t.LINES:n.lines+=l*(s/2);break;case t.LINE_STRIP:n.lines+=l*(s-1);break;case t.LINE_LOOP:n.lines+=l*s;break;case t.POINTS:n.points+=l*s;break;default:vt("WebGLInfo: Unknown draw mode:",a);break}}function r(){n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:e,render:n,programs:null,autoReset:!0,reset:r,update:i}}function Hk(t,e,n){const i=new WeakMap,r=new Gt;function s(a,l,c){const d=a.morphTargetInfluences,h=l.morphAttributes.position||l.morphAttributes.normal||l.morphAttributes.color,f=h!==void 0?h.length:0;let p=i.get(l);if(p===void 0||p.count!==f){let S=function(){A.dispose(),i.delete(l),l.removeEventListener("dispose",S)};p!==void 0&&p.texture.dispose();const m=l.morphAttributes.position!==void 0,y=l.morphAttributes.normal!==void 0,x=l.morphAttributes.color!==void 0,g=l.morphAttributes.position||[],u=l.morphAttributes.normal||[],v=l.morphAttributes.color||[];let b=0;m===!0&&(b=1),y===!0&&(b=2),x===!0&&(b=3);let w=l.attributes.position.count*b,R=1;w>e.maxTextureSize&&(R=Math.ceil(w/e.maxTextureSize),w=e.maxTextureSize);const C=new Float32Array(w*R*4*f),A=new Qy(C,w,R,f);A.type=Bi,A.needsUpdate=!0;const B=b*4;for(let k=0;k<f;k++){const U=g[k],O=u[k],X=v[k],K=w*R*4*k;for(let $=0;$<U.count;$++){const q=$*B;m===!0&&(r.fromBufferAttribute(U,$),C[K+q+0]=r.x,C[K+q+1]=r.y,C[K+q+2]=r.z,C[K+q+3]=0),y===!0&&(r.fromBufferAttribute(O,$),C[K+q+4]=r.x,C[K+q+5]=r.y,C[K+q+6]=r.z,C[K+q+7]=0),x===!0&&(r.fromBufferAttribute(X,$),C[K+q+8]=r.x,C[K+q+9]=r.y,C[K+q+10]=r.z,C[K+q+11]=X.itemSize===4?r.w:1)}}p={count:f,texture:A,size:new it(w,R)},i.set(l,p),l.addEventListener("dispose",S)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)c.getUniforms().setValue(t,"morphTexture",a.morphTexture,n);else{let m=0;for(let x=0;x<d.length;x++)m+=d[x];const y=l.morphTargetsRelative?1:1-m;c.getUniforms().setValue(t,"morphTargetBaseInfluence",y),c.getUniforms().setValue(t,"morphTargetInfluences",d)}c.getUniforms().setValue(t,"morphTargetsTexture",p.texture,n),c.getUniforms().setValue(t,"morphTargetsTextureSize",p.size)}return{update:s}}function Vk(t,e,n,i){let r=new WeakMap;function s(c){const d=i.render.frame,h=c.geometry,f=e.get(c,h);if(r.get(f)!==d&&(e.update(f),r.set(f,d)),c.isInstancedMesh&&(c.hasEventListener("dispose",l)===!1&&c.addEventListener("dispose",l),r.get(c)!==d&&(n.update(c.instanceMatrix,t.ARRAY_BUFFER),c.instanceColor!==null&&n.update(c.instanceColor,t.ARRAY_BUFFER),r.set(c,d))),c.isSkinnedMesh){const p=c.skeleton;r.get(p)!==d&&(p.update(),r.set(p,d))}return f}function a(){r=new WeakMap}function l(c){const d=c.target;d.removeEventListener("dispose",l),n.remove(d.instanceMatrix),d.instanceColor!==null&&n.remove(d.instanceColor)}return{update:s,dispose:a}}const Kk={[Ay]:"LINEAR_TONE_MAPPING",[Py]:"REINHARD_TONE_MAPPING",[Ny]:"CINEON_TONE_MAPPING",[By]:"ACES_FILMIC_TONE_MAPPING",[Dy]:"AGX_TONE_MAPPING",[Ly]:"NEUTRAL_TONE_MAPPING",[Iy]:"CUSTOM_TONE_MAPPING"};function Qk(t,e,n,i,r){const s=new Ui(e,n,{type:t,depthBuffer:i,stencilBuffer:r}),a=new Ui(e,n,{type:or,depthBuffer:!1,stencilBuffer:!1}),l=new ki;l.setAttribute("position",new kn([-1,3,0,-1,-1,0,3,-1,0],3)),l.setAttribute("uv",new kn([0,2,0,0,2,0],2));const c=new L_({uniforms:{tDiffuse:{value:null}},vertexShader:`
			precision highp float;

			uniform mat4 modelViewMatrix;
			uniform mat4 projectionMatrix;

			attribute vec3 position;
			attribute vec2 uv;

			varying vec2 vUv;

			void main() {
				vUv = uv;
				gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			}`,fragmentShader:`
			precision highp float;

			uniform sampler2D tDiffuse;

			varying vec2 vUv;

			#include <tonemapping_pars_fragment>
			#include <colorspace_pars_fragment>

			void main() {
				gl_FragColor = texture2D( tDiffuse, vUv );

				#ifdef LINEAR_TONE_MAPPING
					gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );
				#elif defined( REINHARD_TONE_MAPPING )
					gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );
				#elif defined( CINEON_TONE_MAPPING )
					gl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );
				#elif defined( ACES_FILMIC_TONE_MAPPING )
					gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );
				#elif defined( AGX_TONE_MAPPING )
					gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );
				#elif defined( NEUTRAL_TONE_MAPPING )
					gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );
				#elif defined( CUSTOM_TONE_MAPPING )
					gl_FragColor.rgb = CustomToneMapping( gl_FragColor.rgb );
				#endif

				#ifdef SRGB_TRANSFER
					gl_FragColor = sRGBTransferOETF( gl_FragColor );
				#endif
			}`,depthTest:!1,depthWrite:!1}),d=new Dn(l,c),h=new Cp(-1,1,1,-1,0,1);let f=null,p=null,m=!1,y,x=null,g=[],u=!1;this.setSize=function(v,b){s.setSize(v,b),a.setSize(v,b);for(let w=0;w<g.length;w++){const R=g[w];R.setSize&&R.setSize(v,b)}},this.setEffects=function(v){g=v,u=g.length>0&&g[0].isRenderPass===!0;const b=s.width,w=s.height;for(let R=0;R<g.length;R++){const C=g[R];C.setSize&&C.setSize(b,w)}},this.begin=function(v,b){if(m||v.toneMapping===Fi&&g.length===0)return!1;if(x=b,b!==null){const w=b.width,R=b.height;(s.width!==w||s.height!==R)&&this.setSize(w,R)}return u===!1&&v.setRenderTarget(s),y=v.toneMapping,v.toneMapping=Fi,!0},this.hasRenderPass=function(){return u},this.end=function(v,b){v.toneMapping=y,m=!0;let w=s,R=a;for(let C=0;C<g.length;C++){const A=g[C];if(A.enabled!==!1&&(A.render(v,R,w,b),A.needsSwap!==!1)){const B=w;w=R,R=B}}if(f!==v.outputColorSpace||p!==v.toneMapping){f=v.outputColorSpace,p=v.toneMapping,c.defines={},bt.getTransfer(f)===Rt&&(c.defines.SRGB_TRANSFER="");const C=Kk[p];C&&(c.defines[C]=""),c.needsUpdate=!0}c.uniforms.tDiffuse.value=w.texture,v.setRenderTarget(x),v.render(d,h),x=null,m=!1},this.isCompositing=function(){return m},this.dispose=function(){s.dispose(),a.dispose(),l.dispose(),c.dispose()}}const r1=new wn,pf=new Lo(1,1),s1=new Qy,a1=new h_,o1=new Jy,Ag=[],Pg=[],Ng=new Float32Array(16),Bg=new Float32Array(9),Ig=new Float32Array(4);function Pa(t,e,n){const i=t[0];if(i<=0||i>0)return t;const r=e*n;let s=Ag[r];if(s===void 0&&(s=new Float32Array(r),Ag[r]=s),e!==0){i.toArray(s,0);for(let a=1,l=0;a!==e;++a)l+=n,t[a].toArray(s,l)}return s}function Zt(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function Jt(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function nd(t,e){let n=Pg[e];n===void 0&&(n=new Int32Array(e),Pg[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function qk(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function $k(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Zt(n,e))return;t.uniform2fv(this.addr,e),Jt(n,e)}}function Xk(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(e.r!==void 0)(n[0]!==e.r||n[1]!==e.g||n[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Zt(n,e))return;t.uniform3fv(this.addr,e),Jt(n,e)}}function Yk(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Zt(n,e))return;t.uniform4fv(this.addr,e),Jt(n,e)}}function Zk(t,e){const n=this.cache,i=e.elements;if(i===void 0){if(Zt(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Jt(n,e)}else{if(Zt(n,i))return;Ig.set(i),t.uniformMatrix2fv(this.addr,!1,Ig),Jt(n,i)}}function Jk(t,e){const n=this.cache,i=e.elements;if(i===void 0){if(Zt(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Jt(n,e)}else{if(Zt(n,i))return;Bg.set(i),t.uniformMatrix3fv(this.addr,!1,Bg),Jt(n,i)}}function e3(t,e){const n=this.cache,i=e.elements;if(i===void 0){if(Zt(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Jt(n,e)}else{if(Zt(n,i))return;Ng.set(i),t.uniformMatrix4fv(this.addr,!1,Ng),Jt(n,i)}}function t3(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function n3(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Zt(n,e))return;t.uniform2iv(this.addr,e),Jt(n,e)}}function i3(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Zt(n,e))return;t.uniform3iv(this.addr,e),Jt(n,e)}}function r3(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Zt(n,e))return;t.uniform4iv(this.addr,e),Jt(n,e)}}function s3(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function a3(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Zt(n,e))return;t.uniform2uiv(this.addr,e),Jt(n,e)}}function o3(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Zt(n,e))return;t.uniform3uiv(this.addr,e),Jt(n,e)}}function l3(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Zt(n,e))return;t.uniform4uiv(this.addr,e),Jt(n,e)}}function c3(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r);let s;this.type===t.SAMPLER_2D_SHADOW?(pf.compareFunction=n.isReversedDepthBuffer()?bp:vp,s=pf):s=r1,n.setTexture2D(e||s,r)}function d3(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||a1,r)}function u3(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(e||o1,r)}function h3(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||s1,r)}function f3(t){switch(t){case 5126:return qk;case 35664:return $k;case 35665:return Xk;case 35666:return Yk;case 35674:return Zk;case 35675:return Jk;case 35676:return e3;case 5124:case 35670:return t3;case 35667:case 35671:return n3;case 35668:case 35672:return i3;case 35669:case 35673:return r3;case 5125:return s3;case 36294:return a3;case 36295:return o3;case 36296:return l3;case 35678:case 36198:case 36298:case 36306:case 35682:return c3;case 35679:case 36299:case 36307:return d3;case 35680:case 36300:case 36308:case 36293:return u3;case 36289:case 36303:case 36311:case 36292:return h3}}function p3(t,e){t.uniform1fv(this.addr,e)}function m3(t,e){const n=Pa(e,this.size,2);t.uniform2fv(this.addr,n)}function g3(t,e){const n=Pa(e,this.size,3);t.uniform3fv(this.addr,n)}function x3(t,e){const n=Pa(e,this.size,4);t.uniform4fv(this.addr,n)}function y3(t,e){const n=Pa(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function v3(t,e){const n=Pa(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function b3(t,e){const n=Pa(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function _3(t,e){t.uniform1iv(this.addr,e)}function S3(t,e){t.uniform2iv(this.addr,e)}function w3(t,e){t.uniform3iv(this.addr,e)}function k3(t,e){t.uniform4iv(this.addr,e)}function M3(t,e){t.uniform1uiv(this.addr,e)}function R3(t,e){t.uniform2uiv(this.addr,e)}function E3(t,e){t.uniform3uiv(this.addr,e)}function C3(t,e){t.uniform4uiv(this.addr,e)}function T3(t,e,n){const i=this.cache,r=e.length,s=nd(n,r);Zt(i,s)||(t.uniform1iv(this.addr,s),Jt(i,s));let a;this.type===t.SAMPLER_2D_SHADOW?a=pf:a=r1;for(let l=0;l!==r;++l)n.setTexture2D(e[l]||a,s[l])}function A3(t,e,n){const i=this.cache,r=e.length,s=nd(n,r);Zt(i,s)||(t.uniform1iv(this.addr,s),Jt(i,s));for(let a=0;a!==r;++a)n.setTexture3D(e[a]||a1,s[a])}function P3(t,e,n){const i=this.cache,r=e.length,s=nd(n,r);Zt(i,s)||(t.uniform1iv(this.addr,s),Jt(i,s));for(let a=0;a!==r;++a)n.setTextureCube(e[a]||o1,s[a])}function N3(t,e,n){const i=this.cache,r=e.length,s=nd(n,r);Zt(i,s)||(t.uniform1iv(this.addr,s),Jt(i,s));for(let a=0;a!==r;++a)n.setTexture2DArray(e[a]||s1,s[a])}function B3(t){switch(t){case 5126:return p3;case 35664:return m3;case 35665:return g3;case 35666:return x3;case 35674:return y3;case 35675:return v3;case 35676:return b3;case 5124:case 35670:return _3;case 35667:case 35671:return S3;case 35668:case 35672:return w3;case 35669:case 35673:return k3;case 5125:return M3;case 36294:return R3;case 36295:return E3;case 36296:return C3;case 35678:case 36198:case 36298:case 36306:case 35682:return T3;case 35679:case 36299:case 36307:return A3;case 35680:case 36300:case 36308:case 36293:return P3;case 36289:case 36303:case 36311:case 36292:return N3}}class I3{constructor(e,n,i){this.id=e,this.addr=i,this.cache=[],this.type=n.type,this.setValue=f3(n.type)}}class D3{constructor(e,n,i){this.id=e,this.addr=i,this.cache=[],this.type=n.type,this.size=n.size,this.setValue=B3(n.type)}}class L3{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,n,i){const r=this.seq;for(let s=0,a=r.length;s!==a;++s){const l=r[s];l.setValue(e,n[l.id],i)}}}const mu=/(\w+)(\])?(\[|\.)?/g;function Dg(t,e){t.seq.push(e),t.map[e.id]=e}function F3(t,e,n){const i=t.name,r=i.length;for(mu.lastIndex=0;;){const s=mu.exec(i),a=mu.lastIndex;let l=s[1];const c=s[2]==="]",d=s[3];if(c&&(l=l|0),d===void 0||d==="["&&a+2===r){Dg(n,d===void 0?new I3(l,t,e):new D3(l,t,e));break}else{let f=n.map[l];f===void 0&&(f=new L3(l),Dg(n,f)),n=f}}}class ac{constructor(e,n){this.seq=[],this.map={};const i=e.getProgramParameter(n,e.ACTIVE_UNIFORMS);for(let a=0;a<i;++a){const l=e.getActiveUniform(n,a),c=e.getUniformLocation(n,l.name);F3(l,c,this)}const r=[],s=[];for(const a of this.seq)a.type===e.SAMPLER_2D_SHADOW||a.type===e.SAMPLER_CUBE_SHADOW||a.type===e.SAMPLER_2D_ARRAY_SHADOW?r.push(a):s.push(a);r.length>0&&(this.seq=r.concat(s))}setValue(e,n,i,r){const s=this.map[n];s!==void 0&&s.setValue(e,i,r)}setOptional(e,n,i){const r=n[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,n,i,r){for(let s=0,a=n.length;s!==a;++s){const l=n[s],c=i[l.id];c.needsUpdate!==!1&&l.setValue(e,c.value,r)}}static seqWithValue(e,n){const i=[];for(let r=0,s=e.length;r!==s;++r){const a=e[r];a.id in n&&i.push(a)}return i}}function Lg(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}const U3=37297;let O3=0;function z3(t,e){const n=t.split(`
`),i=[],r=Math.max(e-6,0),s=Math.min(e+6,n.length);for(let a=r;a<s;a++){const l=a+1;i.push(`${l===e?">":" "} ${l}: ${n[a]}`)}return i.join(`
`)}const Fg=new ct;function j3(t){bt._getMatrix(Fg,bt.workingColorSpace,t);const e=`mat3( ${Fg.elements.map(n=>n.toFixed(4))} )`;switch(bt.getTransfer(t)){case Nc:return[e,"LinearTransferOETF"];case Rt:return[e,"sRGBTransferOETF"];default:return lt("WebGLProgram: Unsupported color space: ",t),[e,"LinearTransferOETF"]}}function Ug(t,e,n){const i=t.getShaderParameter(e,t.COMPILE_STATUS),s=(t.getShaderInfoLog(e)||"").trim();if(i&&s==="")return"";const a=/ERROR: 0:(\d+)/.exec(s);if(a){const l=parseInt(a[1]);return n.toUpperCase()+`

`+s+`

`+z3(t.getShaderSource(e),l)}else return s}function W3(t,e){const n=j3(e);return[`vec4 ${t}( vec4 value ) {`,`	return ${n[1]}( vec4( value.rgb * ${n[0]}, value.a ) );`,"}"].join(`
`)}const G3={[Ay]:"Linear",[Py]:"Reinhard",[Ny]:"Cineon",[By]:"ACESFilmic",[Dy]:"AgX",[Ly]:"Neutral",[Iy]:"Custom"};function H3(t,e){const n=G3[e];return n===void 0?(lt("WebGLProgram: Unsupported toneMapping:",e),"vec3 "+t+"( vec3 color ) { return LinearToneMapping( color ); }"):"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const Pl=new re;function V3(){bt.getLuminanceCoefficients(Pl);const t=Pl.x.toFixed(4),e=Pl.y.toFixed(4),n=Pl.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${t}, ${e}, ${n} );`,"	return dot( weights, rgb );","}"].join(`
`)}function K3(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(ro).join(`
`)}function Q3(t){const e=[];for(const n in t){const i=t[n];i!==!1&&e.push("#define "+n+" "+i)}return e.join(`
`)}function q3(t,e){const n={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const s=t.getActiveAttrib(e,r),a=s.name;let l=1;s.type===t.FLOAT_MAT2&&(l=2),s.type===t.FLOAT_MAT3&&(l=3),s.type===t.FLOAT_MAT4&&(l=4),n[a]={type:s.type,location:t.getAttribLocation(e,a),locationSize:l}}return n}function ro(t){return t!==""}function Og(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function zg(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const $3=/^[ \t]*#include +<([\w\d./]+)>/gm;function mf(t){return t.replace($3,Y3)}const X3=new Map;function Y3(t,e){let n=ut[e];if(n===void 0){const i=X3.get(e);if(i!==void 0)n=ut[i],lt('WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return mf(n)}const Z3=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function jg(t){return t.replace(Z3,J3)}function J3(t,e,n,i){let r="";for(let s=parseInt(e);s<parseInt(n);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function Wg(t){let e=`precision ${t.precision} float;
	precision ${t.precision} int;
	precision ${t.precision} sampler2D;
	precision ${t.precision} samplerCube;
	precision ${t.precision} sampler3D;
	precision ${t.precision} sampler2DArray;
	precision ${t.precision} sampler2DShadow;
	precision ${t.precision} samplerCubeShadow;
	precision ${t.precision} sampler2DArrayShadow;
	precision ${t.precision} isampler2D;
	precision ${t.precision} isampler3D;
	precision ${t.precision} isamplerCube;
	precision ${t.precision} isampler2DArray;
	precision ${t.precision} usampler2D;
	precision ${t.precision} usampler3D;
	precision ${t.precision} usamplerCube;
	precision ${t.precision} usampler2DArray;
	`;return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}const eM={[Jl]:"SHADOWMAP_TYPE_PCF",[io]:"SHADOWMAP_TYPE_VSM"};function tM(t){return eM[t.shadowMapType]||"SHADOWMAP_TYPE_BASIC"}const nM={[_s]:"ENVMAP_TYPE_CUBE",[wa]:"ENVMAP_TYPE_CUBE",[ed]:"ENVMAP_TYPE_CUBE_UV"};function iM(t){return t.envMap===!1?"ENVMAP_TYPE_CUBE":nM[t.envMapMode]||"ENVMAP_TYPE_CUBE"}const rM={[wa]:"ENVMAP_MODE_REFRACTION"};function sM(t){return t.envMap===!1?"ENVMAP_MODE_REFLECTION":rM[t.envMapMode]||"ENVMAP_MODE_REFLECTION"}const aM={[Ty]:"ENVMAP_BLENDING_MULTIPLY",[K2]:"ENVMAP_BLENDING_MIX",[Q2]:"ENVMAP_BLENDING_ADD"};function oM(t){return t.envMap===!1?"ENVMAP_BLENDING_NONE":aM[t.combine]||"ENVMAP_BLENDING_NONE"}function lM(t){const e=t.envMapCubeUVHeight;if(e===null)return null;const n=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),7*16)),texelHeight:i,maxMip:n}}function cM(t,e,n,i){const r=t.getContext(),s=n.defines;let a=n.vertexShader,l=n.fragmentShader;const c=tM(n),d=iM(n),h=sM(n),f=oM(n),p=lM(n),m=K3(n),y=Q3(s),x=r.createProgram();let g,u,v=n.glslVersion?"#version "+n.glslVersion+`
`:"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,y].filter(ro).join(`
`),g.length>0&&(g+=`
`),u=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,y].filter(ro).join(`
`),u.length>0&&(u+=`
`)):(g=[Wg(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,y,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",n.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(ro).join(`
`),u=[Wg(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,y,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+d:"",n.envMap?"#define "+h:"",n.envMap?"#define "+f:"",p?"#define CUBEUV_TEXEL_WIDTH "+p.texelWidth:"",p?"#define CUBEUV_TEXEL_HEIGHT "+p.texelHeight:"",p?"#define CUBEUV_MAX_MIP "+p.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",n.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Fi?"#define TONE_MAPPING":"",n.toneMapping!==Fi?ut.tonemapping_pars_fragment:"",n.toneMapping!==Fi?H3("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",ut.colorspace_pars_fragment,W3("linearToOutputTexel",n.outputColorSpace),V3(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(ro).join(`
`)),a=mf(a),a=Og(a,n),a=zg(a,n),l=mf(l),l=Og(l,n),l=zg(l,n),a=jg(a),l=jg(l),n.isRawShaderMaterial!==!0&&(v=`#version 300 es
`,g=[m,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,u=["#define varying in",n.glslVersion===Jm?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Jm?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+u);const b=v+g+a,w=v+u+l,R=Lg(r,r.VERTEX_SHADER,b),C=Lg(r,r.FRAGMENT_SHADER,w);r.attachShader(x,R),r.attachShader(x,C),n.index0AttributeName!==void 0?r.bindAttribLocation(x,0,n.index0AttributeName):n.morphTargets===!0&&r.bindAttribLocation(x,0,"position"),r.linkProgram(x);function A(U){if(t.debug.checkShaderErrors){const O=r.getProgramInfoLog(x)||"",X=r.getShaderInfoLog(R)||"",K=r.getShaderInfoLog(C)||"",$=O.trim(),q=X.trim(),J=K.trim();let V=!0,ue=!0;if(r.getProgramParameter(x,r.LINK_STATUS)===!1)if(V=!1,typeof t.debug.onShaderError=="function")t.debug.onShaderError(r,x,R,C);else{const F=Ug(r,R,"vertex"),de=Ug(r,C,"fragment");vt("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(x,r.VALIDATE_STATUS)+`

Material Name: `+U.name+`
Material Type: `+U.type+`

Program Info Log: `+$+`
`+F+`
`+de)}else $!==""?lt("WebGLProgram: Program Info Log:",$):(q===""||J==="")&&(ue=!1);ue&&(U.diagnostics={runnable:V,programLog:$,vertexShader:{log:q,prefix:g},fragmentShader:{log:J,prefix:u}})}r.deleteShader(R),r.deleteShader(C),B=new ac(r,x),S=q3(r,x)}let B;this.getUniforms=function(){return B===void 0&&A(this),B};let S;this.getAttributes=function(){return S===void 0&&A(this),S};let k=n.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return k===!1&&(k=r.getProgramParameter(x,U3)),k},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(x),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=O3++,this.cacheKey=e,this.usedTimes=1,this.program=x,this.vertexShader=R,this.fragmentShader=C,this}let dM=0;class uM{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const n=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(n),s=this._getShaderStage(i),a=this._getShaderCacheForMaterial(e);return a.has(r)===!1&&(a.add(r),r.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(e){const n=this.materialCache.get(e);for(const i of n)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const n=this.materialCache;let i=n.get(e);return i===void 0&&(i=new Set,n.set(e,i)),i}_getShaderStage(e){const n=this.shaderCache;let i=n.get(e);return i===void 0&&(i=new hM(e),n.set(e,i)),i}}class hM{constructor(e){this.id=dM++,this.code=e,this.usedTimes=0}}function fM(t,e,n,i,r,s,a){const l=new kp,c=new uM,d=new Set,h=[],f=new Map,p=r.logarithmicDepthBuffer;let m=r.precision;const y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distance",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function x(S){return d.add(S),S===0?"uv":`uv${S}`}function g(S,k,U,O,X){const K=O.fog,$=X.geometry,q=S.isMeshStandardMaterial?O.environment:null,J=(S.isMeshStandardMaterial?n:e).get(S.envMap||q),V=J&&J.mapping===ed?J.image.height:null,ue=y[S.type];S.precision!==null&&(m=r.getMaxPrecision(S.precision),m!==S.precision&&lt("WebGLProgram.getParameters:",S.precision,"not supported, using",m,"instead."));const F=$.morphAttributes.position||$.morphAttributes.normal||$.morphAttributes.color,de=F!==void 0?F.length:0;let Te=0;$.morphAttributes.position!==void 0&&(Te=1),$.morphAttributes.normal!==void 0&&(Te=2),$.morphAttributes.color!==void 0&&(Te=3);let xe,le,Re,Q;if(ue){const mt=Ai[ue];xe=mt.vertexShader,le=mt.fragmentShader}else xe=S.vertexShader,le=S.fragmentShader,c.update(S),Re=c.getVertexShaderID(S),Q=c.getFragmentShaderID(S);const ae=t.getRenderTarget(),Me=t.state.buffers.depth.getReversed(),ze=X.isInstancedMesh===!0,se=X.isBatchedMesh===!0,ke=!!S.map,Ge=!!S.matcap,Oe=!!J,Ve=!!S.aoMap,Ze=!!S.lightMap,Ue=!!S.bumpMap,tt=!!S.normalMap,z=!!S.displacementMap,ht=!!S.emissiveMap,Xe=!!S.metalnessMap,Je=!!S.roughnessMap,ee=S.anisotropy>0,P=S.clearcoat>0,_=S.dispersion>0,W=S.iridescence>0,M=S.sheen>0,_e=S.transmission>0,ne=ee&&!!S.anisotropyMap,Ie=P&&!!S.clearcoatMap,ie=P&&!!S.clearcoatNormalMap,Se=P&&!!S.clearcoatRoughnessMap,we=W&&!!S.iridescenceMap,ve=W&&!!S.iridescenceThicknessMap,Ee=M&&!!S.sheenColorMap,he=M&&!!S.sheenRoughnessMap,Z=!!S.specularMap,me=!!S.specularColorMap,Ke=!!S.specularIntensityMap,G=_e&&!!S.transmissionMap,Be=_e&&!!S.thicknessMap,Pe=!!S.gradientMap,je=!!S.alphaMap,Ae=S.alphaTest>0,fe=!!S.alphaHash,Fe=!!S.extensions;let nt=Fi;S.toneMapped&&(ae===null||ae.isXRRenderTarget===!0)&&(nt=t.toneMapping);const yt={shaderID:ue,shaderType:S.type,shaderName:S.name,vertexShader:xe,fragmentShader:le,defines:S.defines,customVertexShaderID:Re,customFragmentShaderID:Q,isRawShaderMaterial:S.isRawShaderMaterial===!0,glslVersion:S.glslVersion,precision:m,batching:se,batchingColor:se&&X._colorsTexture!==null,instancing:ze,instancingColor:ze&&X.instanceColor!==null,instancingMorph:ze&&X.morphTexture!==null,outputColorSpace:ae===null?t.outputColorSpace:ae.isXRRenderTarget===!0?ae.texture.colorSpace:Ma,alphaToCoverage:!!S.alphaToCoverage,map:ke,matcap:Ge,envMap:Oe,envMapMode:Oe&&J.mapping,envMapCubeUVHeight:V,aoMap:Ve,lightMap:Ze,bumpMap:Ue,normalMap:tt,displacementMap:z,emissiveMap:ht,normalMapObjectSpace:tt&&S.normalMapType===X2,normalMapTangentSpace:tt&&S.normalMapType===Vy,metalnessMap:Xe,roughnessMap:Je,anisotropy:ee,anisotropyMap:ne,clearcoat:P,clearcoatMap:Ie,clearcoatNormalMap:ie,clearcoatRoughnessMap:Se,dispersion:_,iridescence:W,iridescenceMap:we,iridescenceThicknessMap:ve,sheen:M,sheenColorMap:Ee,sheenRoughnessMap:he,specularMap:Z,specularColorMap:me,specularIntensityMap:Ke,transmission:_e,transmissionMap:G,thicknessMap:Be,gradientMap:Pe,opaque:S.transparent===!1&&S.blending===ua&&S.alphaToCoverage===!1,alphaMap:je,alphaTest:Ae,alphaHash:fe,combine:S.combine,mapUv:ke&&x(S.map.channel),aoMapUv:Ve&&x(S.aoMap.channel),lightMapUv:Ze&&x(S.lightMap.channel),bumpMapUv:Ue&&x(S.bumpMap.channel),normalMapUv:tt&&x(S.normalMap.channel),displacementMapUv:z&&x(S.displacementMap.channel),emissiveMapUv:ht&&x(S.emissiveMap.channel),metalnessMapUv:Xe&&x(S.metalnessMap.channel),roughnessMapUv:Je&&x(S.roughnessMap.channel),anisotropyMapUv:ne&&x(S.anisotropyMap.channel),clearcoatMapUv:Ie&&x(S.clearcoatMap.channel),clearcoatNormalMapUv:ie&&x(S.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Se&&x(S.clearcoatRoughnessMap.channel),iridescenceMapUv:we&&x(S.iridescenceMap.channel),iridescenceThicknessMapUv:ve&&x(S.iridescenceThicknessMap.channel),sheenColorMapUv:Ee&&x(S.sheenColorMap.channel),sheenRoughnessMapUv:he&&x(S.sheenRoughnessMap.channel),specularMapUv:Z&&x(S.specularMap.channel),specularColorMapUv:me&&x(S.specularColorMap.channel),specularIntensityMapUv:Ke&&x(S.specularIntensityMap.channel),transmissionMapUv:G&&x(S.transmissionMap.channel),thicknessMapUv:Be&&x(S.thicknessMap.channel),alphaMapUv:je&&x(S.alphaMap.channel),vertexTangents:!!$.attributes.tangent&&(tt||ee),vertexColors:S.vertexColors,vertexAlphas:S.vertexColors===!0&&!!$.attributes.color&&$.attributes.color.itemSize===4,pointsUvs:X.isPoints===!0&&!!$.attributes.uv&&(ke||je),fog:!!K,useFog:S.fog===!0,fogExp2:!!K&&K.isFogExp2,flatShading:S.flatShading===!0&&S.wireframe===!1,sizeAttenuation:S.sizeAttenuation===!0,logarithmicDepthBuffer:p,reversedDepthBuffer:Me,skinning:X.isSkinnedMesh===!0,morphTargets:$.morphAttributes.position!==void 0,morphNormals:$.morphAttributes.normal!==void 0,morphColors:$.morphAttributes.color!==void 0,morphTargetsCount:de,morphTextureStride:Te,numDirLights:k.directional.length,numPointLights:k.point.length,numSpotLights:k.spot.length,numSpotLightMaps:k.spotLightMap.length,numRectAreaLights:k.rectArea.length,numHemiLights:k.hemi.length,numDirLightShadows:k.directionalShadowMap.length,numPointLightShadows:k.pointShadowMap.length,numSpotLightShadows:k.spotShadowMap.length,numSpotLightShadowsWithMaps:k.numSpotLightShadowsWithMaps,numLightProbes:k.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:S.dithering,shadowMapEnabled:t.shadowMap.enabled&&U.length>0,shadowMapType:t.shadowMap.type,toneMapping:nt,decodeVideoTexture:ke&&S.map.isVideoTexture===!0&&bt.getTransfer(S.map.colorSpace)===Rt,decodeVideoTextureEmissive:ht&&S.emissiveMap.isVideoTexture===!0&&bt.getTransfer(S.emissiveMap.colorSpace)===Rt,premultipliedAlpha:S.premultipliedAlpha,doubleSided:S.side===Ni,flipSided:S.side===zn,useDepthPacking:S.depthPacking>=0,depthPacking:S.depthPacking||0,index0AttributeName:S.index0AttributeName,extensionClipCullDistance:Fe&&S.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Fe&&S.extensions.multiDraw===!0||se)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:S.customProgramCacheKey()};return yt.vertexUv1s=d.has(1),yt.vertexUv2s=d.has(2),yt.vertexUv3s=d.has(3),d.clear(),yt}function u(S){const k=[];if(S.shaderID?k.push(S.shaderID):(k.push(S.customVertexShaderID),k.push(S.customFragmentShaderID)),S.defines!==void 0)for(const U in S.defines)k.push(U),k.push(S.defines[U]);return S.isRawShaderMaterial===!1&&(v(k,S),b(k,S),k.push(t.outputColorSpace)),k.push(S.customProgramCacheKey),k.join()}function v(S,k){S.push(k.precision),S.push(k.outputColorSpace),S.push(k.envMapMode),S.push(k.envMapCubeUVHeight),S.push(k.mapUv),S.push(k.alphaMapUv),S.push(k.lightMapUv),S.push(k.aoMapUv),S.push(k.bumpMapUv),S.push(k.normalMapUv),S.push(k.displacementMapUv),S.push(k.emissiveMapUv),S.push(k.metalnessMapUv),S.push(k.roughnessMapUv),S.push(k.anisotropyMapUv),S.push(k.clearcoatMapUv),S.push(k.clearcoatNormalMapUv),S.push(k.clearcoatRoughnessMapUv),S.push(k.iridescenceMapUv),S.push(k.iridescenceThicknessMapUv),S.push(k.sheenColorMapUv),S.push(k.sheenRoughnessMapUv),S.push(k.specularMapUv),S.push(k.specularColorMapUv),S.push(k.specularIntensityMapUv),S.push(k.transmissionMapUv),S.push(k.thicknessMapUv),S.push(k.combine),S.push(k.fogExp2),S.push(k.sizeAttenuation),S.push(k.morphTargetsCount),S.push(k.morphAttributeCount),S.push(k.numDirLights),S.push(k.numPointLights),S.push(k.numSpotLights),S.push(k.numSpotLightMaps),S.push(k.numHemiLights),S.push(k.numRectAreaLights),S.push(k.numDirLightShadows),S.push(k.numPointLightShadows),S.push(k.numSpotLightShadows),S.push(k.numSpotLightShadowsWithMaps),S.push(k.numLightProbes),S.push(k.shadowMapType),S.push(k.toneMapping),S.push(k.numClippingPlanes),S.push(k.numClipIntersection),S.push(k.depthPacking)}function b(S,k){l.disableAll(),k.instancing&&l.enable(0),k.instancingColor&&l.enable(1),k.instancingMorph&&l.enable(2),k.matcap&&l.enable(3),k.envMap&&l.enable(4),k.normalMapObjectSpace&&l.enable(5),k.normalMapTangentSpace&&l.enable(6),k.clearcoat&&l.enable(7),k.iridescence&&l.enable(8),k.alphaTest&&l.enable(9),k.vertexColors&&l.enable(10),k.vertexAlphas&&l.enable(11),k.vertexUv1s&&l.enable(12),k.vertexUv2s&&l.enable(13),k.vertexUv3s&&l.enable(14),k.vertexTangents&&l.enable(15),k.anisotropy&&l.enable(16),k.alphaHash&&l.enable(17),k.batching&&l.enable(18),k.dispersion&&l.enable(19),k.batchingColor&&l.enable(20),k.gradientMap&&l.enable(21),S.push(l.mask),l.disableAll(),k.fog&&l.enable(0),k.useFog&&l.enable(1),k.flatShading&&l.enable(2),k.logarithmicDepthBuffer&&l.enable(3),k.reversedDepthBuffer&&l.enable(4),k.skinning&&l.enable(5),k.morphTargets&&l.enable(6),k.morphNormals&&l.enable(7),k.morphColors&&l.enable(8),k.premultipliedAlpha&&l.enable(9),k.shadowMapEnabled&&l.enable(10),k.doubleSided&&l.enable(11),k.flipSided&&l.enable(12),k.useDepthPacking&&l.enable(13),k.dithering&&l.enable(14),k.transmission&&l.enable(15),k.sheen&&l.enable(16),k.opaque&&l.enable(17),k.pointsUvs&&l.enable(18),k.decodeVideoTexture&&l.enable(19),k.decodeVideoTextureEmissive&&l.enable(20),k.alphaToCoverage&&l.enable(21),S.push(l.mask)}function w(S){const k=y[S.type];let U;if(k){const O=Ai[k];U=M_.clone(O.uniforms)}else U=S.uniforms;return U}function R(S,k){let U=f.get(k);return U!==void 0?++U.usedTimes:(U=new cM(t,k,S,s),h.push(U),f.set(k,U)),U}function C(S){if(--S.usedTimes===0){const k=h.indexOf(S);h[k]=h[h.length-1],h.pop(),f.delete(S.cacheKey),S.destroy()}}function A(S){c.remove(S)}function B(){c.dispose()}return{getParameters:g,getProgramCacheKey:u,getUniforms:w,acquireProgram:R,releaseProgram:C,releaseShaderCache:A,programs:h,dispose:B}}function pM(){let t=new WeakMap;function e(a){return t.has(a)}function n(a){let l=t.get(a);return l===void 0&&(l={},t.set(a,l)),l}function i(a){t.delete(a)}function r(a,l,c){t.get(a)[l]=c}function s(){t=new WeakMap}return{has:e,get:n,remove:i,update:r,dispose:s}}function mM(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Gg(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Hg(){const t=[];let e=0;const n=[],i=[],r=[];function s(){e=0,n.length=0,i.length=0,r.length=0}function a(f,p,m,y,x,g){let u=t[e];return u===void 0?(u={id:f.id,object:f,geometry:p,material:m,groupOrder:y,renderOrder:f.renderOrder,z:x,group:g},t[e]=u):(u.id=f.id,u.object=f,u.geometry=p,u.material=m,u.groupOrder=y,u.renderOrder=f.renderOrder,u.z=x,u.group=g),e++,u}function l(f,p,m,y,x,g){const u=a(f,p,m,y,x,g);m.transmission>0?i.push(u):m.transparent===!0?r.push(u):n.push(u)}function c(f,p,m,y,x,g){const u=a(f,p,m,y,x,g);m.transmission>0?i.unshift(u):m.transparent===!0?r.unshift(u):n.unshift(u)}function d(f,p){n.length>1&&n.sort(f||mM),i.length>1&&i.sort(p||Gg),r.length>1&&r.sort(p||Gg)}function h(){for(let f=e,p=t.length;f<p;f++){const m=t[f];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}}return{opaque:n,transmissive:i,transparent:r,init:s,push:l,unshift:c,finish:h,sort:d}}function gM(){let t=new WeakMap;function e(i,r){const s=t.get(i);let a;return s===void 0?(a=new Hg,t.set(i,[a])):r>=s.length?(a=new Hg,s.push(a)):a=s[r],a}function n(){t=new WeakMap}return{get:e,dispose:n}}function xM(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new re,color:new dt};break;case"SpotLight":n={position:new re,direction:new re,color:new dt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new re,color:new dt,distance:0,decay:0};break;case"HemisphereLight":n={direction:new re,skyColor:new dt,groundColor:new dt};break;case"RectAreaLight":n={color:new dt,position:new re,halfWidth:new re,halfHeight:new re};break}return t[e.id]=n,n}}}function yM(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new it};break;case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new it};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new it,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=n,n}}}let vM=0;function bM(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function _M(t){const e=new xM,n=yM(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let d=0;d<9;d++)i.probe.push(new re);const r=new re,s=new zt,a=new zt;function l(d){let h=0,f=0,p=0;for(let S=0;S<9;S++)i.probe[S].set(0,0,0);let m=0,y=0,x=0,g=0,u=0,v=0,b=0,w=0,R=0,C=0,A=0;d.sort(bM);for(let S=0,k=d.length;S<k;S++){const U=d[S],O=U.color,X=U.intensity,K=U.distance;let $=null;if(U.shadow&&U.shadow.map&&(U.shadow.map.texture.format===ka?$=U.shadow.map.texture:$=U.shadow.map.depthTexture||U.shadow.map.texture),U.isAmbientLight)h+=O.r*X,f+=O.g*X,p+=O.b*X;else if(U.isLightProbe){for(let q=0;q<9;q++)i.probe[q].addScaledVector(U.sh.coefficients[q],X);A++}else if(U.isDirectionalLight){const q=e.get(U);if(q.color.copy(U.color).multiplyScalar(U.intensity),U.castShadow){const J=U.shadow,V=n.get(U);V.shadowIntensity=J.intensity,V.shadowBias=J.bias,V.shadowNormalBias=J.normalBias,V.shadowRadius=J.radius,V.shadowMapSize=J.mapSize,i.directionalShadow[m]=V,i.directionalShadowMap[m]=$,i.directionalShadowMatrix[m]=U.shadow.matrix,v++}i.directional[m]=q,m++}else if(U.isSpotLight){const q=e.get(U);q.position.setFromMatrixPosition(U.matrixWorld),q.color.copy(O).multiplyScalar(X),q.distance=K,q.coneCos=Math.cos(U.angle),q.penumbraCos=Math.cos(U.angle*(1-U.penumbra)),q.decay=U.decay,i.spot[x]=q;const J=U.shadow;if(U.map&&(i.spotLightMap[R]=U.map,R++,J.updateMatrices(U),U.castShadow&&C++),i.spotLightMatrix[x]=J.matrix,U.castShadow){const V=n.get(U);V.shadowIntensity=J.intensity,V.shadowBias=J.bias,V.shadowNormalBias=J.normalBias,V.shadowRadius=J.radius,V.shadowMapSize=J.mapSize,i.spotShadow[x]=V,i.spotShadowMap[x]=$,w++}x++}else if(U.isRectAreaLight){const q=e.get(U);q.color.copy(O).multiplyScalar(X),q.halfWidth.set(U.width*.5,0,0),q.halfHeight.set(0,U.height*.5,0),i.rectArea[g]=q,g++}else if(U.isPointLight){const q=e.get(U);if(q.color.copy(U.color).multiplyScalar(U.intensity),q.distance=U.distance,q.decay=U.decay,U.castShadow){const J=U.shadow,V=n.get(U);V.shadowIntensity=J.intensity,V.shadowBias=J.bias,V.shadowNormalBias=J.normalBias,V.shadowRadius=J.radius,V.shadowMapSize=J.mapSize,V.shadowCameraNear=J.camera.near,V.shadowCameraFar=J.camera.far,i.pointShadow[y]=V,i.pointShadowMap[y]=$,i.pointShadowMatrix[y]=U.shadow.matrix,b++}i.point[y]=q,y++}else if(U.isHemisphereLight){const q=e.get(U);q.skyColor.copy(U.color).multiplyScalar(X),q.groundColor.copy(U.groundColor).multiplyScalar(X),i.hemi[u]=q,u++}}g>0&&(t.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=He.LTC_FLOAT_1,i.rectAreaLTC2=He.LTC_FLOAT_2):(i.rectAreaLTC1=He.LTC_HALF_1,i.rectAreaLTC2=He.LTC_HALF_2)),i.ambient[0]=h,i.ambient[1]=f,i.ambient[2]=p;const B=i.hash;(B.directionalLength!==m||B.pointLength!==y||B.spotLength!==x||B.rectAreaLength!==g||B.hemiLength!==u||B.numDirectionalShadows!==v||B.numPointShadows!==b||B.numSpotShadows!==w||B.numSpotMaps!==R||B.numLightProbes!==A)&&(i.directional.length=m,i.spot.length=x,i.rectArea.length=g,i.point.length=y,i.hemi.length=u,i.directionalShadow.length=v,i.directionalShadowMap.length=v,i.pointShadow.length=b,i.pointShadowMap.length=b,i.spotShadow.length=w,i.spotShadowMap.length=w,i.directionalShadowMatrix.length=v,i.pointShadowMatrix.length=b,i.spotLightMatrix.length=w+R-C,i.spotLightMap.length=R,i.numSpotLightShadowsWithMaps=C,i.numLightProbes=A,B.directionalLength=m,B.pointLength=y,B.spotLength=x,B.rectAreaLength=g,B.hemiLength=u,B.numDirectionalShadows=v,B.numPointShadows=b,B.numSpotShadows=w,B.numSpotMaps=R,B.numLightProbes=A,i.version=vM++)}function c(d,h){let f=0,p=0,m=0,y=0,x=0;const g=h.matrixWorldInverse;for(let u=0,v=d.length;u<v;u++){const b=d[u];if(b.isDirectionalLight){const w=i.directional[f];w.direction.setFromMatrixPosition(b.matrixWorld),r.setFromMatrixPosition(b.target.matrixWorld),w.direction.sub(r),w.direction.transformDirection(g),f++}else if(b.isSpotLight){const w=i.spot[m];w.position.setFromMatrixPosition(b.matrixWorld),w.position.applyMatrix4(g),w.direction.setFromMatrixPosition(b.matrixWorld),r.setFromMatrixPosition(b.target.matrixWorld),w.direction.sub(r),w.direction.transformDirection(g),m++}else if(b.isRectAreaLight){const w=i.rectArea[y];w.position.setFromMatrixPosition(b.matrixWorld),w.position.applyMatrix4(g),a.identity(),s.copy(b.matrixWorld),s.premultiply(g),a.extractRotation(s),w.halfWidth.set(b.width*.5,0,0),w.halfHeight.set(0,b.height*.5,0),w.halfWidth.applyMatrix4(a),w.halfHeight.applyMatrix4(a),y++}else if(b.isPointLight){const w=i.point[p];w.position.setFromMatrixPosition(b.matrixWorld),w.position.applyMatrix4(g),p++}else if(b.isHemisphereLight){const w=i.hemi[x];w.direction.setFromMatrixPosition(b.matrixWorld),w.direction.transformDirection(g),x++}}}return{setup:l,setupView:c,state:i}}function Vg(t){const e=new _M(t),n=[],i=[];function r(h){d.camera=h,n.length=0,i.length=0}function s(h){n.push(h)}function a(h){i.push(h)}function l(){e.setup(n)}function c(h){e.setupView(n,h)}const d={lightsArray:n,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:d,setupLights:l,setupLightsView:c,pushLight:s,pushShadow:a}}function SM(t){let e=new WeakMap;function n(r,s=0){const a=e.get(r);let l;return a===void 0?(l=new Vg(t),e.set(r,[l])):s>=a.length?(l=new Vg(t),a.push(l)):l=a[s],l}function i(){e=new WeakMap}return{get:n,dispose:i}}const wM=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,kM=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ).rg;
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ).r;
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( max( 0.0, squared_mean - mean * mean ) );
	gl_FragColor = vec4( mean, std_dev, 0.0, 1.0 );
}`,MM=[new re(1,0,0),new re(-1,0,0),new re(0,1,0),new re(0,-1,0),new re(0,0,1),new re(0,0,-1)],RM=[new re(0,-1,0),new re(0,-1,0),new re(0,0,1),new re(0,0,-1),new re(0,-1,0),new re(0,-1,0)],Kg=new zt,Xa=new re,gu=new re;function EM(t,e,n){let i=new Mp;const r=new it,s=new it,a=new Gt,l=new U_,c=new O_,d={},h=n.maxTextureSize,f={[Hr]:zn,[zn]:Hr,[Ni]:Ni},p=new Wi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new it},radius:{value:4}},vertexShader:wM,fragmentShader:kM}),m=p.clone();m.defines.HORIZONTAL_PASS=1;const y=new ki;y.setAttribute("position",new Oi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const x=new Dn(y,p),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Jl;let u=this.type;this.render=function(C,A,B){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||C.length===0)return;C.type===Cy&&(lt("WebGLShadowMap: PCFSoftShadowMap has been deprecated. Using PCFShadowMap instead."),C.type=Jl);const S=t.getRenderTarget(),k=t.getActiveCubeFace(),U=t.getActiveMipmapLevel(),O=t.state;O.setBlending(tr),O.buffers.depth.getReversed()===!0?O.buffers.color.setClear(0,0,0,0):O.buffers.color.setClear(1,1,1,1),O.buffers.depth.setTest(!0),O.setScissorTest(!1);const X=u!==this.type;X&&A.traverse(function(K){K.material&&(Array.isArray(K.material)?K.material.forEach($=>$.needsUpdate=!0):K.material.needsUpdate=!0)});for(let K=0,$=C.length;K<$;K++){const q=C[K],J=q.shadow;if(J===void 0){lt("WebGLShadowMap:",q,"has no shadow.");continue}if(J.autoUpdate===!1&&J.needsUpdate===!1)continue;r.copy(J.mapSize);const V=J.getFrameExtents();if(r.multiply(V),s.copy(J.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(s.x=Math.floor(h/V.x),r.x=s.x*V.x,J.mapSize.x=s.x),r.y>h&&(s.y=Math.floor(h/V.y),r.y=s.y*V.y,J.mapSize.y=s.y)),J.map===null||X===!0){if(J.map!==null&&(J.map.depthTexture!==null&&(J.map.depthTexture.dispose(),J.map.depthTexture=null),J.map.dispose()),this.type===io){if(q.isPointLight){lt("WebGLShadowMap: VSM shadow maps are not supported for PointLights. Use PCF or BasicShadowMap instead.");continue}J.map=new Ui(r.x,r.y,{format:ka,type:or,minFilter:gn,magFilter:gn,generateMipmaps:!1}),J.map.texture.name=q.name+".shadowMap",J.map.depthTexture=new Lo(r.x,r.y,Bi),J.map.depthTexture.name=q.name+".shadowMapDepth",J.map.depthTexture.format=lr,J.map.depthTexture.compareFunction=null,J.map.depthTexture.minFilter=on,J.map.depthTexture.magFilter=on}else{q.isPointLight?(J.map=new e1(r.x),J.map.depthTexture=new D_(r.x,zi)):(J.map=new Ui(r.x,r.y),J.map.depthTexture=new Lo(r.x,r.y,zi)),J.map.depthTexture.name=q.name+".shadowMap",J.map.depthTexture.format=lr;const F=t.state.buffers.depth.getReversed();this.type===Jl?(J.map.depthTexture.compareFunction=F?bp:vp,J.map.depthTexture.minFilter=gn,J.map.depthTexture.magFilter=gn):(J.map.depthTexture.compareFunction=null,J.map.depthTexture.minFilter=on,J.map.depthTexture.magFilter=on)}J.camera.updateProjectionMatrix()}const ue=J.map.isWebGLCubeRenderTarget?6:1;for(let F=0;F<ue;F++){if(J.map.isWebGLCubeRenderTarget)t.setRenderTarget(J.map,F),t.clear();else{F===0&&(t.setRenderTarget(J.map),t.clear());const de=J.getViewport(F);a.set(s.x*de.x,s.y*de.y,s.x*de.z,s.y*de.w),O.viewport(a)}if(q.isPointLight){const de=J.camera,Te=J.matrix,xe=q.distance||de.far;xe!==de.far&&(de.far=xe,de.updateProjectionMatrix()),Xa.setFromMatrixPosition(q.matrixWorld),de.position.copy(Xa),gu.copy(de.position),gu.add(MM[F]),de.up.copy(RM[F]),de.lookAt(gu),de.updateMatrixWorld(),Te.makeTranslation(-Xa.x,-Xa.y,-Xa.z),Kg.multiplyMatrices(de.projectionMatrix,de.matrixWorldInverse),J._frustum.setFromProjectionMatrix(Kg,de.coordinateSystem,de.reversedDepth)}else J.updateMatrices(q);i=J.getFrustum(),w(A,B,J.camera,q,this.type)}J.isPointLightShadow!==!0&&this.type===io&&v(J,B),J.needsUpdate=!1}u=this.type,g.needsUpdate=!1,t.setRenderTarget(S,k,U)};function v(C,A){const B=e.update(x);p.defines.VSM_SAMPLES!==C.blurSamples&&(p.defines.VSM_SAMPLES=C.blurSamples,m.defines.VSM_SAMPLES=C.blurSamples,p.needsUpdate=!0,m.needsUpdate=!0),C.mapPass===null&&(C.mapPass=new Ui(r.x,r.y,{format:ka,type:or})),p.uniforms.shadow_pass.value=C.map.depthTexture,p.uniforms.resolution.value=C.mapSize,p.uniforms.radius.value=C.radius,t.setRenderTarget(C.mapPass),t.clear(),t.renderBufferDirect(A,null,B,p,x,null),m.uniforms.shadow_pass.value=C.mapPass.texture,m.uniforms.resolution.value=C.mapSize,m.uniforms.radius.value=C.radius,t.setRenderTarget(C.map),t.clear(),t.renderBufferDirect(A,null,B,m,x,null)}function b(C,A,B,S){let k=null;const U=B.isPointLight===!0?C.customDistanceMaterial:C.customDepthMaterial;if(U!==void 0)k=U;else if(k=B.isPointLight===!0?c:l,t.localClippingEnabled&&A.clipShadows===!0&&Array.isArray(A.clippingPlanes)&&A.clippingPlanes.length!==0||A.displacementMap&&A.displacementScale!==0||A.alphaMap&&A.alphaTest>0||A.map&&A.alphaTest>0||A.alphaToCoverage===!0){const O=k.uuid,X=A.uuid;let K=d[O];K===void 0&&(K={},d[O]=K);let $=K[X];$===void 0&&($=k.clone(),K[X]=$,A.addEventListener("dispose",R)),k=$}if(k.visible=A.visible,k.wireframe=A.wireframe,S===io?k.side=A.shadowSide!==null?A.shadowSide:A.side:k.side=A.shadowSide!==null?A.shadowSide:f[A.side],k.alphaMap=A.alphaMap,k.alphaTest=A.alphaToCoverage===!0?.5:A.alphaTest,k.map=A.map,k.clipShadows=A.clipShadows,k.clippingPlanes=A.clippingPlanes,k.clipIntersection=A.clipIntersection,k.displacementMap=A.displacementMap,k.displacementScale=A.displacementScale,k.displacementBias=A.displacementBias,k.wireframeLinewidth=A.wireframeLinewidth,k.linewidth=A.linewidth,B.isPointLight===!0&&k.isMeshDistanceMaterial===!0){const O=t.properties.get(k);O.light=B}return k}function w(C,A,B,S,k){if(C.visible===!1)return;if(C.layers.test(A.layers)&&(C.isMesh||C.isLine||C.isPoints)&&(C.castShadow||C.receiveShadow&&k===io)&&(!C.frustumCulled||i.intersectsObject(C))){C.modelViewMatrix.multiplyMatrices(B.matrixWorldInverse,C.matrixWorld);const X=e.update(C),K=C.material;if(Array.isArray(K)){const $=X.groups;for(let q=0,J=$.length;q<J;q++){const V=$[q],ue=K[V.materialIndex];if(ue&&ue.visible){const F=b(C,ue,S,k);C.onBeforeShadow(t,C,A,B,X,F,V),t.renderBufferDirect(B,null,X,F,C,V),C.onAfterShadow(t,C,A,B,X,F,V)}}}else if(K.visible){const $=b(C,K,S,k);C.onBeforeShadow(t,C,A,B,X,$,null),t.renderBufferDirect(B,null,X,$,C,null),C.onAfterShadow(t,C,A,B,X,$,null)}}const O=C.children;for(let X=0,K=O.length;X<K;X++)w(O[X],A,B,S,k)}function R(C){C.target.removeEventListener("dispose",R);for(const B in d){const S=d[B],k=C.target.uuid;k in S&&(S[k].dispose(),delete S[k])}}}const CM={[Sh]:wh,[kh]:Eh,[Mh]:Ch,[Sa]:Rh,[wh]:Sh,[Eh]:kh,[Ch]:Mh,[Rh]:Sa};function TM(t,e){function n(){let G=!1;const Be=new Gt;let Pe=null;const je=new Gt(0,0,0,0);return{setMask:function(Ae){Pe!==Ae&&!G&&(t.colorMask(Ae,Ae,Ae,Ae),Pe=Ae)},setLocked:function(Ae){G=Ae},setClear:function(Ae,fe,Fe,nt,yt){yt===!0&&(Ae*=nt,fe*=nt,Fe*=nt),Be.set(Ae,fe,Fe,nt),je.equals(Be)===!1&&(t.clearColor(Ae,fe,Fe,nt),je.copy(Be))},reset:function(){G=!1,Pe=null,je.set(-1,0,0,0)}}}function i(){let G=!1,Be=!1,Pe=null,je=null,Ae=null;return{setReversed:function(fe){if(Be!==fe){const Fe=e.get("EXT_clip_control");fe?Fe.clipControlEXT(Fe.LOWER_LEFT_EXT,Fe.ZERO_TO_ONE_EXT):Fe.clipControlEXT(Fe.LOWER_LEFT_EXT,Fe.NEGATIVE_ONE_TO_ONE_EXT),Be=fe;const nt=Ae;Ae=null,this.setClear(nt)}},getReversed:function(){return Be},setTest:function(fe){fe?ae(t.DEPTH_TEST):Me(t.DEPTH_TEST)},setMask:function(fe){Pe!==fe&&!G&&(t.depthMask(fe),Pe=fe)},setFunc:function(fe){if(Be&&(fe=CM[fe]),je!==fe){switch(fe){case Sh:t.depthFunc(t.NEVER);break;case wh:t.depthFunc(t.ALWAYS);break;case kh:t.depthFunc(t.LESS);break;case Sa:t.depthFunc(t.LEQUAL);break;case Mh:t.depthFunc(t.EQUAL);break;case Rh:t.depthFunc(t.GEQUAL);break;case Eh:t.depthFunc(t.GREATER);break;case Ch:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}je=fe}},setLocked:function(fe){G=fe},setClear:function(fe){Ae!==fe&&(Be&&(fe=1-fe),t.clearDepth(fe),Ae=fe)},reset:function(){G=!1,Pe=null,je=null,Ae=null,Be=!1}}}function r(){let G=!1,Be=null,Pe=null,je=null,Ae=null,fe=null,Fe=null,nt=null,yt=null;return{setTest:function(mt){G||(mt?ae(t.STENCIL_TEST):Me(t.STENCIL_TEST))},setMask:function(mt){Be!==mt&&!G&&(t.stencilMask(mt),Be=mt)},setFunc:function(mt,E,be){(Pe!==mt||je!==E||Ae!==be)&&(t.stencilFunc(mt,E,be),Pe=mt,je=E,Ae=be)},setOp:function(mt,E,be){(fe!==mt||Fe!==E||nt!==be)&&(t.stencilOp(mt,E,be),fe=mt,Fe=E,nt=be)},setLocked:function(mt){G=mt},setClear:function(mt){yt!==mt&&(t.clearStencil(mt),yt=mt)},reset:function(){G=!1,Be=null,Pe=null,je=null,Ae=null,fe=null,Fe=null,nt=null,yt=null}}}const s=new n,a=new i,l=new r,c=new WeakMap,d=new WeakMap;let h={},f={},p=new WeakMap,m=[],y=null,x=!1,g=null,u=null,v=null,b=null,w=null,R=null,C=null,A=new dt(0,0,0),B=0,S=!1,k=null,U=null,O=null,X=null,K=null;const $=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let q=!1,J=0;const V=t.getParameter(t.VERSION);V.indexOf("WebGL")!==-1?(J=parseFloat(/^WebGL (\d)/.exec(V)[1]),q=J>=1):V.indexOf("OpenGL ES")!==-1&&(J=parseFloat(/^OpenGL ES (\d)/.exec(V)[1]),q=J>=2);let ue=null,F={};const de=t.getParameter(t.SCISSOR_BOX),Te=t.getParameter(t.VIEWPORT),xe=new Gt().fromArray(de),le=new Gt().fromArray(Te);function Re(G,Be,Pe,je){const Ae=new Uint8Array(4),fe=t.createTexture();t.bindTexture(G,fe),t.texParameteri(G,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(G,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let Fe=0;Fe<Pe;Fe++)G===t.TEXTURE_3D||G===t.TEXTURE_2D_ARRAY?t.texImage3D(Be,0,t.RGBA,1,1,je,0,t.RGBA,t.UNSIGNED_BYTE,Ae):t.texImage2D(Be+Fe,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,Ae);return fe}const Q={};Q[t.TEXTURE_2D]=Re(t.TEXTURE_2D,t.TEXTURE_2D,1),Q[t.TEXTURE_CUBE_MAP]=Re(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),Q[t.TEXTURE_2D_ARRAY]=Re(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),Q[t.TEXTURE_3D]=Re(t.TEXTURE_3D,t.TEXTURE_3D,1,1),s.setClear(0,0,0,1),a.setClear(1),l.setClear(0),ae(t.DEPTH_TEST),a.setFunc(Sa),Ue(!1),tt(Qm),ae(t.CULL_FACE),Ve(tr);function ae(G){h[G]!==!0&&(t.enable(G),h[G]=!0)}function Me(G){h[G]!==!1&&(t.disable(G),h[G]=!1)}function ze(G,Be){return f[G]!==Be?(t.bindFramebuffer(G,Be),f[G]=Be,G===t.DRAW_FRAMEBUFFER&&(f[t.FRAMEBUFFER]=Be),G===t.FRAMEBUFFER&&(f[t.DRAW_FRAMEBUFFER]=Be),!0):!1}function se(G,Be){let Pe=m,je=!1;if(G){Pe=p.get(Be),Pe===void 0&&(Pe=[],p.set(Be,Pe));const Ae=G.textures;if(Pe.length!==Ae.length||Pe[0]!==t.COLOR_ATTACHMENT0){for(let fe=0,Fe=Ae.length;fe<Fe;fe++)Pe[fe]=t.COLOR_ATTACHMENT0+fe;Pe.length=Ae.length,je=!0}}else Pe[0]!==t.BACK&&(Pe[0]=t.BACK,je=!0);je&&t.drawBuffers(Pe)}function ke(G){return y!==G?(t.useProgram(G),y=G,!0):!1}const Ge={[as]:t.FUNC_ADD,[T2]:t.FUNC_SUBTRACT,[A2]:t.FUNC_REVERSE_SUBTRACT};Ge[P2]=t.MIN,Ge[N2]=t.MAX;const Oe={[B2]:t.ZERO,[I2]:t.ONE,[D2]:t.SRC_COLOR,[bh]:t.SRC_ALPHA,[j2]:t.SRC_ALPHA_SATURATE,[O2]:t.DST_COLOR,[F2]:t.DST_ALPHA,[L2]:t.ONE_MINUS_SRC_COLOR,[_h]:t.ONE_MINUS_SRC_ALPHA,[z2]:t.ONE_MINUS_DST_COLOR,[U2]:t.ONE_MINUS_DST_ALPHA,[W2]:t.CONSTANT_COLOR,[G2]:t.ONE_MINUS_CONSTANT_COLOR,[H2]:t.CONSTANT_ALPHA,[V2]:t.ONE_MINUS_CONSTANT_ALPHA};function Ve(G,Be,Pe,je,Ae,fe,Fe,nt,yt,mt){if(G===tr){x===!0&&(Me(t.BLEND),x=!1);return}if(x===!1&&(ae(t.BLEND),x=!0),G!==C2){if(G!==g||mt!==S){if((u!==as||w!==as)&&(t.blendEquation(t.FUNC_ADD),u=as,w=as),mt)switch(G){case ua:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case qm:t.blendFunc(t.ONE,t.ONE);break;case $m:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case Xm:t.blendFuncSeparate(t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ZERO,t.ONE);break;default:vt("WebGLState: Invalid blending: ",G);break}else switch(G){case ua:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case qm:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE,t.ONE,t.ONE);break;case $m:vt("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case Xm:vt("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:vt("WebGLState: Invalid blending: ",G);break}v=null,b=null,R=null,C=null,A.set(0,0,0),B=0,g=G,S=mt}return}Ae=Ae||Be,fe=fe||Pe,Fe=Fe||je,(Be!==u||Ae!==w)&&(t.blendEquationSeparate(Ge[Be],Ge[Ae]),u=Be,w=Ae),(Pe!==v||je!==b||fe!==R||Fe!==C)&&(t.blendFuncSeparate(Oe[Pe],Oe[je],Oe[fe],Oe[Fe]),v=Pe,b=je,R=fe,C=Fe),(nt.equals(A)===!1||yt!==B)&&(t.blendColor(nt.r,nt.g,nt.b,yt),A.copy(nt),B=yt),g=G,S=!1}function Ze(G,Be){G.side===Ni?Me(t.CULL_FACE):ae(t.CULL_FACE);let Pe=G.side===zn;Be&&(Pe=!Pe),Ue(Pe),G.blending===ua&&G.transparent===!1?Ve(tr):Ve(G.blending,G.blendEquation,G.blendSrc,G.blendDst,G.blendEquationAlpha,G.blendSrcAlpha,G.blendDstAlpha,G.blendColor,G.blendAlpha,G.premultipliedAlpha),a.setFunc(G.depthFunc),a.setTest(G.depthTest),a.setMask(G.depthWrite),s.setMask(G.colorWrite);const je=G.stencilWrite;l.setTest(je),je&&(l.setMask(G.stencilWriteMask),l.setFunc(G.stencilFunc,G.stencilRef,G.stencilFuncMask),l.setOp(G.stencilFail,G.stencilZFail,G.stencilZPass)),ht(G.polygonOffset,G.polygonOffsetFactor,G.polygonOffsetUnits),G.alphaToCoverage===!0?ae(t.SAMPLE_ALPHA_TO_COVERAGE):Me(t.SAMPLE_ALPHA_TO_COVERAGE)}function Ue(G){k!==G&&(G?t.frontFace(t.CW):t.frontFace(t.CCW),k=G)}function tt(G){G!==R2?(ae(t.CULL_FACE),G!==U&&(G===Qm?t.cullFace(t.BACK):G===E2?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):Me(t.CULL_FACE),U=G}function z(G){G!==O&&(q&&t.lineWidth(G),O=G)}function ht(G,Be,Pe){G?(ae(t.POLYGON_OFFSET_FILL),(X!==Be||K!==Pe)&&(t.polygonOffset(Be,Pe),X=Be,K=Pe)):Me(t.POLYGON_OFFSET_FILL)}function Xe(G){G?ae(t.SCISSOR_TEST):Me(t.SCISSOR_TEST)}function Je(G){G===void 0&&(G=t.TEXTURE0+$-1),ue!==G&&(t.activeTexture(G),ue=G)}function ee(G,Be,Pe){Pe===void 0&&(ue===null?Pe=t.TEXTURE0+$-1:Pe=ue);let je=F[Pe];je===void 0&&(je={type:void 0,texture:void 0},F[Pe]=je),(je.type!==G||je.texture!==Be)&&(ue!==Pe&&(t.activeTexture(Pe),ue=Pe),t.bindTexture(G,Be||Q[G]),je.type=G,je.texture=Be)}function P(){const G=F[ue];G!==void 0&&G.type!==void 0&&(t.bindTexture(G.type,null),G.type=void 0,G.texture=void 0)}function _(){try{t.compressedTexImage2D(...arguments)}catch(G){vt("WebGLState:",G)}}function W(){try{t.compressedTexImage3D(...arguments)}catch(G){vt("WebGLState:",G)}}function M(){try{t.texSubImage2D(...arguments)}catch(G){vt("WebGLState:",G)}}function _e(){try{t.texSubImage3D(...arguments)}catch(G){vt("WebGLState:",G)}}function ne(){try{t.compressedTexSubImage2D(...arguments)}catch(G){vt("WebGLState:",G)}}function Ie(){try{t.compressedTexSubImage3D(...arguments)}catch(G){vt("WebGLState:",G)}}function ie(){try{t.texStorage2D(...arguments)}catch(G){vt("WebGLState:",G)}}function Se(){try{t.texStorage3D(...arguments)}catch(G){vt("WebGLState:",G)}}function we(){try{t.texImage2D(...arguments)}catch(G){vt("WebGLState:",G)}}function ve(){try{t.texImage3D(...arguments)}catch(G){vt("WebGLState:",G)}}function Ee(G){xe.equals(G)===!1&&(t.scissor(G.x,G.y,G.z,G.w),xe.copy(G))}function he(G){le.equals(G)===!1&&(t.viewport(G.x,G.y,G.z,G.w),le.copy(G))}function Z(G,Be){let Pe=d.get(Be);Pe===void 0&&(Pe=new WeakMap,d.set(Be,Pe));let je=Pe.get(G);je===void 0&&(je=t.getUniformBlockIndex(Be,G.name),Pe.set(G,je))}function me(G,Be){const je=d.get(Be).get(G);c.get(Be)!==je&&(t.uniformBlockBinding(Be,je,G.__bindingPointIndex),c.set(Be,je))}function Ke(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),a.setReversed(!1),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),h={},ue=null,F={},f={},p=new WeakMap,m=[],y=null,x=!1,g=null,u=null,v=null,b=null,w=null,R=null,C=null,A=new dt(0,0,0),B=0,S=!1,k=null,U=null,O=null,X=null,K=null,xe.set(0,0,t.canvas.width,t.canvas.height),le.set(0,0,t.canvas.width,t.canvas.height),s.reset(),a.reset(),l.reset()}return{buffers:{color:s,depth:a,stencil:l},enable:ae,disable:Me,bindFramebuffer:ze,drawBuffers:se,useProgram:ke,setBlending:Ve,setMaterial:Ze,setFlipSided:Ue,setCullFace:tt,setLineWidth:z,setPolygonOffset:ht,setScissorTest:Xe,activeTexture:Je,bindTexture:ee,unbindTexture:P,compressedTexImage2D:_,compressedTexImage3D:W,texImage2D:we,texImage3D:ve,updateUBOMapping:Z,uniformBlockBinding:me,texStorage2D:ie,texStorage3D:Se,texSubImage2D:M,texSubImage3D:_e,compressedTexSubImage2D:ne,compressedTexSubImage3D:Ie,scissor:Ee,viewport:he,reset:Ke}}function AM(t,e,n,i,r,s,a){const l=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),d=new it,h=new WeakMap;let f;const p=new WeakMap;let m=!1;try{m=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(P,_){return m?new OffscreenCanvas(P,_):Ic("canvas")}function x(P,_,W){let M=1;const _e=ee(P);if((_e.width>W||_e.height>W)&&(M=W/Math.max(_e.width,_e.height)),M<1)if(typeof HTMLImageElement<"u"&&P instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&P instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&P instanceof ImageBitmap||typeof VideoFrame<"u"&&P instanceof VideoFrame){const ne=Math.floor(M*_e.width),Ie=Math.floor(M*_e.height);f===void 0&&(f=y(ne,Ie));const ie=_?y(ne,Ie):f;return ie.width=ne,ie.height=Ie,ie.getContext("2d").drawImage(P,0,0,ne,Ie),lt("WebGLRenderer: Texture has been resized from ("+_e.width+"x"+_e.height+") to ("+ne+"x"+Ie+")."),ie}else return"data"in P&&lt("WebGLRenderer: Image in DataTexture is too big ("+_e.width+"x"+_e.height+")."),P;return P}function g(P){return P.generateMipmaps}function u(P){t.generateMipmap(P)}function v(P){return P.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:P.isWebGL3DRenderTarget?t.TEXTURE_3D:P.isWebGLArrayRenderTarget||P.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:t.TEXTURE_2D}function b(P,_,W,M,_e=!1){if(P!==null){if(t[P]!==void 0)return t[P];lt("WebGLRenderer: Attempt to use non-existing WebGL internal format '"+P+"'")}let ne=_;if(_===t.RED&&(W===t.FLOAT&&(ne=t.R32F),W===t.HALF_FLOAT&&(ne=t.R16F),W===t.UNSIGNED_BYTE&&(ne=t.R8)),_===t.RED_INTEGER&&(W===t.UNSIGNED_BYTE&&(ne=t.R8UI),W===t.UNSIGNED_SHORT&&(ne=t.R16UI),W===t.UNSIGNED_INT&&(ne=t.R32UI),W===t.BYTE&&(ne=t.R8I),W===t.SHORT&&(ne=t.R16I),W===t.INT&&(ne=t.R32I)),_===t.RG&&(W===t.FLOAT&&(ne=t.RG32F),W===t.HALF_FLOAT&&(ne=t.RG16F),W===t.UNSIGNED_BYTE&&(ne=t.RG8)),_===t.RG_INTEGER&&(W===t.UNSIGNED_BYTE&&(ne=t.RG8UI),W===t.UNSIGNED_SHORT&&(ne=t.RG16UI),W===t.UNSIGNED_INT&&(ne=t.RG32UI),W===t.BYTE&&(ne=t.RG8I),W===t.SHORT&&(ne=t.RG16I),W===t.INT&&(ne=t.RG32I)),_===t.RGB_INTEGER&&(W===t.UNSIGNED_BYTE&&(ne=t.RGB8UI),W===t.UNSIGNED_SHORT&&(ne=t.RGB16UI),W===t.UNSIGNED_INT&&(ne=t.RGB32UI),W===t.BYTE&&(ne=t.RGB8I),W===t.SHORT&&(ne=t.RGB16I),W===t.INT&&(ne=t.RGB32I)),_===t.RGBA_INTEGER&&(W===t.UNSIGNED_BYTE&&(ne=t.RGBA8UI),W===t.UNSIGNED_SHORT&&(ne=t.RGBA16UI),W===t.UNSIGNED_INT&&(ne=t.RGBA32UI),W===t.BYTE&&(ne=t.RGBA8I),W===t.SHORT&&(ne=t.RGBA16I),W===t.INT&&(ne=t.RGBA32I)),_===t.RGB&&(W===t.UNSIGNED_INT_5_9_9_9_REV&&(ne=t.RGB9_E5),W===t.UNSIGNED_INT_10F_11F_11F_REV&&(ne=t.R11F_G11F_B10F)),_===t.RGBA){const Ie=_e?Nc:bt.getTransfer(M);W===t.FLOAT&&(ne=t.RGBA32F),W===t.HALF_FLOAT&&(ne=t.RGBA16F),W===t.UNSIGNED_BYTE&&(ne=Ie===Rt?t.SRGB8_ALPHA8:t.RGBA8),W===t.UNSIGNED_SHORT_4_4_4_4&&(ne=t.RGBA4),W===t.UNSIGNED_SHORT_5_5_5_1&&(ne=t.RGB5_A1)}return(ne===t.R16F||ne===t.R32F||ne===t.RG16F||ne===t.RG32F||ne===t.RGBA16F||ne===t.RGBA32F)&&e.get("EXT_color_buffer_float"),ne}function w(P,_){let W;return P?_===null||_===zi||_===Io?W=t.DEPTH24_STENCIL8:_===Bi?W=t.DEPTH32F_STENCIL8:_===Bo&&(W=t.DEPTH24_STENCIL8,lt("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):_===null||_===zi||_===Io?W=t.DEPTH_COMPONENT24:_===Bi?W=t.DEPTH_COMPONENT32F:_===Bo&&(W=t.DEPTH_COMPONENT16),W}function R(P,_){return g(P)===!0||P.isFramebufferTexture&&P.minFilter!==on&&P.minFilter!==gn?Math.log2(Math.max(_.width,_.height))+1:P.mipmaps!==void 0&&P.mipmaps.length>0?P.mipmaps.length:P.isCompressedTexture&&Array.isArray(P.image)?_.mipmaps.length:1}function C(P){const _=P.target;_.removeEventListener("dispose",C),B(_),_.isVideoTexture&&h.delete(_)}function A(P){const _=P.target;_.removeEventListener("dispose",A),k(_)}function B(P){const _=i.get(P);if(_.__webglInit===void 0)return;const W=P.source,M=p.get(W);if(M){const _e=M[_.__cacheKey];_e.usedTimes--,_e.usedTimes===0&&S(P),Object.keys(M).length===0&&p.delete(W)}i.remove(P)}function S(P){const _=i.get(P);t.deleteTexture(_.__webglTexture);const W=P.source,M=p.get(W);delete M[_.__cacheKey],a.memory.textures--}function k(P){const _=i.get(P);if(P.depthTexture&&(P.depthTexture.dispose(),i.remove(P.depthTexture)),P.isWebGLCubeRenderTarget)for(let M=0;M<6;M++){if(Array.isArray(_.__webglFramebuffer[M]))for(let _e=0;_e<_.__webglFramebuffer[M].length;_e++)t.deleteFramebuffer(_.__webglFramebuffer[M][_e]);else t.deleteFramebuffer(_.__webglFramebuffer[M]);_.__webglDepthbuffer&&t.deleteRenderbuffer(_.__webglDepthbuffer[M])}else{if(Array.isArray(_.__webglFramebuffer))for(let M=0;M<_.__webglFramebuffer.length;M++)t.deleteFramebuffer(_.__webglFramebuffer[M]);else t.deleteFramebuffer(_.__webglFramebuffer);if(_.__webglDepthbuffer&&t.deleteRenderbuffer(_.__webglDepthbuffer),_.__webglMultisampledFramebuffer&&t.deleteFramebuffer(_.__webglMultisampledFramebuffer),_.__webglColorRenderbuffer)for(let M=0;M<_.__webglColorRenderbuffer.length;M++)_.__webglColorRenderbuffer[M]&&t.deleteRenderbuffer(_.__webglColorRenderbuffer[M]);_.__webglDepthRenderbuffer&&t.deleteRenderbuffer(_.__webglDepthRenderbuffer)}const W=P.textures;for(let M=0,_e=W.length;M<_e;M++){const ne=i.get(W[M]);ne.__webglTexture&&(t.deleteTexture(ne.__webglTexture),a.memory.textures--),i.remove(W[M])}i.remove(P)}let U=0;function O(){U=0}function X(){const P=U;return P>=r.maxTextures&&lt("WebGLTextures: Trying to use "+P+" texture units while this GPU supports only "+r.maxTextures),U+=1,P}function K(P){const _=[];return _.push(P.wrapS),_.push(P.wrapT),_.push(P.wrapR||0),_.push(P.magFilter),_.push(P.minFilter),_.push(P.anisotropy),_.push(P.internalFormat),_.push(P.format),_.push(P.type),_.push(P.generateMipmaps),_.push(P.premultiplyAlpha),_.push(P.flipY),_.push(P.unpackAlignment),_.push(P.colorSpace),_.join()}function $(P,_){const W=i.get(P);if(P.isVideoTexture&&Xe(P),P.isRenderTargetTexture===!1&&P.isExternalTexture!==!0&&P.version>0&&W.__version!==P.version){const M=P.image;if(M===null)lt("WebGLRenderer: Texture marked for update but no image data found.");else if(M.complete===!1)lt("WebGLRenderer: Texture marked for update but image is incomplete");else{Q(W,P,_);return}}else P.isExternalTexture&&(W.__webglTexture=P.sourceTexture?P.sourceTexture:null);n.bindTexture(t.TEXTURE_2D,W.__webglTexture,t.TEXTURE0+_)}function q(P,_){const W=i.get(P);if(P.isRenderTargetTexture===!1&&P.version>0&&W.__version!==P.version){Q(W,P,_);return}else P.isExternalTexture&&(W.__webglTexture=P.sourceTexture?P.sourceTexture:null);n.bindTexture(t.TEXTURE_2D_ARRAY,W.__webglTexture,t.TEXTURE0+_)}function J(P,_){const W=i.get(P);if(P.isRenderTargetTexture===!1&&P.version>0&&W.__version!==P.version){Q(W,P,_);return}n.bindTexture(t.TEXTURE_3D,W.__webglTexture,t.TEXTURE0+_)}function V(P,_){const W=i.get(P);if(P.isCubeDepthTexture!==!0&&P.version>0&&W.__version!==P.version){ae(W,P,_);return}n.bindTexture(t.TEXTURE_CUBE_MAP,W.__webglTexture,t.TEXTURE0+_)}const ue={[Ph]:t.REPEAT,[Ji]:t.CLAMP_TO_EDGE,[Nh]:t.MIRRORED_REPEAT},F={[on]:t.NEAREST,[q2]:t.NEAREST_MIPMAP_NEAREST,[hl]:t.NEAREST_MIPMAP_LINEAR,[gn]:t.LINEAR,[Od]:t.LINEAR_MIPMAP_NEAREST,[us]:t.LINEAR_MIPMAP_LINEAR},de={[Y2]:t.NEVER,[n_]:t.ALWAYS,[Z2]:t.LESS,[vp]:t.LEQUAL,[J2]:t.EQUAL,[bp]:t.GEQUAL,[e_]:t.GREATER,[t_]:t.NOTEQUAL};function Te(P,_){if(_.type===Bi&&e.has("OES_texture_float_linear")===!1&&(_.magFilter===gn||_.magFilter===Od||_.magFilter===hl||_.magFilter===us||_.minFilter===gn||_.minFilter===Od||_.minFilter===hl||_.minFilter===us)&&lt("WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(P,t.TEXTURE_WRAP_S,ue[_.wrapS]),t.texParameteri(P,t.TEXTURE_WRAP_T,ue[_.wrapT]),(P===t.TEXTURE_3D||P===t.TEXTURE_2D_ARRAY)&&t.texParameteri(P,t.TEXTURE_WRAP_R,ue[_.wrapR]),t.texParameteri(P,t.TEXTURE_MAG_FILTER,F[_.magFilter]),t.texParameteri(P,t.TEXTURE_MIN_FILTER,F[_.minFilter]),_.compareFunction&&(t.texParameteri(P,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(P,t.TEXTURE_COMPARE_FUNC,de[_.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(_.magFilter===on||_.minFilter!==hl&&_.minFilter!==us||_.type===Bi&&e.has("OES_texture_float_linear")===!1)return;if(_.anisotropy>1||i.get(_).__currentAnisotropy){const W=e.get("EXT_texture_filter_anisotropic");t.texParameterf(P,W.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(_.anisotropy,r.getMaxAnisotropy())),i.get(_).__currentAnisotropy=_.anisotropy}}}function xe(P,_){let W=!1;P.__webglInit===void 0&&(P.__webglInit=!0,_.addEventListener("dispose",C));const M=_.source;let _e=p.get(M);_e===void 0&&(_e={},p.set(M,_e));const ne=K(_);if(ne!==P.__cacheKey){_e[ne]===void 0&&(_e[ne]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,W=!0),_e[ne].usedTimes++;const Ie=_e[P.__cacheKey];Ie!==void 0&&(_e[P.__cacheKey].usedTimes--,Ie.usedTimes===0&&S(_)),P.__cacheKey=ne,P.__webglTexture=_e[ne].texture}return W}function le(P,_,W){return Math.floor(Math.floor(P/W)/_)}function Re(P,_,W,M){const ne=P.updateRanges;if(ne.length===0)n.texSubImage2D(t.TEXTURE_2D,0,0,0,_.width,_.height,W,M,_.data);else{ne.sort((ve,Ee)=>ve.start-Ee.start);let Ie=0;for(let ve=1;ve<ne.length;ve++){const Ee=ne[Ie],he=ne[ve],Z=Ee.start+Ee.count,me=le(he.start,_.width,4),Ke=le(Ee.start,_.width,4);he.start<=Z+1&&me===Ke&&le(he.start+he.count-1,_.width,4)===me?Ee.count=Math.max(Ee.count,he.start+he.count-Ee.start):(++Ie,ne[Ie]=he)}ne.length=Ie+1;const ie=t.getParameter(t.UNPACK_ROW_LENGTH),Se=t.getParameter(t.UNPACK_SKIP_PIXELS),we=t.getParameter(t.UNPACK_SKIP_ROWS);t.pixelStorei(t.UNPACK_ROW_LENGTH,_.width);for(let ve=0,Ee=ne.length;ve<Ee;ve++){const he=ne[ve],Z=Math.floor(he.start/4),me=Math.ceil(he.count/4),Ke=Z%_.width,G=Math.floor(Z/_.width),Be=me,Pe=1;t.pixelStorei(t.UNPACK_SKIP_PIXELS,Ke),t.pixelStorei(t.UNPACK_SKIP_ROWS,G),n.texSubImage2D(t.TEXTURE_2D,0,Ke,G,Be,Pe,W,M,_.data)}P.clearUpdateRanges(),t.pixelStorei(t.UNPACK_ROW_LENGTH,ie),t.pixelStorei(t.UNPACK_SKIP_PIXELS,Se),t.pixelStorei(t.UNPACK_SKIP_ROWS,we)}}function Q(P,_,W){let M=t.TEXTURE_2D;(_.isDataArrayTexture||_.isCompressedArrayTexture)&&(M=t.TEXTURE_2D_ARRAY),_.isData3DTexture&&(M=t.TEXTURE_3D);const _e=xe(P,_),ne=_.source;n.bindTexture(M,P.__webglTexture,t.TEXTURE0+W);const Ie=i.get(ne);if(ne.version!==Ie.__version||_e===!0){n.activeTexture(t.TEXTURE0+W);const ie=bt.getPrimaries(bt.workingColorSpace),Se=_.colorSpace===Cr?null:bt.getPrimaries(_.colorSpace),we=_.colorSpace===Cr||ie===Se?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,_.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,_.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,_.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,we);let ve=x(_.image,!1,r.maxTextureSize);ve=Je(_,ve);const Ee=s.convert(_.format,_.colorSpace),he=s.convert(_.type);let Z=b(_.internalFormat,Ee,he,_.colorSpace,_.isVideoTexture);Te(M,_);let me;const Ke=_.mipmaps,G=_.isVideoTexture!==!0,Be=Ie.__version===void 0||_e===!0,Pe=ne.dataReady,je=R(_,ve);if(_.isDepthTexture)Z=w(_.format===hs,_.type),Be&&(G?n.texStorage2D(t.TEXTURE_2D,1,Z,ve.width,ve.height):n.texImage2D(t.TEXTURE_2D,0,Z,ve.width,ve.height,0,Ee,he,null));else if(_.isDataTexture)if(Ke.length>0){G&&Be&&n.texStorage2D(t.TEXTURE_2D,je,Z,Ke[0].width,Ke[0].height);for(let Ae=0,fe=Ke.length;Ae<fe;Ae++)me=Ke[Ae],G?Pe&&n.texSubImage2D(t.TEXTURE_2D,Ae,0,0,me.width,me.height,Ee,he,me.data):n.texImage2D(t.TEXTURE_2D,Ae,Z,me.width,me.height,0,Ee,he,me.data);_.generateMipmaps=!1}else G?(Be&&n.texStorage2D(t.TEXTURE_2D,je,Z,ve.width,ve.height),Pe&&Re(_,ve,Ee,he)):n.texImage2D(t.TEXTURE_2D,0,Z,ve.width,ve.height,0,Ee,he,ve.data);else if(_.isCompressedTexture)if(_.isCompressedArrayTexture){G&&Be&&n.texStorage3D(t.TEXTURE_2D_ARRAY,je,Z,Ke[0].width,Ke[0].height,ve.depth);for(let Ae=0,fe=Ke.length;Ae<fe;Ae++)if(me=Ke[Ae],_.format!==vi)if(Ee!==null)if(G){if(Pe)if(_.layerUpdates.size>0){const Fe=wg(me.width,me.height,_.format,_.type);for(const nt of _.layerUpdates){const yt=me.data.subarray(nt*Fe/me.data.BYTES_PER_ELEMENT,(nt+1)*Fe/me.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,Ae,0,0,nt,me.width,me.height,1,Ee,yt)}_.clearLayerUpdates()}else n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,Ae,0,0,0,me.width,me.height,ve.depth,Ee,me.data)}else n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,Ae,Z,me.width,me.height,ve.depth,0,me.data,0,0);else lt("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else G?Pe&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,Ae,0,0,0,me.width,me.height,ve.depth,Ee,he,me.data):n.texImage3D(t.TEXTURE_2D_ARRAY,Ae,Z,me.width,me.height,ve.depth,0,Ee,he,me.data)}else{G&&Be&&n.texStorage2D(t.TEXTURE_2D,je,Z,Ke[0].width,Ke[0].height);for(let Ae=0,fe=Ke.length;Ae<fe;Ae++)me=Ke[Ae],_.format!==vi?Ee!==null?G?Pe&&n.compressedTexSubImage2D(t.TEXTURE_2D,Ae,0,0,me.width,me.height,Ee,me.data):n.compressedTexImage2D(t.TEXTURE_2D,Ae,Z,me.width,me.height,0,me.data):lt("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):G?Pe&&n.texSubImage2D(t.TEXTURE_2D,Ae,0,0,me.width,me.height,Ee,he,me.data):n.texImage2D(t.TEXTURE_2D,Ae,Z,me.width,me.height,0,Ee,he,me.data)}else if(_.isDataArrayTexture)if(G){if(Be&&n.texStorage3D(t.TEXTURE_2D_ARRAY,je,Z,ve.width,ve.height,ve.depth),Pe)if(_.layerUpdates.size>0){const Ae=wg(ve.width,ve.height,_.format,_.type);for(const fe of _.layerUpdates){const Fe=ve.data.subarray(fe*Ae/ve.data.BYTES_PER_ELEMENT,(fe+1)*Ae/ve.data.BYTES_PER_ELEMENT);n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,fe,ve.width,ve.height,1,Ee,he,Fe)}_.clearLayerUpdates()}else n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,ve.width,ve.height,ve.depth,Ee,he,ve.data)}else n.texImage3D(t.TEXTURE_2D_ARRAY,0,Z,ve.width,ve.height,ve.depth,0,Ee,he,ve.data);else if(_.isData3DTexture)G?(Be&&n.texStorage3D(t.TEXTURE_3D,je,Z,ve.width,ve.height,ve.depth),Pe&&n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,ve.width,ve.height,ve.depth,Ee,he,ve.data)):n.texImage3D(t.TEXTURE_3D,0,Z,ve.width,ve.height,ve.depth,0,Ee,he,ve.data);else if(_.isFramebufferTexture){if(Be)if(G)n.texStorage2D(t.TEXTURE_2D,je,Z,ve.width,ve.height);else{let Ae=ve.width,fe=ve.height;for(let Fe=0;Fe<je;Fe++)n.texImage2D(t.TEXTURE_2D,Fe,Z,Ae,fe,0,Ee,he,null),Ae>>=1,fe>>=1}}else if(Ke.length>0){if(G&&Be){const Ae=ee(Ke[0]);n.texStorage2D(t.TEXTURE_2D,je,Z,Ae.width,Ae.height)}for(let Ae=0,fe=Ke.length;Ae<fe;Ae++)me=Ke[Ae],G?Pe&&n.texSubImage2D(t.TEXTURE_2D,Ae,0,0,Ee,he,me):n.texImage2D(t.TEXTURE_2D,Ae,Z,Ee,he,me);_.generateMipmaps=!1}else if(G){if(Be){const Ae=ee(ve);n.texStorage2D(t.TEXTURE_2D,je,Z,Ae.width,Ae.height)}Pe&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,Ee,he,ve)}else n.texImage2D(t.TEXTURE_2D,0,Z,Ee,he,ve);g(_)&&u(M),Ie.__version=ne.version,_.onUpdate&&_.onUpdate(_)}P.__version=_.version}function ae(P,_,W){if(_.image.length!==6)return;const M=xe(P,_),_e=_.source;n.bindTexture(t.TEXTURE_CUBE_MAP,P.__webglTexture,t.TEXTURE0+W);const ne=i.get(_e);if(_e.version!==ne.__version||M===!0){n.activeTexture(t.TEXTURE0+W);const Ie=bt.getPrimaries(bt.workingColorSpace),ie=_.colorSpace===Cr?null:bt.getPrimaries(_.colorSpace),Se=_.colorSpace===Cr||Ie===ie?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,_.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,_.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,_.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,Se);const we=_.isCompressedTexture||_.image[0].isCompressedTexture,ve=_.image[0]&&_.image[0].isDataTexture,Ee=[];for(let fe=0;fe<6;fe++)!we&&!ve?Ee[fe]=x(_.image[fe],!0,r.maxCubemapSize):Ee[fe]=ve?_.image[fe].image:_.image[fe],Ee[fe]=Je(_,Ee[fe]);const he=Ee[0],Z=s.convert(_.format,_.colorSpace),me=s.convert(_.type),Ke=b(_.internalFormat,Z,me,_.colorSpace),G=_.isVideoTexture!==!0,Be=ne.__version===void 0||M===!0,Pe=_e.dataReady;let je=R(_,he);Te(t.TEXTURE_CUBE_MAP,_);let Ae;if(we){G&&Be&&n.texStorage2D(t.TEXTURE_CUBE_MAP,je,Ke,he.width,he.height);for(let fe=0;fe<6;fe++){Ae=Ee[fe].mipmaps;for(let Fe=0;Fe<Ae.length;Fe++){const nt=Ae[Fe];_.format!==vi?Z!==null?G?Pe&&n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+fe,Fe,0,0,nt.width,nt.height,Z,nt.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+fe,Fe,Ke,nt.width,nt.height,0,nt.data):lt("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):G?Pe&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+fe,Fe,0,0,nt.width,nt.height,Z,me,nt.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+fe,Fe,Ke,nt.width,nt.height,0,Z,me,nt.data)}}}else{if(Ae=_.mipmaps,G&&Be){Ae.length>0&&je++;const fe=ee(Ee[0]);n.texStorage2D(t.TEXTURE_CUBE_MAP,je,Ke,fe.width,fe.height)}for(let fe=0;fe<6;fe++)if(ve){G?Pe&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+fe,0,0,0,Ee[fe].width,Ee[fe].height,Z,me,Ee[fe].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+fe,0,Ke,Ee[fe].width,Ee[fe].height,0,Z,me,Ee[fe].data);for(let Fe=0;Fe<Ae.length;Fe++){const yt=Ae[Fe].image[fe].image;G?Pe&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+fe,Fe+1,0,0,yt.width,yt.height,Z,me,yt.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+fe,Fe+1,Ke,yt.width,yt.height,0,Z,me,yt.data)}}else{G?Pe&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+fe,0,0,0,Z,me,Ee[fe]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+fe,0,Ke,Z,me,Ee[fe]);for(let Fe=0;Fe<Ae.length;Fe++){const nt=Ae[Fe];G?Pe&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+fe,Fe+1,0,0,Z,me,nt.image[fe]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+fe,Fe+1,Ke,Z,me,nt.image[fe])}}}g(_)&&u(t.TEXTURE_CUBE_MAP),ne.__version=_e.version,_.onUpdate&&_.onUpdate(_)}P.__version=_.version}function Me(P,_,W,M,_e,ne){const Ie=s.convert(W.format,W.colorSpace),ie=s.convert(W.type),Se=b(W.internalFormat,Ie,ie,W.colorSpace),we=i.get(_),ve=i.get(W);if(ve.__renderTarget=_,!we.__hasExternalTextures){const Ee=Math.max(1,_.width>>ne),he=Math.max(1,_.height>>ne);_e===t.TEXTURE_3D||_e===t.TEXTURE_2D_ARRAY?n.texImage3D(_e,ne,Se,Ee,he,_.depth,0,Ie,ie,null):n.texImage2D(_e,ne,Se,Ee,he,0,Ie,ie,null)}n.bindFramebuffer(t.FRAMEBUFFER,P),ht(_)?l.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,M,_e,ve.__webglTexture,0,z(_)):(_e===t.TEXTURE_2D||_e>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&_e<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,M,_e,ve.__webglTexture,ne),n.bindFramebuffer(t.FRAMEBUFFER,null)}function ze(P,_,W){if(t.bindRenderbuffer(t.RENDERBUFFER,P),_.depthBuffer){const M=_.depthTexture,_e=M&&M.isDepthTexture?M.type:null,ne=w(_.stencilBuffer,_e),Ie=_.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;ht(_)?l.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,z(_),ne,_.width,_.height):W?t.renderbufferStorageMultisample(t.RENDERBUFFER,z(_),ne,_.width,_.height):t.renderbufferStorage(t.RENDERBUFFER,ne,_.width,_.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,Ie,t.RENDERBUFFER,P)}else{const M=_.textures;for(let _e=0;_e<M.length;_e++){const ne=M[_e],Ie=s.convert(ne.format,ne.colorSpace),ie=s.convert(ne.type),Se=b(ne.internalFormat,Ie,ie,ne.colorSpace);ht(_)?l.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,z(_),Se,_.width,_.height):W?t.renderbufferStorageMultisample(t.RENDERBUFFER,z(_),Se,_.width,_.height):t.renderbufferStorage(t.RENDERBUFFER,Se,_.width,_.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function se(P,_,W){const M=_.isWebGLCubeRenderTarget===!0;if(n.bindFramebuffer(t.FRAMEBUFFER,P),!(_.depthTexture&&_.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const _e=i.get(_.depthTexture);if(_e.__renderTarget=_,(!_e.__webglTexture||_.depthTexture.image.width!==_.width||_.depthTexture.image.height!==_.height)&&(_.depthTexture.image.width=_.width,_.depthTexture.image.height=_.height,_.depthTexture.needsUpdate=!0),M){if(_e.__webglInit===void 0&&(_e.__webglInit=!0,_.depthTexture.addEventListener("dispose",C)),_e.__webglTexture===void 0){_e.__webglTexture=t.createTexture(),n.bindTexture(t.TEXTURE_CUBE_MAP,_e.__webglTexture),Te(t.TEXTURE_CUBE_MAP,_.depthTexture);const we=s.convert(_.depthTexture.format),ve=s.convert(_.depthTexture.type);let Ee;_.depthTexture.format===lr?Ee=t.DEPTH_COMPONENT24:_.depthTexture.format===hs&&(Ee=t.DEPTH24_STENCIL8);for(let he=0;he<6;he++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,Ee,_.width,_.height,0,we,ve,null)}}else $(_.depthTexture,0);const ne=_e.__webglTexture,Ie=z(_),ie=M?t.TEXTURE_CUBE_MAP_POSITIVE_X+W:t.TEXTURE_2D,Se=_.depthTexture.format===hs?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(_.depthTexture.format===lr)ht(_)?l.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,Se,ie,ne,0,Ie):t.framebufferTexture2D(t.FRAMEBUFFER,Se,ie,ne,0);else if(_.depthTexture.format===hs)ht(_)?l.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,Se,ie,ne,0,Ie):t.framebufferTexture2D(t.FRAMEBUFFER,Se,ie,ne,0);else throw new Error("Unknown depthTexture format")}function ke(P){const _=i.get(P),W=P.isWebGLCubeRenderTarget===!0;if(_.__boundDepthTexture!==P.depthTexture){const M=P.depthTexture;if(_.__depthDisposeCallback&&_.__depthDisposeCallback(),M){const _e=()=>{delete _.__boundDepthTexture,delete _.__depthDisposeCallback,M.removeEventListener("dispose",_e)};M.addEventListener("dispose",_e),_.__depthDisposeCallback=_e}_.__boundDepthTexture=M}if(P.depthTexture&&!_.__autoAllocateDepthBuffer)if(W)for(let M=0;M<6;M++)se(_.__webglFramebuffer[M],P,M);else{const M=P.texture.mipmaps;M&&M.length>0?se(_.__webglFramebuffer[0],P,0):se(_.__webglFramebuffer,P,0)}else if(W){_.__webglDepthbuffer=[];for(let M=0;M<6;M++)if(n.bindFramebuffer(t.FRAMEBUFFER,_.__webglFramebuffer[M]),_.__webglDepthbuffer[M]===void 0)_.__webglDepthbuffer[M]=t.createRenderbuffer(),ze(_.__webglDepthbuffer[M],P,!1);else{const _e=P.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,ne=_.__webglDepthbuffer[M];t.bindRenderbuffer(t.RENDERBUFFER,ne),t.framebufferRenderbuffer(t.FRAMEBUFFER,_e,t.RENDERBUFFER,ne)}}else{const M=P.texture.mipmaps;if(M&&M.length>0?n.bindFramebuffer(t.FRAMEBUFFER,_.__webglFramebuffer[0]):n.bindFramebuffer(t.FRAMEBUFFER,_.__webglFramebuffer),_.__webglDepthbuffer===void 0)_.__webglDepthbuffer=t.createRenderbuffer(),ze(_.__webglDepthbuffer,P,!1);else{const _e=P.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,ne=_.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,ne),t.framebufferRenderbuffer(t.FRAMEBUFFER,_e,t.RENDERBUFFER,ne)}}n.bindFramebuffer(t.FRAMEBUFFER,null)}function Ge(P,_,W){const M=i.get(P);_!==void 0&&Me(M.__webglFramebuffer,P,P.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),W!==void 0&&ke(P)}function Oe(P){const _=P.texture,W=i.get(P),M=i.get(_);P.addEventListener("dispose",A);const _e=P.textures,ne=P.isWebGLCubeRenderTarget===!0,Ie=_e.length>1;if(Ie||(M.__webglTexture===void 0&&(M.__webglTexture=t.createTexture()),M.__version=_.version,a.memory.textures++),ne){W.__webglFramebuffer=[];for(let ie=0;ie<6;ie++)if(_.mipmaps&&_.mipmaps.length>0){W.__webglFramebuffer[ie]=[];for(let Se=0;Se<_.mipmaps.length;Se++)W.__webglFramebuffer[ie][Se]=t.createFramebuffer()}else W.__webglFramebuffer[ie]=t.createFramebuffer()}else{if(_.mipmaps&&_.mipmaps.length>0){W.__webglFramebuffer=[];for(let ie=0;ie<_.mipmaps.length;ie++)W.__webglFramebuffer[ie]=t.createFramebuffer()}else W.__webglFramebuffer=t.createFramebuffer();if(Ie)for(let ie=0,Se=_e.length;ie<Se;ie++){const we=i.get(_e[ie]);we.__webglTexture===void 0&&(we.__webglTexture=t.createTexture(),a.memory.textures++)}if(P.samples>0&&ht(P)===!1){W.__webglMultisampledFramebuffer=t.createFramebuffer(),W.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,W.__webglMultisampledFramebuffer);for(let ie=0;ie<_e.length;ie++){const Se=_e[ie];W.__webglColorRenderbuffer[ie]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,W.__webglColorRenderbuffer[ie]);const we=s.convert(Se.format,Se.colorSpace),ve=s.convert(Se.type),Ee=b(Se.internalFormat,we,ve,Se.colorSpace,P.isXRRenderTarget===!0),he=z(P);t.renderbufferStorageMultisample(t.RENDERBUFFER,he,Ee,P.width,P.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+ie,t.RENDERBUFFER,W.__webglColorRenderbuffer[ie])}t.bindRenderbuffer(t.RENDERBUFFER,null),P.depthBuffer&&(W.__webglDepthRenderbuffer=t.createRenderbuffer(),ze(W.__webglDepthRenderbuffer,P,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(ne){n.bindTexture(t.TEXTURE_CUBE_MAP,M.__webglTexture),Te(t.TEXTURE_CUBE_MAP,_);for(let ie=0;ie<6;ie++)if(_.mipmaps&&_.mipmaps.length>0)for(let Se=0;Se<_.mipmaps.length;Se++)Me(W.__webglFramebuffer[ie][Se],P,_,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+ie,Se);else Me(W.__webglFramebuffer[ie],P,_,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+ie,0);g(_)&&u(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(Ie){for(let ie=0,Se=_e.length;ie<Se;ie++){const we=_e[ie],ve=i.get(we);let Ee=t.TEXTURE_2D;(P.isWebGL3DRenderTarget||P.isWebGLArrayRenderTarget)&&(Ee=P.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(Ee,ve.__webglTexture),Te(Ee,we),Me(W.__webglFramebuffer,P,we,t.COLOR_ATTACHMENT0+ie,Ee,0),g(we)&&u(Ee)}n.unbindTexture()}else{let ie=t.TEXTURE_2D;if((P.isWebGL3DRenderTarget||P.isWebGLArrayRenderTarget)&&(ie=P.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(ie,M.__webglTexture),Te(ie,_),_.mipmaps&&_.mipmaps.length>0)for(let Se=0;Se<_.mipmaps.length;Se++)Me(W.__webglFramebuffer[Se],P,_,t.COLOR_ATTACHMENT0,ie,Se);else Me(W.__webglFramebuffer,P,_,t.COLOR_ATTACHMENT0,ie,0);g(_)&&u(ie),n.unbindTexture()}P.depthBuffer&&ke(P)}function Ve(P){const _=P.textures;for(let W=0,M=_.length;W<M;W++){const _e=_[W];if(g(_e)){const ne=v(P),Ie=i.get(_e).__webglTexture;n.bindTexture(ne,Ie),u(ne),n.unbindTexture()}}}const Ze=[],Ue=[];function tt(P){if(P.samples>0){if(ht(P)===!1){const _=P.textures,W=P.width,M=P.height;let _e=t.COLOR_BUFFER_BIT;const ne=P.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,Ie=i.get(P),ie=_.length>1;if(ie)for(let we=0;we<_.length;we++)n.bindFramebuffer(t.FRAMEBUFFER,Ie.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+we,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,Ie.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+we,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,Ie.__webglMultisampledFramebuffer);const Se=P.texture.mipmaps;Se&&Se.length>0?n.bindFramebuffer(t.DRAW_FRAMEBUFFER,Ie.__webglFramebuffer[0]):n.bindFramebuffer(t.DRAW_FRAMEBUFFER,Ie.__webglFramebuffer);for(let we=0;we<_.length;we++){if(P.resolveDepthBuffer&&(P.depthBuffer&&(_e|=t.DEPTH_BUFFER_BIT),P.stencilBuffer&&P.resolveStencilBuffer&&(_e|=t.STENCIL_BUFFER_BIT)),ie){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,Ie.__webglColorRenderbuffer[we]);const ve=i.get(_[we]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,ve,0)}t.blitFramebuffer(0,0,W,M,0,0,W,M,_e,t.NEAREST),c===!0&&(Ze.length=0,Ue.length=0,Ze.push(t.COLOR_ATTACHMENT0+we),P.depthBuffer&&P.resolveDepthBuffer===!1&&(Ze.push(ne),Ue.push(ne),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,Ue)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,Ze))}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),ie)for(let we=0;we<_.length;we++){n.bindFramebuffer(t.FRAMEBUFFER,Ie.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+we,t.RENDERBUFFER,Ie.__webglColorRenderbuffer[we]);const ve=i.get(_[we]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,Ie.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+we,t.TEXTURE_2D,ve,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,Ie.__webglMultisampledFramebuffer)}else if(P.depthBuffer&&P.resolveDepthBuffer===!1&&c){const _=P.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[_])}}}function z(P){return Math.min(r.maxSamples,P.samples)}function ht(P){const _=i.get(P);return P.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&_.__useRenderToTexture!==!1}function Xe(P){const _=a.render.frame;h.get(P)!==_&&(h.set(P,_),P.update())}function Je(P,_){const W=P.colorSpace,M=P.format,_e=P.type;return P.isCompressedTexture===!0||P.isVideoTexture===!0||W!==Ma&&W!==Cr&&(bt.getTransfer(W)===Rt?(M!==vi||_e!==Qn)&&lt("WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):vt("WebGLTextures: Unsupported texture color space:",W)),_}function ee(P){return typeof HTMLImageElement<"u"&&P instanceof HTMLImageElement?(d.width=P.naturalWidth||P.width,d.height=P.naturalHeight||P.height):typeof VideoFrame<"u"&&P instanceof VideoFrame?(d.width=P.displayWidth,d.height=P.displayHeight):(d.width=P.width,d.height=P.height),d}this.allocateTextureUnit=X,this.resetTextureUnits=O,this.setTexture2D=$,this.setTexture2DArray=q,this.setTexture3D=J,this.setTextureCube=V,this.rebindTextures=Ge,this.setupRenderTarget=Oe,this.updateRenderTargetMipmap=Ve,this.updateMultisampleRenderTarget=tt,this.setupDepthRenderbuffer=ke,this.setupFrameBufferTexture=Me,this.useMultisampledRTT=ht,this.isReversedDepthBuffer=function(){return n.buffers.depth.getReversed()}}function PM(t,e){function n(i,r=Cr){let s;const a=bt.getTransfer(r);if(i===Qn)return t.UNSIGNED_BYTE;if(i===pp)return t.UNSIGNED_SHORT_4_4_4_4;if(i===mp)return t.UNSIGNED_SHORT_5_5_5_1;if(i===zy)return t.UNSIGNED_INT_5_9_9_9_REV;if(i===jy)return t.UNSIGNED_INT_10F_11F_11F_REV;if(i===Uy)return t.BYTE;if(i===Oy)return t.SHORT;if(i===Bo)return t.UNSIGNED_SHORT;if(i===fp)return t.INT;if(i===zi)return t.UNSIGNED_INT;if(i===Bi)return t.FLOAT;if(i===or)return t.HALF_FLOAT;if(i===Wy)return t.ALPHA;if(i===Gy)return t.RGB;if(i===vi)return t.RGBA;if(i===lr)return t.DEPTH_COMPONENT;if(i===hs)return t.DEPTH_STENCIL;if(i===Hy)return t.RED;if(i===gp)return t.RED_INTEGER;if(i===ka)return t.RG;if(i===xp)return t.RG_INTEGER;if(i===yp)return t.RGBA_INTEGER;if(i===ec||i===tc||i===nc||i===ic)if(a===Rt)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(i===ec)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===tc)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===nc)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===ic)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(i===ec)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===tc)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===nc)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===ic)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===Bh||i===Ih||i===Dh||i===Lh)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(i===Bh)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===Ih)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===Dh)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===Lh)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===Fh||i===Uh||i===Oh||i===zh||i===jh||i===Wh||i===Gh)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(i===Fh||i===Uh)return a===Rt?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(i===Oh)return a===Rt?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC;if(i===zh)return s.COMPRESSED_R11_EAC;if(i===jh)return s.COMPRESSED_SIGNED_R11_EAC;if(i===Wh)return s.COMPRESSED_RG11_EAC;if(i===Gh)return s.COMPRESSED_SIGNED_RG11_EAC}else return null;if(i===Hh||i===Vh||i===Kh||i===Qh||i===qh||i===$h||i===Xh||i===Yh||i===Zh||i===Jh||i===ef||i===tf||i===nf||i===rf)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(i===Hh)return a===Rt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===Vh)return a===Rt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===Kh)return a===Rt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===Qh)return a===Rt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===qh)return a===Rt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===$h)return a===Rt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===Xh)return a===Rt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===Yh)return a===Rt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===Zh)return a===Rt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===Jh)return a===Rt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===ef)return a===Rt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===tf)return a===Rt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===nf)return a===Rt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===rf)return a===Rt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===sf||i===af||i===of)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(i===sf)return a===Rt?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===af)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===of)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===lf||i===cf||i===df||i===uf)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(i===lf)return s.COMPRESSED_RED_RGTC1_EXT;if(i===cf)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===df)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===uf)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===Io?t.UNSIGNED_INT_24_8:t[i]!==void 0?t[i]:null}return{convert:n}}const NM=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,BM=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class IM{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,n){if(this.texture===null){const i=new t1(e.texture);(e.depthNear!==n.depthNear||e.depthFar!==n.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=i}}getMesh(e){if(this.texture!==null&&this.mesh===null){const n=e.cameras[0].viewport,i=new Wi({vertexShader:NM,fragmentShader:BM,uniforms:{depthColor:{value:this.texture},depthWidth:{value:n.z},depthHeight:{value:n.w}}});this.mesh=new Dn(new Vo(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class DM extends Ms{constructor(e,n){super();const i=this;let r=null,s=1,a=null,l="local-floor",c=1,d=null,h=null,f=null,p=null,m=null,y=null;const x=typeof XRWebGLBinding<"u",g=new IM,u={},v=n.getContextAttributes();let b=null,w=null;const R=[],C=[],A=new it;let B=null;const S=new si;S.viewport=new Gt;const k=new si;k.viewport=new Gt;const U=[S,k],O=new G_;let X=null,K=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Q){let ae=R[Q];return ae===void 0&&(ae=new ou,R[Q]=ae),ae.getTargetRaySpace()},this.getControllerGrip=function(Q){let ae=R[Q];return ae===void 0&&(ae=new ou,R[Q]=ae),ae.getGripSpace()},this.getHand=function(Q){let ae=R[Q];return ae===void 0&&(ae=new ou,R[Q]=ae),ae.getHandSpace()};function $(Q){const ae=C.indexOf(Q.inputSource);if(ae===-1)return;const Me=R[ae];Me!==void 0&&(Me.update(Q.inputSource,Q.frame,d||a),Me.dispatchEvent({type:Q.type,data:Q.inputSource}))}function q(){r.removeEventListener("select",$),r.removeEventListener("selectstart",$),r.removeEventListener("selectend",$),r.removeEventListener("squeeze",$),r.removeEventListener("squeezestart",$),r.removeEventListener("squeezeend",$),r.removeEventListener("end",q),r.removeEventListener("inputsourceschange",J);for(let Q=0;Q<R.length;Q++){const ae=C[Q];ae!==null&&(C[Q]=null,R[Q].disconnect(ae))}X=null,K=null,g.reset();for(const Q in u)delete u[Q];e.setRenderTarget(b),m=null,p=null,f=null,r=null,w=null,Re.stop(),i.isPresenting=!1,e.setPixelRatio(B),e.setSize(A.width,A.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Q){s=Q,i.isPresenting===!0&&lt("WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Q){l=Q,i.isPresenting===!0&&lt("WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return d||a},this.setReferenceSpace=function(Q){d=Q},this.getBaseLayer=function(){return p!==null?p:m},this.getBinding=function(){return f===null&&x&&(f=new XRWebGLBinding(r,n)),f},this.getFrame=function(){return y},this.getSession=function(){return r},this.setSession=async function(Q){if(r=Q,r!==null){if(b=e.getRenderTarget(),r.addEventListener("select",$),r.addEventListener("selectstart",$),r.addEventListener("selectend",$),r.addEventListener("squeeze",$),r.addEventListener("squeezestart",$),r.addEventListener("squeezeend",$),r.addEventListener("end",q),r.addEventListener("inputsourceschange",J),v.xrCompatible!==!0&&await n.makeXRCompatible(),B=e.getPixelRatio(),e.getSize(A),x&&"createProjectionLayer"in XRWebGLBinding.prototype){let Me=null,ze=null,se=null;v.depth&&(se=v.stencil?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT24,Me=v.stencil?hs:lr,ze=v.stencil?Io:zi);const ke={colorFormat:n.RGBA8,depthFormat:se,scaleFactor:s};f=this.getBinding(),p=f.createProjectionLayer(ke),r.updateRenderState({layers:[p]}),e.setPixelRatio(1),e.setSize(p.textureWidth,p.textureHeight,!1),w=new Ui(p.textureWidth,p.textureHeight,{format:vi,type:Qn,depthTexture:new Lo(p.textureWidth,p.textureHeight,ze,void 0,void 0,void 0,void 0,void 0,void 0,Me),stencilBuffer:v.stencil,colorSpace:e.outputColorSpace,samples:v.antialias?4:0,resolveDepthBuffer:p.ignoreDepthValues===!1,resolveStencilBuffer:p.ignoreDepthValues===!1})}else{const Me={antialias:v.antialias,alpha:!0,depth:v.depth,stencil:v.stencil,framebufferScaleFactor:s};m=new XRWebGLLayer(r,n,Me),r.updateRenderState({baseLayer:m}),e.setPixelRatio(1),e.setSize(m.framebufferWidth,m.framebufferHeight,!1),w=new Ui(m.framebufferWidth,m.framebufferHeight,{format:vi,type:Qn,colorSpace:e.outputColorSpace,stencilBuffer:v.stencil,resolveDepthBuffer:m.ignoreDepthValues===!1,resolveStencilBuffer:m.ignoreDepthValues===!1})}w.isXRRenderTarget=!0,this.setFoveation(c),d=null,a=await r.requestReferenceSpace(l),Re.setContext(r),Re.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode},this.getDepthTexture=function(){return g.getDepthTexture()};function J(Q){for(let ae=0;ae<Q.removed.length;ae++){const Me=Q.removed[ae],ze=C.indexOf(Me);ze>=0&&(C[ze]=null,R[ze].disconnect(Me))}for(let ae=0;ae<Q.added.length;ae++){const Me=Q.added[ae];let ze=C.indexOf(Me);if(ze===-1){for(let ke=0;ke<R.length;ke++)if(ke>=C.length){C.push(Me),ze=ke;break}else if(C[ke]===null){C[ke]=Me,ze=ke;break}if(ze===-1)break}const se=R[ze];se&&se.connect(Me)}}const V=new re,ue=new re;function F(Q,ae,Me){V.setFromMatrixPosition(ae.matrixWorld),ue.setFromMatrixPosition(Me.matrixWorld);const ze=V.distanceTo(ue),se=ae.projectionMatrix.elements,ke=Me.projectionMatrix.elements,Ge=se[14]/(se[10]-1),Oe=se[14]/(se[10]+1),Ve=(se[9]+1)/se[5],Ze=(se[9]-1)/se[5],Ue=(se[8]-1)/se[0],tt=(ke[8]+1)/ke[0],z=Ge*Ue,ht=Ge*tt,Xe=ze/(-Ue+tt),Je=Xe*-Ue;if(ae.matrixWorld.decompose(Q.position,Q.quaternion,Q.scale),Q.translateX(Je),Q.translateZ(Xe),Q.matrixWorld.compose(Q.position,Q.quaternion,Q.scale),Q.matrixWorldInverse.copy(Q.matrixWorld).invert(),se[10]===-1)Q.projectionMatrix.copy(ae.projectionMatrix),Q.projectionMatrixInverse.copy(ae.projectionMatrixInverse);else{const ee=Ge+Xe,P=Oe+Xe,_=z-Je,W=ht+(ze-Je),M=Ve*Oe/P*ee,_e=Ze*Oe/P*ee;Q.projectionMatrix.makePerspective(_,W,M,_e,ee,P),Q.projectionMatrixInverse.copy(Q.projectionMatrix).invert()}}function de(Q,ae){ae===null?Q.matrixWorld.copy(Q.matrix):Q.matrixWorld.multiplyMatrices(ae.matrixWorld,Q.matrix),Q.matrixWorldInverse.copy(Q.matrixWorld).invert()}this.updateCamera=function(Q){if(r===null)return;let ae=Q.near,Me=Q.far;g.texture!==null&&(g.depthNear>0&&(ae=g.depthNear),g.depthFar>0&&(Me=g.depthFar)),O.near=k.near=S.near=ae,O.far=k.far=S.far=Me,(X!==O.near||K!==O.far)&&(r.updateRenderState({depthNear:O.near,depthFar:O.far}),X=O.near,K=O.far),O.layers.mask=Q.layers.mask|6,S.layers.mask=O.layers.mask&3,k.layers.mask=O.layers.mask&5;const ze=Q.parent,se=O.cameras;de(O,ze);for(let ke=0;ke<se.length;ke++)de(se[ke],ze);se.length===2?F(O,S,k):O.projectionMatrix.copy(S.projectionMatrix),Te(Q,O,ze)};function Te(Q,ae,Me){Me===null?Q.matrix.copy(ae.matrixWorld):(Q.matrix.copy(Me.matrixWorld),Q.matrix.invert(),Q.matrix.multiply(ae.matrixWorld)),Q.matrix.decompose(Q.position,Q.quaternion,Q.scale),Q.updateMatrixWorld(!0),Q.projectionMatrix.copy(ae.projectionMatrix),Q.projectionMatrixInverse.copy(ae.projectionMatrixInverse),Q.isPerspectiveCamera&&(Q.fov=hf*2*Math.atan(1/Q.projectionMatrix.elements[5]),Q.zoom=1)}this.getCamera=function(){return O},this.getFoveation=function(){if(!(p===null&&m===null))return c},this.setFoveation=function(Q){c=Q,p!==null&&(p.fixedFoveation=Q),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=Q)},this.hasDepthSensing=function(){return g.texture!==null},this.getDepthSensingMesh=function(){return g.getMesh(O)},this.getCameraTexture=function(Q){return u[Q]};let xe=null;function le(Q,ae){if(h=ae.getViewerPose(d||a),y=ae,h!==null){const Me=h.views;m!==null&&(e.setRenderTargetFramebuffer(w,m.framebuffer),e.setRenderTarget(w));let ze=!1;Me.length!==O.cameras.length&&(O.cameras.length=0,ze=!0);for(let Oe=0;Oe<Me.length;Oe++){const Ve=Me[Oe];let Ze=null;if(m!==null)Ze=m.getViewport(Ve);else{const tt=f.getViewSubImage(p,Ve);Ze=tt.viewport,Oe===0&&(e.setRenderTargetTextures(w,tt.colorTexture,tt.depthStencilTexture),e.setRenderTarget(w))}let Ue=U[Oe];Ue===void 0&&(Ue=new si,Ue.layers.enable(Oe),Ue.viewport=new Gt,U[Oe]=Ue),Ue.matrix.fromArray(Ve.transform.matrix),Ue.matrix.decompose(Ue.position,Ue.quaternion,Ue.scale),Ue.projectionMatrix.fromArray(Ve.projectionMatrix),Ue.projectionMatrixInverse.copy(Ue.projectionMatrix).invert(),Ue.viewport.set(Ze.x,Ze.y,Ze.width,Ze.height),Oe===0&&(O.matrix.copy(Ue.matrix),O.matrix.decompose(O.position,O.quaternion,O.scale)),ze===!0&&O.cameras.push(Ue)}const se=r.enabledFeatures;if(se&&se.includes("depth-sensing")&&r.depthUsage=="gpu-optimized"&&x){f=i.getBinding();const Oe=f.getDepthInformation(Me[0]);Oe&&Oe.isValid&&Oe.texture&&g.init(Oe,r.renderState)}if(se&&se.includes("camera-access")&&x){e.state.unbindTexture(),f=i.getBinding();for(let Oe=0;Oe<Me.length;Oe++){const Ve=Me[Oe].camera;if(Ve){let Ze=u[Ve];Ze||(Ze=new t1,u[Ve]=Ze);const Ue=f.getCameraImage(Ve);Ze.sourceTexture=Ue}}}}for(let Me=0;Me<R.length;Me++){const ze=C[Me],se=R[Me];ze!==null&&se!==void 0&&se.update(ze,ae,d||a)}xe&&xe(Q,ae),ae.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:ae}),y=null}const Re=new i1;Re.setAnimationLoop(le),this.setAnimationLoop=function(Q){xe=Q},this.dispose=function(){}}}const ns=new ji,LM=new zt;function FM(t,e){function n(g,u){g.matrixAutoUpdate===!0&&g.updateMatrix(),u.value.copy(g.matrix)}function i(g,u){u.color.getRGB(g.fogColor.value,Yy(t)),u.isFog?(g.fogNear.value=u.near,g.fogFar.value=u.far):u.isFogExp2&&(g.fogDensity.value=u.density)}function r(g,u,v,b,w){u.isMeshBasicMaterial||u.isMeshLambertMaterial?s(g,u):u.isMeshToonMaterial?(s(g,u),f(g,u)):u.isMeshPhongMaterial?(s(g,u),h(g,u)):u.isMeshStandardMaterial?(s(g,u),p(g,u),u.isMeshPhysicalMaterial&&m(g,u,w)):u.isMeshMatcapMaterial?(s(g,u),y(g,u)):u.isMeshDepthMaterial?s(g,u):u.isMeshDistanceMaterial?(s(g,u),x(g,u)):u.isMeshNormalMaterial?s(g,u):u.isLineBasicMaterial?(a(g,u),u.isLineDashedMaterial&&l(g,u)):u.isPointsMaterial?c(g,u,v,b):u.isSpriteMaterial?d(g,u):u.isShadowMaterial?(g.color.value.copy(u.color),g.opacity.value=u.opacity):u.isShaderMaterial&&(u.uniformsNeedUpdate=!1)}function s(g,u){g.opacity.value=u.opacity,u.color&&g.diffuse.value.copy(u.color),u.emissive&&g.emissive.value.copy(u.emissive).multiplyScalar(u.emissiveIntensity),u.map&&(g.map.value=u.map,n(u.map,g.mapTransform)),u.alphaMap&&(g.alphaMap.value=u.alphaMap,n(u.alphaMap,g.alphaMapTransform)),u.bumpMap&&(g.bumpMap.value=u.bumpMap,n(u.bumpMap,g.bumpMapTransform),g.bumpScale.value=u.bumpScale,u.side===zn&&(g.bumpScale.value*=-1)),u.normalMap&&(g.normalMap.value=u.normalMap,n(u.normalMap,g.normalMapTransform),g.normalScale.value.copy(u.normalScale),u.side===zn&&g.normalScale.value.negate()),u.displacementMap&&(g.displacementMap.value=u.displacementMap,n(u.displacementMap,g.displacementMapTransform),g.displacementScale.value=u.displacementScale,g.displacementBias.value=u.displacementBias),u.emissiveMap&&(g.emissiveMap.value=u.emissiveMap,n(u.emissiveMap,g.emissiveMapTransform)),u.specularMap&&(g.specularMap.value=u.specularMap,n(u.specularMap,g.specularMapTransform)),u.alphaTest>0&&(g.alphaTest.value=u.alphaTest);const v=e.get(u),b=v.envMap,w=v.envMapRotation;b&&(g.envMap.value=b,ns.copy(w),ns.x*=-1,ns.y*=-1,ns.z*=-1,b.isCubeTexture&&b.isRenderTargetTexture===!1&&(ns.y*=-1,ns.z*=-1),g.envMapRotation.value.setFromMatrix4(LM.makeRotationFromEuler(ns)),g.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=u.reflectivity,g.ior.value=u.ior,g.refractionRatio.value=u.refractionRatio),u.lightMap&&(g.lightMap.value=u.lightMap,g.lightMapIntensity.value=u.lightMapIntensity,n(u.lightMap,g.lightMapTransform)),u.aoMap&&(g.aoMap.value=u.aoMap,g.aoMapIntensity.value=u.aoMapIntensity,n(u.aoMap,g.aoMapTransform))}function a(g,u){g.diffuse.value.copy(u.color),g.opacity.value=u.opacity,u.map&&(g.map.value=u.map,n(u.map,g.mapTransform))}function l(g,u){g.dashSize.value=u.dashSize,g.totalSize.value=u.dashSize+u.gapSize,g.scale.value=u.scale}function c(g,u,v,b){g.diffuse.value.copy(u.color),g.opacity.value=u.opacity,g.size.value=u.size*v,g.scale.value=b*.5,u.map&&(g.map.value=u.map,n(u.map,g.uvTransform)),u.alphaMap&&(g.alphaMap.value=u.alphaMap,n(u.alphaMap,g.alphaMapTransform)),u.alphaTest>0&&(g.alphaTest.value=u.alphaTest)}function d(g,u){g.diffuse.value.copy(u.color),g.opacity.value=u.opacity,g.rotation.value=u.rotation,u.map&&(g.map.value=u.map,n(u.map,g.mapTransform)),u.alphaMap&&(g.alphaMap.value=u.alphaMap,n(u.alphaMap,g.alphaMapTransform)),u.alphaTest>0&&(g.alphaTest.value=u.alphaTest)}function h(g,u){g.specular.value.copy(u.specular),g.shininess.value=Math.max(u.shininess,1e-4)}function f(g,u){u.gradientMap&&(g.gradientMap.value=u.gradientMap)}function p(g,u){g.metalness.value=u.metalness,u.metalnessMap&&(g.metalnessMap.value=u.metalnessMap,n(u.metalnessMap,g.metalnessMapTransform)),g.roughness.value=u.roughness,u.roughnessMap&&(g.roughnessMap.value=u.roughnessMap,n(u.roughnessMap,g.roughnessMapTransform)),u.envMap&&(g.envMapIntensity.value=u.envMapIntensity)}function m(g,u,v){g.ior.value=u.ior,u.sheen>0&&(g.sheenColor.value.copy(u.sheenColor).multiplyScalar(u.sheen),g.sheenRoughness.value=u.sheenRoughness,u.sheenColorMap&&(g.sheenColorMap.value=u.sheenColorMap,n(u.sheenColorMap,g.sheenColorMapTransform)),u.sheenRoughnessMap&&(g.sheenRoughnessMap.value=u.sheenRoughnessMap,n(u.sheenRoughnessMap,g.sheenRoughnessMapTransform))),u.clearcoat>0&&(g.clearcoat.value=u.clearcoat,g.clearcoatRoughness.value=u.clearcoatRoughness,u.clearcoatMap&&(g.clearcoatMap.value=u.clearcoatMap,n(u.clearcoatMap,g.clearcoatMapTransform)),u.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=u.clearcoatRoughnessMap,n(u.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),u.clearcoatNormalMap&&(g.clearcoatNormalMap.value=u.clearcoatNormalMap,n(u.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(u.clearcoatNormalScale),u.side===zn&&g.clearcoatNormalScale.value.negate())),u.dispersion>0&&(g.dispersion.value=u.dispersion),u.iridescence>0&&(g.iridescence.value=u.iridescence,g.iridescenceIOR.value=u.iridescenceIOR,g.iridescenceThicknessMinimum.value=u.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=u.iridescenceThicknessRange[1],u.iridescenceMap&&(g.iridescenceMap.value=u.iridescenceMap,n(u.iridescenceMap,g.iridescenceMapTransform)),u.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=u.iridescenceThicknessMap,n(u.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),u.transmission>0&&(g.transmission.value=u.transmission,g.transmissionSamplerMap.value=v.texture,g.transmissionSamplerSize.value.set(v.width,v.height),u.transmissionMap&&(g.transmissionMap.value=u.transmissionMap,n(u.transmissionMap,g.transmissionMapTransform)),g.thickness.value=u.thickness,u.thicknessMap&&(g.thicknessMap.value=u.thicknessMap,n(u.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=u.attenuationDistance,g.attenuationColor.value.copy(u.attenuationColor)),u.anisotropy>0&&(g.anisotropyVector.value.set(u.anisotropy*Math.cos(u.anisotropyRotation),u.anisotropy*Math.sin(u.anisotropyRotation)),u.anisotropyMap&&(g.anisotropyMap.value=u.anisotropyMap,n(u.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=u.specularIntensity,g.specularColor.value.copy(u.specularColor),u.specularColorMap&&(g.specularColorMap.value=u.specularColorMap,n(u.specularColorMap,g.specularColorMapTransform)),u.specularIntensityMap&&(g.specularIntensityMap.value=u.specularIntensityMap,n(u.specularIntensityMap,g.specularIntensityMapTransform))}function y(g,u){u.matcap&&(g.matcap.value=u.matcap)}function x(g,u){const v=e.get(u).light;g.referencePosition.value.setFromMatrixPosition(v.matrixWorld),g.nearDistance.value=v.shadow.camera.near,g.farDistance.value=v.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function UM(t,e,n,i){let r={},s={},a=[];const l=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function c(v,b){const w=b.program;i.uniformBlockBinding(v,w)}function d(v,b){let w=r[v.id];w===void 0&&(y(v),w=h(v),r[v.id]=w,v.addEventListener("dispose",g));const R=b.program;i.updateUBOMapping(v,R);const C=e.render.frame;s[v.id]!==C&&(p(v),s[v.id]=C)}function h(v){const b=f();v.__bindingPointIndex=b;const w=t.createBuffer(),R=v.__size,C=v.usage;return t.bindBuffer(t.UNIFORM_BUFFER,w),t.bufferData(t.UNIFORM_BUFFER,R,C),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,b,w),w}function f(){for(let v=0;v<l;v++)if(a.indexOf(v)===-1)return a.push(v),v;return vt("WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function p(v){const b=r[v.id],w=v.uniforms,R=v.__cache;t.bindBuffer(t.UNIFORM_BUFFER,b);for(let C=0,A=w.length;C<A;C++){const B=Array.isArray(w[C])?w[C]:[w[C]];for(let S=0,k=B.length;S<k;S++){const U=B[S];if(m(U,C,S,R)===!0){const O=U.__offset,X=Array.isArray(U.value)?U.value:[U.value];let K=0;for(let $=0;$<X.length;$++){const q=X[$],J=x(q);typeof q=="number"||typeof q=="boolean"?(U.__data[0]=q,t.bufferSubData(t.UNIFORM_BUFFER,O+K,U.__data)):q.isMatrix3?(U.__data[0]=q.elements[0],U.__data[1]=q.elements[1],U.__data[2]=q.elements[2],U.__data[3]=0,U.__data[4]=q.elements[3],U.__data[5]=q.elements[4],U.__data[6]=q.elements[5],U.__data[7]=0,U.__data[8]=q.elements[6],U.__data[9]=q.elements[7],U.__data[10]=q.elements[8],U.__data[11]=0):(q.toArray(U.__data,K),K+=J.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,O,U.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}function m(v,b,w,R){const C=v.value,A=b+"_"+w;if(R[A]===void 0)return typeof C=="number"||typeof C=="boolean"?R[A]=C:R[A]=C.clone(),!0;{const B=R[A];if(typeof C=="number"||typeof C=="boolean"){if(B!==C)return R[A]=C,!0}else if(B.equals(C)===!1)return B.copy(C),!0}return!1}function y(v){const b=v.uniforms;let w=0;const R=16;for(let A=0,B=b.length;A<B;A++){const S=Array.isArray(b[A])?b[A]:[b[A]];for(let k=0,U=S.length;k<U;k++){const O=S[k],X=Array.isArray(O.value)?O.value:[O.value];for(let K=0,$=X.length;K<$;K++){const q=X[K],J=x(q),V=w%R,ue=V%J.boundary,F=V+ue;w+=ue,F!==0&&R-F<J.storage&&(w+=R-F),O.__data=new Float32Array(J.storage/Float32Array.BYTES_PER_ELEMENT),O.__offset=w,w+=J.storage}}}const C=w%R;return C>0&&(w+=R-C),v.__size=w,v.__cache={},this}function x(v){const b={boundary:0,storage:0};return typeof v=="number"||typeof v=="boolean"?(b.boundary=4,b.storage=4):v.isVector2?(b.boundary=8,b.storage=8):v.isVector3||v.isColor?(b.boundary=16,b.storage=12):v.isVector4?(b.boundary=16,b.storage=16):v.isMatrix3?(b.boundary=48,b.storage=48):v.isMatrix4?(b.boundary=64,b.storage=64):v.isTexture?lt("WebGLRenderer: Texture samplers can not be part of an uniforms group."):lt("WebGLRenderer: Unsupported uniform value type.",v),b}function g(v){const b=v.target;b.removeEventListener("dispose",g);const w=a.indexOf(b.__bindingPointIndex);a.splice(w,1),t.deleteBuffer(r[b.id]),delete r[b.id],delete s[b.id]}function u(){for(const v in r)t.deleteBuffer(r[v]);a=[],r={},s={}}return{bind:c,update:d,dispose:u}}const OM=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let Ei=null;function zM(){return Ei===null&&(Ei=new P_(OM,16,16,ka,or),Ei.name="DFG_LUT",Ei.minFilter=gn,Ei.magFilter=gn,Ei.wrapS=Ji,Ei.wrapT=Ji,Ei.generateMipmaps=!1,Ei.needsUpdate=!0),Ei}class jM{constructor(e={}){const{canvas:n=i_(),context:i=null,depth:r=!0,stencil:s=!1,alpha:a=!1,antialias:l=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:d=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:f=!1,reversedDepthBuffer:p=!1,outputBufferType:m=Qn}=e;this.isWebGLRenderer=!0;let y;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");y=i.getContextAttributes().alpha}else y=a;const x=m,g=new Set([yp,xp,gp]),u=new Set([Qn,zi,Bo,Io,pp,mp]),v=new Uint32Array(4),b=new Int32Array(4);let w=null,R=null;const C=[],A=[];let B=null;this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Fi,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const S=this;let k=!1;this._outputColorSpace=ni;let U=0,O=0,X=null,K=-1,$=null;const q=new Gt,J=new Gt;let V=null;const ue=new dt(0);let F=0,de=n.width,Te=n.height,xe=1,le=null,Re=null;const Q=new Gt(0,0,de,Te),ae=new Gt(0,0,de,Te);let Me=!1;const ze=new Mp;let se=!1,ke=!1;const Ge=new zt,Oe=new re,Ve=new Gt,Ze={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Ue=!1;function tt(){return X===null?xe:1}let z=i;function ht(T,Y){return n.getContext(T,Y)}try{const T={alpha:!0,depth:r,stencil:s,antialias:l,premultipliedAlpha:c,preserveDrawingBuffer:d,powerPreference:h,failIfMajorPerformanceCaveat:f};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${hp}`),n.addEventListener("webglcontextlost",nt,!1),n.addEventListener("webglcontextrestored",yt,!1),n.addEventListener("webglcontextcreationerror",mt,!1),z===null){const Y="webgl2";if(z=ht(Y,T),z===null)throw ht(Y)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(T){throw vt("WebGLRenderer: "+T.message),T}let Xe,Je,ee,P,_,W,M,_e,ne,Ie,ie,Se,we,ve,Ee,he,Z,me,Ke,G,Be,Pe,je,Ae;function fe(){Xe=new zk(z),Xe.init(),Pe=new PM(z,Xe),Je=new Pk(z,Xe,e,Pe),ee=new TM(z,Xe),Je.reversedDepthBuffer&&p&&ee.buffers.depth.setReversed(!0),P=new Gk(z),_=new pM,W=new AM(z,Xe,ee,_,Je,Pe,P),M=new Bk(S),_e=new Ok(S),ne=new Q_(z),je=new Tk(z,ne),Ie=new jk(z,ne,P,je),ie=new Vk(z,Ie,ne,P),Ke=new Hk(z,Je,W),he=new Nk(_),Se=new fM(S,M,_e,Xe,Je,je,he),we=new FM(S,_),ve=new gM,Ee=new SM(Xe),me=new Ck(S,M,_e,ee,ie,y,c),Z=new EM(S,ie,Je),Ae=new UM(z,P,Je,ee),G=new Ak(z,Xe,P),Be=new Wk(z,Xe,P),P.programs=Se.programs,S.capabilities=Je,S.extensions=Xe,S.properties=_,S.renderLists=ve,S.shadowMap=Z,S.state=ee,S.info=P}fe(),x!==Qn&&(B=new Qk(x,n.width,n.height,r,s));const Fe=new DM(S,z);this.xr=Fe,this.getContext=function(){return z},this.getContextAttributes=function(){return z.getContextAttributes()},this.forceContextLoss=function(){const T=Xe.get("WEBGL_lose_context");T&&T.loseContext()},this.forceContextRestore=function(){const T=Xe.get("WEBGL_lose_context");T&&T.restoreContext()},this.getPixelRatio=function(){return xe},this.setPixelRatio=function(T){T!==void 0&&(xe=T,this.setSize(de,Te,!1))},this.getSize=function(T){return T.set(de,Te)},this.setSize=function(T,Y,pe=!0){if(Fe.isPresenting){lt("WebGLRenderer: Can't change size while VR device is presenting.");return}de=T,Te=Y,n.width=Math.floor(T*xe),n.height=Math.floor(Y*xe),pe===!0&&(n.style.width=T+"px",n.style.height=Y+"px"),B!==null&&B.setSize(n.width,n.height),this.setViewport(0,0,T,Y)},this.getDrawingBufferSize=function(T){return T.set(de*xe,Te*xe).floor()},this.setDrawingBufferSize=function(T,Y,pe){de=T,Te=Y,xe=pe,n.width=Math.floor(T*pe),n.height=Math.floor(Y*pe),this.setViewport(0,0,T,Y)},this.setEffects=function(T){if(x===Qn){console.error("THREE.WebGLRenderer: setEffects() requires outputBufferType set to HalfFloatType or FloatType.");return}if(T){for(let Y=0;Y<T.length;Y++)if(T[Y].isOutputPass===!0){console.warn("THREE.WebGLRenderer: OutputPass is not needed in setEffects(). Tone mapping and color space conversion are applied automatically.");break}}B.setEffects(T||[])},this.getCurrentViewport=function(T){return T.copy(q)},this.getViewport=function(T){return T.copy(Q)},this.setViewport=function(T,Y,pe,ce){T.isVector4?Q.set(T.x,T.y,T.z,T.w):Q.set(T,Y,pe,ce),ee.viewport(q.copy(Q).multiplyScalar(xe).round())},this.getScissor=function(T){return T.copy(ae)},this.setScissor=function(T,Y,pe,ce){T.isVector4?ae.set(T.x,T.y,T.z,T.w):ae.set(T,Y,pe,ce),ee.scissor(J.copy(ae).multiplyScalar(xe).round())},this.getScissorTest=function(){return Me},this.setScissorTest=function(T){ee.setScissorTest(Me=T)},this.setOpaqueSort=function(T){le=T},this.setTransparentSort=function(T){Re=T},this.getClearColor=function(T){return T.copy(me.getClearColor())},this.setClearColor=function(){me.setClearColor(...arguments)},this.getClearAlpha=function(){return me.getClearAlpha()},this.setClearAlpha=function(){me.setClearAlpha(...arguments)},this.clear=function(T=!0,Y=!0,pe=!0){let ce=0;if(T){let te=!1;if(X!==null){const We=X.texture.format;te=g.has(We)}if(te){const We=X.texture.type,D=u.has(We),oe=me.getClearColor(),ye=me.getClearAlpha(),L=oe.r,H=oe.g,j=oe.b;D?(v[0]=L,v[1]=H,v[2]=j,v[3]=ye,z.clearBufferuiv(z.COLOR,0,v)):(b[0]=L,b[1]=H,b[2]=j,b[3]=ye,z.clearBufferiv(z.COLOR,0,b))}else ce|=z.COLOR_BUFFER_BIT}Y&&(ce|=z.DEPTH_BUFFER_BIT),pe&&(ce|=z.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),z.clear(ce)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",nt,!1),n.removeEventListener("webglcontextrestored",yt,!1),n.removeEventListener("webglcontextcreationerror",mt,!1),me.dispose(),ve.dispose(),Ee.dispose(),_.dispose(),M.dispose(),_e.dispose(),ie.dispose(),je.dispose(),Ae.dispose(),Se.dispose(),Fe.dispose(),Fe.removeEventListener("sessionstart",Le),Fe.removeEventListener("sessionend",Pt),Ft.stop()};function nt(T){T.preventDefault(),tg("WebGLRenderer: Context Lost."),k=!0}function yt(){tg("WebGLRenderer: Context Restored."),k=!1;const T=P.autoReset,Y=Z.enabled,pe=Z.autoUpdate,ce=Z.needsUpdate,te=Z.type;fe(),P.autoReset=T,Z.enabled=Y,Z.autoUpdate=pe,Z.needsUpdate=ce,Z.type=te}function mt(T){vt("WebGLRenderer: A WebGL context could not be created. Reason: ",T.statusMessage)}function E(T){const Y=T.target;Y.removeEventListener("dispose",E),be(Y)}function be(T){qe(T),_.remove(T)}function qe(T){const Y=_.get(T).programs;Y!==void 0&&(Y.forEach(function(pe){Se.releaseProgram(pe)}),T.isShaderMaterial&&Se.releaseShaderCache(T))}this.renderBufferDirect=function(T,Y,pe,ce,te,We){Y===null&&(Y=Ze);const D=te.isMesh&&te.matrixWorld.determinant()<0,oe=Rs(T,Y,pe,ce,te);ee.setMaterial(ce,D);let ye=pe.index,L=1;if(ce.wireframe===!0){if(ye=Ie.getWireframeAttribute(pe),ye===void 0)return;L=2}const H=pe.drawRange,j=pe.attributes.position;let ge=H.start*L,De=(H.start+H.count)*L;We!==null&&(ge=Math.max(ge,We.start*L),De=Math.min(De,(We.start+We.count)*L)),ye!==null?(ge=Math.max(ge,0),De=Math.min(De,ye.count)):j!=null&&(ge=Math.max(ge,0),De=Math.min(De,j.count));const Ye=De-ge;if(Ye<0||Ye===1/0)return;je.setup(te,ce,oe,pe,ye);let xt,pt=G;if(ye!==null&&(xt=ne.get(ye),pt=Be,pt.setIndex(xt)),te.isMesh)ce.wireframe===!0?(ee.setLineWidth(ce.wireframeLinewidth*tt()),pt.setMode(z.LINES)):pt.setMode(z.TRIANGLES);else if(te.isLine){let et=ce.linewidth;et===void 0&&(et=1),ee.setLineWidth(et*tt()),te.isLineSegments?pt.setMode(z.LINES):te.isLineLoop?pt.setMode(z.LINE_LOOP):pt.setMode(z.LINE_STRIP)}else te.isPoints?pt.setMode(z.POINTS):te.isSprite&&pt.setMode(z.TRIANGLES);if(te.isBatchedMesh)if(te._multiDrawInstances!==null)Do("WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),pt.renderMultiDrawInstances(te._multiDrawStarts,te._multiDrawCounts,te._multiDrawCount,te._multiDrawInstances);else if(Xe.get("WEBGL_multi_draw"))pt.renderMultiDraw(te._multiDrawStarts,te._multiDrawCounts,te._multiDrawCount);else{const et=te._multiDrawStarts,Mt=te._multiDrawCounts,wt=te._multiDrawCount,jn=ye?ne.get(ye).bytesPerElement:1,Cs=_.get(ce).currentProgram.getUniforms();for(let Wn=0;Wn<wt;Wn++)Cs.setValue(z,"_gl_DrawID",Wn),pt.render(et[Wn]/jn,Mt[Wn])}else if(te.isInstancedMesh)pt.renderInstances(ge,Ye,te.count);else if(pe.isInstancedBufferGeometry){const et=pe._maxInstanceCount!==void 0?pe._maxInstanceCount:1/0,Mt=Math.min(pe.instanceCount,et);pt.renderInstances(ge,Ye,Mt)}else pt.render(ge,Ye)};function at(T,Y,pe){T.transparent===!0&&T.side===Ni&&T.forceSinglePass===!1?(T.side=zn,T.needsUpdate=!0,Jn(T,Y,pe),T.side=Hr,T.needsUpdate=!0,Jn(T,Y,pe),T.side=Ni):Jn(T,Y,pe)}this.compile=function(T,Y,pe=null){pe===null&&(pe=T),R=Ee.get(pe),R.init(Y),A.push(R),pe.traverseVisible(function(te){te.isLight&&te.layers.test(Y.layers)&&(R.pushLight(te),te.castShadow&&R.pushShadow(te))}),T!==pe&&T.traverseVisible(function(te){te.isLight&&te.layers.test(Y.layers)&&(R.pushLight(te),te.castShadow&&R.pushShadow(te))}),R.setupLights();const ce=new Set;return T.traverse(function(te){if(!(te.isMesh||te.isPoints||te.isLine||te.isSprite))return;const We=te.material;if(We)if(Array.isArray(We))for(let D=0;D<We.length;D++){const oe=We[D];at(oe,pe,te),ce.add(oe)}else at(We,pe,te),ce.add(We)}),R=A.pop(),ce},this.compileAsync=function(T,Y,pe=null){const ce=this.compile(T,Y,pe);return new Promise(te=>{function We(){if(ce.forEach(function(D){_.get(D).currentProgram.isReady()&&ce.delete(D)}),ce.size===0){te(T);return}setTimeout(We,10)}Xe.get("KHR_parallel_shader_compile")!==null?We():setTimeout(We,10)})};let I=null;function St(T){I&&I(T)}function Le(){Ft.stop()}function Pt(){Ft.start()}const Ft=new i1;Ft.setAnimationLoop(St),typeof self<"u"&&Ft.setContext(self),this.setAnimationLoop=function(T){I=T,Fe.setAnimationLoop(T),T===null?Ft.stop():Ft.start()},Fe.addEventListener("sessionstart",Le),Fe.addEventListener("sessionend",Pt),this.render=function(T,Y){if(Y!==void 0&&Y.isCamera!==!0){vt("WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(k===!0)return;const pe=Fe.enabled===!0&&Fe.isPresenting===!0,ce=B!==null&&(X===null||pe)&&B.begin(S,X);if(T.matrixWorldAutoUpdate===!0&&T.updateMatrixWorld(),Y.parent===null&&Y.matrixWorldAutoUpdate===!0&&Y.updateMatrixWorld(),Fe.enabled===!0&&Fe.isPresenting===!0&&(B===null||B.isCompositing()===!1)&&(Fe.cameraAutoUpdate===!0&&Fe.updateCamera(Y),Y=Fe.getCamera()),T.isScene===!0&&T.onBeforeRender(S,T,Y,X),R=Ee.get(T,A.length),R.init(Y),A.push(R),Ge.multiplyMatrices(Y.projectionMatrix,Y.matrixWorldInverse),ze.setFromProjectionMatrix(Ge,Ii,Y.reversedDepth),ke=this.localClippingEnabled,se=he.init(this.clippingPlanes,ke),w=ve.get(T,C.length),w.init(),C.push(w),Fe.enabled===!0&&Fe.isPresenting===!0){const D=S.xr.getDepthSensingMesh();D!==null&&kt(D,Y,-1/0,S.sortObjects)}kt(T,Y,0,S.sortObjects),w.finish(),S.sortObjects===!0&&w.sort(le,Re),Ue=Fe.enabled===!1||Fe.isPresenting===!1||Fe.hasDepthSensing()===!1,Ue&&me.addToRenderList(w,T),this.info.render.frame++,se===!0&&he.beginShadows();const te=R.state.shadowsArray;if(Z.render(te,T,Y),se===!0&&he.endShadows(),this.info.autoReset===!0&&this.info.reset(),(ce&&B.hasRenderPass())===!1){const D=w.opaque,oe=w.transmissive;if(R.setupLights(),Y.isArrayCamera){const ye=Y.cameras;if(oe.length>0)for(let L=0,H=ye.length;L<H;L++){const j=ye[L];di(D,oe,T,j)}Ue&&me.render(T);for(let L=0,H=ye.length;L<H;L++){const j=ye[L];En(w,T,j,j.viewport)}}else oe.length>0&&di(D,oe,T,Y),Ue&&me.render(T),En(w,T,Y)}X!==null&&O===0&&(W.updateMultisampleRenderTarget(X),W.updateRenderTargetMipmap(X)),ce&&B.end(S),T.isScene===!0&&T.onAfterRender(S,T,Y),je.resetDefaultState(),K=-1,$=null,A.pop(),A.length>0?(R=A[A.length-1],se===!0&&he.setGlobalState(S.clippingPlanes,R.state.camera)):R=null,C.pop(),C.length>0?w=C[C.length-1]:w=null};function kt(T,Y,pe,ce){if(T.visible===!1)return;if(T.layers.test(Y.layers)){if(T.isGroup)pe=T.renderOrder;else if(T.isLOD)T.autoUpdate===!0&&T.update(Y);else if(T.isLight)R.pushLight(T),T.castShadow&&R.pushShadow(T);else if(T.isSprite){if(!T.frustumCulled||ze.intersectsSprite(T)){ce&&Ve.setFromMatrixPosition(T.matrixWorld).applyMatrix4(Ge);const D=ie.update(T),oe=T.material;oe.visible&&w.push(T,D,oe,pe,Ve.z,null)}}else if((T.isMesh||T.isLine||T.isPoints)&&(!T.frustumCulled||ze.intersectsObject(T))){const D=ie.update(T),oe=T.material;if(ce&&(T.boundingSphere!==void 0?(T.boundingSphere===null&&T.computeBoundingSphere(),Ve.copy(T.boundingSphere.center)):(D.boundingSphere===null&&D.computeBoundingSphere(),Ve.copy(D.boundingSphere.center)),Ve.applyMatrix4(T.matrixWorld).applyMatrix4(Ge)),Array.isArray(oe)){const ye=D.groups;for(let L=0,H=ye.length;L<H;L++){const j=ye[L],ge=oe[j.materialIndex];ge&&ge.visible&&w.push(T,D,ge,pe,Ve.z,j)}}else oe.visible&&w.push(T,D,oe,pe,Ve.z,null)}}const We=T.children;for(let D=0,oe=We.length;D<oe;D++)kt(We[D],Y,pe,ce)}function En(T,Y,pe,ce){const{opaque:te,transmissive:We,transparent:D}=T;R.setupLightsView(pe),se===!0&&he.setGlobalState(S.clippingPlanes,pe),ce&&ee.viewport(q.copy(ce)),te.length>0&&$e(te,Y,pe),We.length>0&&$e(We,Y,pe),D.length>0&&$e(D,Y,pe),ee.buffers.depth.setTest(!0),ee.buffers.depth.setMask(!0),ee.buffers.color.setMask(!0),ee.setPolygonOffset(!1)}function di(T,Y,pe,ce){if((pe.isScene===!0?pe.overrideMaterial:null)!==null)return;if(R.state.transmissionRenderTarget[ce.id]===void 0){const ge=Xe.has("EXT_color_buffer_half_float")||Xe.has("EXT_color_buffer_float");R.state.transmissionRenderTarget[ce.id]=new Ui(1,1,{generateMipmaps:!0,type:ge?or:Qn,minFilter:us,samples:Je.samples,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:bt.workingColorSpace})}const We=R.state.transmissionRenderTarget[ce.id],D=ce.viewport||q;We.setSize(D.z*S.transmissionResolutionScale,D.w*S.transmissionResolutionScale);const oe=S.getRenderTarget(),ye=S.getActiveCubeFace(),L=S.getActiveMipmapLevel();S.setRenderTarget(We),S.getClearColor(ue),F=S.getClearAlpha(),F<1&&S.setClearColor(16777215,.5),S.clear(),Ue&&me.render(pe);const H=S.toneMapping;S.toneMapping=Fi;const j=ce.viewport;if(ce.viewport!==void 0&&(ce.viewport=void 0),R.setupLightsView(ce),se===!0&&he.setGlobalState(S.clippingPlanes,ce),$e(T,pe,ce),W.updateMultisampleRenderTarget(We),W.updateRenderTargetMipmap(We),Xe.has("WEBGL_multisampled_render_to_texture")===!1){let ge=!1;for(let De=0,Ye=Y.length;De<Ye;De++){const xt=Y[De],{object:pt,geometry:et,material:Mt,group:wt}=xt;if(Mt.side===Ni&&pt.layers.test(ce.layers)){const jn=Mt.side;Mt.side=zn,Mt.needsUpdate=!0,dr(pt,pe,ce,et,Mt,wt),Mt.side=jn,Mt.needsUpdate=!0,ge=!0}}ge===!0&&(W.updateMultisampleRenderTarget(We),W.updateRenderTargetMipmap(We))}S.setRenderTarget(oe,ye,L),S.setClearColor(ue,F),j!==void 0&&(ce.viewport=j),S.toneMapping=H}function $e(T,Y,pe){const ce=Y.isScene===!0?Y.overrideMaterial:null;for(let te=0,We=T.length;te<We;te++){const D=T[te],{object:oe,geometry:ye,group:L}=D;let H=D.material;H.allowOverride===!0&&ce!==null&&(H=ce),oe.layers.test(pe.layers)&&dr(oe,Y,pe,ye,H,L)}}function dr(T,Y,pe,ce,te,We){T.onBeforeRender(S,Y,pe,ce,te,We),T.modelViewMatrix.multiplyMatrices(pe.matrixWorldInverse,T.matrixWorld),T.normalMatrix.getNormalMatrix(T.modelViewMatrix),te.onBeforeRender(S,Y,pe,ce,T,We),te.transparent===!0&&te.side===Ni&&te.forceSinglePass===!1?(te.side=zn,te.needsUpdate=!0,S.renderBufferDirect(pe,Y,ce,te,T,We),te.side=Hr,te.needsUpdate=!0,S.renderBufferDirect(pe,Y,ce,te,T,We),te.side=Ni):S.renderBufferDirect(pe,Y,ce,te,T,We),T.onAfterRender(S,Y,pe,ce,te,We)}function Jn(T,Y,pe){Y.isScene!==!0&&(Y=Ze);const ce=_.get(T),te=R.state.lights,We=R.state.shadowsArray,D=te.state.version,oe=Se.getParameters(T,te.state,We,Y,pe),ye=Se.getProgramCacheKey(oe);let L=ce.programs;ce.environment=T.isMeshStandardMaterial?Y.environment:null,ce.fog=Y.fog,ce.envMap=(T.isMeshStandardMaterial?_e:M).get(T.envMap||ce.environment),ce.envMapRotation=ce.environment!==null&&T.envMap===null?Y.environmentRotation:T.envMapRotation,L===void 0&&(T.addEventListener("dispose",E),L=new Map,ce.programs=L);let H=L.get(ye);if(H!==void 0){if(ce.currentProgram===H&&ce.lightsStateVersion===D)return ur(T,oe),H}else oe.uniforms=Se.getUniforms(T),T.onBeforeCompile(oe,S),H=Se.acquireProgram(oe,ye),L.set(ye,H),ce.uniforms=oe.uniforms;const j=ce.uniforms;return(!T.isShaderMaterial&&!T.isRawShaderMaterial||T.clipping===!0)&&(j.clippingPlanes=he.uniform),ur(T,oe),ce.needsLights=Es(T),ce.lightsStateVersion=D,ce.needsLights&&(j.ambientLightColor.value=te.state.ambient,j.lightProbe.value=te.state.probe,j.directionalLights.value=te.state.directional,j.directionalLightShadows.value=te.state.directionalShadow,j.spotLights.value=te.state.spot,j.spotLightShadows.value=te.state.spotShadow,j.rectAreaLights.value=te.state.rectArea,j.ltc_1.value=te.state.rectAreaLTC1,j.ltc_2.value=te.state.rectAreaLTC2,j.pointLights.value=te.state.point,j.pointLightShadows.value=te.state.pointShadow,j.hemisphereLights.value=te.state.hemi,j.directionalShadowMap.value=te.state.directionalShadowMap,j.directionalShadowMatrix.value=te.state.directionalShadowMatrix,j.spotShadowMap.value=te.state.spotShadowMap,j.spotLightMatrix.value=te.state.spotLightMatrix,j.spotLightMap.value=te.state.spotLightMap,j.pointShadowMap.value=te.state.pointShadowMap,j.pointShadowMatrix.value=te.state.pointShadowMatrix),ce.currentProgram=H,ce.uniformsList=null,H}function Cn(T){if(T.uniformsList===null){const Y=T.currentProgram.getUniforms();T.uniformsList=ac.seqWithValue(Y.seq,T.uniforms)}return T.uniformsList}function ur(T,Y){const pe=_.get(T);pe.outputColorSpace=Y.outputColorSpace,pe.batching=Y.batching,pe.batchingColor=Y.batchingColor,pe.instancing=Y.instancing,pe.instancingColor=Y.instancingColor,pe.instancingMorph=Y.instancingMorph,pe.skinning=Y.skinning,pe.morphTargets=Y.morphTargets,pe.morphNormals=Y.morphNormals,pe.morphColors=Y.morphColors,pe.morphTargetsCount=Y.morphTargetsCount,pe.numClippingPlanes=Y.numClippingPlanes,pe.numIntersection=Y.numClipIntersection,pe.vertexAlphas=Y.vertexAlphas,pe.vertexTangents=Y.vertexTangents,pe.toneMapping=Y.toneMapping}function Rs(T,Y,pe,ce,te){Y.isScene!==!0&&(Y=Ze),W.resetTextureUnits();const We=Y.fog,D=ce.isMeshStandardMaterial?Y.environment:null,oe=X===null?S.outputColorSpace:X.isXRRenderTarget===!0?X.texture.colorSpace:Ma,ye=(ce.isMeshStandardMaterial?_e:M).get(ce.envMap||D),L=ce.vertexColors===!0&&!!pe.attributes.color&&pe.attributes.color.itemSize===4,H=!!pe.attributes.tangent&&(!!ce.normalMap||ce.anisotropy>0),j=!!pe.morphAttributes.position,ge=!!pe.morphAttributes.normal,De=!!pe.morphAttributes.color;let Ye=Fi;ce.toneMapped&&(X===null||X.isXRRenderTarget===!0)&&(Ye=S.toneMapping);const xt=pe.morphAttributes.position||pe.morphAttributes.normal||pe.morphAttributes.color,pt=xt!==void 0?xt.length:0,et=_.get(ce),Mt=R.state.lights;if(se===!0&&(ke===!0||T!==$)){const vn=T===$&&ce.id===K;he.setState(ce,T,vn)}let wt=!1;ce.version===et.__version?(et.needsLights&&et.lightsStateVersion!==Mt.state.version||et.outputColorSpace!==oe||te.isBatchedMesh&&et.batching===!1||!te.isBatchedMesh&&et.batching===!0||te.isBatchedMesh&&et.batchingColor===!0&&te.colorTexture===null||te.isBatchedMesh&&et.batchingColor===!1&&te.colorTexture!==null||te.isInstancedMesh&&et.instancing===!1||!te.isInstancedMesh&&et.instancing===!0||te.isSkinnedMesh&&et.skinning===!1||!te.isSkinnedMesh&&et.skinning===!0||te.isInstancedMesh&&et.instancingColor===!0&&te.instanceColor===null||te.isInstancedMesh&&et.instancingColor===!1&&te.instanceColor!==null||te.isInstancedMesh&&et.instancingMorph===!0&&te.morphTexture===null||te.isInstancedMesh&&et.instancingMorph===!1&&te.morphTexture!==null||et.envMap!==ye||ce.fog===!0&&et.fog!==We||et.numClippingPlanes!==void 0&&(et.numClippingPlanes!==he.numPlanes||et.numIntersection!==he.numIntersection)||et.vertexAlphas!==L||et.vertexTangents!==H||et.morphTargets!==j||et.morphNormals!==ge||et.morphColors!==De||et.toneMapping!==Ye||et.morphTargetsCount!==pt)&&(wt=!0):(wt=!0,et.__version=ce.version);let jn=et.currentProgram;wt===!0&&(jn=Jn(ce,Y,te));let Cs=!1,Wn=!1,Ia=!1;const Tt=jn.getUniforms(),Tn=et.uniforms;if(ee.useProgram(jn.program)&&(Cs=!0,Wn=!0,Ia=!0),ce.id!==K&&(K=ce.id,Wn=!0),Cs||$!==T){ee.buffers.depth.getReversed()&&T.reversedDepth!==!0&&(T._reversedDepth=!0,T.updateProjectionMatrix()),Tt.setValue(z,"projectionMatrix",T.projectionMatrix),Tt.setValue(z,"viewMatrix",T.matrixWorldInverse);const An=Tt.map.cameraPosition;An!==void 0&&An.setValue(z,Oe.setFromMatrixPosition(T.matrixWorld)),Je.logarithmicDepthBuffer&&Tt.setValue(z,"logDepthBufFC",2/(Math.log(T.far+1)/Math.LN2)),(ce.isMeshPhongMaterial||ce.isMeshToonMaterial||ce.isMeshLambertMaterial||ce.isMeshBasicMaterial||ce.isMeshStandardMaterial||ce.isShaderMaterial)&&Tt.setValue(z,"isOrthographic",T.isOrthographicCamera===!0),$!==T&&($=T,Wn=!0,Ia=!0)}if(et.needsLights&&(Mt.state.directionalShadowMap.length>0&&Tt.setValue(z,"directionalShadowMap",Mt.state.directionalShadowMap,W),Mt.state.spotShadowMap.length>0&&Tt.setValue(z,"spotShadowMap",Mt.state.spotShadowMap,W),Mt.state.pointShadowMap.length>0&&Tt.setValue(z,"pointShadowMap",Mt.state.pointShadowMap,W)),te.isSkinnedMesh){Tt.setOptional(z,te,"bindMatrix"),Tt.setOptional(z,te,"bindMatrixInverse");const vn=te.skeleton;vn&&(vn.boneTexture===null&&vn.computeBoneTexture(),Tt.setValue(z,"boneTexture",vn.boneTexture,W))}te.isBatchedMesh&&(Tt.setOptional(z,te,"batchingTexture"),Tt.setValue(z,"batchingTexture",te._matricesTexture,W),Tt.setOptional(z,te,"batchingIdTexture"),Tt.setValue(z,"batchingIdTexture",te._indirectTexture,W),Tt.setOptional(z,te,"batchingColorTexture"),te._colorsTexture!==null&&Tt.setValue(z,"batchingColorTexture",te._colorsTexture,W));const ei=pe.morphAttributes;if((ei.position!==void 0||ei.normal!==void 0||ei.color!==void 0)&&Ke.update(te,pe,jn),(Wn||et.receiveShadow!==te.receiveShadow)&&(et.receiveShadow=te.receiveShadow,Tt.setValue(z,"receiveShadow",te.receiveShadow)),ce.isMeshGouraudMaterial&&ce.envMap!==null&&(Tn.envMap.value=ye,Tn.flipEnvMap.value=ye.isCubeTexture&&ye.isRenderTargetTexture===!1?-1:1),ce.isMeshStandardMaterial&&ce.envMap===null&&Y.environment!==null&&(Tn.envMapIntensity.value=Y.environmentIntensity),Tn.dfgLUT!==void 0&&(Tn.dfgLUT.value=zM()),Wn&&(Tt.setValue(z,"toneMappingExposure",S.toneMappingExposure),et.needsLights&&Na(Tn,Ia),We&&ce.fog===!0&&we.refreshFogUniforms(Tn,We),we.refreshMaterialUniforms(Tn,ce,xe,Te,R.state.transmissionRenderTarget[T.id]),ac.upload(z,Cn(et),Tn,W)),ce.isShaderMaterial&&ce.uniformsNeedUpdate===!0&&(ac.upload(z,Cn(et),Tn,W),ce.uniformsNeedUpdate=!1),ce.isSpriteMaterial&&Tt.setValue(z,"center",te.center),Tt.setValue(z,"modelViewMatrix",te.modelViewMatrix),Tt.setValue(z,"normalMatrix",te.normalMatrix),Tt.setValue(z,"modelMatrix",te.matrixWorld),ce.isShaderMaterial||ce.isRawShaderMaterial){const vn=ce.uniformsGroups;for(let An=0,sd=vn.length;An<sd;An++){const $r=vn[An];Ae.update($r,jn),Ae.bind($r,jn)}}return jn}function Na(T,Y){T.ambientLightColor.needsUpdate=Y,T.lightProbe.needsUpdate=Y,T.directionalLights.needsUpdate=Y,T.directionalLightShadows.needsUpdate=Y,T.pointLights.needsUpdate=Y,T.pointLightShadows.needsUpdate=Y,T.spotLights.needsUpdate=Y,T.spotLightShadows.needsUpdate=Y,T.rectAreaLights.needsUpdate=Y,T.hemisphereLights.needsUpdate=Y}function Es(T){return T.isMeshLambertMaterial||T.isMeshToonMaterial||T.isMeshPhongMaterial||T.isMeshStandardMaterial||T.isShadowMaterial||T.isShaderMaterial&&T.lights===!0}this.getActiveCubeFace=function(){return U},this.getActiveMipmapLevel=function(){return O},this.getRenderTarget=function(){return X},this.setRenderTargetTextures=function(T,Y,pe){const ce=_.get(T);ce.__autoAllocateDepthBuffer=T.resolveDepthBuffer===!1,ce.__autoAllocateDepthBuffer===!1&&(ce.__useRenderToTexture=!1),_.get(T.texture).__webglTexture=Y,_.get(T.depthTexture).__webglTexture=ce.__autoAllocateDepthBuffer?void 0:pe,ce.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(T,Y){const pe=_.get(T);pe.__webglFramebuffer=Y,pe.__useDefaultFramebuffer=Y===void 0};const qr=z.createFramebuffer();this.setRenderTarget=function(T,Y=0,pe=0){X=T,U=Y,O=pe;let ce=null,te=!1,We=!1;if(T){const oe=_.get(T);if(oe.__useDefaultFramebuffer!==void 0){ee.bindFramebuffer(z.FRAMEBUFFER,oe.__webglFramebuffer),q.copy(T.viewport),J.copy(T.scissor),V=T.scissorTest,ee.viewport(q),ee.scissor(J),ee.setScissorTest(V),K=-1;return}else if(oe.__webglFramebuffer===void 0)W.setupRenderTarget(T);else if(oe.__hasExternalTextures)W.rebindTextures(T,_.get(T.texture).__webglTexture,_.get(T.depthTexture).__webglTexture);else if(T.depthBuffer){const H=T.depthTexture;if(oe.__boundDepthTexture!==H){if(H!==null&&_.has(H)&&(T.width!==H.image.width||T.height!==H.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");W.setupDepthRenderbuffer(T)}}const ye=T.texture;(ye.isData3DTexture||ye.isDataArrayTexture||ye.isCompressedArrayTexture)&&(We=!0);const L=_.get(T).__webglFramebuffer;T.isWebGLCubeRenderTarget?(Array.isArray(L[Y])?ce=L[Y][pe]:ce=L[Y],te=!0):T.samples>0&&W.useMultisampledRTT(T)===!1?ce=_.get(T).__webglMultisampledFramebuffer:Array.isArray(L)?ce=L[pe]:ce=L,q.copy(T.viewport),J.copy(T.scissor),V=T.scissorTest}else q.copy(Q).multiplyScalar(xe).floor(),J.copy(ae).multiplyScalar(xe).floor(),V=Me;if(pe!==0&&(ce=qr),ee.bindFramebuffer(z.FRAMEBUFFER,ce)&&ee.drawBuffers(T,ce),ee.viewport(q),ee.scissor(J),ee.setScissorTest(V),te){const oe=_.get(T.texture);z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_CUBE_MAP_POSITIVE_X+Y,oe.__webglTexture,pe)}else if(We){const oe=Y;for(let ye=0;ye<T.textures.length;ye++){const L=_.get(T.textures[ye]);z.framebufferTextureLayer(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0+ye,L.__webglTexture,pe,oe)}}else if(T!==null&&pe!==0){const oe=_.get(T.texture);z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_2D,oe.__webglTexture,pe)}K=-1},this.readRenderTargetPixels=function(T,Y,pe,ce,te,We,D,oe=0){if(!(T&&T.isWebGLRenderTarget)){vt("WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ye=_.get(T).__webglFramebuffer;if(T.isWebGLCubeRenderTarget&&D!==void 0&&(ye=ye[D]),ye){ee.bindFramebuffer(z.FRAMEBUFFER,ye);try{const L=T.textures[oe],H=L.format,j=L.type;if(!Je.textureFormatReadable(H)){vt("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Je.textureTypeReadable(j)){vt("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Y>=0&&Y<=T.width-ce&&pe>=0&&pe<=T.height-te&&(T.textures.length>1&&z.readBuffer(z.COLOR_ATTACHMENT0+oe),z.readPixels(Y,pe,ce,te,Pe.convert(H),Pe.convert(j),We))}finally{const L=X!==null?_.get(X).__webglFramebuffer:null;ee.bindFramebuffer(z.FRAMEBUFFER,L)}}},this.readRenderTargetPixelsAsync=async function(T,Y,pe,ce,te,We,D,oe=0){if(!(T&&T.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let ye=_.get(T).__webglFramebuffer;if(T.isWebGLCubeRenderTarget&&D!==void 0&&(ye=ye[D]),ye)if(Y>=0&&Y<=T.width-ce&&pe>=0&&pe<=T.height-te){ee.bindFramebuffer(z.FRAMEBUFFER,ye);const L=T.textures[oe],H=L.format,j=L.type;if(!Je.textureFormatReadable(H))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Je.textureTypeReadable(j))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const ge=z.createBuffer();z.bindBuffer(z.PIXEL_PACK_BUFFER,ge),z.bufferData(z.PIXEL_PACK_BUFFER,We.byteLength,z.STREAM_READ),T.textures.length>1&&z.readBuffer(z.COLOR_ATTACHMENT0+oe),z.readPixels(Y,pe,ce,te,Pe.convert(H),Pe.convert(j),0);const De=X!==null?_.get(X).__webglFramebuffer:null;ee.bindFramebuffer(z.FRAMEBUFFER,De);const Ye=z.fenceSync(z.SYNC_GPU_COMMANDS_COMPLETE,0);return z.flush(),await r_(z,Ye,4),z.bindBuffer(z.PIXEL_PACK_BUFFER,ge),z.getBufferSubData(z.PIXEL_PACK_BUFFER,0,We),z.deleteBuffer(ge),z.deleteSync(Ye),We}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(T,Y=null,pe=0){const ce=Math.pow(2,-pe),te=Math.floor(T.image.width*ce),We=Math.floor(T.image.height*ce),D=Y!==null?Y.x:0,oe=Y!==null?Y.y:0;W.setTexture2D(T,0),z.copyTexSubImage2D(z.TEXTURE_2D,pe,0,0,D,oe,te,We),ee.unbindTexture()};const Mi=z.createFramebuffer(),Ba=z.createFramebuffer();this.copyTextureToTexture=function(T,Y,pe=null,ce=null,te=0,We=null){We===null&&(te!==0?(Do("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),We=te,te=0):We=0);let D,oe,ye,L,H,j,ge,De,Ye;const xt=T.isCompressedTexture?T.mipmaps[We]:T.image;if(pe!==null)D=pe.max.x-pe.min.x,oe=pe.max.y-pe.min.y,ye=pe.isBox3?pe.max.z-pe.min.z:1,L=pe.min.x,H=pe.min.y,j=pe.isBox3?pe.min.z:0;else{const ei=Math.pow(2,-te);D=Math.floor(xt.width*ei),oe=Math.floor(xt.height*ei),T.isDataArrayTexture?ye=xt.depth:T.isData3DTexture?ye=Math.floor(xt.depth*ei):ye=1,L=0,H=0,j=0}ce!==null?(ge=ce.x,De=ce.y,Ye=ce.z):(ge=0,De=0,Ye=0);const pt=Pe.convert(Y.format),et=Pe.convert(Y.type);let Mt;Y.isData3DTexture?(W.setTexture3D(Y,0),Mt=z.TEXTURE_3D):Y.isDataArrayTexture||Y.isCompressedArrayTexture?(W.setTexture2DArray(Y,0),Mt=z.TEXTURE_2D_ARRAY):(W.setTexture2D(Y,0),Mt=z.TEXTURE_2D),z.pixelStorei(z.UNPACK_FLIP_Y_WEBGL,Y.flipY),z.pixelStorei(z.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Y.premultiplyAlpha),z.pixelStorei(z.UNPACK_ALIGNMENT,Y.unpackAlignment);const wt=z.getParameter(z.UNPACK_ROW_LENGTH),jn=z.getParameter(z.UNPACK_IMAGE_HEIGHT),Cs=z.getParameter(z.UNPACK_SKIP_PIXELS),Wn=z.getParameter(z.UNPACK_SKIP_ROWS),Ia=z.getParameter(z.UNPACK_SKIP_IMAGES);z.pixelStorei(z.UNPACK_ROW_LENGTH,xt.width),z.pixelStorei(z.UNPACK_IMAGE_HEIGHT,xt.height),z.pixelStorei(z.UNPACK_SKIP_PIXELS,L),z.pixelStorei(z.UNPACK_SKIP_ROWS,H),z.pixelStorei(z.UNPACK_SKIP_IMAGES,j);const Tt=T.isDataArrayTexture||T.isData3DTexture,Tn=Y.isDataArrayTexture||Y.isData3DTexture;if(T.isDepthTexture){const ei=_.get(T),vn=_.get(Y),An=_.get(ei.__renderTarget),sd=_.get(vn.__renderTarget);ee.bindFramebuffer(z.READ_FRAMEBUFFER,An.__webglFramebuffer),ee.bindFramebuffer(z.DRAW_FRAMEBUFFER,sd.__webglFramebuffer);for(let $r=0;$r<ye;$r++)Tt&&(z.framebufferTextureLayer(z.READ_FRAMEBUFFER,z.COLOR_ATTACHMENT0,_.get(T).__webglTexture,te,j+$r),z.framebufferTextureLayer(z.DRAW_FRAMEBUFFER,z.COLOR_ATTACHMENT0,_.get(Y).__webglTexture,We,Ye+$r)),z.blitFramebuffer(L,H,D,oe,ge,De,D,oe,z.DEPTH_BUFFER_BIT,z.NEAREST);ee.bindFramebuffer(z.READ_FRAMEBUFFER,null),ee.bindFramebuffer(z.DRAW_FRAMEBUFFER,null)}else if(te!==0||T.isRenderTargetTexture||_.has(T)){const ei=_.get(T),vn=_.get(Y);ee.bindFramebuffer(z.READ_FRAMEBUFFER,Mi),ee.bindFramebuffer(z.DRAW_FRAMEBUFFER,Ba);for(let An=0;An<ye;An++)Tt?z.framebufferTextureLayer(z.READ_FRAMEBUFFER,z.COLOR_ATTACHMENT0,ei.__webglTexture,te,j+An):z.framebufferTexture2D(z.READ_FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_2D,ei.__webglTexture,te),Tn?z.framebufferTextureLayer(z.DRAW_FRAMEBUFFER,z.COLOR_ATTACHMENT0,vn.__webglTexture,We,Ye+An):z.framebufferTexture2D(z.DRAW_FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_2D,vn.__webglTexture,We),te!==0?z.blitFramebuffer(L,H,D,oe,ge,De,D,oe,z.COLOR_BUFFER_BIT,z.NEAREST):Tn?z.copyTexSubImage3D(Mt,We,ge,De,Ye+An,L,H,D,oe):z.copyTexSubImage2D(Mt,We,ge,De,L,H,D,oe);ee.bindFramebuffer(z.READ_FRAMEBUFFER,null),ee.bindFramebuffer(z.DRAW_FRAMEBUFFER,null)}else Tn?T.isDataTexture||T.isData3DTexture?z.texSubImage3D(Mt,We,ge,De,Ye,D,oe,ye,pt,et,xt.data):Y.isCompressedArrayTexture?z.compressedTexSubImage3D(Mt,We,ge,De,Ye,D,oe,ye,pt,xt.data):z.texSubImage3D(Mt,We,ge,De,Ye,D,oe,ye,pt,et,xt):T.isDataTexture?z.texSubImage2D(z.TEXTURE_2D,We,ge,De,D,oe,pt,et,xt.data):T.isCompressedTexture?z.compressedTexSubImage2D(z.TEXTURE_2D,We,ge,De,xt.width,xt.height,pt,xt.data):z.texSubImage2D(z.TEXTURE_2D,We,ge,De,D,oe,pt,et,xt);z.pixelStorei(z.UNPACK_ROW_LENGTH,wt),z.pixelStorei(z.UNPACK_IMAGE_HEIGHT,jn),z.pixelStorei(z.UNPACK_SKIP_PIXELS,Cs),z.pixelStorei(z.UNPACK_SKIP_ROWS,Wn),z.pixelStorei(z.UNPACK_SKIP_IMAGES,Ia),We===0&&Y.generateMipmaps&&z.generateMipmap(Mt),ee.unbindTexture()},this.initRenderTarget=function(T){_.get(T).__webglFramebuffer===void 0&&W.setupRenderTarget(T)},this.initTexture=function(T){T.isCubeTexture?W.setTextureCube(T,0):T.isData3DTexture?W.setTexture3D(T,0):T.isDataArrayTexture||T.isCompressedArrayTexture?W.setTexture2DArray(T,0):W.setTexture2D(T,0),ee.unbindTexture()},this.resetState=function(){U=0,O=0,X=null,ee.reset(),je.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Ii}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const n=this.getContext();n.drawingBufferColorSpace=bt._getDrawingBufferColorSpace(e),n.unpackColorSpace=bt._getUnpackColorSpace()}}const Qg={type:"change"},Tp={type:"start"},l1={type:"end"},Nl=new wp,qg=new Mr,WM=Math.cos(70*a_.DEG2RAD),qt=new re,Nn=2*Math.PI,Ct={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},xu=1e-6;class GM extends V_{constructor(e,n=null){super(e,n),this.state=Ct.NONE,this.target=new re,this.cursor=new re,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:da.ROTATE,MIDDLE:da.DOLLY,RIGHT:da.PAN},this.touches={ONE:na.ROTATE,TWO:na.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new re,this._lastQuaternion=new Ss,this._lastTargetPosition=new re,this._quat=new Ss().setFromUnitVectors(e.up,new re(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Sg,this._sphericalDelta=new Sg,this._scale=1,this._panOffset=new re,this._rotateStart=new it,this._rotateEnd=new it,this._rotateDelta=new it,this._panStart=new it,this._panEnd=new it,this._panDelta=new it,this._dollyStart=new it,this._dollyEnd=new it,this._dollyDelta=new it,this._dollyDirection=new re,this._mouse=new it,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=VM.bind(this),this._onPointerDown=HM.bind(this),this._onPointerUp=KM.bind(this),this._onContextMenu=JM.bind(this),this._onMouseWheel=$M.bind(this),this._onKeyDown=XM.bind(this),this._onTouchStart=YM.bind(this),this._onTouchMove=ZM.bind(this),this._onMouseDown=QM.bind(this),this._onMouseMove=qM.bind(this),this._interceptControlDown=e5.bind(this),this._interceptControlUp=t5.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(Qg),this.update(),this.state=Ct.NONE}update(e=null){const n=this.object.position;qt.copy(n).sub(this.target),qt.applyQuaternion(this._quat),this._spherical.setFromVector3(qt),this.autoRotate&&this.state===Ct.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let i=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(i)&&isFinite(r)&&(i<-Math.PI?i+=Nn:i>Math.PI&&(i-=Nn),r<-Math.PI?r+=Nn:r>Math.PI&&(r-=Nn),i<=r?this._spherical.theta=Math.max(i,Math.min(r,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(i+r)/2?Math.max(i,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const a=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=a!=this._spherical.radius}if(qt.setFromSpherical(this._spherical),qt.applyQuaternion(this._quatInverse),n.copy(this.target).add(qt),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let a=null;if(this.object.isPerspectiveCamera){const l=qt.length();a=this._clampDistance(l*this._scale);const c=l-a;this.object.position.addScaledVector(this._dollyDirection,c),this.object.updateMatrixWorld(),s=!!c}else if(this.object.isOrthographicCamera){const l=new re(this._mouse.x,this._mouse.y,0);l.unproject(this.object);const c=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=c!==this.object.zoom;const d=new re(this._mouse.x,this._mouse.y,0);d.unproject(this.object),this.object.position.sub(d).add(l),this.object.updateMatrixWorld(),a=qt.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;a!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(a).add(this.object.position):(Nl.origin.copy(this.object.position),Nl.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(Nl.direction))<WM?this.object.lookAt(this.target):(qg.setFromNormalAndCoplanarPoint(this.object.up,this.target),Nl.intersectPlane(qg,this.target))))}else if(this.object.isOrthographicCamera){const a=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),a!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,s||this._lastPosition.distanceToSquared(this.object.position)>xu||8*(1-this._lastQuaternion.dot(this.object.quaternion))>xu||this._lastTargetPosition.distanceToSquared(this.target)>xu?(this.dispatchEvent(Qg),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Nn/60*this.autoRotateSpeed*e:Nn/60/60*this.autoRotateSpeed}_getZoomScale(e){const n=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*n)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,n){qt.setFromMatrixColumn(n,0),qt.multiplyScalar(-e),this._panOffset.add(qt)}_panUp(e,n){this.screenSpacePanning===!0?qt.setFromMatrixColumn(n,1):(qt.setFromMatrixColumn(n,0),qt.crossVectors(this.object.up,qt)),qt.multiplyScalar(e),this._panOffset.add(qt)}_pan(e,n){const i=this.domElement;if(this.object.isPerspectiveCamera){const r=this.object.position;qt.copy(r).sub(this.target);let s=qt.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*s/i.clientHeight,this.object.matrix),this._panUp(2*n*s/i.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrix),this._panUp(n*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,n){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const i=this.domElement.getBoundingClientRect(),r=e-i.left,s=n-i.top,a=i.width,l=i.height;this._mouse.x=r/a*2-1,this._mouse.y=-(s/l)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const n=this.domElement;this._rotateLeft(Nn*this._rotateDelta.x/n.clientHeight),this._rotateUp(Nn*this._rotateDelta.y/n.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let n=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(Nn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),n=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-Nn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),n=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(Nn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),n=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-Nn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),n=!0;break}n&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),i=.5*(e.pageX+n.x),r=.5*(e.pageY+n.y);this._rotateStart.set(i,r)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),i=.5*(e.pageX+n.x),r=.5*(e.pageY+n.y);this._panStart.set(i,r)}}_handleTouchStartDolly(e){const n=this._getSecondPointerPosition(e),i=e.pageX-n.x,r=e.pageY-n.y,s=Math.sqrt(i*i+r*r);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),r=.5*(e.pageX+i.x),s=.5*(e.pageY+i.y);this._rotateEnd.set(r,s)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const n=this.domElement;this._rotateLeft(Nn*this._rotateDelta.x/n.clientHeight),this._rotateUp(Nn*this._rotateDelta.y/n.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),i=.5*(e.pageX+n.x),r=.5*(e.pageY+n.y);this._panEnd.set(i,r)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const n=this._getSecondPointerPosition(e),i=e.pageX-n.x,r=e.pageY-n.y,s=Math.sqrt(i*i+r*r);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const a=(e.pageX+n.x)*.5,l=(e.pageY+n.y)*.5;this._updateZoomParameters(a,l)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let n=0;n<this._pointers.length;n++)if(this._pointers[n]==e.pointerId){this._pointers.splice(n,1);return}}_isTrackingPointer(e){for(let n=0;n<this._pointers.length;n++)if(this._pointers[n]==e.pointerId)return!0;return!1}_trackPointer(e){let n=this._pointerPositions[e.pointerId];n===void 0&&(n=new it,this._pointerPositions[e.pointerId]=n),n.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const n=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[n]}_customWheelEvent(e){const n=e.deltaMode,i={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(n){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(i.deltaY*=10),i}}function HM(t){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(t.pointerId),this.domElement.ownerDocument.addEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(t)&&(this._addPointer(t),t.pointerType==="touch"?this._onTouchStart(t):this._onMouseDown(t)))}function VM(t){this.enabled!==!1&&(t.pointerType==="touch"?this._onTouchMove(t):this._onMouseMove(t))}function KM(t){switch(this._removePointer(t),this._pointers.length){case 0:this.domElement.releasePointerCapture(t.pointerId),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(l1),this.state=Ct.NONE;break;case 1:const e=this._pointers[0],n=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:n.x,pageY:n.y});break}}function QM(t){let e;switch(t.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case da.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(t),this.state=Ct.DOLLY;break;case da.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(t),this.state=Ct.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(t),this.state=Ct.ROTATE}break;case da.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(t),this.state=Ct.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(t),this.state=Ct.PAN}break;default:this.state=Ct.NONE}this.state!==Ct.NONE&&this.dispatchEvent(Tp)}function qM(t){switch(this.state){case Ct.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(t);break;case Ct.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(t);break;case Ct.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(t);break}}function $M(t){this.enabled===!1||this.enableZoom===!1||this.state!==Ct.NONE||(t.preventDefault(),this.dispatchEvent(Tp),this._handleMouseWheel(this._customWheelEvent(t)),this.dispatchEvent(l1))}function XM(t){this.enabled!==!1&&this._handleKeyDown(t)}function YM(t){switch(this._trackPointer(t),this._pointers.length){case 1:switch(this.touches.ONE){case na.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(t),this.state=Ct.TOUCH_ROTATE;break;case na.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(t),this.state=Ct.TOUCH_PAN;break;default:this.state=Ct.NONE}break;case 2:switch(this.touches.TWO){case na.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(t),this.state=Ct.TOUCH_DOLLY_PAN;break;case na.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(t),this.state=Ct.TOUCH_DOLLY_ROTATE;break;default:this.state=Ct.NONE}break;default:this.state=Ct.NONE}this.state!==Ct.NONE&&this.dispatchEvent(Tp)}function ZM(t){switch(this._trackPointer(t),this.state){case Ct.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(t),this.update();break;case Ct.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(t),this.update();break;case Ct.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(t),this.update();break;case Ct.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(t),this.update();break;default:this.state=Ct.NONE}}function JM(t){this.enabled!==!1&&t.preventDefault()}function e5(t){t.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function t5(t){t.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const $g={staunton:{id:"staunton",name:"Staunton Classic",scale:.72,profiles:{p:[[0,0],[.42,0],[.4,.08],[.28,.16],[.3,.42],[.22,.56],[.26,.68],[.2,.82],[0,.82]],r:[[0,0],[.48,0],[.45,.1],[.32,.18],[.35,.52],[.3,.78],[.34,.86],[.38,.94],[.32,.98],[0,.98]],n:[[0,0],[.48,0],[.44,.1],[.3,.18],[.33,.54],[.26,.78],[.3,.94],[.22,1.06],[0,1.06]],b:[[0,0],[.48,0],[.44,.1],[.3,.18],[.33,.58],[.24,.82],[.28,1],[.16,1.18],[.08,1.24],[0,1.24]],q:[[0,0],[.5,0],[.46,.1],[.3,.2],[.35,.64],[.28,.92],[.32,1.12],[.2,1.34],[.12,1.4],[0,1.4]],k:[[0,0],[.52,0],[.48,.12],[.32,.22],[.38,.68],[.32,.98],[.38,1.2],[.28,1.44],[.1,1.52],[0,1.52]]}},modern:{id:"modern",name:"Modern Minimal",scale:.75,profiles:{p:[[0,0],[.32,0],[.32,.45],[.28,.5],[.28,.65],[.18,.8],[0,.8]],r:[[0,0],[.38,0],[.38,.65],[.42,.65],[.42,.85],[.32,.85],[.32,.9],[0,.9]],n:[[0,0],[.36,0],[.36,.3],[.3,.35],[.3,.7],[.22,.95],[.15,1.05],[0,1.05]],b:[[0,0],[.36,0],[.36,.3],[.3,.35],[.26,.7],[.18,.95],[.1,1.15],[0,1.15]],q:[[0,0],[.4,0],[.4,.3],[.32,.38],[.28,.85],[.18,1.1],[.22,1.2],[.18,1.3],[0,1.3]],k:[[0,0],[.42,0],[.42,.35],[.34,.42],[.34,.9],[.24,1.1],[.28,1.25],[.12,1.35],[.12,1.5],[0,1.5]]}},medieval:{id:"medieval",name:"Medieval Castle",scale:.7,profiles:{p:[[0,0],[.45,0],[.45,.12],[.35,.18],[.35,.35],[.4,.4],[.4,.55],[.3,.62],[.32,.75],[.22,.85],[0,.85]],r:[[0,0],[.55,0],[.55,.15],[.42,.22],[.42,.55],[.48,.58],[.48,.75],[.55,.78],[.55,.95],[.4,.95],[0,.95]],n:[[0,0],[.5,0],[.5,.15],[.38,.22],[.4,.45],[.48,.55],[.42,.7],[.35,.85],[.28,1],[.18,1.08],[0,1.08]],b:[[0,0],[.5,0],[.5,.15],[.38,.22],[.38,.5],[.32,.62],[.35,.8],[.25,1],[.3,1.15],[.15,1.28],[0,1.28]],q:[[0,0],[.55,0],[.55,.18],[.4,.28],[.42,.65],[.35,.82],[.4,1],[.45,1.15],[.35,1.3],[.25,1.42],[0,1.42]],k:[[0,0],[.58,0],[.58,.2],[.42,.3],[.45,.7],[.38,.9],[.42,1.1],[.48,1.25],[.38,1.4],[.2,1.55],[.08,1.65],[0,1.65]]}},baroque:{id:"baroque",name:"Baroque Ornate",scale:.68,profiles:{p:[[0,0],[.44,0],[.46,.06],[.38,.14],[.32,.2],[.34,.36],[.28,.48],[.32,.58],[.26,.7],[.3,.78],[.22,.88],[0,.88]],r:[[0,0],[.52,0],[.54,.08],[.44,.18],[.36,.26],[.4,.5],[.34,.7],[.38,.82],[.44,.9],[.4,.98],[0,.98]],n:[[0,0],[.52,0],[.54,.08],[.42,.18],[.34,.28],[.38,.52],[.3,.74],[.34,.88],[.26,1.02],[.3,1.1],[.2,1.18],[0,1.18]],b:[[0,0],[.52,0],[.54,.08],[.42,.18],[.34,.28],[.38,.56],[.28,.78],[.32,.94],[.22,1.12],[.26,1.22],[.14,1.34],[0,1.34]],q:[[0,0],[.56,0],[.58,.1],[.44,.22],[.36,.32],[.42,.62],[.32,.88],[.38,1.06],[.28,1.26],[.34,1.38],[.2,1.52],[0,1.52]],k:[[0,0],[.58,0],[.6,.12],[.46,.24],[.38,.34],[.44,.68],[.36,.96],[.42,1.16],[.32,1.38],[.38,1.5],[.24,1.64],[.12,1.72],[0,1.72]]}},abstract:{id:"abstract",name:"Abstract Geometric",scale:.72,profiles:{p:[[0,0],[.35,0],[.35,.55],[.25,.6],[.25,.75],[0,.75]],r:[[0,0],[.48,0],[.48,.25],[.38,.25],[.38,.5],[.45,.5],[.45,.75],[.35,.75],[.35,.9],[0,.9]],n:[[0,0],[.42,0],[.42,.2],[.5,.35],[.35,.6],[.4,.8],[.25,1],[0,1]],b:[[0,0],[.4,0],[.4,.2],[.3,.4],[.38,.7],[.2,1],[.08,1.2],[0,1.2]],q:[[0,0],[.45,0],[.45,.2],[.35,.35],[.42,.55],[.32,.75],[.38,.95],[.22,1.2],[.15,1.35],[0,1.35]],k:[[0,0],[.48,0],[.48,.25],[.38,.4],[.38,.8],[.3,1],[.3,1.25],[.18,1.45],[.08,1.55],[0,1.55]]}},lewis:{id:"lewis",name:"Lewis Viking",scale:.65,profiles:{p:[[0,0],[.48,0],[.5,.1],[.45,.25],[.42,.45],[.38,.55],[.35,.7],[.28,.82],[.18,.9],[0,.9]],r:[[0,0],[.55,0],[.58,.12],[.5,.28],[.48,.5],[.52,.62],[.48,.78],[.42,.92],[.35,1.02],[0,1.02]],n:[[0,0],[.52,0],[.55,.15],[.48,.3],[.52,.48],[.45,.68],[.5,.85],[.38,1.02],[.28,1.12],[0,1.12]],b:[[0,0],[.55,0],[.58,.15],[.48,.32],[.45,.55],[.5,.72],[.42,.92],[.35,1.1],[.25,1.25],[0,1.25]],q:[[0,0],[.58,0],[.62,.18],[.52,.35],[.5,.6],[.55,.78],[.48,1],[.42,1.2],[.32,1.38],[.18,1.48],[0,1.48]],k:[[0,0],[.62,0],[.65,.2],[.55,.38],[.52,.65],[.58,.85],[.5,1.08],[.45,1.28],[.35,1.48],[.22,1.62],[.1,1.72],[0,1.72]]}}},gf={classic_ebony_ivory:{id:"classic_ebony_ivory",name:"Classic Staunton",geometryStyle:"staunton",white:{color:15921127,roughness:.32,metalness:.08,clearcoat:.6,clearcoatRoughness:.2},black:{color:1710618,roughness:.35,metalness:.12,clearcoat:.7,clearcoatRoughness:.2},accent:{color:13938487,roughness:.25,metalness:.7}},modern_matte:{id:"modern_matte",name:"Modern Minimal",geometryStyle:"modern",white:{color:16448250,roughness:.85,metalness:.02,clearcoat:0},black:{color:2763306,roughness:.88,metalness:.02,clearcoat:0},accent:{color:12040119,roughness:.7,metalness:.2}},medieval_stone:{id:"medieval_stone",name:"Medieval Castle",geometryStyle:"medieval",white:{color:13946820,roughness:.75,metalness:0,clearcoat:.1},black:{color:3814962,roughness:.8,metalness:0,clearcoat:.1},accent:{color:9139029,roughness:.6,metalness:.1}},wood_rosewood:{id:"wood_rosewood",name:"Boxwood & Rosewood",geometryStyle:"staunton",white:{color:15258792,roughness:.65,metalness:0,clearcoat:.3,clearcoatRoughness:.4},black:{color:4860970,roughness:.6,metalness:0,clearcoat:.35,clearcoatRoughness:.35},accent:{color:9139029,roughness:.5,metalness:.1}},marble_classic:{id:"marble_classic",name:"Baroque Marble",geometryStyle:"baroque",white:{color:16119280,roughness:.25,metalness:0,clearcoat:.8,clearcoatRoughness:.15},black:{color:1710618,roughness:.2,metalness:.05,clearcoat:.85,clearcoatRoughness:.1},accent:{color:12105912,roughness:.3,metalness:.1}},gold_silver:{id:"gold_silver",name:"Abstract Metal",geometryStyle:"abstract",white:{color:13938487,roughness:.22,metalness:.95,clearcoat:.4,clearcoatRoughness:.2},black:{color:12632256,roughness:.25,metalness:.92,clearcoat:.35,clearcoatRoughness:.25},accent:{color:16777215,roughness:.5,metalness:.2}},lewis_antique:{id:"lewis_antique",name:"Lewis Viking",geometryStyle:"lewis",white:{color:16115400,roughness:.7,metalness:0,clearcoat:.2,clearcoatRoughness:.5},black:{color:7029795,roughness:.72,metalness:0,clearcoat:.15,clearcoatRoughness:.6},accent:{color:9139029,roughness:.6,metalness:.05}},jade_obsidian:{id:"jade_obsidian",name:"Jade & Obsidian",geometryStyle:"modern",white:{color:43115,roughness:.3,metalness:0,clearcoat:.7,clearcoatRoughness:.2,transmission:.15,thickness:.5},black:{color:657930,roughness:.15,metalness:.1,clearcoat:.9,clearcoatRoughness:.1},accent:{color:13938487,roughness:.25,metalness:.7}},glass_crystal:{id:"glass_crystal",name:"Crystal Glass",geometryStyle:"abstract",white:{color:16777215,roughness:.08,metalness:0,transmission:.92,thickness:.8,ior:1.52,clearcoat:.1},black:{color:1710638,roughness:.1,metalness:0,transmission:.75,thickness:.8,ior:1.5,clearcoat:.15},accent:{color:16777215,roughness:.1,metalness:0}}};function n5(){return Object.values(gf).map(t=>({id:t.id,name:t.name}))}function i5(t){return gf[t]||gf.classic_ebony_ivory}function r5(t){return $g[t]||$g.staunton}function s5({chess:t,size:e=560,orientation:n="w",interactive:i=!0,onMove:r,lastMove:s=null,themeId:a="carrara_gold",pieceSetId:l="classic_ebony_ivory",cameraPreset:c="straight",animations:d=!0}){const h=N.useRef(null),f=N.useRef(null),p=e==="full",m=N.useMemo(()=>Ey(a),[a]),y=N.useMemo(()=>i5(l),[l]),x=N.useMemo(()=>r5(y.geometryStyle||"staunton"),[y]),g=N.useRef(new Map),u=N.useRef(new Map),v=N.useRef({selected:null,legal:[],hover:null});return N.useEffect(()=>{if(!h.current)return;let w=(()=>{if(p){const ie=h.current.getBoundingClientRect();return{width:ie.width||window.innerWidth,height:ie.height||window.innerHeight}}return{width:e,height:e}})();const R=new A_;R.background=new dt(657931);const C=new si(45,w.width/w.height,.1,200);(()=>{if(c==="top"){const Se=n==="w"?4:-4;C.position.set(0,12,Se),C.lookAt(0,0,0),C.up.set(0,1,0)}else c==="angled"?(n==="w"?C.position.set(8,10,12):C.position.set(-8,10,-12),C.lookAt(0,0,0),C.up.set(0,1,0)):(n==="w"?C.position.set(0,9,14):C.position.set(0,9,-14),C.lookAt(0,0,0),C.up.set(0,1,0))})();const B=new jM({antialias:!0,alpha:!1});B.setPixelRatio(Math.min(window.devicePixelRatio||1,2)),B.setSize(w.width,w.height),B.shadowMap.enabled=!0,B.shadowMap.type=Cy;const S=new GM(C,B.domElement);S.enablePan=!1,S.enableDamping=!0,S.dampingFactor=.08,S.minDistance=12,S.maxDistance=22,S.maxPolarAngle=Math.PI*.48,S.minPolarAngle=Math.PI*.2;const k=new du(16777215,1);k.position.set(12,18,10),k.castShadow=!0,k.shadow.mapSize.set(2048,2048),k.shadow.camera.near=2,k.shadow.camera.far=60,k.shadow.camera.left=-18,k.shadow.camera.right=18,k.shadow.camera.top=18,k.shadow.camera.bottom=-18;const U=new du(16777215,.35);U.position.set(-12,10,-10);const O=new du(16777215,.25);O.position.set(-2,16,18);const X=new W_(16777215,.25);R.add(k,U,O,X);const K=new ia;R.add(K);const $=new sc({color:new dt(m.frame),roughness:.55,metalness:.15}),q=new Dn(new zr(10.2,.7,10.2),$);q.position.y=-.35,q.receiveShadow=!0,q.castShadow=!1,K.add(q);const J=new sc({color:new dt(m.light),roughness:.75,metalness:.05}),V=new sc({color:new dt(m.dark),roughness:.75,metalness:.05}),ue=new zr(1,.12,1),F=new Map,de=xh("w");for(const ie of de){const{file:Se,rank:we}=no(ie),ve=Ry(ie),Ee=new Dn(ue,ve?V:J);Ee.position.set(Se-3.5,-.05,-(we-3.5)),Ee.receiveShadow=!0,Ee.castShadow=!1,Ee.userData={square:ie},K.add(Ee),F.set(ie,Ee)}const Te=new Vo(1.02,1.02),xe=new Dc({color:new dt(13938487),transparent:!0,opacity:0,side:Ni}),le=new Dn(Te,xe);le.rotation.x=-Math.PI/2,le.position.y=.02,K.add(le);const Re=new Dc({color:new dt(13938487),transparent:!0,opacity:0}),Q=new Rp(.14,24),ae=new Map;for(const ie of de){const Se=new Dn(Q,Re.clone());Se.rotation.x=-Math.PI/2;const{file:we,rank:ve}=no(ie);Se.position.set(we-3.5,.025,-(ve-3.5)),Se.visible=!1,K.add(Se),ae.set(ie,Se)}const Me=ie=>new F_({color:new dt(ie.color),roughness:ie.roughness??.5,metalness:ie.metalness??0,clearcoat:ie.clearcoat??0,clearcoatRoughness:ie.clearcoatRoughness??.5,transmission:ie.transmission??0,thickness:ie.thickness??0,ior:ie.ior??1.5}),ze=Me(y.white),se=Me(y.black),ke=new Map,Ge=(ie,Se=48)=>{const we=ie.map(Ee=>new it(Ee[0],Ee[1])),ve=new Ep(we,Se);return ve.computeVertexNormals(),ve},Oe=ie=>{const Se=`${x.id}_${ie}`;if(ke.has(Se))return ke.get(Se);const we=x.profiles[ie];if(!we)return console.warn(`No profile for piece type ${ie} in style ${x.id}`),new zr(.5,.5,.5);const ve=Ge(we);return ve.scale(x.scale,x.scale,x.scale),ve.computeBoundingBox(),ke.set(Se,ve),ve},Ve=new ia;K.add(Ve);const Ze=new Map,Ue=()=>{Ve.clear(),Ze.clear(),u.current.clear();for(const ie of de){const Se=t.get(ie);if(!Se)continue;const we=Oe(Se.type),ve=Se.color==="w"?ze:se,Ee=new Dn(we,ve),{file:he,rank:Z}=no(ie);Ee.position.set(he-3.5,.06,-(Z-3.5)),Ee.castShadow=!0,Ee.receiveShadow=!1,Ee.userData={square:ie,piece:Se},Ve.add(Ee),Ze.set(ie,Ee),u.current.set(`${Se.color}${Se.type}`,{square:ie})}},tt=new Map,z=()=>{tt.clear();const ie={w:{p:0,n:0,b:0,r:0,q:0,k:0},b:{p:0,n:0,b:0,r:0,q:0,k:0}};for(const Se of de){const we=t.get(Se);if(!we)continue;ie[we.color][we.type]+=1;const ve=`${we.color}${we.type}#${ie[we.color][we.type]}`;tt.set(Se,ve)}},ht=ie=>{const{file:Se,rank:we}=no(ie);return new re(Se-3.5,.06,-(we-3.5))};z(),Ue(),u.current.clear();{const ie={w:{p:0,n:0,b:0,r:0,q:0,k:0},b:{p:0,n:0,b:0,r:0,q:0,k:0}};for(const Se of de){const we=t.get(Se);if(!we)continue;ie[we.color][we.type]+=1;const ve=`${we.color}${we.type}#${ie[we.color][we.type]}`;u.current.set(ve,{square:Se})}}const Xe=new H_,Je=new it,ee=()=>{for(const ie of ae.values())ie.visible=!1,ie.material.opacity=0},P=ie=>{ee();for(const Se of ie){const we=ae.get(Se);we&&(we.visible=!0,we.material.opacity=.55)}},_=ie=>{if(v.current.selected=ie,!ie){le.material.opacity=0,P([]);return}const Se=ht(ie);le.position.set(Se.x,.022,Se.z),le.material.opacity=.35;let we=[];try{we=t.moves({square:ie,verbose:!0}).map(ve=>ve.to)}catch{we=[]}v.current.legal=we,P(we)},W=ie=>{const Se=v.current.selected,we=v.current.legal||[];return!Se||!we.includes(ie)?!1:(r==null||r({from:Se,to:ie,promotion:"q"}),_(null),!0)},M=ie=>{var Ke,G,Be;if(!i)return;const Se=B.domElement.getBoundingClientRect(),we=(ie.clientX-Se.left)/Se.width*2-1,ve=-((ie.clientY-Se.top)/Se.height*2-1);Je.set(we,ve),Xe.setFromCamera(Je,C);const Ee=Xe.intersectObjects([...F.values(),...Ze.values()],!0);if(!Ee.length)return;const he=Ee[0].object,Z=((Ke=he.userData)==null?void 0:Ke.square)||((Be=(G=he.parent)==null?void 0:G.userData)==null?void 0:Be.square);if(!Z)return;const me=t.get(Z);W(Z)||(me&&me.color===t.turn()?_(Z):_(null))};B.domElement.addEventListener("pointerdown",M),h.current.innerHTML="",h.current.appendChild(B.domElement);const _e=new ResizeObserver(()=>{const ie=h.current;if(ie){if(p){const Se=ie.getBoundingClientRect(),we=Se.width||window.innerWidth,ve=Se.height||window.innerHeight;B.setSize(we,ve),C.aspect=we/ve}else B.setSize(e,e),C.aspect=1;C.updateProjectionMatrix()}});_e.observe(h.current);const ne=ie=>1-Math.pow(1-ie,3),Ie=()=>{if(S.update(),g.current.size>0){const ie=performance.now();for(const[Se,we]of g.current.entries()){const ve=Math.min(1,(ie-we.t0)/we.durMs),Ee=ne(ve);we.mesh.position.lerpVectors(we.from,we.to,Ee);const he=Math.sin(Math.PI*ve)*we.lift;we.mesh.position.y=.06+he,ve>=1&&(we.mesh.position.copy(we.to),we.mesh.position.y=.06,g.current.delete(Se))}}B.render(R,C),f.current=requestAnimationFrame(Ie)};return Ie(),()=>{B.domElement.removeEventListener("pointerdown",M),_e.disconnect(),cancelAnimationFrame(f.current),S.dispose(),B.dispose(),ue.dispose(),Te.dispose(),Q.dispose(),J.dispose(),V.dispose(),$.dispose();for(const ie of ke.values())ie.dispose();ze.dispose(),se.dispose()}},[e,p,n,c,l,a]),N.useEffect(()=>{if(!h.current)return;const b=new CustomEvent("cm_board3d_state_changed");h.current.dispatchEvent(b)},[t,s]),o.jsx("div",{ref:h,style:p?{width:"100%",height:"100%",position:"absolute",inset:0}:{width:e,height:e}})}const a5={russian_chess:{id:"russian_chess",title:"Russian Chess",author:"Bruce Pandolfini",description:"Learn from the greatest Soviet and Russian champions. This book explores the distinctive style of Russian chess masters, emphasizing strategic planning, patience, and deep calculation. Covers the light-square strategy, minority attack, prophylactic thinking, attacking play, and endgame technique.",coverColor:"#8B0000",chapters:3}},c1=[{id:"russian_chess_ch1_lesson1",bookId:"russian_chess",chapter:1,lessonNumber:1,title:"The Light Square Strategy",subtitle:"Karpov's Positional Mastery",introduction:`In Russian chess thinking, the concept of "color complexes" is fundamental. A color complex refers to controlling squares of one coloreither light or darkthroughout the board.

When you dominate a color complex, you create permanent weaknesses in your opponent's position. Pieces become restricted, pawns become targets, and the king often lacks safe squares.

Anatoly Karpov was perhaps the greatest master of light-square strategy. In this lesson, we examine his classic victory over Viktor Korchnoi from their 1978 World Championship match.

**Key Concepts:**
 Trading the light-squared bishops early
 Placing pawns on dark squares to control light squares
 Using knights to occupy weak light squares
 The "Karpov squeeze" - slowly improving piece placement`,concepts:["Light square weakness","Color complex domination","Piece coordination","Prophylactic thinking","The Karpov squeeze"],game:{white:"Anatoly Karpov",black:"Viktor Korchnoi",event:"World Championship",site:"Baguio City",year:1978,result:"1-0",opening:"Nimzo-Indian Defense",pgn:"1. d4 Nf6 2. c4 e6 3. Nc3 Bb4 4. e3 c5 5. Nge2 d5 6. a3 Bxc3+ 7. Nxc3 cxd4 8. exd4 dxc4 9. Bxc4 Nc6 10. Be3 O-O 11. O-O b6 12. Qd3 Bb7 13. Rad1 Rc8 14. Bb5 Na5 15. Bg5 h6 16. Bh4 Rxc3 17. bxc3 Qc7 18. Bd6 Qxc3 19. Qxc3 Nxc3 20. Bxf8 Nxd1 21. Rxd1 Kxf8 22. Rc1 Ke7 23. Kf1 g5 24. Ke2 Kd6 25. Kd3 Nc4 26. Bxc4 Bxg2 27. Rg1 Bh3 28. Rxg5 Bg4 29. f3 Bf5+ 30. Kc3 hxg5 31. Kb4 a6 32. Ka5 Kc7 33. d5 exd5 34. Bxd5 Kb7 35. Bc6+ Ka7 36. Bd5 Kb7 37. Bf7 Be6 38. Bxe6 fxe6 39. Kxa6 1-0"},annotations:{0:"The starting position. Karpov will demonstrate his legendary ability to exploit light-square weaknesses.",6:"3. Nc3 Bb4 - The Nimzo-Indian Defense. Black pins the knight and challenges White's center.",12:"6. a3 Bxc3+ - The critical moment. Black gives up the bishop pair. Black keeps the DARK-squared bishop, meaning Black's LIGHT squares will be permanently weak!",20:"10. Be3 O-O - Both sides develop. White has BOTH bishops, Black has only the dark-squared one.",28:"14. Bb5! - Karpov's bishop targets weak light squares on c6 and a6. Black's bishop cannot challenge it.",36:"18. Bd6! - Beautiful. The bishop dominates from d6, controlling c7 and e7.",52:"26. Bxc4! - After this trade, Black has NO pieces that can control light squares.",66:"33. d5! - The breakthrough. Karpov's passed pawn decides the game.",78:"39. Kxa6 1-0 - Korchnoi resigns. A masterclass in light-square domination."},quizPositions:[{afterMove:12,question:"Black just played 6...Bxc3+. Why is this exchange strategically significant?",hint:"Think about which bishop Black keeps.",answer:"Black gives up the light-squared bishop and keeps the dark-squared one. This means Black will have permanent weaknesses on light squares."},{afterMove:28,question:"White just played 14. Bb5. What makes this bishop so powerful?",hint:"Consider which enemy piece could challenge this bishop.",answer:"Black's remaining bishop is dark-squared, so it can NEVER challenge the bishop on b5."}],conclusion:`This game demonstrates the power of light-square strategy. By trading off Black's light-squared bishop early, Karpov created a permanent weakness that persisted throughout the entire game.

**Key Takeaways:**
1. When your opponent lacks a bishop of one color, place your pawns on that color
2. Knights are powerful on squares the opponent's bishop cannot reach
3. In endgames, these color advantages become decisive`},{id:"russian_chess_ch1_lesson2",bookId:"russian_chess",chapter:1,lessonNumber:2,title:"The Minority Attack",subtitle:"Botvinnik's Strategic Brilliance",introduction:`The minority attack is one of the most important strategic concepts in chess. Russian players perfected it over decades of study.

A "minority attack" occurs when you advance fewer pawns against a larger pawn chain. The goal is NOT to win materialit's to CREATE WEAKNESSES.

In this lesson, we examine Mikhail Botvinnik's legendary victory over Jose Raul Capablanca from the 1938 AVRO tournament.

**Key Concepts:**
 Advance b4-b5 to force pawn exchanges
 Create an isolated or backward c-pawn
 Pressure the newly created weakness
 Convert the advantage in the endgame`,concepts:["Minority attack","Pawn structure","Creating weaknesses","Long-term pressure"],game:{white:"Mikhail Botvinnik",black:"Jose Raul Capablanca",event:"AVRO Tournament",site:"Netherlands",year:1938,result:"1-0",opening:"Nimzo-Indian Defense",pgn:"1. d4 Nf6 2. c4 e6 3. Nc3 Bb4 4. e3 d5 5. a3 Bxc3+ 6. bxc3 c5 7. cxd5 exd5 8. Bd3 O-O 9. Ne2 b6 10. O-O Ba6 11. Bxa6 Nxa6 12. Bb2 Qd7 13. a4 Rfe8 14. Qd3 c4 15. Qc2 Nb8 16. Rae1 Nc6 17. Ng3 Na5 18. f3 Nb3 19. e4 Qxa4 20. e5 Nd7 21. Qf2 g6 22. f4 f5 23. exf6 Nxf6 24. f5 Rxe1 25. Rxe1 Re8 26. Re6 Rxe6 27. fxe6 Kg7 28. Qf4 Qe8 29. Qe5 Qe7 30. Ba3 Qxa3 31. Nh5+ gxh5 32. Qg5+ Kf8 33. Qxf6+ Kg8 34. e7 Qc1+ 35. Kf2 Qc2+ 36. Kg3 Qd3+ 37. Kh4 Qe4+ 38. Kxh5 Qe2+ 39. Kh4 Qe4+ 40. g4 Qe1+ 41. Kh5 1-0"},annotations:{0:"One of the most famous games in chess history. Botvinnik defeats the legendary Capablanca.",10:"5. a3 Bxc3+ 6. bxc3 - White gets the semi-open b-file for the minority attack.",26:"13. a4! - The minority attack begins. White will play a4-a5.",38:"19. e4! - The breakthrough. Botvinnik opens the position when his pieces are optimally placed.",52:"26. Re6! - A brilliant sacrifice. The e-pawn will become decisive.",60:"30. Ba3! Qxa3 31. Nh5+! - The combination begins.",82:"41. Kh5 1-0 - One of the greatest games ever played."},quizPositions:[{afterMove:26,question:"What is the purpose of 13. a4?",hint:"Think about the queenside pawns.",answer:"This starts the minority attack. White plans a4-a5, forcing exchanges that create weaknesses in Black's pawn structure."}],conclusion:`Botvinnik's victory over Capablanca demonstrated that systematic preparation and strategic understanding could overcome natural talent.

**Key Takeaways:**
1. The minority attack creates permanent weaknesses
2. Open the position when your pieces are better coordinated  
3. Passed pawns are worth material sacrifices`},{id:"russian_chess_ch2_lesson1",bookId:"russian_chess",chapter:2,lessonNumber:1,title:"The Art of Defense",subtitle:"Petrosian's Prophylactic Thinking",introduction:`Tigran Petrosian was known as "Iron Tigran" for his impenetrable defensive style. Unlike tactical players who seek brilliant attacks, Petrosian focused on preventing his opponent's plans before they could develop.

This concept"prophylaxis"became a cornerstone of Soviet chess training. The idea is simple: before making your move, ask "What does my opponent want to do?" Then prevent it.

In this lesson, we examine Petrosian's famous victory over Boris Spassky, where he demonstrates how defense can become the strongest form of attack.

**Key Concepts:**
 Prophylactic thinking - preventing opponent's plans
 The exchange sacrifice - giving up material for positional compensation
 Blockade - controlling key squares to restrict enemy pieces
 Patience - waiting for the right moment to strike`,concepts:["Prophylaxis","Exchange sacrifice","Positional compensation","Blockade strategy","Patience in chess"],game:{white:"Tigran Petrosian",black:"Boris Spassky",event:"World Championship",site:"Moscow",year:1966,result:"1-0",opening:"Queen's Indian Defense",pgn:"1. Nf3 Nf6 2. g3 b6 3. Bg2 Bb7 4. O-O e6 5. d3 Be7 6. e4 d6 7. Nc3 Nbd7 8. Nh4 g6 9. f4 a6 10. Be3 Qc7 11. Qe1 h6 12. Qf2 O-O-O 13. a3 Rdg8 14. b4 g5 15. fxg5 hxg5 16. Nf3 Rg6 17. b5 axb5 18. Nxb5 Qb8 19. a4 Nc5 20. Rfb1 Bc6 21. Nd2 Rgh6 22. Nc4 Rxh2 23. Qxh2 Rxh2 24. Kxh2 g4 25. Kg1 Qg8 26. Bf4 Nfd7 27. a5 f6 28. Rb4 d5 29. exd5 Bxd5 30. Na3 Bxg2 31. Kxg2 e5 32. Bc1 Qc8 33. Nc4 Ne6 34. Rba4 f5 35. Na3 Nc5 36. Nc4 Ne6 37. axb6 cxb6 38. Na3 Nc5 39. Nc4 Ne6 40. Ra8 1-0"},annotations:{0:"Petrosian opens with the Rti. He prefers flexible setups that don't commit too early.",16:"8. Nh4! - Prophylaxis. Petrosian prevents Black from playing ...e5 and takes control of f5.",24:"12. Qf2! - A multi-purpose move. The queen protects b6 while eyeing the kingside.",42:"21. Nc4! - The knight heads to d6, a dream square. Petrosian slowly improves his pieces.",48:"24. Kxh2 - Petrosian accepts the exchange sacrifice but Black gets attacking chances.",64:"32. Bc1! - Prophylactic. The bishop retreats to prevent any tactics on the long diagonal.",80:"40. Ra8! 1-0 - The decisive blow. Black cannot prevent Rxc8+ winning the queen."},quizPositions:[{afterMove:16,question:"Why did Petrosian play 8. Nh4 instead of developing naturally?",hint:"What move was Black hoping to play?",answer:"The knight on h4 controls f5 and prevents Black from playing ...e5, which would give Black a good central pawn structure."}],conclusion:`Petrosian's style teaches us that chess is not just about attackingit's about preventing your opponent's ideas while slowly improving your position.

**Key Takeaways:**
1. Before moving, ask: "What does my opponent want?"
2. Prevention is often stronger than cure
3. Piece placement matters more than raw material`},{id:"russian_chess_ch2_lesson2",bookId:"russian_chess",chapter:2,lessonNumber:2,title:"The Magician of Attack",subtitle:"Tal's Sacrificial Brilliance",introduction:`If Petrosian represented the defensive school, Mikhail Tal was its polar opposite. Known as "The Magician from Riga," Tal played with a ferocity that terrified even the strongest grandmasters.

Tal's philosophy was revolutionary: "You must take your opponent into a deep, dark forest where 2+2=5, and the path leading out is only wide enough for one."

He would sacrifice materialsometimes unsoundlyto create complications that were practically impossible to navigate over the board. Even if objectively worse, his positions gave him winning chances because of the immense pressure.

**Key Concepts:**
 The speculative sacrifice - offering material without calculating everything
 Practical chess - creating problems your opponent cannot solve
 Attack before development - sometimes the initiative is worth more than material
 Psychological pressure - making your opponent uncomfortable`,concepts:["Speculative sacrifice","Initiative over material","Practical complications","Psychological warfare","Attacking the king"],game:{white:"Mikhail Tal",black:"Vasily Smyslov",event:"Candidates Tournament",site:"Bled-Zagreb-Belgrade",year:1959,result:"1-0",opening:"Caro-Kann Defense",pgn:"1. e4 c6 2. d4 d5 3. Nc3 dxe4 4. Nxe4 Nd7 5. Nf3 Ngf6 6. Nxf6+ Nxf6 7. Bc4 Bf5 8. Qe2 e6 9. Bg5 Be7 10. O-O-O O-O 11. Kb1 Nd5 12. Bxe7 Qxe7 13. Qe5 Qb4 14. Bd3 Bxd3 15. Rxd3 Qa5 16. Nd2 Nf6 17. Nc4 Qc7 18. Qxc7 Rxc8 19. Ne5 Rfd8 20. f4 Nd5 21. Rhd1 Kf8 22. c4 Nb4 23. R3d2 Na6 24. f5 Nc5 25. fxe6 fxe6 26. Nxc6 bxc6 27. d5 cxd5 28. cxd5 Rxd5 29. Rxd5 exd5 30. Rxd5 Re8 31. b4 Nd7 32. Kc2 Re2+ 33. Kd3 Rxa2 34. Rd6 Ra3+ 35. Kc4 Rxg3 36. Rxd7 a6 37. Ra7 Rxh3 38. Rxa6 Ke7 39. b5 1-0"},annotations:{0:"Tal faces Smyslov, a former World Champion known for his precise technique.",18:"9. Bg5! - Tal immediately pins the knight. He's not interested in quiet play.",24:"12. Bxe7 Qxe7 13. Qe5! - The queen enters aggressively. Tal has his pieces aimed at Black's king.",38:"19. Ne5! - The knight lunges into the center. Tal's pieces coordinate menacingly.",50:"25. fxe6 fxe6 26. Nxc6! - Tal breaks through. The sacrifice opens lines to Black's king.",58:"30. Rxd5 Re8 - Tal has won a pawn and kept the initiative.",76:"39. b5! 1-0 - The passed pawn decides. Smyslov is crushed."},quizPositions:[{afterMove:24,question:"What is the purpose of 13. Qe5?",hint:"Consider what the queen threatens and how it coordinates with other pieces.",answer:"The queen on e5 attacks g7 and coordinates with the bishop on g5. It also prevents Black from castling queenside due to Qxb8+."}],conclusion:`Tal's games teach us that chess is not just about who has the better evaluationit's about who can handle the pressure. Sometimes the best move is the one that creates the most problems.

**Key Takeaways:**
1. Initiative can be worth more than material
2. Create positions where your opponent has to find the only moves
3. Psychology is part of chessmake your opponent uncomfortable`},{id:"russian_chess_ch3_lesson1",bookId:"russian_chess",chapter:3,lessonNumber:1,title:"The Endgame Maestro",subtitle:"Smyslov's Endgame Technique",introduction:`Vasily Smyslov was called the "Hand of God" for his seemingly effortless technique, especially in the endgame. While other players struggled to convert advantages, Smyslov made it look like magic.

The Soviet school emphasized endgame study more than any other aspect of chess. They understood that most games are decided in the endgame, yet most players spend their time studying openings.

Smyslov's endgame philosophy was simple: understand the principles deeply, and the moves will flow naturally.

**Key Concepts:**
 King activity - the king is a fighting piece in the endgame
 The principle of two weaknesses - attack on both flanks
 Opposition and zugzwang - forcing your opponent to make bad moves
 Technique - converting advantages without giving counterplay`,concepts:["King activity","Two weaknesses principle","Opposition","Zugzwang","Endgame technique"],game:{white:"Vasily Smyslov",black:"Samuel Reshevsky",event:"Candidates Tournament",site:"Zurich",year:1953,result:"1-0",opening:"Ruy Lopez",pgn:"1. e4 e5 2. Nf3 Nc6 3. Bb5 a6 4. Ba4 Nf6 5. O-O Be7 6. Re1 b5 7. Bb3 d6 8. c3 O-O 9. h3 Na5 10. Bc2 c5 11. d4 Qc7 12. Nbd2 Nc6 13. dxc5 dxc5 14. Nf1 Be6 15. Ne3 Rad8 16. Qe2 c4 17. Ng5 Bc8 18. Nf5 Bxf5 19. exf5 Nd5 20. Qe4 g6 21. fxg6 fxg6 22. Nf3 Nf4 23. Bxf4 Rxf4 24. Qe3 Qf7 25. Re2 Rd5 26. Rae1 Bf8 27. Qe4 Nd8 28. Qb7 Rb5 29. Qa8 Qd5 30. Qa7 Rf7 31. Qc5 Qxc5 32. Rxe5 Qa3 33. Rxb5 axb5 34. Re8 Qxa2 35. Rxd8 Qxb2 36. Rd1 a1=Q 37. Rxa1 Rf1+ 38. Rxf1 Qxf1+ 39. Kh2 Qf4+ 40. g3 Qxc4 41. Ne5 Qe2 42. Nxg6 hxg6 43. Kg2 Kf7 44. h4 Kf6 45. h5 gxh5 46. Kf3 Qd3+ 47. Kf4 Qd4+ 48. Kf3 Qd5+ 49. Kf4 Qd2+ 50. Kf3 Qc3 51. g4 hxg4+ 52. Kxg4 Qe5 53. Kf3 Qf5+ 54. Ke2 Ke5 55. Kd2 Kd4 56. f4 Qe4 57. Kc2 Qe2+ 58. Kb3 Qd3 59. Ka2 Qc4+ 60. Kb2 Kd3 61. Ka3 Qc3+ 62. Ka2 Kc4 63. f5 Kb4 64. f6 Qa5+ 65. Kb2 Qa4 66. f7 Qe8 67. Kc2 Qf8 68. Kd3 Kc5 69. Ke4 b4 70. Ke5 b3 71. Ke6 b2 72. Ke7 Qb4+ 73. Kd7 1-0"},annotations:{0:"Smyslov faces Reshevsky, one of America's strongest players.",30:"15. Ne3 Rad8 16. Qe2 c4 - The game has reached a critical middlegame phase.",58:"29. Qa8 Qd5 30. Qa7 - Smyslov maneuvers, looking for the right moment to exchange into a favorable endgame.",86:"43. Kg2! - The key to the endgame. The king marches up the board as a fighting piece.",104:"52. Kxg4 Qe5 - Despite being down material, Smyslov's technique is flawless.",144:"72. Ke7 Qb4+ 73. Kd7 1-0 - The pawn promotes. A masterclass in endgame technique."},quizPositions:[{afterMove:86,question:"After 43. Kg2, why is king activity so important in this endgame?",hint:"Think about what the king can do that no other piece can.",answer:"In the endgame, the king is a strong piece that can attack pawns and support passed pawns. An active king is often worth more than a pawn."}],conclusion:`Smyslov's games demonstrate that endgame mastery is about understanding principles, not memorizing positions. A well-placed king and proper technique can overcome material deficits.

**Key Takeaways:**
1. The king must be active in the endgame
2. Create multiple weaknesses in your opponent's position
3. Technique means finding the cleanest path to victory`}];function o5(t){return c1.filter(e=>e.bookId===t)}function Xg(t){return c1.find(e=>e.id===t)}function l5(){return Object.values(a5)}const Ea=null,Yg={signUp:async(t,e)=>({error:{message:"Supabase not configured"}}),signIn:async(t,e)=>({error:{message:"Supabase not configured"}}),signOut:async()=>({error:{message:"Supabase not configured"}}),getUser:async()=>({data:{user:null}}),getSession:async()=>({data:{session:null}}),onAuthStateChange:t=>({data:{subscription:{unsubscribe:()=>{}}}})},Bn={saveImportedGame:async(t,e)=>({error:{message:"Supabase not configured"}}),saveImportedGames:async(t,e)=>({error:{message:"Supabase not configured"}}),getImportedGames:async t=>({data:[],error:null}),deleteImportedGame:async t=>({error:{message:"Supabase not configured"}}),saveMasterGame:async(t,e)=>({error:{message:"Supabase not configured"}}),saveMasterGames:async(t,e)=>({error:{message:"Supabase not configured"},count:0}),getMasterGames:async(t,e=100,n=0)=>({data:[],error:null,count:0}),getMasterGameCount:async t=>({count:0,error:null}),searchMasterGames:async(t,e,n=50)=>({data:[],error:null}),deleteMasterGames:async t=>({error:{message:"Supabase not configured"}}),savePlayerOverride:async(t,e)=>({error:{message:"Supabase not configured"}}),getPlayerOverride:async t=>({data:null,error:null}),getAllPlayerOverrides:async()=>({data:[],error:null}),deletePlayerOverride:async t=>({error:{message:"Supabase not configured"}}),uploadPlayerImage:async(t,e)=>({error:{message:"Supabase not configured"}}),saveFavoriteGame:async(t,e)=>({error:{message:"Supabase not configured"}}),getFavoriteGames:async t=>({data:[],error:null}),removeFavoriteGame:async t=>({error:{message:"Supabase not configured"}}),saveGameNote:async(t,e,n)=>({error:{message:"Supabase not configured"}}),savePreferences:async(t,e)=>({error:{message:"Supabase not configured"}}),getPreferences:async t=>({data:null,error:null}),createCustomPlayer:async t=>({error:{message:"Supabase not configured"}}),updateCustomPlayer:async(t,e)=>({error:{message:"Supabase not configured"}}),updateCustomPlayerImage:async(t,e)=>({error:{message:"Supabase not configured"}}),getCustomPlayers:async()=>({data:[],error:null}),getCustomPlayer:async t=>({data:null,error:null}),deleteCustomPlayer:async t=>({error:{message:"Supabase not configured"}}),uploadAudioFile:async(t,e)=>({error:{message:"Supabase not configured"}}),uploadArtwork:async(t,e)=>({error:{message:"Supabase not configured"}}),createAudioTrack:async t=>({error:{message:"Supabase not configured"}}),getAudioTracks:async()=>({data:[],error:null}),updateAudioTrack:async(t,e)=>({error:{message:"Supabase not configured"}}),deleteAudioTrack:async t=>({error:{message:"Supabase not configured"}}),reorderAudioTracks:async t=>({error:{message:"Supabase not configured"}}),seedBuiltInPlayers:async t=>({error:{message:"Supabase not configured"},seeded:0}),getAllPlayers:async()=>({data:[],error:null})};class c5{constructor(e={}){this.crossfadeSeconds=e.crossfadeSeconds??2,this.volume=e.defaultVolume??.22,this.avoidRepeatWindow=e.avoidRepeatWindow??3,this.audioA=this.makeAudio(),this.audioB=this.makeAudio(),this.currentIsA=!0,this.manifest=null,this.tracksById=new Map,this.mode="zone",this.modeQueue=[],this.history=[],this.muted=!1,this.isPlaying=!1,this.userHasInteracted=!1,this.currentTrack=null,this.audioA.addEventListener("ended",()=>this.onEnded(this.audioA)),this.audioB.addEventListener("ended",()=>this.onEnded(this.audioB)),this.onTrackChange=null,this.onPlayStateChange=null}makeAudio(){const e=new Audio;return e.preload="auto",e.loop=!1,e.volume=0,e}markUserInteracted(){this.userHasInteracted=!0}async loadManifest(e="/audio/lofi/playlist.json"){try{const n=await fetch(e,{cache:"no-cache"});n.ok?this.manifest=await n.json():(console.warn("AudioManager: Using default manifest"),this.manifest=this.getDefaultManifest())}catch(n){console.warn("AudioManager: Failed to load manifest, using default",n),this.manifest=this.getDefaultManifest()}this.updateTracksMap(),this.setMode(this.mode)}updateTracksMap(){this.tracksById.clear();for(const e of this.manifest.tracks)this.tracksById.set(e.id,e)}convertSupabaseTracks(e){const n=e.map(r=>({id:r.id,title:r.title,artist:r.artist,album:r.album,file:r.file_url,artwork:r.artwork_url,duration:r.duration,tags:r.tags||[]})),i={zone:[],casual:[],puzzle:[],analysis:[],menu:[]};return e.forEach(r=>{(r.modes||["zone"]).forEach(a=>{i[a]&&i[a].push(r.id)})}),{version:2,source:"supabase",tracks:n,modes:i}}getDefaultManifest(){return{version:1,tracks:[{id:"lofi_study",title:"Lo-fi Study",file:"/audio/lofi/lofi_study.mp3",tags:["focus","casual"]},{id:"empty_mind",title:"Empty Mind",file:"/audio/lofi/empty_mind.mp3",tags:["zone","focus"]},{id:"slow_motion",title:"Slow Motion",file:"/audio/lofi/slow_motion.mp3",tags:["zone","endgame"]},{id:"coffee_break",title:"Coffee Break",file:"/audio/lofi/coffee_break.mp3",tags:["menu","casual"]},{id:"calm_night",title:"Calm Night",file:"/audio/lofi/calm_night.mp3",tags:["casual","focus"]},{id:"floating",title:"Floating",file:"/audio/lofi/floating.mp3",tags:["ambient","puzzle"]}],modes:{menu:["coffee_break","calm_night"],casual:["lofi_study","calm_night","coffee_break"],zone:["empty_mind","slow_motion","calm_night","floating","lofi_study"],puzzle:["floating","empty_mind"],analysis:["lofi_study","slow_motion","calm_night"]}}}setMode(e){this.mode=e,this.rebuildQueueForMode(e),this.isPlaying&&this.playNext(!0)}getMode(){return this.mode}setVolume(e){this.volume=Math.max(0,Math.min(1,e));const n=this.getActiveAudio();n.volume=this.muted?0:this.volume}getVolume(){return this.volume}setMuted(e){this.muted=e;const n=this.getActiveAudio(),i=this.getInactiveAudio();n.volume=e?0:this.volume,i.volume=e?0:i.volume}getMuted(){return this.muted}async play(){var e;return this.userHasInteracted?(this.manifest||await this.loadManifest(),this.isPlaying||(this.isPlaying=!0,(e=this.onPlayStateChange)==null||e.call(this,!0),await this.playNext(!1)),!0):!1}pause(){var e;this.isPlaying=!1,this.audioA.pause(),this.audioB.pause(),(e=this.onPlayStateChange)==null||e.call(this,!1)}toggle(){this.isPlaying?this.pause():this.play()}async skip(){this.isPlaying&&await this.playNext(!0)}getCurrentTrack(){return this.currentTrack}getIsPlaying(){return this.isPlaying}rebuildQueueForMode(e){if(!this.manifest){this.modeQueue=[];return}const n=this.manifest.modes[e]??this.manifest.modes.zone??[],i=[];for(const r of n){const s=this.tracksById.get(r);s&&i.push(s)}this.modeQueue=i}pickNextTrack(){if(!this.manifest||this.modeQueue.length===0)return null;const e=new Set(this.history.slice(-this.avoidRepeatWindow)),n=this.modeQueue.filter(s=>!e.has(s.id)),i=n.length>0?n:this.modeQueue,r=Math.floor(Math.random()*i.length);return i[r]??null}getActiveAudio(){return this.currentIsA?this.audioA:this.audioB}getInactiveAudio(){return this.currentIsA?this.audioB:this.audioA}async playNext(e){var l,c;const n=this.pickNextTrack();if(!n)return;this.history.push(n.id),this.history.length>50&&(this.history=this.history.slice(-25)),this.currentTrack=n,(l=this.onTrackChange)==null||l.call(this,n);const i=this.getInactiveAudio(),r=this.getActiveAudio();i.src=n.file,i.currentTime=0;try{await this.waitCanPlay(i)}catch(d){console.warn("AudioManager: Track failed to load:",n.file,d),setTimeout(()=>this.playNext(!1),100);return}i.volume=0;try{await i.play()}catch(d){console.warn("AudioManager: Playback blocked",d),this.isPlaying=!1,(c=this.onPlayStateChange)==null||c.call(this,!1);return}const s=this.crossfadeSeconds;if(!(!r.paused&&!r.ended&&r.currentSrc)||!e){this.currentIsA=!this.currentIsA,await this.fade(i,0,this.muted?0:this.volume,s);return}this.currentIsA=!this.currentIsA,await Promise.all([this.fade(i,0,this.muted?0:this.volume,s),this.fade(r,r.volume,0,s)]),r.pause(),r.currentTime=0,r.src=""}async waitCanPlay(e){if(!(e.readyState>=3))return new Promise((n,i)=>{const r=()=>{a(),n()},s=()=>{a(),i(new Error("Audio failed to load"))},a=()=>{e.removeEventListener("canplay",r),e.removeEventListener("error",s)};e.addEventListener("canplay",r),e.addEventListener("error",s),e.load(),setTimeout(()=>{a(),i(new Error("Audio load timeout"))},1e4)})}async fade(e,n,i,r){const s=performance.now(),a=Math.max(.05,r)*1e3,l=i-n;return new Promise(c=>{const d=h=>{const f=Math.min(1,(h-s)/a),p=n+l*f;e.volume=this.muted?0:Math.max(0,Math.min(1,p)),f<1?requestAnimationFrame(d):c()};e.volume=this.muted?0:n,requestAnimationFrame(d)})}onEnded(e){this.isPlaying&&e===this.getActiveAudio()&&this.playNext(!0)}destroy(){this.pause(),this.audioA.src="",this.audioB.src=""}}let yu=null;function d5(){return yu||(yu=new c5({crossfadeSeconds:2,defaultVolume:.22,avoidRepeatWindow:3})),yu}const is="all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",u5=[{id:"dark",name:"Dark"},{id:"light",name:"Light"},{id:"sepia",name:"Sepia"},{id:"midnight",name:"Midnight"},{id:"classic-dark",name:"Classic Dark"},{id:"classic-light",name:"Classic Light"},{id:"gallery",name:"Gallery"},{id:"gallery-light",name:"Gallery Light"},{id:"typographic",name:"Typographic"},{id:"typographic-light",name:"Typographic Light"},{id:"editorial",name:"Editorial"},{id:"editorial-light",name:"Editorial Light"}],h5=[{id:"straight",name:"Straight On"},{id:"angled",name:"3/4 Angled"},{id:"top",name:"Top Down"}];function f5({initialGame:t=null,initialLesson:e=null,onClose:n,theme:i,themeId:r="dark",onThemeChange:s,boardThemeId:a="carrara_gold",onBoardThemeChange:l}){const c=i||{bg:"#0a0a0b",bgAlt:"#111113",ink:"#FAFAF8",inkMuted:"#888",accent:"#D4AF37",accentSoft:"rgba(212,175,55,0.15)",border:"rgba(255,255,255,0.08)",shadow:"0 8px 32px rgba(0,0,0,0.5)"},d=(r==null?void 0:r.includes("light"))||r==="sepia",[h,f]=N.useState(e?"lesson":t?"game":"browse"),[p]=N.useState(()=>new Bt),[m,y]=N.useState(()=>new Bt().fen()),[x,g]=N.useState([]),[u,v]=N.useState(0),[b,w]=N.useState("w"),[R,C]=N.useState(null),[A,B]=N.useState(t),[S,k]=N.useState(e?Xg(e):null),[U,O]=N.useState(a),[X,K]=N.useState(!1),[$,q]=N.useState(!1),J=N.useRef(null),V=N.useRef(null),ue=N.useRef(null),[F,de]=N.useState("2d"),[Te,xe]=N.useState("classic_ebony_ivory"),[le,Re]=N.useState("top"),[Q,ae]=N.useState(580),Me=N.useMemo(()=>d5(),[]),[ze,se]=N.useState(!0),[ke,Ge]=N.useState(()=>Me.getVolume()),[Oe,Ve]=N.useState(null),[Ze,Ue]=N.useState(!1),tt=N.useRef(null);N.useEffect(()=>{if(F!=="2d"||!ue.current)return;const he=()=>{const me=ue.current;if(!me)return;const Ke=me.getBoundingClientRect(),G=Ke.height-28-28-80-64,Be=Ke.width-64,Pe=Math.max(400,Math.min(700,Math.min(Be,G)));ae(Pe)};he();const Z=new ResizeObserver(he);return Z.observe(ue.current),()=>Z.disconnect()},[F]);const z=he=>{O(he),l==null||l(he)};N.useEffect(()=>{S?(ht(S.game.pgn),f("lesson")):A!=null&&A.pgn&&(ht(A.pgn),f("game"))},[S,A]);const ht=N.useCallback(he=>{try{const Z=new Bt;Z.loadPgn(he,{strict:!1});let me=Z.history();if(me.length===0&&he){Z.reset();const Ke=he.replace(/\[[^\]]*\]/g,"").replace(/\{[^}]*\}/g,"").replace(/\d+\.\s*/g,"").replace(/1-0|0-1|1\/2-1\/2|\*/g,"").trim().split(/\s+/).filter(G=>G&&/^[KQRBNP]?[a-h]?[1-8]?x?[a-h][1-8](=[QRBN])?[+#]?$|^O-O(-O)?[+#]?$/i.test(G));for(const G of Ke)try{Z.move(G,{sloppy:!0})}catch{break}me=Z.history()}g(me),v(0),p.reset(),y(p.fen()),C(null)}catch(Z){console.error("ZoneMode loadPgn error:",Z),g([])}},[p]),Xe=N.useCallback(he=>{const Z=Math.max(0,Math.min(he,x.length));v(Z),p.reset();let me=null;for(let Ke=0;Ke<Z;Ke++)try{const G=p.move(x[Ke]);Ke===Z-1&&(me={from:G.from,to:G.to})}catch{break}y(p.fen()),C(me)},[x,p]);N.useEffect(()=>{if(V.current){const he=Math.floor((u-1)/2),Z=32;V.current.scrollTop=Math.max(0,he*Z-100)}},[u]),N.useEffect(()=>($&&u<x.length&&(J.current=setTimeout(()=>Xe(u+1),1500)),()=>clearTimeout(J.current)),[$,u,x.length,Xe]),N.useEffect(()=>(Me.loadManifest("/audio/lofi/playlist.json"),Me.setMode("zone"),Me.onTrackChange=he=>{Ve(he),he&&ze&&(Ue(!0),clearTimeout(tt.current),tt.current=setTimeout(()=>Ue(!1),4e3))},()=>{Me.onTrackChange=null,clearTimeout(tt.current)}),[Me,ze]),N.useEffect(()=>{ze?(Me.markUserInteracted(),Me.play()):Me.pause()},[ze,Me]),N.useEffect(()=>{Me.setVolume(ke)},[ke,Me]),N.useEffect(()=>{const he=Z=>{Z.key==="ArrowLeft"?(Z.preventDefault(),Xe(u-1),q(!1)):Z.key==="ArrowRight"?(Z.preventDefault(),Xe(u+1)):Z.key==="ArrowUp"?(Z.preventDefault(),Xe(0),q(!1)):Z.key==="ArrowDown"?(Z.preventDefault(),Xe(x.length)):Z.key==="f"?(Z.preventDefault(),w(me=>me==="w"?"b":"w")):Z.key===" "?(Z.preventDefault(),q(me=>!me)):Z.key==="Escape"&&(n==null||n())};return window.addEventListener("keydown",he),()=>window.removeEventListener("keydown",he)},[u,x.length,Xe,n]);const Je=N.useMemo(()=>{if(!(S!=null&&S.annotations))return null;const Z=Object.keys(S.annotations).map(Number).sort((me,Ke)=>Ke-me).find(me=>me<=u);return Z!==void 0?S.annotations[Z]:null},[S,u]),ee=N.useMemo(()=>{const he={w:{p:8,n:2,b:2,r:2,q:1},b:{p:8,n:2,b:2,r:2,q:1}},Z={w:{p:0,n:0,b:0,r:0,q:0},b:{p:0,n:0,b:0,r:0,q:0}};return p.board().flat().filter(Boolean).forEach(me=>{Z[me.color][me.type]!==void 0&&Z[me.color][me.type]++}),{byWhite:Object.entries(he.b).flatMap(([me,Ke])=>Array(Ke-Z.b[me]).fill(me)),byBlack:Object.entries(he.w).flatMap(([me,Ke])=>Array(Ke-Z.w[me]).fill(me))}},[m,p]),P=he=>{k(Xg(he)),B(null)},_=A||(S==null?void 0:S.game),W=c.accent,M=d?"#fff":"#000",_e=d?"rgba(0,0,0,0.04)":"rgba(255,255,255,0.03)",ne=c.ink,Ie=c.inkMuted,ie=d?"rgba(0,0,0,0.08)":"rgba(255,255,255,0.08)",Se=d?"rgba(255,255,255,0.95)":"rgba(20,20,22,0.95)",we=c.border,ve=c.ink,Ee=c.inkMuted;if(h==="browse"){const he=l5(),Z=r==null?void 0:r.includes("classic");return o.jsxs("div",{style:{position:"fixed",inset:0,zIndex:2e3,background:c.bg,display:"flex",flexDirection:"column",overflow:"hidden"},children:[o.jsxs("header",{style:{padding:Z?"24px 40px":"16px 24px",borderBottom:`1px solid ${c.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsx("h1",{style:{margin:0,fontSize:Z?24:18,fontWeight:Z?400:600,color:c.ink,fontFamily:Z?'"Playfair Display", Georgia, serif':"inherit",letterSpacing:Z?"0.02em":"0"},children:Z?"Focus Mode":" Zone Mode"}),o.jsx("button",{onClick:n,style:{padding:Z?"10px 20px":"8px 16px",background:"transparent",border:`1px solid ${c.border}`,borderRadius:Z?4:8,color:c.ink,cursor:"pointer",fontSize:Z?14:13,letterSpacing:Z?"0.05em":"0"},children:Z?"Close":" Close"})]}),o.jsx("div",{style:{flex:1,overflow:"auto",padding:Z?48:32},children:o.jsxs("div",{style:{maxWidth:Z?720:800,margin:"0 auto"},children:[Z?o.jsxs("div",{style:{textAlign:"center",marginBottom:64,paddingBottom:48,borderBottom:`1px solid ${c.border}`},children:[o.jsx("div",{style:{fontSize:48,marginBottom:24,color:c.accent,fontFamily:'"Playfair Display", Georgia, serif',fontWeight:300},children:""}),o.jsx("h2",{style:{color:c.ink,fontSize:36,marginBottom:20,fontWeight:400,fontFamily:'"Playfair Display", Georgia, serif',letterSpacing:"0.01em"},children:"Deep Practice"}),o.jsx("p",{style:{color:c.inkMuted,fontSize:17,maxWidth:480,margin:"0 auto",lineHeight:1.7,fontWeight:300},children:"Immersive study sessions with ambient music, annotated games, and beautiful boards. Select a lesson to begin."})]}):o.jsxs("div",{style:{textAlign:"center",marginBottom:48,padding:"40px 20px",background:c.accentSoft,borderRadius:16,border:`1px solid ${c.border}`},children:[o.jsx("div",{style:{fontSize:48,marginBottom:16},children:""}),o.jsx("h2",{style:{color:c.ink,fontSize:28,marginBottom:12,fontWeight:600},children:"Welcome to Zone Mode"}),o.jsx("p",{style:{color:c.inkMuted,fontSize:15,maxWidth:500,margin:"0 auto",lineHeight:1.6},children:"Immersive chess study with ambient music, beautiful boards, and deep annotations. Select a lesson below to begin your focused practice session."})]}),o.jsxs("div",{style:{marginBottom:32},children:[o.jsx("h3",{style:{color:c.inkMuted,fontSize:Z?13:12,letterSpacing:"0.12em",marginBottom:Z?24:16,fontWeight:Z?400:600},children:"LESSONS"}),he.length===0?o.jsx("div",{style:{padding:Z?48:32,textAlign:"center",background:d?"rgba(0,0,0,0.02)":"rgba(255,255,255,0.03)",borderRadius:Z?4:12,color:c.inkMuted},children:"No lessons available yet."}):he.map(me=>{const Ke=o5(me.id);return o.jsxs("div",{style:{marginBottom:Z?32:24,background:d?"rgba(0,0,0,0.02)":"rgba(255,255,255,0.03)",borderRadius:Z?4:12,padding:Z?28:20,border:`1px solid ${c.border}`},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:Z?16:12,marginBottom:Z?20:16},children:[Z?o.jsx("div",{style:{width:48,height:48,borderRadius:4,background:c.accent,display:"flex",alignItems:"center",justifyContent:"center",fontSize:22,color:d?"#fff":c.bg,fontFamily:'"Playfair Display", Georgia, serif',fontWeight:400},children:""}):o.jsx("div",{style:{width:40,height:40,borderRadius:8,background:me.coverColor||c.accent,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20},children:""}),o.jsxs("div",{children:[o.jsx("div",{style:{color:c.ink,fontWeight:Z?500:600,fontSize:Z?18:16,fontFamily:Z?'"Playfair Display", Georgia, serif':"inherit"},children:me.title}),o.jsxs("div",{style:{color:c.inkMuted,fontSize:Z?13:12,fontStyle:Z?"italic":"normal"},children:["by ",me.author]})]})]}),o.jsx("p",{style:{color:c.inkMuted,fontSize:Z?15:13,marginBottom:Z?24:16,lineHeight:Z?1.7:1.5},children:me.description}),Ke.length===0?o.jsx("div",{style:{color:c.inkMuted,fontSize:13,fontStyle:"italic"},children:"No lessons available for this book yet."}):o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:Z?12:8},children:Ke.map(G=>o.jsx("button",{onClick:()=>P(G.id),style:{padding:Z?"14px 24px":"12px 18px",background:c.accent,border:"none",borderRadius:Z?4:8,color:M,cursor:"pointer",fontSize:Z?14:13,fontWeight:Z?400:500,letterSpacing:Z?"0.03em":"0",transition:"all 0.2s ease",boxShadow:Z?"none":"0 2px 8px rgba(0,0,0,0.2)"},onMouseEnter:Be=>{Z?Be.target.style.opacity="0.85":(Be.target.style.transform="translateY(-2px)",Be.target.style.boxShadow="0 4px 12px rgba(0,0,0,0.3)")},onMouseLeave:Be=>{Z?Be.target.style.opacity="1":(Be.target.style.transform="translateY(0)",Be.target.style.boxShadow="0 2px 8px rgba(0,0,0,0.2)")},children:G.title},G.id))})]},me.id)})]}),o.jsxs("div",{style:{padding:20,background:"rgba(255,255,255,0.03)",borderRadius:12,border:`1px solid ${c.border}`,display:"flex",gap:16,alignItems:"flex-start"},children:[o.jsx("div",{style:{fontSize:24},children:""}),o.jsxs("div",{children:[o.jsx("div",{style:{color:c.ink,fontWeight:500,marginBottom:8},children:"Tip: Zone Mode Features"}),o.jsxs("ul",{style:{color:c.inkMuted,fontSize:13,margin:0,paddingLeft:20,lineHeight:1.8},children:[o.jsx("li",{children:"Lo-fi background music for focus"}),o.jsx("li",{children:"2D or 3D board views"}),o.jsx("li",{children:"Move-by-move annotations"}),o.jsx("li",{children:"Keyboard navigation (  arrows)"}),o.jsx("li",{children:"Auto-play mode"})]})]})]})]})})]})}return o.jsxs("div",{style:{position:"fixed",inset:0,zIndex:2e3,background:c.bg,display:"flex",overflow:"hidden"},children:[o.jsxs("div",{style:{position:"fixed",bottom:24,left:"50%",transform:`translateX(-50%) translateY(${Ze?0:100}px)`,opacity:Ze?1:0,background:Se,backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",border:`1px solid ${we}`,borderRadius:12,padding:"14px 20px",display:"flex",alignItems:"center",gap:14,zIndex:3e3,transition:"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)",pointerEvents:Ze?"auto":"none",boxShadow:c.shadow},children:[o.jsx("div",{style:{width:44,height:44,borderRadius:10,background:c.accent,display:"flex",alignItems:"center",justifyContent:"center",fontSize:22,color:M},children:""}),o.jsxs("div",{children:[o.jsx("div",{style:{color:ve,fontWeight:600,fontSize:14,marginBottom:2},children:(Oe==null?void 0:Oe.title)||"Now Playing"}),o.jsx("div",{style:{color:Ee,fontSize:12},children:(Oe==null?void 0:Oe.artist)||"Unknown Artist"})]})]}),o.jsxs("div",{ref:ue,style:{flex:"1 1 auto",display:"flex",flexDirection:"column",alignItems:F==="3d"?"stretch":"center",justifyContent:F==="3d"?"stretch":"center",padding:F==="3d"?0:32,position:"relative",overflow:"hidden"},children:[o.jsx("button",{onClick:n,style:{position:"absolute",top:20,left:20,zIndex:50,padding:"10px 16px",background:d?"rgba(255,255,255,0.9)":"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)",border:`1px solid ${c.border}`,borderRadius:8,color:c.ink,cursor:"pointer",fontSize:13,display:"flex",alignItems:"center",gap:8,transition:is,fontWeight:500},children:" Exit"}),o.jsx("button",{onClick:()=>K(!X),style:{position:"absolute",top:20,right:20,zIndex:50,padding:"10px 14px",background:X?c.accent:d?"rgba(255,255,255,0.9)":"rgba(0,0,0,0.7)",backdropFilter:"blur(10px)",border:`1px solid ${c.border}`,borderRadius:8,color:X?M:c.ink,cursor:"pointer",fontSize:14,transition:is},children:""}),X&&o.jsxs("div",{style:{position:"absolute",top:70,right:20,zIndex:100,background:d?"rgba(255,255,255,0.98)":"rgba(20,20,22,0.98)",backdropFilter:"blur(20px)",border:`1px solid ${c.border}`,borderRadius:12,padding:20,minWidth:220,boxShadow:c.shadow},children:[o.jsx("div",{style:{fontSize:11,color:c.inkMuted,marginBottom:16,letterSpacing:"0.1em",fontWeight:600},children:"SETTINGS"}),o.jsxs("div",{style:{marginBottom:16},children:[o.jsx("div",{style:{fontSize:12,color:c.ink,marginBottom:8,fontWeight:500},children:"App Theme"}),o.jsx("select",{value:r,onChange:he=>s==null?void 0:s(he.target.value),style:{width:"100%",padding:"10px 12px",background:d?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.08)",border:`1px solid ${c.border}`,borderRadius:8,color:c.ink,fontSize:13,cursor:"pointer"},children:u5.map(he=>o.jsx("option",{value:he.id,style:{background:c.bg,color:c.ink},children:he.name},he.id))})]}),o.jsxs("div",{style:{marginBottom:16},children:[o.jsx("div",{style:{fontSize:12,color:c.ink,marginBottom:8,fontWeight:500},children:"Board View"}),o.jsxs("div",{style:{display:"flex",background:d?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.05)",borderRadius:8,overflow:"hidden"},children:[o.jsx("button",{onClick:()=>de("2d"),style:{flex:1,padding:"10px 12px",border:"none",background:F==="2d"?c.accent:"transparent",color:F==="2d"?M:c.ink,cursor:"pointer",fontSize:13,fontWeight:600},children:"2D"}),o.jsx("button",{onClick:()=>de("3d"),style:{flex:1,padding:"10px 12px",border:"none",background:F==="3d"?c.accent:"transparent",color:F==="3d"?M:c.ink,cursor:"pointer",fontSize:13,fontWeight:600},children:"3D"})]})]}),o.jsxs("div",{style:{marginBottom:16},children:[o.jsx("div",{style:{fontSize:12,color:c.ink,marginBottom:8,fontWeight:500},children:"Board Theme"}),o.jsx("select",{value:U,onChange:he=>z(he.target.value),style:{width:"100%",padding:"10px 12px",background:d?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.08)",border:`1px solid ${c.border}`,borderRadius:8,color:c.ink,fontSize:13,cursor:"pointer"},children:vh().map(he=>o.jsx("option",{value:he.id,style:{background:c.bg,color:c.ink},children:he.name},he.id))})]}),F==="3d"&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{marginBottom:16},children:[o.jsx("div",{style:{fontSize:12,color:c.ink,marginBottom:8,fontWeight:500},children:"3D Piece Set"}),o.jsx("select",{value:Te,onChange:he=>xe(he.target.value),style:{width:"100%",padding:"10px 12px",background:d?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.08)",border:`1px solid ${c.border}`,borderRadius:8,color:c.ink,fontSize:13,cursor:"pointer"},children:n5().map(he=>o.jsx("option",{value:he.id,style:{background:c.bg,color:c.ink},children:he.name},he.id))})]}),o.jsxs("div",{style:{marginBottom:16},children:[o.jsx("div",{style:{fontSize:12,color:c.ink,marginBottom:8,fontWeight:500},children:"Camera Angle"}),o.jsx("select",{value:le,onChange:he=>Re(he.target.value),style:{width:"100%",padding:"10px 12px",background:d?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.08)",border:`1px solid ${c.border}`,borderRadius:8,color:c.ink,fontSize:13,cursor:"pointer"},children:h5.map(he=>o.jsx("option",{value:he.id,style:{background:c.bg,color:c.ink},children:he.name},he.id))})]})]}),o.jsxs("div",{style:{marginBottom:12},children:[o.jsx("div",{style:{fontSize:12,color:c.ink,marginBottom:8,fontWeight:500},children:"Music"}),o.jsx("button",{onClick:()=>se(!ze),style:{width:"100%",padding:"10px 12px",background:ze?c.accent:d?"rgba(0,0,0,0.05)":"rgba(255,255,255,0.05)",border:`1px solid ${ze?c.accent:c.border}`,borderRadius:8,color:ze?M:c.ink,cursor:"pointer",fontSize:13,display:"flex",alignItems:"center",justifyContent:"center",gap:8,fontWeight:500},children:ze?" On":" Off"})]}),ze&&o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:12,color:c.ink,marginBottom:8,fontWeight:500},children:"Volume"}),o.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:ke,onChange:he=>Ge(parseFloat(he.target.value)),style:{width:"100%",accentColor:c.accent}})]})]}),F==="3d"?o.jsx("div",{style:{position:"absolute",inset:0,background:d?"#e8e8e6":"#0a0a0b"},children:o.jsx(s5,{chess:p,size:"full",orientation:b,interactive:!1,lastMove:R,themeId:U,pieceSetId:Te,cameraPreset:le,animations:!0},`3d-${m}-${Te}-${le}-${U}-${b}`)}):o.jsxs(o.Fragment,{children:[o.jsx("div",{style:{height:28,marginBottom:12,display:"flex",gap:2,alignItems:"center",minWidth:Q},children:ee.byBlack.map((he,Z)=>o.jsx("img",{src:`/pieces/classic/w${he.toUpperCase()}.svg`,alt:"",style:{width:22,height:22,opacity:.6}},Z))}),o.jsx("div",{style:{background:d?"rgba(0,0,0,0.1)":"rgba(0,0,0,0.3)",borderRadius:4,padding:4,boxShadow:c.shadow},children:o.jsx(M2,{chess:p,fen:m,size:Q,orientation:b,interactive:!1,lastMove:R,themeId:U,vignette:!1})}),o.jsx("div",{style:{height:28,marginTop:12,display:"flex",gap:2,alignItems:"center",minWidth:Q},children:ee.byWhite.map((he,Z)=>o.jsx("img",{src:`/pieces/classic/b${he.toUpperCase()}.svg`,alt:"",style:{width:22,height:22,opacity:.6}},Z))})]}),o.jsxs("div",{style:{position:F==="3d"?"absolute":"relative",bottom:F==="3d"?24:"auto",left:F==="3d"?"50%":"auto",transform:F==="3d"?"translateX(-50%)":"none",marginTop:F==="3d"?0:24,display:"flex",alignItems:"center",gap:6,background:d?F==="3d"?"rgba(255,255,255,0.9)":"rgba(0,0,0,0.05)":F==="3d"?"rgba(0,0,0,0.8)":"rgba(255,255,255,0.03)",backdropFilter:F==="3d"?"blur(20px)":"none",border:`1px solid ${c.border}`,borderRadius:12,padding:"6px 10px",zIndex:50},children:[o.jsx("button",{onClick:()=>{Xe(0),q(!1)},disabled:u===0,"aria-label":"Go to start",style:{width:40,height:40,borderRadius:8,border:"none",background:d?"rgba(0,0,0,0.06)":"rgba(255,255,255,0.06)",color:u===0?c.inkMuted:c.ink,cursor:u===0?"default":"pointer",opacity:u===0?.4:1,fontSize:14,display:"flex",alignItems:"center",justifyContent:"center",transition:is},children:""}),o.jsx("button",{onClick:()=>{Xe(u-1),q(!1)},disabled:u===0,"aria-label":"Previous move",style:{width:40,height:40,borderRadius:8,border:"none",background:d?"rgba(0,0,0,0.06)":"rgba(255,255,255,0.06)",color:u===0?c.inkMuted:c.ink,cursor:u===0?"default":"pointer",opacity:u===0?.4:1,fontSize:16,display:"flex",alignItems:"center",justifyContent:"center",transition:is},children:""}),o.jsx("button",{onClick:()=>q(!$),"aria-label":$?"Pause auto-play":"Start auto-play",style:{width:56,height:48,borderRadius:10,border:"none",background:$?"#4CAF50":c.accent,color:$?"#fff":M,cursor:"pointer",fontSize:18,display:"flex",alignItems:"center",justifyContent:"center",transition:is,boxShadow:`0 2px 8px ${$?"rgba(76,175,80,0.4)":"rgba(212,175,55,0.3)"}`,fontWeight:"bold"},children:$?"":""}),o.jsx("button",{onClick:()=>Xe(u+1),disabled:u>=x.length,"aria-label":"Next move",style:{width:40,height:40,borderRadius:8,border:"none",background:d?"rgba(0,0,0,0.06)":"rgba(255,255,255,0.06)",color:u>=x.length?c.inkMuted:c.ink,cursor:u>=x.length?"default":"pointer",opacity:u>=x.length?.4:1,fontSize:16,display:"flex",alignItems:"center",justifyContent:"center",transition:is},children:""}),o.jsx("button",{onClick:()=>Xe(x.length),disabled:u>=x.length,"aria-label":"Go to end",style:{width:40,height:40,borderRadius:8,border:"none",background:d?"rgba(0,0,0,0.06)":"rgba(255,255,255,0.06)",color:u>=x.length?c.inkMuted:c.ink,cursor:u>=x.length?"default":"pointer",opacity:u>=x.length?.4:1,fontSize:14,display:"flex",alignItems:"center",justifyContent:"center",transition:is},children:""}),o.jsxs("div",{style:{padding:"0 14px",fontSize:14,fontWeight:600,color:c.ink,fontVariantNumeric:"tabular-nums",minWidth:70,textAlign:"center"},children:[u," / ",x.length]}),o.jsx("button",{onClick:()=>w(he=>he==="w"?"b":"w"),"aria-label":"Flip board",style:{width:40,height:40,borderRadius:8,border:"none",background:d?"rgba(0,0,0,0.06)":"rgba(255,255,255,0.06)",color:c.ink,cursor:"pointer",fontSize:16,display:"flex",alignItems:"center",justifyContent:"center"},children:""})]})]}),o.jsxs("div",{style:{width:360,borderLeft:`1px solid ${c.border}`,display:"flex",flexDirection:"column",background:d?c.bgAlt:"rgba(0,0,0,0.2)"},children:[o.jsx("div",{style:{padding:24,borderBottom:`1px solid ${c.border}`},children:_&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:16},children:[o.jsx("div",{style:{width:44,height:44,borderRadius:10,background:d?"#fff":"#f0f0f0",border:`1px solid ${c.border}`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,color:"#000"},children:""}),o.jsxs("div",{style:{flex:1},children:[o.jsx("div",{style:{color:c.ink,fontWeight:600,fontSize:15},children:_.white||"White"}),o.jsx("div",{style:{color:c.inkMuted,fontSize:12},children:_.whiteElo&&`${_.whiteElo}`})]})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:16},children:[o.jsx("div",{style:{width:44,height:44,borderRadius:10,background:"#1a1a1a",border:`1px solid ${c.border}`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,color:"#fff"},children:""}),o.jsxs("div",{style:{flex:1},children:[o.jsx("div",{style:{color:c.ink,fontWeight:600,fontSize:15},children:_.black||"Black"}),o.jsx("div",{style:{color:c.inkMuted,fontSize:12},children:_.blackElo&&`${_.blackElo}`})]})]}),o.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",fontSize:11,color:c.inkMuted},children:[_.event&&o.jsx("span",{style:{padding:"5px 10px",background:d?"rgba(0,0,0,0.06)":"rgba(255,255,255,0.06)",borderRadius:6},children:_.event}),(_.year||_.date)&&o.jsx("span",{style:{padding:"5px 10px",background:d?"rgba(0,0,0,0.06)":"rgba(255,255,255,0.06)",borderRadius:6},children:_.year||_.date}),_.result&&o.jsx("span",{style:{padding:"5px 10px",background:c.accent,borderRadius:6,color:M,fontWeight:700},children:_.result})]})]})}),Je&&o.jsxs("div",{style:{padding:16,borderBottom:`1px solid ${c.border}`,background:d?"rgba(212,175,55,0.08)":"rgba(212,175,55,0.06)"},children:[o.jsx("div",{style:{fontSize:11,color:c.accent,marginBottom:8,letterSpacing:"0.05em",fontWeight:700},children:"ANNOTATION"}),o.jsx("div",{style:{fontSize:13,color:c.ink,lineHeight:1.7},children:Je})]}),o.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[o.jsxs("div",{style:{padding:"14px 20px",borderBottom:`1px solid ${c.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsx("span",{style:{fontSize:11,color:c.inkMuted,letterSpacing:"0.1em",fontWeight:700},children:"MOVES"}),o.jsxs("span",{style:{fontSize:13,color:c.ink,fontWeight:600},children:[u," of ",x.length]})]}),o.jsx("div",{ref:V,style:{flex:1,overflowY:"auto",padding:12,background:_e},children:x.length===0?o.jsx("div",{style:{textAlign:"center",color:c.inkMuted,padding:24,fontSize:13},children:"No moves loaded"}):o.jsx("div",{style:{display:"grid",gridTemplateColumns:"36px 1fr 1fr",gap:"4px 2px"},children:Array.from({length:Math.ceil(x.length/2)}).map((he,Z)=>o.jsxs(_u.Fragment,{children:[o.jsxs("span",{style:{color:Ie,padding:"8px 4px",textAlign:"right",fontSize:13,fontVariantNumeric:"tabular-nums",fontWeight:500},children:[Z+1,"."]}),o.jsx("button",{onClick:()=>{Xe(Z*2+1),q(!1)},style:{padding:"8px 12px",borderRadius:6,border:"none",background:u===Z*2+1?W:"transparent",color:u===Z*2+1?M:ne,cursor:"pointer",fontSize:14,fontWeight:u===Z*2+1?700:500,textAlign:"left",transition:"all 0.15s"},onMouseEnter:me=>{u!==Z*2+1&&(me.target.style.background=ie)},onMouseLeave:me=>{u!==Z*2+1&&(me.target.style.background="transparent")},children:x[Z*2]}),x[Z*2+1]?o.jsx("button",{onClick:()=>{Xe(Z*2+2),q(!1)},style:{padding:"8px 12px",borderRadius:6,border:"none",background:u===Z*2+2?W:"transparent",color:u===Z*2+2?M:ne,cursor:"pointer",fontSize:14,fontWeight:u===Z*2+2?700:500,textAlign:"left",transition:"all 0.15s"},onMouseEnter:me=>{u!==Z*2+2&&(me.target.style.background=ie)},onMouseLeave:me=>{u!==Z*2+2&&(me.target.style.background="transparent")},children:x[Z*2+1]}):o.jsx("span",{})]},Z))})})]}),o.jsxs("div",{style:{padding:16,borderTop:`1px solid ${c.border}`,fontSize:11,color:c.inkMuted,display:"grid",gridTemplateColumns:"1fr 1fr",gap:"6px 16px"},children:[o.jsx("span",{children:"  Navigate"}),o.jsx("span",{children:"  Start/End"}),o.jsx("span",{children:"Space Auto-play"}),o.jsx("span",{children:"F Flip board"})]}),o.jsx("div",{style:{padding:16,borderTop:`1px solid ${c.border}`},children:o.jsx("button",{onClick:()=>{f("browse"),k(null),B(null)},style:{width:"100%",padding:"14px",background:d?"rgba(0,0,0,0.06)":"rgba(255,255,255,0.06)",border:`1px solid ${c.border}`,borderRadius:8,color:c.ink,cursor:"pointer",fontSize:13,fontWeight:500},children:" Back to Library"})})]})]})}const bi={fischer:{id:"fischer",name:"Bobby Fischer",fullName:"Robert James Fischer",born:"March 9, 1943",died:"January 17, 2008",birthPlace:"Chicago, Illinois, USA",deathPlace:"Reykjavk, Iceland",nationality:"American",titles:["World Champion (1972-1975)","Grandmaster (1958)"],peakRating:2785,worldChampion:"1972-1975",imageUrl:"https://upload.wikimedia.org/wikipedia/commons/thumb/9/9d/Bobby_Fischer_1960_in_Leipzig_in_color.jpg/440px-Bobby_Fischer_1960_in_Leipzig_in_color.jpg",imageAlt:"Bobby Fischer in 1960",imageCredit:"Wikipedia Commons",bio:`Bobby Fischer was an American chess grandmaster and the eleventh World Chess Champion. He is widely considered one of the greatest chess players of all time.

Fischer became the youngest grandmaster in history in 1958 at age 15. He won the U.S. Championship eight times, including a perfect 11-0 score in 1963/64.

His 1972 World Championship match against Boris Spassky in Reykjavk, Icelanddubbed the "Match of the Century"captivated the world during the Cold War and sparked a chess boom in America.

Fischer's famous "Game of the Century" was played when he was just 13 years old, featuring a stunning queen sacrifice against Donald Byrne.

He authored "My 60 Memorable Games" (1969), considered one of the greatest chess books ever written, and invented Fischer Random Chess (Chess960).`,famousGames:["Game of the Century vs Donald Byrne (1956)","World Championship Game 6 vs Spassky (1972)","US Championship perfect 11-0 (1963/64)"],playingStyle:"Universal player with exceptional opening preparation, endgame technique, and tactical vision. Known for relentless will to win.",quotes:["Chess demands total concentration.","I don't believe in psychology. I believe in good moves.","All I want to do, ever, is play chess."],icon:"",era:"1943-2008",pgnFile:"/pgn/Fischer.pgn",totalGames:827},carlsen:{id:"carlsen",name:"Magnus Carlsen",fullName:"Sven Magnus en Carlsen",born:"November 30, 1990",died:null,birthPlace:"Tnsberg, Norway",deathPlace:null,nationality:"Norwegian",titles:["World Champion (2013-2023)","World Rapid Champion (6x)","World Blitz Champion (9x)","Grandmaster (2004)"],peakRating:2882,worldChampion:"2013-2023",imageUrl:"https://upload.wikimedia.org/wikipedia/commons/thumb/1/1a/Magnus_Carlsen_Tata_Steel_2013.jpg/440px-Magnus_Carlsen_Tata_Steel_2013.jpg",imageAlt:"Magnus Carlsen at Tata Steel 2013",imageCredit:"Wikipedia Commons",bio:`Magnus Carlsen is a Norwegian chess grandmaster widely regarded as one of the greatest players of all time. He holds the record for the highest chess rating ever achieved (2882).

Carlsen became a grandmaster at age 13, making him one of the youngest in history. At 19, he became the youngest player to be ranked world number one.

He won the World Championship in 2013 by defeating Viswanathan Anand and successfully defended his title five times against Anand (2014), Karjakin (2016), Caruana (2018), and Nepomniachtchi (2021).

Known as the "Mozart of Chess," Carlsen excels in all phases of the game but is particularly renowned for his exceptional endgame technique and ability to win seemingly drawn positions.

In 2022, he chose not to defend his World Championship title, citing lack of motivation, but continues to dominate rapid and blitz chess.`,famousGames:["World Championship Game 9 vs Anand (2013)","125-game unbeaten streak (2018-2020)","World Championship Game 6 vs Nepomniachtchi (2021)"],playingStyle:"Universal player combining Karpov's positional mastery with Fischer's fighting spirit. Exceptional endgame technique and grinding ability.",quotes:["I am trying to beat the guy sitting across from me and trying to choose the moves that are most unpleasant for him and his style.","Some people think that if their opponent plays a beautiful game, it's okay to lose. I don't.","Without the element of enjoyment, it is not worth trying to excel at anything."],icon:"",era:"1990-",pgnFile:"/pgn/carlsen.pgn",totalGames:6615},morphy:{id:"morphy",name:"Paul Morphy",fullName:"Paul Charles Morphy",born:"June 22, 1837",died:"July 10, 1884",birthPlace:"New Orleans, Louisiana, USA",deathPlace:"New Orleans, Louisiana, USA",nationality:"American",titles:["Unofficial World Champion (1858-1859)"],peakRating:null,worldChampion:"1858-1859 (unofficial)",imageUrl:"https://upload.wikimedia.org/wikipedia/commons/thumb/3/3c/Paul_Morphy.jpg/440px-Paul_Morphy.jpg",imageAlt:"Paul Morphy portrait",imageCredit:"Wikipedia Commons (Public Domain)",bio:`Paul Morphy was an American chess player who dominated chess in the late 1850s. He is considered by many to be the greatest chess genius of all time and the first unofficial World Champion.

A child prodigy, Morphy learned chess by watching his family play and defeated Hungarian master Johann Lwenthal at age 12.

In 1857, he won the First American Chess Congress convincingly. He then traveled to Europe in 1858, defeating every strong player including Adolf Anderssen (considered the world's best) by large margins.

His most famous game, "The Opera Game" (1858), played against the Duke of Brunswick and Count Isouard at the Paris Opera, is considered the greatest chess game ever played and a perfect demonstration of rapid development.

Morphy retired from serious chess in 1859 at just 22 years old. His strategic principlesrapid development, open files, and piece coordinationwere far ahead of his time and form the foundation of modern chess.

He is known as "The Pride and Sorrow of Chess" for his brilliant but tragically brief career.`,famousGames:["The Opera Game vs Duke of Brunswick (1858)","vs Louis Paulsen - Queen sacrifice (1857)","vs Adolf Anderssen - Match victory (1858)"],playingStyle:"Attacking genius who pioneered rapid piece development and open game principles. Combined tactical brilliance with positional understanding decades ahead of his time.",quotes:["Help your pieces so they can help you.","The ability to play chess is the sign of a gentleman. The ability to play chess well is the sign of a wasted life."],icon:"",era:"1837-1884",pgnFile:"/pgn/morphy.pgn",totalGames:400},kasparov:{id:"kasparov",name:"Garry Kasparov",fullName:"Garry Kimovich Kasparov",born:"April 13, 1963",died:null,birthPlace:"Baku, Azerbaijan SSR, Soviet Union",deathPlace:null,nationality:"Russian",titles:["World Champion (1985-2000)","Grandmaster (1980)"],peakRating:2851,worldChampion:"1985-2000",imageUrl:"https://upload.wikimedia.org/wikipedia/commons/thumb/8/8b/Kasparov-34.jpg/440px-Kasparov-34.jpg",imageAlt:"Garry Kasparov",imageCredit:"Wikipedia Commons",bio:`Garry Kasparov is a Russian chess grandmaster, former World Chess Champion, writer, and political activist. He is widely considered to be the greatest chess player of all time.

Kasparov became the youngest ever undisputed World Chess Champion in 1985 at age 22 by defeating Anatoly Karpov. Their rivalry produced five world championship matches.

He held the world number one ranking for 255 months (over 21 years), the longest in chess history.

In 1997, he famously lost a match to IBM's Deep Blue computer, marking a pivotal moment in AI history.

Known for his aggressive attacking style, exceptional preparation, and psychological warfare, Kasparov revolutionized opening theory and professional chess training.`,famousGames:["Kasparov's Immortal vs Topalov (1999)","World Championship Game 16 vs Karpov (1985)","vs Deep Blue Game 1 (1996)"],playingStyle:"Aggressive, dynamic player with exceptional opening preparation and attacking skills. Known for psychological warfare and competitive intensity.",quotes:["Chess is mental torture.","Losing can persuade you to change what doesn't need to be changed.","I started playing chess when I was six years old."],icon:"",era:"1963-",pgnFile:null,totalGames:null},tal:{id:"tal",name:"Mikhail Tal",fullName:"Mikhail Nekhemyevich Tal",born:"November 9, 1936",died:"June 28, 1992",birthPlace:"Riga, Latvia",deathPlace:"Moscow, Russia",nationality:"Latvian/Soviet",titles:["World Champion (1960-1961)","Grandmaster (1957)"],peakRating:2705,worldChampion:"1960-1961",imageUrl:"https://upload.wikimedia.org/wikipedia/commons/thumb/1/11/Mikhail_Tal_1982.jpg/440px-Mikhail_Tal_1982.jpg",imageAlt:"Mikhail Tal in 1982",imageCredit:"Wikipedia Commons",bio:`Mikhail Tal, known as "The Magician from Riga," was a Soviet Latvian chess grandmaster and the eighth World Chess Champion.

Famous for his creative, aggressive, and tactical style of play, Tal's attacking games are considered among the most beautiful in chess history.

He became World Champion in 1960 by defeating Mikhail Botvinnik, becoming the youngest world champion at that time. Though he lost the rematch in 1961, he remained one of the world's top players for decades.

Despite chronic health issues, Tal won six Soviet Championships and numerous international tournaments. His 95-game unbeaten streak (1973-1974) stood as a record for decades.

Tal was beloved for his charisma, sportsmanship, and the pure joy he brought to chess. His games are studied for their artistic beauty and tactical complexity.`,famousGames:["Tal vs Larsen - Candidates 1965","Tal vs Smyslov - Candidates 1959","Tal's Attack vs Botvinnik WC 1960"],playingStyle:"Brilliant attacking player known for spectacular sacrifices and complex tactical combinations. Called 'The Magician from Riga' for his seemingly impossible victories.",quotes:["You must take your opponent into a deep dark forest where 2+2=5, and the path leading out is only wide enough for one.","There are two types of sacrifices: correct ones and mine.","Later, I began to succeed in decisive games. Perhaps because I realized a simple truth: not only was I worried, but also my opponent."],icon:"",era:"1936-1992",pgnFile:null,totalGames:null},anand:{id:"anand",name:"Viswanathan Anand",fullName:"Viswanathan Anand",born:"December 11, 1969",died:null,birthPlace:"Chennai, India",deathPlace:null,nationality:"Indian",titles:["World Champion (2007-2013)","Grandmaster (1988)"],peakRating:2817,worldChampion:"2007-2013",imageUrl:"https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Viswanathan_Anand_08_14_2005.jpg/440px-Viswanathan_Anand_08_14_2005.jpg",imageAlt:"Viswanathan Anand",imageCredit:"Wikipedia Commons",bio:`Viswanathan Anand, known as "Vishy" and the "Tiger of Madras," is an Indian chess grandmaster and former World Chess Champion.

Anand became India's first grandmaster in 1988 and has been instrumental in popularizing chess in India, inspiring a generation of Indian chess players.

He won the World Championship multiple times in different formats: FIDE knockout (2000), tournament (2007), and matches against Kramnik (2008), Topalov (2010), and Gelfand (2012).

Known for his lightning-fast intuition and exceptional speed in both calculation and physical play, Anand is considered one of the greatest rapid chess players ever.

His friendly demeanor and sportsmanship have made him one of the most beloved figures in chess history.`,famousGames:["vs Kramnik WC 2008 Game 3","vs Kasparov PCA 1995","vs Carlsen WC 2013"],playingStyle:"Fast, intuitive player with excellent tactical vision and opening preparation. Known for speed of play and adaptability.",quotes:["In chess, knowledge is a very transient thing. It changes so fast that even a single game can change the theory.","I try to play for the initiative, to attack.","Some sacrifices are sound; the rest are mine."],icon:"",era:"1969-",pgnFile:null,totalGames:null},kramnik:{id:"kramnik",name:"Vladimir Kramnik",fullName:"Vladimir Borisovich Kramnik",born:"June 25, 1975",died:null,birthPlace:"Tuapse, Russia",deathPlace:null,nationality:"Russian",titles:["World Champion (2000-2007)","Grandmaster (1991)"],peakRating:2817,worldChampion:"2000-2007",imageUrl:"https://upload.wikimedia.org/wikipedia/commons/thumb/d/da/Vladimir_Kramnik_2_%28cropped%29.jpg/440px-Vladimir_Kramnik_2_%28cropped%29.jpg",imageAlt:"Vladimir Kramnik",imageCredit:"Wikipedia Commons",bio:`Vladimir Kramnik is a Russian chess grandmaster who was the Classical World Chess Champion from 2000 to 2006 and the undisputed World Champion from 2006 to 2007.

Kramnik defeated Garry Kasparov in the 2000 World Championship match, ending Kasparov's 15-year reign. It was one of the biggest upsets in chess history.

Known for his deep positional understanding and exceptional endgame technique, Kramnik was nicknamed "the Drawmaster" for his ability to neutralize opponents' advantages.

He pioneered the Berlin Defense against the Ruy Lopez, making it a respectable weapon at the highest level.

Kramnik retired from professional chess in 2019 after a distinguished career spanning nearly three decades at the world elite level.`,famousGames:["vs Kasparov WC 2000 Game 2 - Berlin Wall","vs Topalov WC 2006","vs Deep Fritz 2006"],playingStyle:"Positional mastermind with exceptional endgame technique. Known for deep preparation and solid, grinding style.",quotes:["Chess is not for timid souls.","I think it's almost impossible to play with the computer and not lose.","My style is somewhere between that of Tal and Petrosian."],icon:"",era:"1975-",pgnFile:null,totalGames:null},capablanca:{id:"capablanca",name:"Jos Capablanca",fullName:"Jos Ral Capablanca y Graupera",born:"November 19, 1888",died:"March 8, 1942",birthPlace:"Havana, Cuba",deathPlace:"New York City, USA",nationality:"Cuban",titles:["World Champion (1921-1927)","Grandmaster"],peakRating:null,worldChampion:"1921-1927",imageUrl:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5d/JR_Capablanca_and_E_Lasker_1925.jpg/440px-JR_Capablanca_and_E_Lasker_1925.jpg",imageAlt:"Jos Capablanca",imageCredit:"Wikipedia Commons (Public Domain)",bio:`Jos Ral Capablanca was a Cuban chess player who was World Chess Champion from 1921 to 1927. He is considered one of the greatest players of all time.

A child prodigy, Capablanca learned chess at age 4 by watching his father play. He was largely self-taught and relied on natural talent rather than extensive study.

His playing style was characterized by exceptional clarity, simplicity, and technical perfection. He made difficult positions look easy.

Capablanca lost only 34 serious games in his entire career and went undefeated from 1916 to 1924, a period of eight years.

Known as the "Human Chess Machine" for his seemingly effortless play and near-perfect technique.`,famousGames:["vs Marshall 1918 - Marshall Attack refutation","vs Lasker WC 1921","vs Tartakower 1924"],playingStyle:"Pure technique and clarity. Made complex positions look simple. Exceptional endgame mastery with minimal effort.",quotes:["A good player is always lucky.","Chess books should be used as we use glasses: to assist the sight.","In order to improve your game, you must study the endgame before everything else."],icon:"",era:"1888-1942",pgnFile:null,totalGames:null},karpov:{id:"karpov",name:"Anatoly Karpov",fullName:"Anatoly Yevgenyevich Karpov",born:"May 23, 1951",died:null,birthPlace:"Zlatoust, Soviet Union",deathPlace:null,nationality:"Russian",titles:["World Champion (1975-1985)","FIDE World Champion (1993-1999)","Grandmaster (1970)"],peakRating:2780,worldChampion:"1975-1985, 1993-1999",imageUrl:"https://upload.wikimedia.org/wikipedia/commons/thumb/a/a8/Karpov%2C_Pair_rapid_2009-1.jpg/440px-Karpov%2C_Pair_rapid_2009-1.jpg",imageAlt:"Anatoly Karpov",imageCredit:"Wikipedia Commons",bio:`Anatoly Karpov is a Russian chess grandmaster and former World Chess Champion. He was the official world champion from 1975 to 1985 and FIDE World Champion from 1993 to 1999.

Karpov became World Champion in 1975 by default when Bobby Fischer refused to defend his title. He then dominated the chess world for a decade.

His legendary rivalry with Garry Kasparov produced five World Championship matches and some of the most dramatic moments in chess history.

Known for his "boa constrictor" style - slowly squeezing opponents with small advantages until they cracked. His positional mastery is considered among the best ever.

Karpov has won more tournaments and games than any other player in chess history.`,famousGames:["vs Kasparov WC 1985 Game 16","vs Kasparov WC 1987 Seville","vs Spassky Candidates 1974"],playingStyle:"Boa constrictor style - patient, positional play that slowly suffocates opponents. Master of prophylaxis and small advantages.",quotes:["Style? I have no style.","The most important thing in chess is to learn to wait.","Chess is everything: art, science, and sport."],icon:"",era:"1951-",pgnFile:null,totalGames:null}};function p5(t){return bi[t]||null}function m5({playerId:t,onSelectGame:e,onViewGames:n,onClose:i,theme:r="dark",gameCount:s=null}){const[a,l]=N.useState(null),[c,d]=N.useState("bio"),[h,f]=N.useState(!1),[p,m]=N.useState(!1);if(N.useEffect(()=>{t&&(l(p5(t)),f(!1),m(!1))},[t]),!a)return o.jsx("div",{style:rt.container(r),children:o.jsx("div",{style:rt.empty,children:"Select a player to view their profile"})});const y={dark:{bg:"#1a1a2e",card:"#16213e",text:"#e8e8e8",accent:"#4a9eff",muted:"#888"},light:{bg:"#f5f5f5",card:"#ffffff",text:"#333",accent:"#2563eb",muted:"#666"},sepia:{bg:"#f4ecd8",card:"#fffef9",text:"#5c4b37",accent:"#8b6914",muted:"#8b7355"},midnight:{bg:"#0d1117",card:"#161b22",text:"#c9d1d9",accent:"#58a6ff",muted:"#8b949e"}},x=y[r]||y.dark;return o.jsxs("div",{style:rt.container(x),children:[o.jsxs("div",{style:rt.header(x),children:[o.jsxs("h2",{style:rt.headerTitle(x),children:[a.icon," ",a.name]}),i&&o.jsx("button",{onClick:i,style:rt.closeBtn(x),children:""})]}),o.jsxs("div",{style:rt.content,children:[o.jsxs("div",{style:rt.sidebar(x),children:[o.jsxs("div",{style:rt.imageContainer(x),children:[!h&&!p&&o.jsx("div",{style:rt.imagePlaceholder(x),children:o.jsx("span",{style:{fontSize:"64px"},children:a.icon})}),!p&&o.jsx("img",{src:a.imageUrl,alt:a.imageAlt,style:{...rt.image,display:h?"block":"none"},onLoad:()=>f(!0),onError:()=>m(!0)}),p&&o.jsx("div",{style:rt.imagePlaceholder(x),children:o.jsx("span",{style:{fontSize:"64px"},children:a.icon})})]}),o.jsxs("div",{style:rt.imageCredit(x),children:[" ",a.imageCredit]}),o.jsxs("div",{style:rt.statsCard(x),children:[o.jsx("h3",{style:rt.statsTitle(x),children:"Quick Facts"}),o.jsxs("div",{style:rt.statRow(x),children:[o.jsx("span",{style:rt.statLabel(x),children:"Born:"}),o.jsx("span",{children:a.born})]}),a.died&&o.jsxs("div",{style:rt.statRow(x),children:[o.jsx("span",{style:rt.statLabel(x),children:"Died:"}),o.jsx("span",{children:a.died})]}),o.jsxs("div",{style:rt.statRow(x),children:[o.jsx("span",{style:rt.statLabel(x),children:"Birthplace:"}),o.jsx("span",{children:a.birthPlace})]}),o.jsxs("div",{style:rt.statRow(x),children:[o.jsx("span",{style:rt.statLabel(x),children:"Nationality:"}),o.jsx("span",{children:a.nationality})]}),a.peakRating&&o.jsxs("div",{style:rt.statRow(x),children:[o.jsx("span",{style:rt.statLabel(x),children:"Peak Rating:"}),o.jsx("span",{style:{fontWeight:"bold",color:x.accent},children:a.peakRating})]}),o.jsxs("div",{style:rt.statRow(x),children:[o.jsx("span",{style:rt.statLabel(x),children:"World Champion:"}),o.jsx("span",{style:{color:"#ffd700"},children:a.worldChampion})]})]}),o.jsxs("div",{style:rt.titlesCard(x),children:[o.jsx("h3",{style:rt.statsTitle(x),children:" Titles"}),a.titles.map((g,u)=>o.jsx("div",{style:rt.titleItem(x),children:g},u))]})]}),o.jsxs("div",{style:rt.mainContent(x),children:[o.jsx("div",{style:rt.tabs(x),children:["bio","style","games","quotes"].map(g=>o.jsxs("button",{onClick:()=>d(g),style:rt.tab(x,c===g),children:[g==="bio"&&" Biography",g==="style"&&" Playing Style",g==="games"&&" Famous Games",g==="quotes"&&" Quotes"]},g))}),o.jsxs("div",{style:rt.tabContent(x),children:[c==="bio"&&o.jsxs("div",{style:rt.bioContent,children:[o.jsx("h3",{style:rt.sectionTitle(x),children:a.fullName}),a.bio.split(`

`).map((g,u)=>o.jsx("p",{style:rt.paragraph(x),children:g},u))]}),c==="style"&&o.jsxs("div",{children:[o.jsx("h3",{style:rt.sectionTitle(x),children:"Playing Style"}),o.jsx("p",{style:rt.paragraph(x),children:a.playingStyle}),o.jsxs("div",{style:rt.styleCard(x),children:[o.jsx("div",{style:rt.styleIcon,children:""}),o.jsxs("div",{style:rt.styleText(x),children:["Era: ",a.era]})]})]}),c==="games"&&o.jsxs("div",{children:[o.jsx("h3",{style:rt.sectionTitle(x),children:"Famous Games"}),a.famousGames.map((g,u)=>o.jsxs("div",{style:rt.gameItem(x),onClick:()=>e&&e(g),children:[o.jsx("span",{style:rt.gameNumber(x),children:u+1}),o.jsx("span",{children:g})]},u)),(s>0||a.totalGames)&&o.jsxs("div",{style:{...rt.totalGames(x),cursor:n?"pointer":"default",transition:"all 0.2s"},onClick:()=>n&&n(t),onMouseEnter:g=>{n&&(g.target.style.transform="scale(1.02)",g.target.style.backgroundColor=`${x.accent}30`)},onMouseLeave:g=>{g.target.style.transform="scale(1)",g.target.style.backgroundColor=`${x.accent}15`},children:[" ",(s||a.totalGames||0).toLocaleString()," games in database",n&&o.jsx("span",{style:{marginLeft:8,opacity:.7},children:" View Games"})]})]}),c==="quotes"&&o.jsxs("div",{children:[o.jsx("h3",{style:rt.sectionTitle(x),children:"Notable Quotes"}),a.quotes.map((g,u)=>o.jsxs("blockquote",{style:rt.quote(x),children:['"',g,'"',o.jsxs("footer",{style:rt.quoteAuthor(x),children:[" ",a.name]})]},u))]})]})]})]})]})}const rt={container:t=>({display:"flex",flexDirection:"column",height:"100%",backgroundColor:t.bg,color:t.text,borderRadius:"12px",overflow:"hidden"}),header:t=>({display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 20px",backgroundColor:t.card,borderBottom:`1px solid ${t.muted}33`}),headerTitle:t=>({margin:0,fontSize:"24px",fontWeight:"bold",color:t.text}),closeBtn:t=>({background:"none",border:"none",color:t.muted,fontSize:"20px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",transition:"all 0.2s"}),content:{display:"flex",flex:1,overflow:"hidden",gap:"20px",padding:"20px"},sidebar:t=>({width:"280px",flexShrink:0,display:"flex",flexDirection:"column",gap:"16px",overflowY:"auto"}),imageContainer:t=>({width:"100%",aspectRatio:"3/4",borderRadius:"12px",overflow:"hidden",backgroundColor:t.card,border:`2px solid ${t.accent}33`}),image:{width:"100%",height:"100%",objectFit:"cover"},imagePlaceholder:t=>({width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:t.card}),imageCredit:t=>({fontSize:"11px",color:t.muted,textAlign:"center"}),statsCard:t=>({backgroundColor:t.card,borderRadius:"12px",padding:"16px",border:`1px solid ${t.muted}22`}),statsTitle:t=>({margin:"0 0 12px 0",fontSize:"14px",fontWeight:"bold",color:t.accent,textTransform:"uppercase",letterSpacing:"0.5px"}),statRow:t=>({display:"flex",justifyContent:"space-between",padding:"6px 0",fontSize:"13px",borderBottom:`1px solid ${t.muted}15`}),statLabel:t=>({color:t.muted,fontWeight:"500"}),titlesCard:t=>({backgroundColor:t.card,borderRadius:"12px",padding:"16px",border:`1px solid ${t.muted}22`}),titleItem:t=>({padding:"8px 12px",marginBottom:"6px",backgroundColor:`${t.accent}15`,borderRadius:"6px",fontSize:"12px",color:t.text}),mainContent:t=>({flex:1,display:"flex",flexDirection:"column",overflow:"hidden"}),tabs:t=>({display:"flex",gap:"8px",marginBottom:"16px",flexWrap:"wrap"}),tab:(t,e)=>({padding:"10px 16px",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"13px",fontWeight:"500",backgroundColor:e?t.accent:t.card,color:e?"#fff":t.text,transition:"all 0.2s"}),tabContent:t=>({flex:1,overflowY:"auto",backgroundColor:t.card,borderRadius:"12px",padding:"20px",border:`1px solid ${t.muted}22`}),sectionTitle:t=>({margin:"0 0 16px 0",fontSize:"20px",fontWeight:"bold",color:t.text}),paragraph:t=>({lineHeight:"1.7",marginBottom:"16px",color:t.text}),bioContent:{maxWidth:"700px"},styleCard:t=>({display:"flex",alignItems:"center",gap:"12px",padding:"16px",backgroundColor:`${t.accent}10`,borderRadius:"8px",marginTop:"16px"}),styleIcon:{fontSize:"32px"},styleText:t=>({fontSize:"14px",color:t.text}),gameItem:t=>({display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",marginBottom:"8px",backgroundColor:`${t.accent}10`,borderRadius:"8px",cursor:"pointer",transition:"all 0.2s",border:"1px solid transparent"}),gameNumber:t=>({width:"28px",height:"28px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:t.accent,color:"#fff",borderRadius:"50%",fontSize:"12px",fontWeight:"bold"}),totalGames:t=>({marginTop:"20px",padding:"12px",backgroundColor:`${t.accent}15`,borderRadius:"8px",textAlign:"center",fontSize:"14px",fontWeight:"500",color:t.accent}),quote:t=>({borderLeft:`4px solid ${t.accent}`,paddingLeft:"20px",marginBottom:"20px",fontStyle:"italic",fontSize:"16px",lineHeight:"1.6",color:t.text}),quoteAuthor:t=>({display:"block",marginTop:"8px",fontStyle:"normal",fontWeight:"bold",color:t.muted}),empty:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"#888"},playerGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"16px",padding:"16px"},playerCard:t=>({backgroundColor:t.card,borderRadius:"12px",padding:"20px",textAlign:"center",cursor:"pointer",transition:"all 0.2s",border:"2px solid transparent",":hover":{borderColor:t.accent}}),playerCardIcon:{fontSize:"48px",marginBottom:"12px"},playerCardName:t=>({fontSize:"16px",fontWeight:"bold",color:t.text,marginBottom:"4px"}),playerCardInfo:t=>({fontSize:"12px",color:t.muted}),playerCardGames:t=>({marginTop:"8px",padding:"4px 8px",backgroundColor:`${t.accent}20`,borderRadius:"4px",fontSize:"11px",color:t.accent,display:"inline-block"})};function d1(t,e=0){const n=[],r=t.replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(/\n\s*\n(?=\[Event\s)/),s=e>0?Math.min(e,r.length):r.length;for(let a=0;a<s;a++){const l=r[a];if(!l.trim())continue;const c=g5(l.trim(),a);c&&n.push(c)}return n}function g5(t,e=0){const n={},i=/\[(\w+)\s+"([^"]*)"\]/g;let r;for(;(r=i.exec(t))!==null;)n[r[1]]=r[2];let s=0;const a=t.match(/\]\s*\n/g);if(a){let f=0,p=t;for(const m of a){const y=p.indexOf(m);f+=y+m.length,p=p.slice(y+m.length)}s=f}let c=t.slice(s).trim().replace(/\{[^}]*\}/g,"").replace(/;[^\n]*/g,"").replace(/\([^)]*\)/g,"").replace(/\$\d+/g,"").replace(/\s+/g," ").trim();if(!n.White||!n.Black)return null;const d=b5(n.White,n.Black),h=x5(n,c);return{id:y5(n,e,c),white:n.White,black:n.Black,result:n.Result||"*",year:n.Date?parseInt(n.Date.split(".")[0]):null,date:n.Date||null,event:n.Event||"Unknown",site:n.Site||"",round:n.Round||"",eco:n.ECO||"",whiteElo:n.WhiteElo||"",blackElo:n.BlackElo||"",title:`${n.White} vs ${n.Black}`,description:v5(n),pgn:h,moves:c,category:d}}function x5(t,e){const n=[],i=["Event","Site","Date","Round","White","Black","Result"];for(const s of i)n.push(`[${s} "${t[s]||"?"}"]`);const r=["WhiteElo","BlackElo","ECO","Opening"];for(const s of r)t[s]&&n.push(`[${s} "${t[s]}"]`);return n.push(""),n.push(e),n.join(`
`)}function y5(t,e=0,n=""){const i=(t.White||"").toLowerCase().replace(/[^a-z0-9]/g,"").slice(0,10),r=(t.Black||"").toLowerCase().replace(/[^a-z0-9]/g,"").slice(0,10),s=(t.Date||"").replace(/\./g,"").replace(/\?/g,""),a=(t.Round||"").replace(/[^0-9]/g,""),l=(t.ECO||"").replace(/[^A-Za-z0-9]/g,"");let c=0;const d=(n||"").slice(0,50);for(let f=0;f<d.length;f++)c=(c<<5)-c+d.charCodeAt(f),c=c&c;const h=Math.abs(c).toString(36).slice(0,4);return`${i}-${r}-${s||"nodate"}-${l||"x"}-${a||"r"}-${e}-${h}`}function v5(t){const e=[];if(t.Event&&t.Event!=="?"&&e.push(t.Event),t.Site&&t.Site!=="?"&&e.push(t.Site),t.Date&&t.Date!=="????.??.??"){const n=t.Date.split(".")[0];n!=="????"&&e.push(n)}return t.ECO&&e.push(`ECO: ${t.ECO}`),e.join("  ")||"Chess game"}function b5(t,e){const n=[t,e].join(" ").toLowerCase();return n.includes("morphy")?"morphy":n.includes("fischer")?"fischer":n.includes("carlsen")?"carlsen":n.includes("kasparov")?"kasparov":n.includes("tal")?"tal":n.includes("capablanca")?"capablanca":n.includes("alekhine")?"alekhine":n.includes("anand")?"anand":n.includes("kramnik")?"kramnik":n.includes("karpov")?"karpov":n.includes("steinitz")?"steinitz":n.includes("lasker")?"lasker":n.includes("caruana")?"caruana":n.includes("ding")?"ding":"modern"}const _5={carlsen:{...bi.carlsen,file:"/pgn/carlsen.pgn"},fischer:{...bi.fischer,file:"/pgn/Fischer.pgn"},morphy:{...bi.morphy,file:"/pgn/morphy.pgn"}};function S5(t){return(t.match(/\[Event\s+"/g)||[]).length}async function w5(t){return new Promise(e=>{const n=new FileReader;n.onload=async i=>{const r=i.target.result,s=new DataView(r),a={title:null,artist:null,album:null,year:null,artwork:null,duration:null};try{const l=new Audio;l.src=URL.createObjectURL(t),await new Promise(c=>{l.onloadedmetadata=()=>{a.duration=Math.round(l.duration),URL.revokeObjectURL(l.src),c()},l.onerror=()=>c()})}catch(l){console.warn("Could not read duration:",l)}if(s.getUint8(0)===73&&s.getUint8(1)===68&&s.getUint8(2)===51){const l=s.getUint8(3);s.getUint8(5);const c=Zg(s,6);let d=10;const h=10+c;for(;d<h&&d<r.byteLength-10;){const f=String.fromCharCode(s.getUint8(d),s.getUint8(d+1),s.getUint8(d+2),s.getUint8(d+3));if(f==="\0\0\0\0"||f[0]==="\0")break;const p=l>=4?Zg(s,d+4):s.getUint32(d+4);if(p<=0||p>r.byteLength)break;const m=new Uint8Array(r,d+10,p);switch(f){case"TIT2":a.title=Bl(m);break;case"TPE1":a.artist=Bl(m);break;case"TALB":a.album=Bl(m);break;case"TYER":case"TDRC":a.year=Bl(m);break;case"APIC":a.artwork=k5(m);break}d+=10+p}}if(!a.title&&r.byteLength>128){const l=r.byteLength-128;String.fromCharCode(s.getUint8(l),s.getUint8(l+1),s.getUint8(l+2))==="TAG"&&(a.title=Il(s,l+3,30),a.artist=Il(s,l+33,30),a.album=Il(s,l+63,30),a.year=Il(s,l+93,4))}a.title||(a.title=t.name.replace(/\.[^/.]+$/,"").replace(/_/g," ")),e(a)},n.onerror=()=>{e({title:t.name.replace(/\.[^/.]+$/,"").replace(/_/g," "),artist:null,album:null,year:null,artwork:null,duration:null})},n.readAsArrayBuffer(t)})}function Zg(t,e){return(t.getUint8(e)&127)<<21|(t.getUint8(e+1)&127)<<14|(t.getUint8(e+2)&127)<<7|t.getUint8(e+3)&127}function Bl(t){if(t.length===0)return null;const e=t[0],n=t.slice(1);try{switch(e){case 0:return new TextDecoder("iso-8859-1").decode(n).replace(/\0/g,"").trim();case 1:case 2:return new TextDecoder("utf-16").decode(n).replace(/\0/g,"").trim();case 3:return new TextDecoder("utf-8").decode(n).replace(/\0/g,"").trim();default:return new TextDecoder("iso-8859-1").decode(n).replace(/\0/g,"").trim()}}catch{return null}}function Il(t,e,n){let i="";for(let r=0;r<n;r++){const s=t.getUint8(e+r);if(s===0)break;i+=String.fromCharCode(s)}return i.trim()||null}function k5(t){try{const e=t[0];let n=1,i="";for(;n<t.length&&t[n]!==0;)i+=String.fromCharCode(t[n]),n++;if(n++,n++,e===1||e===2)for(;n<t.length-1;){if(t[n]===0&&t[n+1]===0){n+=2;break}n++}else{for(;n<t.length&&t[n]!==0;)n++;n++}const r=t.slice(n);if(r.length<100)return null;(!i||i==="image/")&&(r[0]===255&&r[1]===216?i="image/jpeg":r[0]===137&&r[1]===80?i="image/png":i="image/jpeg");const s=new Blob([r],{type:i});return URL.createObjectURL(s)}catch(e){return console.warn("Failed to extract album art:",e),null}}function Jg(t){if(!t)return"--:--";const e=Math.floor(t/60),n=Math.floor(t%60);return`${e}:${n.toString().padStart(2,"0")}`}const Lc=(t,e=5e3)=>new Promise(n=>{const i=new Image,r=setTimeout(()=>{i.src="",n({success:!1,error:"timeout"})},e);i.onload=()=>{clearTimeout(r),n({success:!0,url:t})},i.onerror=()=>{clearTimeout(r),n({success:!1,error:"load_failed"})},i.src=t}),M5=async t=>{var n,i;const e=`https://en.wikipedia.org/w/api.php?action=query&titles=${encodeURIComponent(t)}&prop=pageimages&format=json&origin=*&pithumbsize=400`;try{const r=await fetch(e);if(!r.ok)return{success:!1,error:"api_error"};const a=((n=(await r.json()).query)==null?void 0:n.pages)||{},l=Object.values(a)[0],c=(i=l==null?void 0:l.thumbnail)==null?void 0:i.source;if(!c)return{success:!1,error:"no_image"};const d=await Lc(c);return d.success?{success:!0,url:c,source:"Wikipedia Main",label:"Main Article Image"}:d}catch(r){return{success:!1,error:r.message}}},R5=async t=>{var n,i;const e=`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(t)}`;try{const r=await fetch(e);if(!r.ok)return{success:!1,error:"api_error"};const s=await r.json(),a=[];return(n=s.thumbnail)!=null&&n.source&&(await Lc(s.thumbnail.source)).success&&a.push({url:s.thumbnail.source,source:"Wikipedia Summary",label:"Summary Thumbnail"}),(i=s.originalimage)!=null&&i.source&&(await Lc(s.originalimage.source)).success&&a.push({url:s.originalimage.source,source:"Wikipedia Original",label:"Original (High Res)"}),{success:a.length>0,images:a}}catch(r){return{success:!1,error:r.message}}},E5=async(t,e=6)=>{var i,r,s;const n=`https://commons.wikimedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(t+" chess")}&srnamespace=6&format=json&origin=*&srlimit=${e}`;try{const a=await fetch(n);if(!a.ok)return{success:!1,error:"api_error"};const l=await a.json(),c=[];if((i=l.query)!=null&&i.search)for(const d of l.query.search){const h=d.title.replace("File:",""),f=`https://commons.wikimedia.org/w/api.php?action=query&titles=${encodeURIComponent(d.title)}&prop=imageinfo&iiprop=url|thumburl&iiurlwidth=400&format=json&origin=*`;try{const y=((r=(await(await fetch(f)).json()).query)==null?void 0:r.pages)||{},x=Object.values(y)[0],g=(s=x==null?void 0:x.imageinfo)==null?void 0:s[0];g!=null&&g.thumburl&&(await Lc(g.thumburl)).success&&c.push({url:g.thumburl,source:"Wikimedia Commons",label:h.substring(0,40)+(h.length>40?"...":"")})}catch{console.warn("Failed to get file info for:",d.title)}}return{success:c.length>0,images:c}}catch(a){return{success:!1,error:a.message}}},C5=async(t,e)=>{const n=[],i=new Set;e==null||e({stage:"searching",message:"Searching Wikipedia..."});const r=await M5(t);r.success&&!i.has(r.url)&&(i.add(r.url),n.push(r)),e==null||e({stage:"searching",message:"Checking additional sources..."});const s=await R5(t);s.success&&s.images.forEach(l=>{i.has(l.url)||(i.add(l.url),n.push(l))}),e==null||e({stage:"searching",message:"Searching Wikimedia Commons..."});const a=await E5(t);return a.success&&a.images.forEach(l=>{i.has(l.url)||(i.add(l.url),n.push(l))}),e==null||e({stage:"complete",message:`Found ${n.length} verified images`}),{success:n.length>0,images:n,count:n.length}};function T5({theme:t,onClose:e,onPlayersUpdated:n}){var nt,yt,mt;const[i,r]=N.useState("players"),[s,a]=N.useState("import"),[l,c]=N.useState("fischer"),[d,h]=N.useState(null),[f,p]=N.useState(""),[m,y]=N.useState(0),[x,g]=N.useState([]),[u,v]=N.useState({}),[b,w]=N.useState({}),[R,C]=N.useState(!1),[A,B]=N.useState(0),[S,k]=N.useState(""),[U,O]=N.useState([]),[X,K]=N.useState(!1),[$,q]=N.useState([]),[J,V]=N.useState(!1),[ue,F]=N.useState(null),[de,Te]=N.useState([]),[xe,le]=N.useState(!1),[Re,Q]=N.useState(null),[ae,Me]=N.useState(null),[ze,se]=N.useState(!1),ke=N.useRef(null),[Ge,Oe]=N.useState({}),[Ve,Ze]=N.useState(!1),[Ue,tt]=N.useState({name:"",fullName:"",icon:"Chess",born:"",died:"",birthPlace:"",nationality:"",titles:"",peakRating:"",worldChampion:"",bio:"",playingStyle:"",era:"",imageUrl:""}),z=N.useRef(null),ht=N.useRef(null);N.useRef(null);const Xe=()=>{p(""),y(0),g([]),h(null),B(0)},Je=E=>{E!==l&&Xe(),c(E),Ze(!1)},ee=async E=>{var be,qe,at,I,St,Le;if(E.trim()){K(!0),O([]);try{const Pt=`https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(E+" chess player")}&format=json&origin=*&srlimit=5`,kt=await(await fetch(Pt)).json();if(((qe=(be=kt.query)==null?void 0:be.search)==null?void 0:qe.length)>0){const En=[];for(const di of kt.query.search.slice(0,3)){const $e=di.title,dr=`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent($e)}`;try{const Cn=await(await fetch(dr)).json();En.push({title:Cn.title,description:Cn.description||"",extract:Cn.extract||"",imageUrl:((at=Cn.thumbnail)==null?void 0:at.source)||((I=Cn.originalimage)==null?void 0:I.source)||"",pageUrl:((Le=(St=Cn.content_urls)==null?void 0:St.desktop)==null?void 0:Le.page)||""})}catch(Jn){console.warn("Failed to get Wikipedia summary:",Jn)}}O(En)}}catch(Pt){console.error("Wikipedia search error:",Pt)}finally{K(!1)}}},P=E=>{const be=E.extract.match(/born\s+(\w+\s+\d+,?\s+\d{4})/i),qe=E.extract.match(/died\s+(\w+\s+\d+,?\s+\d{4})/i),at=E.extract.match(/is\s+an?\s+(\w+)\s+chess/i)||E.extract.match(/was\s+an?\s+(\w+)\s+chess/i),I=E.extract.match(/peak.*?rating.*?(\d{4})/i)||E.extract.match(/(\d{4}).*?rating/i);tt(St=>({...St,name:E.title,fullName:E.title,bio:E.extract.slice(0,500)+(E.extract.length>500?"...":""),imageUrl:E.imageUrl,born:be?be[1]:St.born,died:qe?qe[1]:St.died,nationality:at?at[1]:St.nationality,peakRating:I?I[1]:St.peakRating})),O([]),k("")},_=async E=>{V(!0),q([]),F(null),console.log("=== FETCHING PHOTO OPTIONS FOR:",E,"===");try{const be=await C5(E,qe=>{h({type:"loading",message:qe.message})});be.success?(q(be.images),h({type:"success",message:`${be.count} photos verified and ready`})):h({type:"error",message:"No photos found. Try a different search term."})}catch(be){console.error("Error fetching photo options:",be),h({type:"error",message:"Failed to fetch photos: "+be.message})}finally{V(!1)}},W=async E=>{if(E){h({type:"loading",message:"Saving photo..."});try{if(!!Ge[l]){const{error:qe}=await Bn.updateCustomPlayerImage(l,E);if(qe)throw qe;Oe(at=>({...at,[l]:{...at[l],imageUrl:E}}))}else{const qe={...u[l]||{},customImageUrl:E},{error:at}=await Bn.savePlayerOverride(l,qe);if(at)throw at;v(I=>({...I,[l]:qe}))}h({type:"success",message:" Photo saved to database!"}),F(E),q([]),n==null||n()}catch(be){console.error("Error saving photo:",be),h({type:"error",message:"Failed to save: "+be.message})}}},M={bg:(t==null?void 0:t.bg)||"#141416",card:(t==null?void 0:t.card)||"#1c1c20",text:(t==null?void 0:t.ink)||"#e8e8e8",muted:(t==null?void 0:t.inkMuted)||"#888",accent:(t==null?void 0:t.accent)||"#4a9eff",border:(t==null?void 0:t.border)||"rgba(255,255,255,0.1)",success:"#4caf50",error:"#f44336"};N.useEffect(()=>{ne(),_e()},[]);const _e=async()=>{},ne=async()=>{{h({type:"error",message:"Supabase not configured. Check your environment variables."});return}},Ie=async E=>{var at,I;E.preventDefault(),se(!1);const qe=Array.from(((at=E.dataTransfer)==null?void 0:at.files)||((I=E.target)==null?void 0:I.files)||[]).find(St=>St.type.startsWith("audio/")||St.name.endsWith(".mp3"));if(!qe){h({type:"error",message:"Please drop an MP3 audio file"});return}await ie(qe)},ie=async E=>{le(!0),h({type:"loading",message:"Reading audio metadata..."});try{const be=await w5(E);Q({file:E,title:be.title||E.name.replace(/\.[^/.]+$/,""),artist:be.artist||"",album:be.album||"",duration:be.duration,artworkUrl:be.artwork,artworkBlob:be.artwork?await fetch(be.artwork).then(qe=>qe.blob()):null,modes:["zone"],tags:[]}),h({type:"success",message:"Metadata extracted! Review and save."})}catch(be){console.error("Error processing audio:",be),h({type:"error",message:`Failed to process: ${be.message}`})}finally{le(!1)}},Se=async()=>{},we=async E=>{},ve=E=>{Re&&Q(be=>({...be,modes:be.modes.includes(E)?be.modes.filter(qe=>qe!==E):[...be.modes,E]}))},Ee=async()=>{if(!Ue.name.trim()){h({type:"error",message:"Player name is required"});return}{h({type:"error",message:"Supabase not configured"});return}},he=async E=>{{h({type:"error",message:"Supabase not configured"});return}},Z=E=>{const be=E.target.files[0];if(!be)return;h({type:"loading",message:"Reading file..."});const qe=new FileReader;qe.onload=at=>{const I=at.target.result;p(I);const St=S5(I);y(St);const Le=d1(I,10);g(Le),h({type:"success",message:`Found ${St.toLocaleString()} games in ${be.name}`})},qe.onerror=()=>{h({type:"error",message:"Failed to read file"})},qe.readAsText(be)},me=async E=>{if(E.target.files[0]){h({type:"error",message:"Supabase not configured"});return}},Ke=async()=>{if(!f||m===0){h({type:"error",message:"No games to import"});return}{h({type:"error",message:"Supabase not configured. Check your environment variables."});return}},[G,Be]=N.useState(!1),Pe=async()=>{{h({type:"error",message:"Supabase not configured"});return}},je=async(E,be)=>{{h({type:"error",message:"Supabase not configured"});return}},fe=(E=>{if(Ge[E]){const at=Ge[E],I=u[E]||{};return{...at,imageUrl:I.customImageUrl||at.imageUrl,bio:I.customBio||at.bio,fullName:I.fullName||at.fullName,born:I.born||at.born,died:I.died||at.died,nationality:I.nationality||at.nationality,peakRating:I.peakRating||at.peakRating,worldChampion:I.worldChampion||at.worldChampion,playingStyle:I.playingStyle||at.playingStyle,isCustom:!0}}const be=bi[E]||{},qe=u[E]||{};return{...be,imageUrl:qe.customImageUrl||be.imageUrl,bio:qe.customBio||be.bio,fullName:qe.fullName||be.fullName,born:qe.born||be.born,died:qe.died||be.died,nationality:qe.nationality||be.nationality,peakRating:qe.peakRating||be.peakRating,worldChampion:qe.worldChampion||be.worldChampion,playingStyle:qe.playingStyle||be.playingStyle,isCustom:!1}})(l),Fe=b[l]||0;return o.jsxs("div",{style:Ce.container(M),children:[o.jsxs("div",{style:Ce.header(M),children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:20},children:[o.jsx("h2",{style:Ce.title(M),children:" Admin Panel"}),o.jsxs("div",{style:{display:"flex",gap:4,background:"rgba(255,255,255,0.05)",padding:4,borderRadius:8},children:[o.jsx("button",{onClick:()=>r("players"),style:{padding:"8px 16px",border:"none",borderRadius:6,background:i==="players"?M.accent:"transparent",color:i==="players"?"#fff":M.muted,cursor:"pointer",fontWeight:500,fontSize:13,transition:"all 0.2s"},children:"Chess Players"}),o.jsxs("button",{onClick:()=>r("audio"),style:{padding:"8px 16px",border:"none",borderRadius:6,background:i==="audio"?M.accent:"transparent",color:i==="audio"?"#fff":M.muted,cursor:"pointer",fontWeight:500,fontSize:13,transition:"all 0.2s"},children:[" Audio (",de.length,")"]}),o.jsx("button",{onClick:()=>r("system"),style:{padding:"8px 16px",border:"none",borderRadius:6,background:i==="system"?M.accent:"transparent",color:i==="system"?"#fff":M.muted,cursor:"pointer",fontWeight:500,fontSize:13,transition:"all 0.2s"},children:" System"})]})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[o.jsx("span",{style:{color:M.error,fontSize:13},children:"Warning: Supabase not configured"}),o.jsx("button",{onClick:e,style:Ce.closeBtn(M),children:""})]})]}),i==="audio"&&o.jsx("div",{style:{flex:1,overflow:"auto",padding:24},children:o.jsxs("div",{style:{maxWidth:900,margin:"0 auto"},children:[o.jsxs("div",{onDragOver:E=>{E.preventDefault(),se(!0)},onDragLeave:()=>se(!1),onDrop:Ie,onClick:()=>{var E;return(E=ke.current)==null?void 0:E.click()},style:{padding:40,border:`2px dashed ${ze?M.accent:M.border}`,borderRadius:12,textAlign:"center",cursor:"pointer",background:ze?`${M.accent}10`:"transparent",transition:"all 0.2s",marginBottom:24},children:[o.jsx("input",{ref:ke,type:"file",accept:"audio/mp3,audio/mpeg,.mp3",onChange:E=>E.target.files[0]&&ie(E.target.files[0]),style:{display:"none"}}),o.jsx("div",{style:{fontSize:48,marginBottom:12},children:""}),o.jsx("div",{style:{fontWeight:500,marginBottom:8,color:M.text},children:"Drop MP3 file here or click to browse"}),o.jsx("div",{style:{fontSize:13,color:M.muted},children:"Metadata (title, artist, album art) will be extracted automatically"})]}),Re&&o.jsxs("div",{style:{background:M.card,borderRadius:12,padding:20,marginBottom:24,border:`1px solid ${M.border}`},children:[o.jsx("h3",{style:{margin:"0 0 16px",color:M.text},children:" New Track"}),o.jsxs("div",{style:{display:"flex",gap:20},children:[o.jsx("div",{style:{width:120,height:120,borderRadius:8,background:M.bg,overflow:"hidden",flexShrink:0},children:Re.artworkUrl?o.jsx("img",{src:Re.artworkUrl,alt:"Album art",style:{width:"100%",height:"100%",objectFit:"cover"}}):o.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:M.muted,fontSize:40},children:""})}),o.jsxs("div",{style:{flex:1},children:[o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:12},children:[o.jsxs("div",{children:[o.jsx("label",{style:{fontSize:11,color:M.muted,display:"block",marginBottom:4},children:"TITLE"}),o.jsx("input",{type:"text",value:Re.title,onChange:E=>Q(be=>({...be,title:E.target.value})),style:Ce.input(M)})]}),o.jsxs("div",{children:[o.jsx("label",{style:{fontSize:11,color:M.muted,display:"block",marginBottom:4},children:"ARTIST"}),o.jsx("input",{type:"text",value:Re.artist,onChange:E=>Q(be=>({...be,artist:E.target.value})),style:Ce.input(M)})]})]}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:12,marginBottom:16},children:[o.jsxs("div",{children:[o.jsx("label",{style:{fontSize:11,color:M.muted,display:"block",marginBottom:4},children:"ALBUM"}),o.jsx("input",{type:"text",value:Re.album,onChange:E=>Q(be=>({...be,album:E.target.value})),style:Ce.input(M)})]}),o.jsxs("div",{children:[o.jsx("label",{style:{fontSize:11,color:M.muted,display:"block",marginBottom:4},children:"DURATION"}),o.jsx("div",{style:{padding:"10px 12px",background:M.bg,borderRadius:6,color:M.text},children:Jg(Re.duration)})]})]}),o.jsxs("div",{style:{marginBottom:16},children:[o.jsx("label",{style:{fontSize:11,color:M.muted,display:"block",marginBottom:8},children:"PLAY IN MODES"}),o.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:["zone","casual","puzzle","analysis","menu"].map(E=>o.jsxs("button",{onClick:()=>ve(E),style:{padding:"6px 12px",border:`1px solid ${Re.modes.includes(E)?M.accent:M.border}`,borderRadius:6,background:Re.modes.includes(E)?`${M.accent}20`:"transparent",color:Re.modes.includes(E)?M.accent:M.muted,cursor:"pointer",fontSize:12,textTransform:"capitalize"},children:[Re.modes.includes(E)?" ":"",E]},E))})]}),o.jsxs("div",{style:{display:"flex",gap:12},children:[o.jsx("button",{onClick:Se,disabled:xe||!Re.title,style:{flex:1,padding:"12px 20px",border:"none",borderRadius:8,background:xe?M.muted:M.accent,color:"#fff",cursor:xe?"wait":"pointer",fontWeight:600},children:xe?"Uploading...":" Save Track"}),o.jsx("button",{onClick:()=>{Re.artworkUrl&&URL.revokeObjectURL(Re.artworkUrl),Q(null)},style:{padding:"12px 20px",border:`1px solid ${M.border}`,borderRadius:8,background:"transparent",color:M.text,cursor:"pointer"},children:"Cancel"})]})]})]})]}),d&&o.jsxs("div",{style:{padding:"12px 16px",borderRadius:8,marginBottom:16,background:d.type==="error"?`${M.error}20`:d.type==="success"?`${M.success}20`:`${M.accent}20`,color:d.type==="error"?M.error:d.type==="success"?M.success:M.accent,fontSize:13},children:[d.type==="loading"&&" ",d.type==="success"&&" ",d.type==="error"&&" ",d.message]}),o.jsxs("h3",{style:{margin:"0 0 16px",color:M.text},children:[" Audio Library (",de.length," tracks)"]}),de.length===0?o.jsxs("div",{style:{padding:40,textAlign:"center",color:M.muted,background:M.card,borderRadius:12},children:[o.jsx("div",{style:{fontSize:48,marginBottom:12},children:""}),o.jsx("div",{children:"No audio tracks yet. Upload your first track above!"})]}):o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:de.map(E=>o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,padding:12,background:M.card,borderRadius:8,border:`1px solid ${M.border}`},children:[o.jsx("div",{style:{width:50,height:50,borderRadius:6,background:M.bg,overflow:"hidden",flexShrink:0},children:E.artwork_url?o.jsx("img",{src:E.artwork_url,alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}}):o.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:M.muted},children:""})}),o.jsxs("div",{style:{flex:1,minWidth:0},children:[o.jsx("div",{style:{fontWeight:500,color:M.text,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:E.title}),o.jsxs("div",{style:{fontSize:12,color:M.muted},children:[E.artist||"Unknown Artist"," ",E.album&&` ${E.album}`]})]}),o.jsx("div",{style:{fontSize:13,color:M.muted,flexShrink:0},children:Jg(E.duration)}),o.jsx("div",{style:{display:"flex",gap:4,flexShrink:0},children:(E.modes||["zone"]).map(be=>o.jsx("span",{style:{padding:"2px 6px",fontSize:10,background:`${M.accent}20`,color:M.accent,borderRadius:4,textTransform:"uppercase"},children:be},be))}),o.jsx("button",{onClick:()=>we(E.id),style:{padding:"6px 10px",border:`1px solid ${M.error}40`,borderRadius:6,background:"transparent",color:M.error,cursor:"pointer",fontSize:12},children:""})]},E.id))})]})}),i==="system"&&o.jsx(A5,{colors:M}),i==="players"&&o.jsxs("div",{style:Ce.content,children:[o.jsxs("div",{style:Ce.sidebar(M),children:[o.jsx("h3",{style:Ce.sidebarTitle(M),children:"BUILT-IN PLAYERS"}),Object.entries(bi).map(([E,be])=>o.jsxs("button",{onClick:()=>Je(E),style:Ce.playerBtn(M,l===E&&!Ve),children:[o.jsx("span",{style:{fontSize:20},children:be.icon}),o.jsxs("div",{children:[o.jsx("div",{style:{fontWeight:500},children:be.name}),o.jsxs("div",{style:{fontSize:11,opacity:.7},children:[(b[E]||0).toLocaleString()," games in DB"]})]})]},E)),Object.keys(Ge).length>0&&o.jsxs(o.Fragment,{children:[o.jsx("h3",{style:{...Ce.sidebarTitle(M),marginTop:20},children:"CUSTOM PLAYERS"}),Object.entries(Ge).map(([E,be])=>o.jsxs("button",{onClick:()=>Je(E),style:Ce.playerBtn(M,l===E&&!Ve),children:[o.jsx("span",{style:{fontSize:20},children:be.icon}),o.jsxs("div",{children:[o.jsx("div",{style:{fontWeight:500},children:be.name}),o.jsxs("div",{style:{fontSize:11,opacity:.7},children:[(b[E]||0).toLocaleString()," games in DB"]})]})]},E))]}),o.jsxs("button",{onClick:()=>{Xe(),Ze(!0)},style:{...Ce.playerBtn(M,Ve),marginTop:20,background:Ve?M.accent:`${M.accent}20`,borderColor:M.accent,justifyContent:"center"},children:[o.jsx("span",{style:{fontSize:18,marginRight:8},children:""}),o.jsx("span",{style:{fontWeight:600},children:"Add New Player"})]})]}),o.jsx("div",{style:Ce.mainPanel(M),children:Ve?o.jsxs("div",{style:Ce.section(M),children:[o.jsx("h3",{style:Ce.sectionTitle(M),children:" Add New Player"}),o.jsxs("div",{style:{background:`${M.accent}15`,border:`1px solid ${M.accent}40`,borderRadius:12,padding:16,marginBottom:24},children:[o.jsx("label",{style:{...Ce.label(M),color:M.accent,marginBottom:8,display:"block"},children:" Search Wikipedia for Player Info"}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("input",{type:"text",value:S,onChange:E=>k(E.target.value),onKeyDown:E=>E.key==="Enter"&&ee(S),placeholder:"Enter player name (e.g., Hikaru Nakamura)",style:{...Ce.input(M),flex:1}}),o.jsx("button",{onClick:()=>ee(S),disabled:X||!S.trim(),style:{padding:"10px 20px",borderRadius:8,border:"none",background:M.accent,color:"#fff",fontWeight:600,cursor:X||!S.trim()?"not-allowed":"pointer",opacity:X||!S.trim()?.5:1},children:X?"...":"Search"})]}),U.length>0&&o.jsxs("div",{style:{marginTop:12},children:[o.jsx("div",{style:{fontSize:12,color:M.muted,marginBottom:8},children:"Select a player to populate the form:"}),U.map((E,be)=>{var qe,at;return o.jsxs("div",{onClick:()=>P(E),style:{display:"flex",gap:12,padding:12,background:M.card,borderRadius:8,marginBottom:8,border:`1px solid ${M.border}`,cursor:"pointer",transition:"all 0.2s"},onMouseOver:I=>I.currentTarget.style.borderColor=M.accent,onMouseOut:I=>I.currentTarget.style.borderColor=M.border,children:[E.imageUrl&&o.jsx("img",{src:E.imageUrl,alt:"",style:{width:70,height:70,objectFit:"cover",borderRadius:8}}),!E.imageUrl&&o.jsx("div",{style:{width:70,height:70,borderRadius:8,background:M.bg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:24,color:M.muted},children:(qe=E.title)==null?void 0:qe.charAt(0)}),o.jsxs("div",{style:{flex:1,minWidth:0},children:[o.jsx("div",{style:{fontWeight:600,color:M.text,marginBottom:2},children:E.title}),o.jsx("div",{style:{fontSize:11,color:M.accent,marginBottom:4},children:E.description}),o.jsxs("div",{style:{fontSize:12,color:M.muted,lineHeight:1.4},children:[(at=E.extract)==null?void 0:at.slice(0,120),"..."]})]}),o.jsx("div",{style:{padding:"8px 16px",background:`${M.accent}20`,borderRadius:6,fontSize:13,fontWeight:600,color:M.accent,alignSelf:"center",whiteSpace:"nowrap"},children:"Select "})]},be)})]})]}),o.jsx("p",{style:{fontSize:13,color:M.muted,marginBottom:20},children:Ue.name?o.jsx("span",{style:{color:M.success,fontWeight:500},children:' Form populated from Wikipedia! Review the details below and click "Create Player" to save.'}):"Or fill in the details manually:"}),Ue.imageUrl&&o.jsxs("div",{style:{marginBottom:16,display:"flex",alignItems:"center",gap:16,padding:12,background:`${M.success}15`,borderRadius:8,border:`1px solid ${M.success}40`},children:[o.jsx("img",{src:Ue.imageUrl,alt:"Player",style:{width:80,height:80,objectFit:"cover",borderRadius:12}}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:12,color:M.muted,marginBottom:4},children:"Image from Wikipedia"}),o.jsx("button",{onClick:()=>tt(E=>({...E,imageUrl:""})),style:{fontSize:11,color:M.error,background:"none",border:"none",cursor:"pointer"},children:"Remove"})]})]}),o.jsxs("div",{style:Ce.formRow,children:[o.jsxs("div",{style:Ce.formGroup(M),children:[o.jsx("label",{style:Ce.label(M),children:"Name *"}),o.jsx("input",{type:"text",value:Ue.name,onChange:E=>tt(be=>({...be,name:E.target.value})),placeholder:"e.g., Hikaru Nakamura",style:Ce.input(M)})]}),o.jsxs("div",{style:Ce.formGroup(M),children:[o.jsx("label",{style:Ce.label(M),children:"Full Name"}),o.jsx("input",{type:"text",value:Ue.fullName,onChange:E=>tt(be=>({...be,fullName:E.target.value})),placeholder:"e.g., Hikaru Nakamura",style:Ce.input(M)})]})]}),o.jsxs("div",{style:Ce.formRow,children:[o.jsxs("div",{style:{...Ce.formGroup(M),flex:"0 0 80px"},children:[o.jsx("label",{style:Ce.label(M),children:"Icon"}),o.jsx("input",{type:"text",value:Ue.icon,onChange:E=>tt(be=>({...be,icon:E.target.value})),placeholder:"Chess",style:{...Ce.input(M),textAlign:"center",fontSize:20},maxLength:2})]}),o.jsxs("div",{style:Ce.formGroup(M),children:[o.jsx("label",{style:Ce.label(M),children:"Nationality"}),o.jsx("input",{type:"text",value:Ue.nationality,onChange:E=>tt(be=>({...be,nationality:E.target.value})),placeholder:"e.g., American",style:Ce.input(M)})]}),o.jsxs("div",{style:Ce.formGroup(M),children:[o.jsx("label",{style:Ce.label(M),children:"Era"}),o.jsx("input",{type:"text",value:Ue.era,onChange:E=>tt(be=>({...be,era:E.target.value})),placeholder:"e.g., Modern",style:Ce.input(M)})]})]}),o.jsxs("div",{style:Ce.formRow,children:[o.jsxs("div",{style:Ce.formGroup(M),children:[o.jsx("label",{style:Ce.label(M),children:"Born"}),o.jsx("input",{type:"text",value:Ue.born,onChange:E=>tt(be=>({...be,born:E.target.value})),placeholder:"e.g., December 9, 1987",style:Ce.input(M)})]}),o.jsxs("div",{style:Ce.formGroup(M),children:[o.jsx("label",{style:Ce.label(M),children:"Died (leave empty if alive)"}),o.jsx("input",{type:"text",value:Ue.died,onChange:E=>tt(be=>({...be,died:E.target.value})),placeholder:"",style:Ce.input(M)})]})]}),o.jsxs("div",{style:Ce.formRow,children:[o.jsxs("div",{style:Ce.formGroup(M),children:[o.jsx("label",{style:Ce.label(M),children:"Birth Place"}),o.jsx("input",{type:"text",value:Ue.birthPlace,onChange:E=>tt(be=>({...be,birthPlace:E.target.value})),placeholder:"e.g., Hirakata, Japan",style:Ce.input(M)})]}),o.jsxs("div",{style:Ce.formGroup(M),children:[o.jsx("label",{style:Ce.label(M),children:"Peak Rating"}),o.jsx("input",{type:"number",value:Ue.peakRating,onChange:E=>tt(be=>({...be,peakRating:E.target.value})),placeholder:"e.g., 2816",style:Ce.input(M)})]})]}),o.jsxs("div",{style:Ce.formRow,children:[o.jsxs("div",{style:Ce.formGroup(M),children:[o.jsx("label",{style:Ce.label(M),children:"World Champion Years"}),o.jsx("input",{type:"text",value:Ue.worldChampion,onChange:E=>tt(be=>({...be,worldChampion:E.target.value})),placeholder:"e.g., 2013-2023 (leave empty if none)",style:Ce.input(M)})]}),o.jsxs("div",{style:Ce.formGroup(M),children:[o.jsx("label",{style:Ce.label(M),children:"Titles (comma separated)"}),o.jsx("input",{type:"text",value:Ue.titles,onChange:E=>tt(be=>({...be,titles:E.target.value})),placeholder:"e.g., GM, 5x US Champion",style:Ce.input(M)})]})]}),o.jsxs("div",{style:Ce.formGroup(M),children:[o.jsx("label",{style:Ce.label(M),children:"Playing Style"}),o.jsx("input",{type:"text",value:Ue.playingStyle,onChange:E=>tt(be=>({...be,playingStyle:E.target.value})),placeholder:"e.g., Aggressive, tactical, speed chess specialist",style:Ce.input(M)})]}),o.jsxs("div",{style:Ce.formGroup(M),children:[o.jsx("label",{style:Ce.label(M),children:"Biography"}),o.jsx("textarea",{value:Ue.bio,onChange:E=>tt(be=>({...be,bio:E.target.value})),rows:4,placeholder:"Write a brief biography...",style:Ce.textarea(M)})]}),o.jsxs("div",{style:{display:"flex",gap:12,marginTop:20},children:[o.jsx("button",{onClick:Ee,disabled:R||!Ue.name.trim(),style:{flex:1,padding:"14px 20px",border:"none",borderRadius:8,backgroundColor:!Ue.name.trim()||R?M.muted:M.accent,color:"#fff",cursor:!Ue.name.trim()||R?"not-allowed":"pointer",fontWeight:600,fontSize:15},children:R?"Creating...":" Create Player"}),o.jsx("button",{onClick:()=>{Ze(!1),tt({name:"",fullName:"",icon:"Chess",born:"",died:"",birthPlace:"",nationality:"",titles:"",peakRating:"",worldChampion:"",bio:"",playingStyle:"",era:"",imageUrl:""})},style:{padding:"14px 20px",border:`1px solid ${M.border}`,borderRadius:8,backgroundColor:"transparent",color:M.text,cursor:"pointer",fontSize:15},children:"Cancel"})]})]}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:Ce.tabs(M),children:[[{id:"import",label:"Import Games"},{id:"profile",label:"Edit Profile"},{id:"image",label:"Custom Image"},{id:"seed",label:"Seed to DB"}].map(E=>o.jsx("button",{onClick:()=>a(E.id),style:Ce.tab(M,s===E.id),children:E.label},E.id)),Ge[l]&&o.jsx("button",{onClick:()=>Be(!0),style:{...Ce.tab(M,!1),marginLeft:"auto",color:M.error,borderColor:M.error},children:" Delete Player"})]}),G&&o.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},children:o.jsxs("div",{style:{background:M.card,padding:24,borderRadius:12,maxWidth:400,border:`1px solid ${M.border}`},children:[o.jsx("h3",{style:{margin:"0 0 16px",color:M.error},children:"Warning: Confirm Delete"}),o.jsxs("p",{style:{margin:"0 0 20px",color:M.text},children:["Are you sure you want to delete ",o.jsx("strong",{children:fe.name})," and all their games? This cannot be undone."]}),o.jsxs("div",{style:{display:"flex",gap:12},children:[o.jsx("button",{onClick:()=>Ge[l]?he():Pe(),style:{flex:1,padding:"12px",border:"none",borderRadius:8,backgroundColor:M.error,color:"#fff",cursor:"pointer",fontWeight:600},children:"Yes, Delete"}),o.jsx("button",{onClick:()=>Be(!1),style:{flex:1,padding:"12px",border:`1px solid ${M.border}`,borderRadius:8,backgroundColor:"transparent",color:M.text,cursor:"pointer"},children:"Cancel"})]})]})}),s==="import"&&o.jsxs("div",{style:Ce.section(M),children:[o.jsxs("h3",{style:Ce.sectionTitle(M),children:["Import PGN for ",fe.name]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:16,padding:"8px 12px",background:`${M.accent}15`,borderRadius:8,border:`1px solid ${M.accent}30`},children:[o.jsx("span",{style:{fontSize:20},children:fe.icon}),o.jsxs("span",{style:{color:M.text},children:["Importing to: ",o.jsx("strong",{children:fe.name})]})]}),o.jsxs("div",{style:Ce.uploadArea(M),onClick:()=>{var E;return(E=z.current)==null?void 0:E.click()},children:[o.jsx("input",{ref:z,type:"file",accept:".pgn",onChange:Z,style:{display:"none"}}),o.jsx("div",{style:{fontSize:48,marginBottom:12},children:""}),o.jsx("div",{style:{fontWeight:500,marginBottom:8},children:"Click to select PGN file"}),o.jsx("div",{style:{fontSize:13,opacity:.7},children:"Games will be stored in Supabase"})]}),A>0&&A<100&&o.jsxs("div",{style:{marginTop:16},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:6,fontSize:12,color:M.muted},children:[o.jsx("span",{children:"Importing..."}),o.jsxs("span",{children:[A,"%"]})]}),o.jsx("div",{style:{height:8,background:M.border,borderRadius:4,overflow:"hidden"},children:o.jsx("div",{style:{height:"100%",width:`${A}%`,background:M.accent,borderRadius:4,transition:"width 0.3s ease"}})})]}),d&&o.jsxs("div",{style:{...Ce.status(M,d.type),marginTop:16},children:[d.type==="loading"&&" ",d.type==="success"&&"OK: ",d.type==="error"&&" ",d.message]}),x.length>0&&o.jsxs("div",{style:Ce.preview(M),children:[o.jsxs("h4",{style:{margin:"0 0 12px 0"},children:["Preview (",m.toLocaleString()," games total)"]}),o.jsxs("div",{style:{maxHeight:200,overflowY:"auto"},children:[x.map((E,be)=>o.jsxs("div",{style:Ce.previewGame(M),children:[o.jsx("span",{style:{fontWeight:500},children:E.white}),o.jsx("span",{style:{opacity:.6},children:" vs "}),o.jsx("span",{style:{fontWeight:500},children:E.black}),o.jsxs("span",{style:{marginLeft:8,opacity:.6},children:[E.result," (",E.year||"?",")"]})]},be)),m>10&&o.jsxs("div",{style:{opacity:.5,fontStyle:"italic",marginTop:8},children:["... and ",(m-10).toLocaleString()," more"]})]}),o.jsx("button",{onClick:Ke,disabled:R||!Ea,style:{...Ce.importBtn(M),opacity:.5,cursor:"not-allowed"},children:R?"Importing...":`Import ${m.toLocaleString()} Games for ${fe.name}`}),o.jsx("button",{onClick:Xe,style:{marginTop:8,padding:"8px 16px",borderRadius:8,border:`1px solid ${M.border}`,background:"transparent",color:M.muted,cursor:"pointer",fontSize:13},children:"Clear"})]}),o.jsxs("div",{style:Ce.currentGames(M),children:[o.jsx("h4",{style:{margin:"0 0 8px 0"},children:"Games in Database"}),o.jsxs("p",{style:{margin:0,opacity:.7},children:[fe.name," has ",o.jsx("strong",{children:Fe.toLocaleString()})," games stored in Supabase."]}),Fe>0&&o.jsx("button",{onClick:Pe,disabled:R||!Ea,style:Ce.clearBtn(M),children:" Delete All Games"})]})]}),s==="profile"&&o.jsxs("div",{style:Ce.section(M),children:[o.jsxs("h3",{style:Ce.sectionTitle(M),children:["Edit Profile: ",fe.name]}),o.jsxs("div",{style:Ce.formGroup(M),children:[o.jsx("label",{style:Ce.label(M),children:"Full Name"}),o.jsx("input",{type:"text",defaultValue:fe.fullName,onBlur:E=>je("fullName",E.target.value),style:Ce.input(M)})]}),o.jsxs("div",{style:Ce.formGroup(M),children:[o.jsx("label",{style:Ce.label(M),children:"Bio (saved to Supabase)"}),o.jsx("textarea",{defaultValue:fe.bio,rows:6,onBlur:E=>je("customBio",E.target.value),style:Ce.textarea(M)})]}),o.jsxs("div",{style:Ce.formRow,children:[o.jsxs("div",{style:Ce.formGroup(M),children:[o.jsx("label",{style:Ce.label(M),children:"Born"}),o.jsx("input",{type:"text",defaultValue:fe.born,onBlur:E=>je("born",E.target.value),style:Ce.input(M)})]}),o.jsxs("div",{style:Ce.formGroup(M),children:[o.jsx("label",{style:Ce.label(M),children:"Died"}),o.jsx("input",{type:"text",defaultValue:fe.died||"",placeholder:"Still active",onBlur:E=>je("died",E.target.value||null),style:Ce.input(M)})]})]}),o.jsxs("div",{style:Ce.formRow,children:[o.jsxs("div",{style:Ce.formGroup(M),children:[o.jsx("label",{style:Ce.label(M),children:"Peak Rating"}),o.jsx("input",{type:"number",defaultValue:fe.peakRating||"",onBlur:E=>je("peakRating",parseInt(E.target.value)||null),style:Ce.input(M)})]}),o.jsxs("div",{style:Ce.formGroup(M),children:[o.jsx("label",{style:Ce.label(M),children:"World Champion"}),o.jsx("input",{type:"text",defaultValue:fe.worldChampion||"",onBlur:E=>je("worldChampion",E.target.value),style:Ce.input(M)})]})]}),o.jsx("div",{style:{marginTop:16,padding:12,background:`${M.accent}15`,borderRadius:8,fontSize:13},children:" Changes are automatically saved to Supabase when you leave each field."})]}),s==="image"&&o.jsxs("div",{style:Ce.section(M),children:[o.jsxs("h3",{style:Ce.sectionTitle(M),children:["Custom Image: ",fe.name]}),o.jsxs("div",{style:Ce.imageSection,children:[o.jsxs("div",{style:Ce.imagePreview(M),children:[o.jsx("h4",{style:{margin:"0 0 12px 0"},children:"Current Image"}),fe.imageUrl?o.jsx("img",{src:fe.imageUrl,alt:fe.name,style:Ce.previewImg,onLoad:()=>console.log("Image loaded successfully:",fe.imageUrl),onError:E=>{console.error("Image failed to load:",fe.imageUrl),E.target.style.opacity="0.3",E.target.style.border="2px dashed red"}},fe.imageUrl):o.jsx("div",{style:{width:120,height:120,borderRadius:8,background:M.bg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:48,color:M.muted,border:`2px dashed ${M.border}`},children:fe.icon||"?"}),o.jsx("div",{style:{fontSize:11,opacity:.6,marginTop:8},children:fe.imageUrl?(nt=u[l])!=null&&nt.customImageUrl?"OK: Custom (Supabase Storage)":(yt=Ge[l])!=null&&yt.imageUrl?"OK: Custom Player Image":" Wikipedia/Default":"Warning: No image set"}),fe.imageUrl&&o.jsxs("div",{style:{fontSize:10,opacity:.4,marginTop:4,wordBreak:"break-all",maxWidth:150},children:[fe.imageUrl.substring(0,60),"..."]})]}),o.jsxs("div",{style:Ce.uploadSection,children:[o.jsxs("div",{style:Ce.uploadArea(M),onClick:()=>{var E;return(E=ht.current)==null?void 0:E.click()},children:[o.jsx("input",{ref:ht,type:"file",accept:"image/*",onChange:me,style:{display:"none"}}),o.jsx("div",{style:{fontSize:48,marginBottom:12}}),o.jsx("div",{style:{fontWeight:500,marginBottom:8},children:"Upload Custom Image"}),o.jsx("div",{style:{fontSize:13,opacity:.7},children:"Stored in Supabase Storage"})]}),o.jsx("button",{onClick:async()=>{var E,be;h({type:"loading",message:"Fetching from Wikipedia..."}),console.log("=== FETCH IMAGE FROM WIKIPEDIA ==="),console.log("Player name:",fe.name),console.log("Selected player ID:",l),console.log("Is custom player?",!!Ge[l]);try{const qe=`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(fe.name)}`;console.log("API URL:",qe);const I=await(await fetch(qe)).json();console.log("Wikipedia response:",I);let St=((E=I.thumbnail)==null?void 0:E.source)||((be=I.originalimage)==null?void 0:be.source)||null;if(!St){console.log("No image found in response"),h({type:"error",message:'No image found on Wikipedia for "'+fe.name+'"'});return}console.log("Image URL found:",St);const Le=!!Ge[l];if(console.log("Processing as:",Le?"CUSTOM PLAYER":"BUILT-IN PLAYER"),Le){console.log("Calling db.updateCustomPlayerImage...");const{error:Pt}=await Bn.updateCustomPlayerImage(l,St);if(Pt){console.error("DB error:",Pt),h({type:"error",message:"Database error: "+Pt.message});return}console.log("DB updated successfully, updating local state..."),Oe(Ft=>{const kt={...Ft,[l]:{...Ft[l],imageUrl:St}};return console.log("New customPlayers state:",kt[l]),kt})}else{console.log("Calling db.savePlayerOverride...");const Pt={...u[l]||{},customImageUrl:St},{error:Ft}=await Bn.savePlayerOverride(l,Pt);if(Ft){console.error("DB error:",Ft),h({type:"error",message:"Database error: "+Ft.message});return}console.log("DB updated successfully, updating local state..."),v(kt=>{const En={...kt,[l]:Pt};return console.log("New playerOverrides state:",En[l]),En})}h({type:"success",message:" Image saved! URL: "+St.substring(0,40)+"..."}),console.log("=== FETCH COMPLETE ==="),n==null||n()}catch(qe){console.error("Fetch error:",qe),h({type:"error",message:"Network error: "+qe.message})}},style:{width:"100%",padding:"12px",borderRadius:8,border:`1px solid ${M.accent}40`,background:`${M.accent}15`,color:M.accent,cursor:"pointer",fontSize:13,fontWeight:500,marginTop:12},children:"Quick Set (Auto-pick)"}),o.jsx("button",{onClick:()=>_(fe.name),disabled:J,style:{width:"100%",padding:"14px",borderRadius:8,border:`2px solid ${M.accent}`,background:M.accent,color:"#fff",cursor:J?"not-allowed":"pointer",fontSize:14,fontWeight:600,marginTop:12},children:J?"Searching...":"Search Wikipedia Photos"}),$.length>0&&o.jsxs("div",{style:{marginTop:20,padding:16,background:M.bg,borderRadius:12,border:`1px solid ${M.border}`},children:[o.jsxs("h4",{style:{margin:"0 0 12px",fontSize:14,color:M.text},children:["Select a Photo (",$.length," options found)"]}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gap:12},children:$.map((E,be)=>o.jsxs("div",{onClick:()=>F(E.url),style:{cursor:"pointer",borderRadius:8,overflow:"hidden",border:ue===E.url?`3px solid ${M.accent}`:`1px solid ${M.border}`,transition:"all 0.2s",transform:ue===E.url?"scale(1.05)":"scale(1)"},children:[o.jsx("img",{src:E.url,alt:E.label,style:{width:"100%",height:120,objectFit:"cover",display:"block"},referrerPolicy:"no-referrer",onError:qe=>{qe.target.style.opacity="0.3"}}),o.jsx("div",{style:{padding:"6px 8px",fontSize:10,color:M.muted,background:M.card,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:E.source})]},be))}),ue&&o.jsx("button",{onClick:()=>W(ue),style:{width:"100%",padding:"14px",marginTop:16,borderRadius:8,border:"none",background:M.success,color:"#fff",cursor:"pointer",fontSize:14,fontWeight:600},children:" Save Selected Photo to Database"}),o.jsx("button",{onClick:()=>{q([]),F(null)},style:{width:"100%",padding:"10px",marginTop:8,borderRadius:8,border:`1px solid ${M.border}`,background:"transparent",color:M.muted,cursor:"pointer",fontSize:12},children:"Cancel"})]}),o.jsx("button",{onClick:()=>{console.log("=== DEBUG STATE ==="),console.log("selectedPlayer:",l),console.log("customPlayers[selectedPlayer]:",Ge[l]),console.log("playerOverrides[selectedPlayer]:",u[l]),console.log("currentPlayer:",fe),console.log("currentPlayer.imageUrl:",fe.imageUrl),console.log("==================="),alert(`Image URL: ${fe.imageUrl||"NONE"}

Check console for full state.`)},style:{width:"100%",padding:"8px",borderRadius:8,border:`1px solid ${M.border}`,background:"transparent",color:M.muted,cursor:"pointer",fontSize:11,marginTop:12},children:"Debug: Show Current State"}),((mt=u[l])==null?void 0:mt.customImageUrl)&&o.jsx("button",{onClick:async()=>{await Bn.savePlayerOverride(l,{...u[l],customImageUrl:null}),v(E=>{const be={...E};return be[l]&&delete be[l].customImageUrl,be}),h({type:"success",message:"Reverted to Wikipedia image"})},style:Ce.revertBtn(M),children:"Revert to Wikipedia Image"})]})]})]}),s==="seed"&&o.jsxs("div",{style:Ce.section(M),children:[o.jsx("h3",{style:Ce.sectionTitle(M),children:"Seed Built-in Players to Supabase"}),o.jsx("p",{style:{fontSize:14,color:M.muted,marginBottom:16,lineHeight:1.5},children:"This will copy all 9 built-in players (Fischer, Carlsen, Morphy, etc.) to your Supabase database. This ensures all player data and Wikipedia image URLs are stored in Supabase."}),o.jsxs("div",{style:{marginBottom:16},children:[o.jsx("strong",{style:{color:M.text},children:"Built-in players to seed:"}),o.jsx("ul",{style:{marginTop:8,paddingLeft:20,color:M.muted},children:Object.entries(bi).map(([E,be])=>o.jsxs("li",{children:[be.name," (",E,")"]},E))})]}),o.jsx("button",{onClick:async()=>{h({type:"loading",message:"Seeding players to Supabase..."}),C(!0);try{const E=await Bn.seedBuiltInPlayers(bi);if(E.error)h({type:"error",message:E.error.message});else{h({type:"success",message:`Seeded ${E.seeded} of ${E.total} players to Supabase!`});const{data:be}=await Bn.getCustomPlayers();if(be){const qe={};be.forEach(at=>{qe[at.id]=at}),Oe(qe)}n&&n()}}catch(E){h({type:"error",message:E.message})}finally{C(!1)}},disabled:R,style:{padding:"12px 24px",background:M.accent,color:"#fff",border:"none",borderRadius:8,fontSize:14,fontWeight:600,cursor:R?"wait":"pointer",opacity:R?.7:1},children:R?"Seeding...":"Seed All Built-in Players"}),d&&o.jsx("div",{style:{marginTop:16,padding:12,borderRadius:8,background:d.type==="error"?"rgba(255,0,0,0.1)":d.type==="success"?"rgba(0,255,0,0.1)":"rgba(255,255,0,0.1)",color:d.type==="error"?"#ff4444":d.type==="success"?"#44ff44":M.text},children:d.message})]})]})})]})]})}function A5({colors:t}){const[e,n]=N.useState({ai:{status:"checking",message:"Checking..."},supabase:{status:"checking",message:"Checking..."},wikipedia:{status:"checking",message:"Checking..."},lichess:{status:"checking",message:"Checking..."},chesscom:{status:"checking",message:"Checking..."},stockfish:{status:"checking",message:"Checking..."},audio:{status:"checking",message:"Checking..."},storage:{status:"checking",message:"Checking..."}}),[i,r]=N.useState(!1),[s,a]=N.useState(!1),l=p=>new Promise(m=>{const y=new Image,x=setTimeout(()=>m(!1),5e3);y.onload=()=>{clearTimeout(x),m(!0)},y.onerror=()=>{clearTimeout(x),m(!1)},y.src=p}),c=async()=>{var p,m,y,x;r(!0),n({ai:{status:"checking",message:"Checking..."},supabase:{status:"checking",message:"Checking..."},wikipedia:{status:"checking",message:"Checking..."},lichess:{status:"checking",message:"Checking..."},chesscom:{status:"checking",message:"Checking..."},stockfish:{status:"checking",message:"Checking..."},audio:{status:"checking",message:"Checking..."},storage:{status:"checking",message:"Checking..."}});try{const g=await fetch("/api/coach",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:'Say "OK" if you can hear me.',maxTokens:10})});g.ok?(await g.json()).text?n(v=>({...v,ai:{status:"ok",message:"Connected"}})):n(v=>({...v,ai:{status:"warning",message:"Empty response"}})):(p=(await g.json().catch(()=>({}))).message)!=null&&p.includes("API key")?n(v=>({...v,ai:{status:"error",message:"API key missing"}})):n(v=>({...v,ai:{status:"error",message:"Connection failed"}}))}catch(g){(m=g.message)!=null&&m.includes("Failed to fetch")?n(u=>({...u,ai:{status:"warning",message:"Not available locally"}})):n(u=>({...u,ai:{status:"error",message:"Error"}}))}try{typeof Ea<"u"&&Ea||n(g=>({...g,supabase:{status:"error",message:"Not configured"}}))}catch{n(u=>({...u,supabase:{status:"error",message:"Error"}}))}try{const g=await fetch("https://en.wikipedia.org/w/api.php?action=query&titles=Magnus_Carlsen&prop=pageimages&format=json&origin=*&pithumbsize=100");if(g.ok){const v=((y=(await g.json()).query)==null?void 0:y.pages)||{},b=Object.values(v)[0],w=(x=b==null?void 0:b.thumbnail)==null?void 0:x.source;if(w){const R=await l(w);n(R?C=>({...C,wikipedia:{status:"ok",message:"Images loading"}}):C=>({...C,wikipedia:{status:"error",message:"Images blocked"}}))}else n(R=>({...R,wikipedia:{status:"warning",message:"No image returned"}}))}else n(u=>({...u,wikipedia:{status:"error",message:"API error"}}))}catch{n(u=>({...u,wikipedia:{status:"error",message:"Failed"}}))}try{(await fetch("https://lichess.org/api/user/DrNykterstein",{headers:{Accept:"application/json"}})).ok?n(u=>({...u,lichess:{status:"ok",message:"Connected"}})):n(u=>({...u,lichess:{status:"error",message:"API error"}}))}catch{n(u=>({...u,lichess:{status:"error",message:"Failed"}}))}try{(await fetch("https://api.chess.com/pub/player/magnuscarlsen")).ok?n(u=>({...u,chesscom:{status:"ok",message:"Connected"}})):n(u=>({...u,chesscom:{status:"error",message:"API error"}}))}catch{n(u=>({...u,chesscom:{status:"error",message:"Failed"}}))}try{(await fetch("https://cdnjs.cloudflare.com/ajax/libs/stockfish.js/10.0.2/stockfish.js",{method:"HEAD"})).ok?n(v=>({...v,stockfish:{status:"ok",message:"Ready"}})):n(v=>({...v,stockfish:{status:"error",message:"CDN error"}}))}catch{n(u=>({...u,stockfish:{status:"warning",message:"Cannot verify"}}))}try{n(typeof AudioContext<"u"||typeof webkitAudioContext<"u"?g=>({...g,audio:{status:"ok",message:"Supported"}}):g=>({...g,audio:{status:"error",message:"Not supported"}}))}catch{n(u=>({...u,audio:{status:"error",message:"Error"}}))}try{localStorage.setItem("_test_","1"),localStorage.removeItem("_test_"),n(g=>({...g,storage:{status:"ok",message:"Available"}}))}catch{n(u=>({...u,storage:{status:"error",message:"Blocked"}}))}r(!1)};N.useEffect(()=>{c()},[]);const d=Object.values(e).reduce((p,m)=>(p[m.status]=(p[m.status]||0)+1,p),{}),h=[{key:"supabase",name:"Database",sub:"Supabase"},{key:"wikipedia",name:"Images",sub:"Wikipedia"},{key:"lichess",name:"Lichess",sub:"API"},{key:"chesscom",name:"Chess.com",sub:"API"},{key:"stockfish",name:"Engine",sub:"Stockfish"},{key:"audio",name:"Audio",sub:"Web Audio"},{key:"ai",name:"AI Coach",sub:"Claude API"},{key:"storage",name:"Storage",sub:"Local"}],f={ok:"#10b981",warning:"#f59e0b",error:"#ef4444",checking:"#6b7280"};return o.jsx("div",{style:{flex:1,overflow:"auto",padding:"32px 24px",background:"linear-gradient(180deg, rgba(0,0,0,0.2) 0%, transparent 100%)"},children:o.jsxs("div",{style:{maxWidth:600,margin:"0 auto"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:32},children:[o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:13,color:t.muted,textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:4},children:"System Status"}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16},children:[d.ok>0&&o.jsxs("span",{style:{color:f.ok,fontSize:14,fontWeight:500},children:[d.ok," operational"]}),d.warning>0&&o.jsxs("span",{style:{color:f.warning,fontSize:14,fontWeight:500},children:[d.warning," warning"]}),d.error>0&&o.jsxs("span",{style:{color:f.error,fontSize:14,fontWeight:500},children:[d.error," issue",d.error>1?"s":""]}),d.checking>0&&o.jsx("span",{style:{color:f.checking,fontSize:14},children:"checking..."})]})]}),o.jsx("button",{onClick:c,disabled:i,style:{padding:"8px 16px",background:"transparent",color:i?t.muted:t.text,border:`1px solid ${t.border||"rgba(255,255,255,0.15)"}`,borderRadius:6,cursor:i?"not-allowed":"pointer",fontSize:13,fontWeight:500,transition:"all 0.2s",opacity:i?.5:1},children:i?"Checking...":"Refresh"})]}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:1,background:t.border||"rgba(255,255,255,0.08)",borderRadius:12,overflow:"hidden"},children:h.map((p,m)=>{const y=e[p.key];return o.jsxs("div",{style:{background:t.bg||"#1a1a1a",padding:"20px 16px",display:"flex",alignItems:"center",gap:12},children:[o.jsx("div",{style:{width:10,height:10,borderRadius:"50%",background:f[y==null?void 0:y.status]||f.checking,boxShadow:(y==null?void 0:y.status)==="ok"?`0 0 8px ${f.ok}`:"none",flexShrink:0}}),o.jsxs("div",{style:{flex:1,minWidth:0},children:[o.jsx("div",{style:{color:t.text,fontSize:14,fontWeight:500,marginBottom:2},children:p.name}),o.jsx("div",{style:{color:t.muted,fontSize:12,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:(y==null?void 0:y.message)||p.sub})]})]},p.key)})}),o.jsxs("div",{style:{marginTop:24},children:[o.jsxs("button",{onClick:()=>a(!s),style:{width:"100%",padding:"12px 16px",background:"rgba(255,255,255,0.03)",border:`1px solid ${t.border||"rgba(255,255,255,0.08)"}`,borderRadius:8,color:t.muted,fontSize:13,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s"},children:[o.jsx("span",{children:"Setup Guide"}),o.jsx("span",{style:{transform:s?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"},children:""})]}),s&&o.jsxs("div",{style:{marginTop:8,padding:16,background:"rgba(255,255,255,0.02)",borderRadius:8,border:`1px solid ${t.border||"rgba(255,255,255,0.08)"}`,fontSize:13,color:t.muted,lineHeight:1.8},children:[o.jsxs("div",{style:{marginBottom:12},children:[o.jsx("strong",{style:{color:t.text},children:"AI Coach"}),o.jsx("br",{}),"Add ",o.jsx("code",{style:{background:"rgba(255,255,255,0.1)",padding:"2px 6px",borderRadius:4,fontSize:12},children:"ANTHROPIC_API_KEY"})," in Vercel  Settings  Environment Variables"]}),o.jsxs("div",{style:{marginBottom:12},children:[o.jsx("strong",{style:{color:t.text},children:"Database"}),o.jsx("br",{}),"Add ",o.jsx("code",{style:{background:"rgba(255,255,255,0.1)",padding:"2px 6px",borderRadius:4,fontSize:12},children:"VITE_SUPABASE_URL"})," and ",o.jsx("code",{style:{background:"rgba(255,255,255,0.1)",padding:"2px 6px",borderRadius:4,fontSize:12},children:"VITE_SUPABASE_ANON_KEY"})]}),o.jsx("div",{style:{color:t.muted,opacity:.7},children:"Engine, Audio, Voice, and Storage require no setup."})]})]}),o.jsx("div",{style:{marginTop:32,textAlign:"center",color:t.muted,fontSize:12,opacity:.5},children:"ChessGrandmaster v2.4.1"})]})})}const Ce={container:t=>({display:"flex",flexDirection:"column",height:"100%",backgroundColor:t.bg,color:t.text}),header:t=>({display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 24px",backgroundColor:t.card,borderBottom:`1px solid ${t.border}`}),title:t=>({margin:0,fontSize:22,fontWeight:600}),closeBtn:t=>({background:"none",border:"none",color:t.muted,fontSize:20,cursor:"pointer",padding:"4px 8px"}),content:{display:"flex",flex:1,overflow:"hidden"},sidebar:t=>({width:220,backgroundColor:t.card,borderRight:`1px solid ${t.border}`,padding:16,overflowY:"auto"}),sidebarTitle:t=>({margin:"0 0 16px 0",fontSize:13,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",opacity:.7}),playerBtn:(t,e)=>({display:"flex",alignItems:"center",gap:12,width:"100%",padding:"10px 12px",marginBottom:8,border:e?`2px solid ${t.accent}`:`1px solid ${t.border}`,borderRadius:8,backgroundColor:e?`${t.accent}20`:"transparent",color:t.text,cursor:"pointer",textAlign:"left",transition:"all 0.2s"}),mainPanel:t=>({flex:1,display:"flex",flexDirection:"column",overflow:"hidden"}),tabs:t=>({display:"flex",gap:8,padding:16,borderBottom:`1px solid ${t.border}`}),tab:(t,e)=>({padding:"10px 20px",border:"none",borderRadius:8,backgroundColor:e?t.accent:"transparent",color:e?"#fff":t.text,cursor:"pointer",fontWeight:500,fontSize:14,transition:"all 0.2s"}),section:t=>({flex:1,padding:24,overflowY:"auto"}),sectionTitle:t=>({margin:"0 0 20px 0",fontSize:18,fontWeight:600}),uploadArea:t=>({border:`2px dashed ${t.border}`,borderRadius:12,padding:40,textAlign:"center",cursor:"pointer",transition:"all 0.2s",backgroundColor:`${t.accent}05`}),status:(t,e)=>({padding:"12px 16px",marginTop:16,borderRadius:8,backgroundColor:e==="error"?`${t.error}20`:e==="success"?`${t.success}20`:`${t.accent}20`,color:e==="error"?t.error:e==="success"?t.success:t.text}),preview:t=>({marginTop:20,padding:16,backgroundColor:t.card,borderRadius:12,border:`1px solid ${t.border}`}),previewGame:t=>({padding:"8px 0",borderBottom:`1px solid ${t.border}`,fontSize:13}),importBtn:t=>({width:"100%",marginTop:16,padding:"14px 20px",border:"none",borderRadius:8,backgroundColor:t.accent,color:"#fff",cursor:"pointer",fontWeight:600,fontSize:15}),currentGames:t=>({marginTop:24,padding:16,backgroundColor:t.card,borderRadius:12,border:`1px solid ${t.border}`}),clearBtn:t=>({marginTop:12,padding:"8px 16px",border:`1px solid ${t.error}`,borderRadius:6,backgroundColor:"transparent",color:t.error,cursor:"pointer",fontSize:13}),formGroup:t=>({marginBottom:16,flex:1}),formRow:{display:"flex",gap:16},label:t=>({display:"block",marginBottom:6,fontSize:13,fontWeight:500,opacity:.8}),input:t=>({width:"100%",padding:"10px 14px",border:`1px solid ${t.border}`,borderRadius:8,backgroundColor:t.bg,color:t.text,fontSize:14,outline:"none"}),textarea:t=>({width:"100%",padding:"10px 14px",border:`1px solid ${t.border}`,borderRadius:8,backgroundColor:t.bg,color:t.text,fontSize:14,outline:"none",resize:"vertical",fontFamily:"inherit"}),imageSection:{display:"flex",gap:24},imagePreview:t=>({flex:1,padding:16,backgroundColor:t.card,borderRadius:12,border:`1px solid ${t.border}`,textAlign:"center"}),previewImg:{maxWidth:"100%",maxHeight:300,borderRadius:8,objectFit:"cover"},uploadSection:{flex:1},revertBtn:t=>({marginTop:16,padding:"10px 16px",border:`1px solid ${t.border}`,borderRadius:8,backgroundColor:"transparent",color:t.text,cursor:"pointer",fontSize:13,width:"100%"})};function P5({players:t,customPlayers:e,selectedMaster:n,onSelectMaster:i,onShowBiography:r,theme:s,dbGameCounts:a}){const l=[...Object.entries(t),...e.map(c=>[c.id,c])];return o.jsxs("div",{className:"gallery-masters",children:[o.jsxs("div",{className:"gallery-header",style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end",marginBottom:80,paddingRight:40},children:[o.jsxs("h1",{style:{fontFamily:"'Syne', sans-serif",fontSize:"clamp(60px, 10vw, 120px)",fontWeight:800,lineHeight:.9,letterSpacing:"-0.03em"},children:[o.jsx("span",{style:{display:"block"},children:"CHESS"}),o.jsx("span",{style:{display:"block",WebkitTextStroke:`2px ${s.ink}`,WebkitTextFillColor:"transparent"},children:"MASTERS"})]}),o.jsxs("div",{style:{fontSize:14,color:s.inkMuted,letterSpacing:"0.2em",textTransform:"uppercase"},children:[l.length," LEGENDS"]})]}),o.jsx("div",{className:"gallery-grid",style:{display:"grid",gridTemplateColumns:"repeat(12, 1fr)",gridAutoRows:"100px",gap:20},children:l.map(([c,d],h)=>{const f=[{col:"span 4",row:"span 4"},{col:"span 6",row:"span 5"},{col:"span 3",row:"span 3"},{col:"span 5",row:"span 4"},{col:"span 4",row:"span 5"}],p=f[h%f.length],m=a[c]||0;return o.jsxs("div",{className:`gallery-item ${n===c?"active":""}`,onClick:()=>i(c),style:{gridColumn:p.col,gridRow:p.row,position:"relative",overflow:"hidden",cursor:"pointer",background:s.card},children:[d.imageUrl&&o.jsx("img",{src:d.imageUrl,alt:d.name,referrerPolicy:"no-referrer",style:{width:"100%",height:"100%",objectFit:"cover",transition:"transform 0.6s cubic-bezier(0.4, 0, 0.2, 1)"},onError:y=>{y.target.style.display="none"}}),o.jsxs("div",{className:"gallery-item-info",style:{position:"absolute",bottom:0,left:0,right:0,padding:24,background:"linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 100%)",transform:"translateY(100%)",transition:"transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)"},children:[o.jsx("div",{style:{fontFamily:"'Syne', sans-serif",fontSize:24,fontWeight:700,marginBottom:4,color:"#fff"},children:d.name}),o.jsx("div",{style:{fontSize:12,color:"rgba(255,255,255,0.6)",letterSpacing:"0.1em",textTransform:"uppercase",marginBottom:12},children:d.era||d.worldChampion||"Grandmaster"}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{onClick:y=>{y.stopPropagation(),i(c)},style:{padding:"8px 16px",background:s.accent,border:"none",color:"#fff",fontSize:12,fontWeight:600,cursor:"pointer"},children:m>0?`${m} Games`:"View Games"}),o.jsx("button",{onClick:y=>{y.stopPropagation(),r(c)},style:{padding:"8px 16px",background:"transparent",border:"1px solid rgba(255,255,255,0.3)",color:"#fff",fontSize:12,cursor:"pointer"},children:"Biography"})]})]}),o.jsx("div",{style:{position:"absolute",top:16,right:16,width:32,height:32,borderRadius:"50%",border:"1px solid rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:600,color:"rgba(255,255,255,0.5)"},children:String(h+1).padStart(2,"0")}),n===c&&o.jsx("div",{style:{position:"absolute",inset:0,border:`3px solid ${s.accent}`,pointerEvents:"none"}})]},c)})}),o.jsx("style",{children:`
        .gallery-item:hover img {
          transform: scale(1.1);
        }
        .gallery-item:hover .gallery-item-info {
          transform: translateY(0) !important;
        }
      `})]})}function N5({players:t,customPlayers:e,selectedMaster:n,onSelectMaster:i,onShowBiography:r,theme:s,dbGameCounts:a}){var c;const l=[...Object.entries(t),...e.map(d=>[d.id,d])];return(c=s.id)==null||c.includes("light"),o.jsxs("div",{className:"typo-masters",children:[o.jsx("div",{style:{marginBottom:60,overflow:"hidden"},children:o.jsxs("h1",{style:{fontFamily:"'Bebas Neue', Impact, sans-serif",fontSize:"clamp(80px, 15vw, 200px)",lineHeight:.85,letterSpacing:"-0.02em",color:s.ink},children:["THE ",o.jsx("span",{style:{color:s.accent},children:"MASTERS"})]})}),o.jsx("div",{style:{overflow:"hidden",marginBottom:60,borderTop:`1px solid ${s.border}`,borderBottom:`1px solid ${s.border}`,padding:"16px 0"},children:o.jsx("div",{className:"typo-marquee",style:{display:"flex",gap:48,animation:"marquee 30s linear infinite",whiteSpace:"nowrap"},children:[...l,...l].map(([d,h],f)=>o.jsxs("span",{style:{fontFamily:"'Bebas Neue', Impact, sans-serif",fontSize:24,color:s.inkMuted,textTransform:"uppercase",letterSpacing:"0.05em"},children:[h.name," "]},`${d}-${f}`))})}),o.jsx("div",{className:"typo-player-list",children:l.map(([d,h],f)=>{const p=a[d]||0,m=n===d;return o.jsxs("div",{className:`typo-player-row ${m?"active":""}`,onClick:()=>i(d),style:{display:"grid",gridTemplateColumns:"100px 1fr 200px 180px",alignItems:"center",padding:"32px 0",borderBottom:`1px solid ${s.border}`,cursor:"pointer",transition:"all 0.3s",background:m?s.accentSoft:"transparent"},children:[o.jsx("div",{style:{fontFamily:"'Bebas Neue', Impact, sans-serif",fontSize:48,color:m?s.accent:s.inkMuted,fontWeight:400},children:String(f+1).padStart(2,"0")}),o.jsxs("div",{children:[o.jsx("div",{style:{fontFamily:"'Bebas Neue', Impact, sans-serif",fontSize:36,letterSpacing:"0.02em",marginBottom:4},children:h.name.toUpperCase()}),o.jsxs("div",{style:{fontSize:13,color:s.inkMuted,letterSpacing:"0.05em"},children:[h.era||h.nationality||"",h.peakRating&&`  Peak ${h.peakRating}`]})]}),o.jsx("div",{style:{width:120,height:80,overflow:"hidden",filter:m?"grayscale(0%)":"grayscale(100%)",transition:"filter 0.4s"},children:h.imageUrl&&o.jsx("img",{src:h.imageUrl,alt:h.name,referrerPolicy:"no-referrer",style:{width:"100%",height:"100%",objectFit:"cover"},onError:y=>{y.target.style.display="none"}})}),o.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[o.jsx("button",{onClick:y=>{y.stopPropagation(),i(d)},style:{padding:"8px 16px",background:s.accent,border:"none",color:"#fff",fontFamily:"'Bebas Neue', sans-serif",fontSize:14,letterSpacing:"0.05em",cursor:"pointer"},children:p>0?`${p}G`:"GAMES"}),o.jsx("button",{onClick:y=>{y.stopPropagation(),r(d)},style:{padding:"8px 16px",background:"transparent",border:`1px solid ${s.border}`,color:s.ink,fontFamily:"'Bebas Neue', sans-serif",fontSize:14,letterSpacing:"0.05em",cursor:"pointer"},children:"BIO"})]})]},d)})}),o.jsx("style",{children:`
        @keyframes marquee {
          0% { transform: translateX(0); }
          100% { transform: translateX(-50%); }
        }
        .typo-player-row:hover {
          background: ${s.accentSoft} !important;
        }
        .typo-player-row:hover img {
          filter: grayscale(0%) !important;
        }
      `})]})}function B5({players:t,customPlayers:e,selectedMaster:n,onSelectMaster:i,onShowBiography:r,theme:s,dbGameCounts:a}){const l=[...Object.entries(t),...e.map(c=>[c.id,c])];return o.jsxs("div",{className:"editorial-masters",children:[o.jsxs("div",{style:{textAlign:"center",marginBottom:80,padding:"40px 0"},children:[o.jsx("div",{style:{fontSize:14,color:s.inkMuted,marginBottom:16,textTransform:"uppercase",letterSpacing:"0.15em"},children:"The Definitive Collection"}),o.jsxs("h1",{style:{fontFamily:"'Playfair Display', Georgia, serif",fontSize:"clamp(48px, 8vw, 72px)",fontWeight:600,letterSpacing:"-0.02em",marginBottom:16},children:["Chess ",o.jsx("span",{style:{background:`linear-gradient(90deg, ${s.accent}, #E8D48A)`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Grandmasters"})]}),o.jsx("p",{style:{fontSize:18,color:s.inkMuted,maxWidth:500,margin:"0 auto",lineHeight:1.6},children:"Explore the brilliant minds who shaped the royal game through centuries of innovation."})]}),o.jsx("div",{className:"editorial-grid",style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:24},children:l.map(([c,d],h)=>{const f=a[c]||0,p=n===c;return o.jsxs("div",{className:`editorial-card ${p?"active":""}`,onClick:()=>i(c),style:{position:"relative",aspectRatio:"3 / 4",borderRadius:20,overflow:"hidden",cursor:"pointer",transform:p?"scale(1.02)":"scale(1)",transition:"transform 0.6s cubic-bezier(0.16, 1, 0.3, 1)"},children:[o.jsx("div",{className:"editorial-card-image",style:{position:"absolute",inset:0},children:d.imageUrl?o.jsx("img",{src:d.imageUrl,alt:d.name,referrerPolicy:"no-referrer",style:{width:"100%",height:"100%",objectFit:"cover",filter:"grayscale(100%)",transition:"all 0.6s cubic-bezier(0.16, 1, 0.3, 1)"},onError:m=>{m.target.style.display="none"}}):o.jsx("div",{style:{width:"100%",height:"100%",background:s.bgAlt,display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsx("span",{style:{fontFamily:"'Playfair Display', Georgia, serif",fontSize:120,color:s.border,fontWeight:600},children:d.name.charAt(0)})})}),o.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 50%)",opacity:0,transition:"opacity 0.4s"},className:"editorial-card-overlay"}),o.jsxs("div",{className:"editorial-card-info",style:{position:"absolute",bottom:0,left:0,right:0,padding:30,opacity:0,transform:"translateY(20px)",transition:"all 0.4s cubic-bezier(0.16, 1, 0.3, 1)"},children:[o.jsx("div",{style:{fontFamily:"'Playfair Display', Georgia, serif",fontSize:26,fontWeight:600,color:"#fff",marginBottom:4},children:d.name}),o.jsx("div",{style:{fontSize:14,color:"rgba(255,255,255,0.6)",marginBottom:16},children:d.worldChampion?`World Champion ${d.worldChampion}`:d.era||d.nationality||"Grandmaster"}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{onClick:m=>{m.stopPropagation(),i(c)},style:{padding:"8px 16px",background:s.accent,border:"none",borderRadius:20,color:"#fff",fontSize:12,fontWeight:600,cursor:"pointer"},children:f>0?`${f} Games`:"View Games"}),o.jsx("button",{onClick:m=>{m.stopPropagation(),r(c)},style:{padding:"8px 16px",background:"transparent",border:"1px solid rgba(255,255,255,0.3)",borderRadius:20,color:"#fff",fontSize:12,cursor:"pointer"},children:"Biography"})]})]}),o.jsx("div",{style:{position:"absolute",bottom:20,right:20,fontFamily:"'Playfair Display', Georgia, serif",fontSize:180,fontWeight:700,color:"rgba(255,255,255,0.03)",lineHeight:1,pointerEvents:"none"},children:d.name.charAt(0)}),p&&o.jsx("div",{style:{position:"absolute",inset:0,border:`3px solid ${s.accent}`,borderRadius:20,pointerEvents:"none"}})]},c)})}),o.jsx("style",{children:`
        .editorial-card:hover {
          transform: scale(1.02) !important;
          z-index: 10;
        }
        .editorial-card:hover .editorial-card-image img {
          filter: grayscale(0%) !important;
          transform: scale(1.1);
        }
        .editorial-card:hover .editorial-card-overlay {
          opacity: 1 !important;
        }
        .editorial-card:hover .editorial-card-info {
          opacity: 1 !important;
          transform: translateY(0) !important;
        }
      `})]})}function I5({players:t,customPlayers:e,selectedMaster:n,onSelectMaster:i,onShowBiography:r,theme:s,dbGameCounts:a,isMobile:l,isTablet:c}){const d=[...Object.entries(t),...e.map(h=>[h.id,h])];return o.jsxs("div",{className:"classic-masters",children:[o.jsxs("div",{style:{marginBottom:24},children:[o.jsx("h2",{style:{fontFamily:"'Playfair Display', Georgia, serif",fontSize:l?20:24,marginBottom:8,color:s.ink},children:"Chess Legends"}),o.jsx("p",{style:{fontSize:l?13:14,color:s.inkMuted,maxWidth:600,lineHeight:1.5},children:"Explore curated game collections from the greatest players in chess history."})]}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:l?"repeat(2, 1fr)":c?"repeat(3, 1fr)":"repeat(4, 1fr)",gap:l?12:20},children:d.map(([h,f])=>{const p=a[h]||0,m=n===h;return o.jsxs("div",{className:`classic-card ${m?"active":""}`,onClick:()=>i(h),style:{position:"relative",aspectRatio:"3 / 4",backgroundColor:s.card,overflow:"hidden",border:m?`2px solid ${s.accent}`:`1px solid ${s.border}`,cursor:"pointer",transition:"border-color 0.3s ease"},children:[f.imageUrl&&o.jsx("img",{className:"classic-card-img",src:f.imageUrl,alt:f.name,referrerPolicy:"no-referrer",style:{position:"absolute",inset:0,width:"100%",height:"100%",objectFit:"cover",objectPosition:"center top",filter:"grayscale(100%)",transition:"filter 0.3s ease"},onError:y=>{y.target.style.display="none"}}),o.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 60%)",zIndex:1}}),o.jsxs("div",{style:{position:"absolute",bottom:0,left:0,right:0,padding:l?12:16,zIndex:2},children:[o.jsx("div",{style:{fontFamily:"'Playfair Display', Georgia, serif",fontSize:l?14:18,fontWeight:600,color:"#fff",marginBottom:4},children:f.name}),o.jsx("div",{style:{fontSize:l?10:12,color:"rgba(255,255,255,0.6)",marginBottom:12},children:f.era||f.worldChampion||"Grandmaster"}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{onClick:y=>{y.stopPropagation(),i(h)},style:{flex:1,padding:l?"6px 10px":"8px 12px",background:s.accent,border:"none",color:"#fff",fontSize:l?10:11,fontWeight:600,cursor:"pointer"},children:p>0?`${p} Games`:"Games"}),o.jsx("button",{onClick:y=>{y.stopPropagation(),r(h)},style:{padding:l?"6px 10px":"8px 12px",background:"transparent",border:"1px solid rgba(255,255,255,0.3)",color:"#fff",fontSize:l?10:11,cursor:"pointer"},children:"Bio"})]})]})]},h)})}),o.jsx("style",{children:`
        .classic-card:hover {
          border-color: ${s.accent}60 !important;
        }
        .classic-card:hover .classic-card-img {
          filter: grayscale(0%) !important;
        }
      `})]})}function D5({players:t,customPlayers:e,selectedMaster:n,onSelectMaster:i,onShowBiography:r,theme:s,dbGameCounts:a,isMobile:l,isTablet:c}){const d=[...Object.entries(t),...e.map(h=>[h.id,h])];return o.jsxs("div",{className:"modern-masters",children:[o.jsxs("div",{style:{marginBottom:24},children:[o.jsx("h2",{style:{fontFamily:"'Playfair Display', Georgia, serif",fontSize:l?20:24,marginBottom:8,color:s.ink},children:"Chess Legends"}),o.jsx("p",{style:{fontSize:l?13:14,color:s.inkMuted,maxWidth:600,lineHeight:1.5},children:"Explore curated game collections from the greatest players in chess history."})]}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:l?"1fr":c?"repeat(auto-fill, minmax(280px, 1fr))":"repeat(auto-fill, minmax(320px, 1fr))",gap:l?12:20},children:d.map(([h,f])=>{var y;const p=a[h]||0,m=n===h;return o.jsxs("div",{className:`modern-card ${m?"active":""}`,onClick:()=>i(h),style:{backgroundColor:s.card,borderRadius:l?12:16,overflow:"hidden",border:m?`2px solid ${s.accent}`:`1px solid ${s.border}`,transition:"all 0.2s ease",cursor:"pointer",display:"flex",flexDirection:"column"},children:[o.jsxs("div",{style:{display:"flex",height:l?100:140},children:[o.jsx("div",{style:{width:l?100:140,minWidth:l?100:140,backgroundColor:s.bgAlt,position:"relative",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center"},children:f.imageUrl?o.jsx("img",{src:f.imageUrl,alt:f.name,referrerPolicy:"no-referrer",style:{position:"absolute",inset:0,width:"100%",height:"100%",objectFit:"cover",objectPosition:"center top"},onError:x=>{x.target.style.display="none"}}):o.jsx("div",{style:{width:l?50:70,height:l?50:70,borderRadius:"50%",background:s.accentSoft,display:"flex",alignItems:"center",justifyContent:"center",fontSize:l?20:28,color:s.accent},children:f.name.charAt(0)})}),o.jsxs("div",{style:{flex:1,padding:l?12:16,display:"flex",flexDirection:"column",justifyContent:"center"},children:[o.jsx("h3",{style:{fontFamily:"'Playfair Display', Georgia, serif",fontSize:l?16:20,fontWeight:600,marginBottom:4,color:s.ink},children:f.name}),o.jsx("div",{style:{fontSize:l?11:12,color:s.inkMuted,marginBottom:8},children:f.era||f.worldChampion||"Grandmaster"}),p>0&&o.jsxs("div",{style:{fontSize:l?10:11,color:s.accent,fontWeight:500},children:[p," games available"]})]})]}),o.jsxs("div",{style:{padding:l?12:16,borderTop:`1px solid ${s.border}`,display:"flex",flexDirection:"column"},children:[o.jsxs("p",{style:{fontSize:l?12:13,color:s.inkMuted,lineHeight:1.5,marginBottom:12,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:[((y=f.bio)==null?void 0:y.slice(0,120))||"Explore this chess legend's games.","..."]}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{onClick:x=>{x.stopPropagation(),i(h)},style:{flex:1,padding:l?"8px 12px":"10px 16px",borderRadius:8,border:"none",background:s.accent,color:s.id==="light"?"#fff":s.bg,cursor:"pointer",fontWeight:600,fontSize:l?12:13},children:"View Games"}),o.jsx("button",{onClick:x=>{x.stopPropagation(),r(h)},style:{padding:l?"8px 12px":"10px 16px",borderRadius:8,border:`1px solid ${s.border}`,background:"transparent",color:s.ink,cursor:"pointer",fontWeight:500,fontSize:l?12:13},children:"Biography"})]})]})]},h)})}),o.jsx("style",{children:`
        .modern-card:hover {
          border-color: ${s.accent}60 !important;
          transform: translateY(-2px);
          box-shadow: ${s.shadow};
        }
      `})]})}const id={tactics:{id:"tactics",name:"Tactics",icon:"",description:"Short-term opportunities that win material or deliver checkmate",color:"#e53935",skills:{forks:{id:"forks",name:"Forks",description:"Attack two or more pieces simultaneously with one piece",levels:[{level:1,name:"Knight Forks",description:"Recognize basic knight forks on king + piece"},{level:2,name:"Pawn & Bishop Forks",description:"Spot forks with other pieces"},{level:3,name:"Setting Up Forks",description:"Create fork opportunities with preparation moves"},{level:4,name:"Fork Combinations",description:"Multi-move sequences leading to forks"},{level:5,name:"Fork Mastery",description:"Spot complex forks in rapid time pressure"}]},pins:{id:"pins",name:"Pins",description:"Immobilize a piece that shields a more valuable piece behind it",levels:[{level:1,name:"Absolute Pins",description:"Recognize pins against the king"},{level:2,name:"Relative Pins",description:"Spot pins against queen and other pieces"},{level:3,name:"Exploiting Pins",description:"Add pressure to pinned pieces"},{level:4,name:"Pin Combinations",description:"Create and exploit pins in sequences"},{level:5,name:"Pin Mastery",description:"Advanced pin tactics in complex positions"}]},skewers:{id:"skewers",name:"Skewers",description:"Attack a valuable piece that shields a less valuable piece behind it",levels:[{level:1,name:"Basic Skewers",description:"Recognize skewers with rook and bishop"},{level:2,name:"Queen Skewers",description:"Use queen for powerful skewer attacks"},{level:3,name:"Setting Up Skewers",description:"Force pieces into skewerable positions"},{level:4,name:"Skewer Combinations",description:"Multi-move skewer sequences"},{level:5,name:"Skewer Mastery",description:"Advanced skewer patterns"}]},discoveredAttacks:{id:"discoveredAttacks",name:"Discovered Attacks",description:"Move one piece to reveal an attack from another",levels:[{level:1,name:"Basic Discoveries",description:"Recognize simple discovered attacks"},{level:2,name:"Discovered Check",description:"Discoveries that give check"},{level:3,name:"Double Check",description:"Both moving and revealed piece give check"},{level:4,name:"Discovery Setup",description:"Create discovery opportunities"},{level:5,name:"Discovery Mastery",description:"Complex discovery combinations"}]},backRank:{id:"backRank",name:"Back Rank Tactics",description:"Exploit weakness of king trapped on back rank",levels:[{level:1,name:"Basic Back Rank Mate",description:"Recognize back rank checkmate patterns"},{level:2,name:"Back Rank Threats",description:"Use back rank weakness for material"},{level:3,name:"Creating Weakness",description:"Force back rank vulnerabilities"},{level:4,name:"Defense & Attack",description:"Defend and exploit back rank"},{level:5,name:"Back Rank Mastery",description:"Complex back rank combinations"}]},deflection:{id:"deflection",name:"Deflection",description:"Force a piece away from an important defensive duty",levels:[{level:1,name:"Basic Deflection",description:"Recognize when a piece is overloaded"},{level:2,name:"Deflection Sacrifices",description:"Sacrifice to deflect defenders"},{level:3,name:"Overloading",description:"Attack pieces with multiple duties"},{level:4,name:"Deflection Chains",description:"Sequential deflections"},{level:5,name:"Deflection Mastery",description:"Complex deflection combinations"}]},matingPatterns:{id:"matingPatterns",name:"Mating Patterns",description:"Recognize and execute checkmate patterns",levels:[{level:1,name:"Basic Mates",description:"Scholar's, Fool's, Back Rank"},{level:2,name:"Common Mates",description:"Smothered, Arabian, Anastasia's"},{level:3,name:"Advanced Mates",description:"Boden's, Opera, Lgal's"},{level:4,name:"Mating Attacks",description:"Build positions leading to mate"},{level:5,name:"Mating Mastery",description:"Spot complex mating nets"}]}}},opening:{id:"opening",name:"Opening Principles",icon:"",description:"First phase fundamentals that set up successful middlegames",color:"#1e88e5",skills:{development:{id:"development",name:"Piece Development",description:"Get pieces off starting squares to active positions",levels:[{level:1,name:"Basic Development",description:"Knights before bishops, one move per piece"},{level:2,name:"Active Squares",description:"Place pieces on optimal squares"},{level:3,name:"Development Tempo",description:"Gain time by developing with threats"},{level:4,name:"Rapid Mobilization",description:"Complete development efficiently"},{level:5,name:"Development Mastery",description:"Punish opponent's slow development"}]},centerControl:{id:"centerControl",name:"Center Control",description:"Control the central squares e4, d4, e5, d5",levels:[{level:1,name:"Pawn Center",description:"Place pawns in the center"},{level:2,name:"Piece Control",description:"Control center with pieces"},{level:3,name:"Flexible Center",description:"Adapt center strategy to position"},{level:4,name:"Center Breaks",description:"Time pawn breaks effectively"},{level:5,name:"Center Mastery",description:"Dynamic center play"}]},kingSafety:{id:"kingSafety",name:"King Safety",description:"Protect your king, typically by castling",levels:[{level:1,name:"Castling",description:"Castle early to safety"},{level:2,name:"Pawn Shield",description:"Maintain protective pawn structure"},{level:3,name:"Castling Direction",description:"Choose kingside or queenside wisely"},{level:4,name:"King Defense",description:"Defend against attacks on castled king"},{level:5,name:"King Safety Mastery",description:"Balance king safety and activity"}]},openingTraps:{id:"openingTraps",name:"Opening Traps",description:"Know common traps to avoid and exploit",levels:[{level:1,name:"Basic Traps",description:"Avoid common beginner traps"},{level:2,name:"Trap Recognition",description:"Recognize trap patterns"},{level:3,name:"Setting Traps",description:"Set traps for opponents"},{level:4,name:"Trap Refutation",description:"Punish opponents who fall for traps"},{level:5,name:"Trap Mastery",description:"Use traps as part of strategy"}]}}},middlegame:{id:"middlegame",name:"Middlegame Strategy",icon:"",description:"Strategic planning and piece coordination after the opening",color:"#7b1fa2",skills:{planning:{id:"planning",name:"Planning",description:"Form and execute long-term plans",levels:[{level:1,name:"Basic Plans",description:"Recognize simple plans based on position"},{level:2,name:"Candidate Moves",description:"Identify 3-4 candidate moves each turn"},{level:3,name:"Plan Execution",description:"Follow through on strategic plans"},{level:4,name:"Plan Adaptation",description:"Adjust plans based on opponent's moves"},{level:5,name:"Planning Mastery",description:"Multi-layered strategic planning"}]},pawnStructure:{id:"pawnStructure",name:"Pawn Structure",description:"Understand and exploit pawn formations",levels:[{level:1,name:"Weak Pawns",description:"Identify isolated and doubled pawns"},{level:2,name:"Pawn Chains",description:"Understand pawn chain dynamics"},{level:3,name:"Pawn Breaks",description:"Time pawn breaks effectively"},{level:4,name:"Structural Advantages",description:"Create lasting pawn advantages"},{level:5,name:"Pawn Structure Mastery",description:"Advanced pawn play"}]},pieceActivity:{id:"pieceActivity",name:"Piece Activity",description:"Keep pieces active and coordinated",levels:[{level:1,name:"Active vs Passive",description:"Recognize active and passive pieces"},{level:2,name:"Improving Pieces",description:"Find better squares for pieces"},{level:3,name:"Piece Coordination",description:"Make pieces work together"},{level:4,name:"Piece Exchanges",description:"Know when to trade pieces"},{level:5,name:"Activity Mastery",description:"Maximize piece potential"}]},attack:{id:"attack",name:"Attacking Play",description:"Launch and sustain attacks on the opponent's position",levels:[{level:1,name:"Basic Attacks",description:"Recognize attacking opportunities"},{level:2,name:"Kingside Attack",description:"Attack the castled king"},{level:3,name:"Sacrificial Attacks",description:"Use sacrifices to break through"},{level:4,name:"Sustained Pressure",description:"Maintain attacking momentum"},{level:5,name:"Attack Mastery",description:"Devastating attacking play"}]},defense:{id:"defense",name:"Defensive Play",description:"Hold difficult positions and find resources",levels:[{level:1,name:"Basic Defense",description:"Defend attacked pieces"},{level:2,name:"Prophylaxis",description:"Prevent opponent's plans"},{level:3,name:"Active Defense",description:"Create counterplay while defending"},{level:4,name:"Fortress Building",description:"Create impenetrable positions"},{level:5,name:"Defense Mastery",description:"Save lost positions"}]}}},endgame:{id:"endgame",name:"Endgame Technique",icon:"",description:"Final phase technique to convert advantages or save draws",color:"#ff9800",skills:{basicMates:{id:"basicMates",name:"Basic Checkmates",description:"Deliver checkmate with basic piece combinations",levels:[{level:1,name:"Queen + King",description:"Mate with king and queen"},{level:2,name:"Rook + King",description:"Mate with king and rook"},{level:3,name:"Two Bishops",description:"Mate with two bishops"},{level:4,name:"Bishop + Knight",description:"Mate with bishop and knight"},{level:5,name:"Basic Mates Mastery",description:"Execute all basic mates quickly"}]},kingActivity:{id:"kingActivity",name:"King Activity",description:"Use the king as an active piece in the endgame",levels:[{level:1,name:"King Centralization",description:"Bring king to center in endgame"},{level:2,name:"Opposition",description:"Understand basic opposition"},{level:3,name:"Distant Opposition",description:"Use distant opposition"},{level:4,name:"King Infiltration",description:"Penetrate with the king"},{level:5,name:"King Activity Mastery",description:"Advanced king maneuvers"}]},pawnEndgames:{id:"pawnEndgames",name:"Pawn Endgames",description:"Navigate king and pawn endings",levels:[{level:1,name:"Key Squares",description:"Understand key squares for promotion"},{level:2,name:"Square of the Pawn",description:"Calculate pawn races"},{level:3,name:"Breakthrough",description:"Force pawn breakthroughs"},{level:4,name:"Triangulation",description:"Lose a tempo with the king"},{level:5,name:"Pawn Endgame Mastery",description:"Complex pawn endings"}]},rookEndgames:{id:"rookEndgames",name:"Rook Endgames",description:"Most common endgame type - master it!",levels:[{level:1,name:"Lucena Position",description:"Win the Lucena position"},{level:2,name:"Philidor Position",description:"Draw with Philidor defense"},{level:3,name:"Active Rook",description:"Keep the rook active"},{level:4,name:"Rook + Pawns",description:"Complex rook and pawn endings"},{level:5,name:"Rook Endgame Mastery",description:"Advanced rook technique"}]}}},calculation:{id:"calculation",name:"Calculation",icon:"",description:"Concrete move calculation and visualization",color:"#00897b",skills:{depth:{id:"depth",name:"Calculation Depth",description:"See further ahead in variations",levels:[{level:1,name:"2-Ply Calculation",description:"Calculate 1 move for each side"},{level:2,name:"4-Ply Calculation",description:"Calculate 2 moves for each side"},{level:3,name:"6-Ply Calculation",description:"Calculate 3 moves for each side"},{level:4,name:"8-Ply Calculation",description:"Calculate 4 moves for each side"},{level:5,name:"Deep Calculation",description:"Calculate 5+ moves for each side"}]},accuracy:{id:"accuracy",name:"Move Accuracy",description:"Find the best moves consistently",levels:[{level:1,name:"Avoiding Blunders",description:"Don't hang pieces"},{level:2,name:"Reducing Mistakes",description:"Minimize serious errors"},{level:3,name:"Consistent Play",description:"Play solidly throughout"},{level:4,name:"High Accuracy",description:"Match engine moves frequently"},{level:5,name:"Precision",description:"Near-optimal play"}]},visualization:{id:"visualization",name:"Visualization",description:"See positions in your mind without moving pieces",levels:[{level:1,name:"Basic Visualization",description:"Track piece positions mentally"},{level:2,name:"Short Sequences",description:"Visualize 2-3 move sequences"},{level:3,name:"Complex Positions",description:"Handle multiple pieces mentally"},{level:4,name:"Blindfold Practice",description:"Play positions without seeing board"},{level:5,name:"Visualization Mastery",description:"Advanced mental calculation"}]}}}};function oc(){const t=[];return Object.values(id).forEach(e=>{Object.values(e.skills).forEach(n=>{t.push({...n,categoryId:e.id,categoryName:e.name,categoryColor:e.color})})}),t}function L5(t){return[600,1e3,1400,1800,2200][Math.min(t-1,4)]}const Ko={fundamentals:{id:"fundamentals",name:"Chess Fundamentals",level:"beginner",description:"Master the basics every chess player needs to know",icon:"",estimatedTime:"2-3 hours",prerequisites:[],sessions:[{id:"fund_1",name:"Piece Power",duration:8,type:"lesson",description:"Understanding the relative value of each piece",skills:["development"],content:{introduction:"Every piece has a point value that helps you make trading decisions. Queen=9, Rook=5, Bishop=3, Knight=3, Pawn=1. Let's see why!",exercises:[{type:"quiz",question:"Which is worth more: a rook or a knight?",answer:"rook"},{type:"puzzle",fen:"r1bqkbnr/pppp1ppp/2n5/4p3/2B1P3/5Q2/PPPP1PPP/RNB1K1NR w KQkq - 0 1",goal:"Find the winning move (Scholar's Mate)"}]}},{id:"fund_2",name:"Controlling the Center",duration:8,type:"lesson",description:"Why the center matters and how to fight for it",skills:["centerControl"],content:{introduction:"The four central squares (e4, d4, e5, d5) are the most important squares on the board. Pieces in the center control more squares and can reach any part of the board quickly.",exercises:[{type:"position",fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",task:"Play moves that control the center"}]}},{id:"fund_3",name:"Developing Your Army",duration:8,type:"lesson",description:"Get your pieces into the game efficiently",skills:["development"],content:{introduction:"Development means moving your pieces from their starting squares to more active positions. Key principles: Knights before bishops, don't move the same piece twice, don't bring the queen out too early.",exercises:[]}},{id:"fund_4",name:"King Safety First",duration:8,type:"lesson",description:"Castle early and protect your king",skills:["kingSafety"],content:{introduction:"Your king is the most important piece - if it's checkmated, you lose! Castle early (usually by move 10) to tuck your king away safely.",exercises:[]}},{id:"fund_5",name:"Fundamentals Game",duration:10,type:"game",description:"Play a game focusing on development and center control",skills:["development","centerControl","kingSafety"],opponent:"beginner_bot",analysis:!0}]},tacticsBasics:{id:"tacticsBasics",name:"Basic Tactics",level:"beginner",description:"Learn the tactical patterns that win games",icon:"",estimatedTime:"3-4 hours",prerequisites:["fundamentals"],sessions:[{id:"tac_1",name:"The Fork",duration:10,type:"lesson",description:"Attack two pieces at once with one piece",skills:["forks"],content:{introduction:"A fork is when one piece attacks two or more enemy pieces at the same time. Knights are famous for forks because of their unique jumping ability!",exercises:[{type:"puzzle",fen:"r1bqkb1r/pppp1ppp/2n2n2/4p3/2B1P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 0 1",hint:"Can the knight fork?"},{type:"puzzle",fen:"r1bqkbnr/pppp1ppp/2n5/4p3/4P3/5N2/PPPP1PPP/RNBQKB1R w KQkq - 0 1",hint:"Knight fork incoming!"}]}},{id:"tac_2",name:"The Pin",duration:10,type:"lesson",description:"Freeze pieces in place by attacking through them",skills:["pins"],content:{introduction:"A pin is when a piece can't move because it would expose a more valuable piece behind it. Bishops, rooks, and queens can create pins.",exercises:[]}},{id:"tac_3",name:"The Skewer",duration:10,type:"lesson",description:"Force a piece to move and capture what's behind it",skills:["skewers"],content:{introduction:"A skewer is like a pin in reverse - you attack a valuable piece, and when it moves, you capture the piece behind it.",exercises:[]}},{id:"tac_4",name:"Discovered Attacks",duration:10,type:"lesson",description:"Move one piece to unleash another",skills:["discoveredAttacks"],content:{introduction:"A discovered attack happens when you move one piece out of the way to reveal an attack from a piece behind it. Double check is the most powerful version!",exercises:[]}},{id:"tac_5",name:"Back Rank Threats",duration:10,type:"lesson",description:"Exploit kings trapped on the back rank",skills:["backRank"],content:{introduction:"When a king is stuck on the back rank with no escape squares, a rook or queen can deliver checkmate. Always make 'luft' (an escape square) for your king!",exercises:[]}},{id:"tac_6",name:"Tactics Drill",duration:10,type:"puzzles",description:"Practice all the basic patterns",skills:["forks","pins","skewers","discoveredAttacks","backRank"],puzzleCount:15,difficulty:"beginner"}]},tacticsIntermediate:{id:"tacticsIntermediate",name:"Intermediate Tactics",level:"intermediate",description:"Sharpen your tactical vision with harder puzzles",icon:"",estimatedTime:"4-5 hours",prerequisites:["tacticsBasics"],sessions:[{id:"taci_1",name:"Complex Forks",duration:10,type:"puzzles",description:"Multi-move fork combinations",skills:["forks"],puzzleCount:12,difficulty:"intermediate"},{id:"taci_2",name:"Pin Exploitation",duration:10,type:"puzzles",description:"Creating and exploiting pins",skills:["pins"],puzzleCount:12,difficulty:"intermediate"},{id:"taci_3",name:"Deflection & Overloading",duration:10,type:"lesson",description:"Force defenders away from their duties",skills:["deflection"],content:{introduction:"Deflection is when you force a piece away from defending something important. Overloading is when a piece has too many jobs and can't do them all.",exercises:[]}},{id:"taci_4",name:"Mating Patterns",duration:12,type:"lesson",description:"Learn the classic checkmate patterns",skills:["matingPatterns"],content:{introduction:"Strong players recognize mating patterns instantly. We'll study the most common ones: back rank mate, smothered mate, Anastasia's mate, Arabian mate, and more.",exercises:[]}},{id:"taci_5",name:"Combination Practice",duration:15,type:"puzzles",description:"Multi-step tactical combinations",skills:["forks","pins","skewers","discoveredAttacks","deflection","matingPatterns"],puzzleCount:20,difficulty:"intermediate"}]},middlegameFundamentals:{id:"middlegameFundamentals",name:"Middlegame Strategy",level:"intermediate",description:"Think strategically and make plans",icon:"",estimatedTime:"4-5 hours",prerequisites:["tacticsBasics"],sessions:[{id:"mid_1",name:"Making a Plan",duration:10,type:"lesson",description:"How to assess positions and form plans",skills:["planning"],content:{introduction:"Every move should be part of a plan. Ask yourself: What are the weaknesses in my opponent's position? What are my best pieces? What's my target?",exercises:[]}},{id:"mid_2",name:"Pawn Structure",duration:10,type:"lesson",description:"Understanding pawn weaknesses and strengths",skills:["pawnStructure"],content:{introduction:"Pawns can't move backwards, so pawn structure decisions are permanent. Learn about isolated pawns, doubled pawns, passed pawns, and pawn chains.",exercises:[]}},{id:"mid_3",name:"Piece Activity",duration:10,type:"lesson",description:"Keep your pieces active and coordinated",skills:["pieceActivity"],content:{introduction:"An active piece is worth more than a passive one. Knights need outposts, bishops need open diagonals, rooks need open files.",exercises:[]}},{id:"mid_4",name:"Attack & Defense",duration:12,type:"lesson",description:"When to attack and how to defend",skills:["attack","defense"],content:{introduction:"Attack when you have an advantage. Defend actively - create counterplay instead of just sitting passively.",exercises:[]}},{id:"mid_5",name:"Strategy Game",duration:15,type:"game",description:"Apply strategic concepts in a real game",skills:["planning","pawnStructure","pieceActivity"],opponent:"intermediate_bot",analysis:!0}]},endgameEssentials:{id:"endgameEssentials",name:"Endgame Essentials",level:"intermediate",description:"Convert your advantages and save difficult positions",icon:"",estimatedTime:"3-4 hours",prerequisites:["fundamentals"],sessions:[{id:"end_1",name:"King + Queen Mate",duration:8,type:"lesson",description:"The most basic checkmate",skills:["basicMates"],content:{introduction:"Checkmate with king and queen is the first endgame you must master. The technique: push the enemy king to the edge with your queen, then deliver mate with your king's help.",exercises:[]}},{id:"end_2",name:"King + Rook Mate",duration:10,type:"lesson",description:"Essential technique everyone must know",skills:["basicMates"],content:{introduction:"Rook checkmate takes more technique. Use the 'box method' - cut off the enemy king, then shrink the box until mate.",exercises:[]}},{id:"end_3",name:"King Activity",duration:10,type:"lesson",description:"Your king becomes a fighting piece",skills:["kingActivity"],content:{introduction:"In the endgame, your king should be active! Bring it to the center and use it to support your pawns and attack your opponent's.",exercises:[]}},{id:"end_4",name:"Pawn Endgames",duration:12,type:"lesson",description:"King and pawn technique",skills:["pawnEndgames"],content:{introduction:"Pawn endgames are all about the king. Learn the key squares, opposition, and the square of the pawn rule.",exercises:[]}},{id:"end_5",name:"Rook Endgames Basics",duration:12,type:"lesson",description:"The Lucena and Philidor positions",skills:["rookEndgames"],content:{introduction:"Rook endgames are the most common. You MUST know the Lucena (how to win) and Philidor (how to draw) positions.",exercises:[]}}]},tacticsAdvanced:{id:"tacticsAdvanced",name:"Advanced Tactics",level:"advanced",description:"Master-level tactical combinations",icon:"",estimatedTime:"5-6 hours",prerequisites:["tacticsIntermediate"],sessions:[{id:"taca_1",name:"Sacrificial Attacks",duration:15,type:"lesson",description:"When and how to sacrifice material",skills:["attack","matingPatterns"],content:{introduction:"The best attacks often require sacrifices. Learn to recognize when a sacrifice leads to checkmate or decisive advantage.",exercises:[]}},{id:"taca_2",name:"Complex Combinations",duration:15,type:"puzzles",description:"Multi-move tactical masterpieces",skills:["forks","pins","discoveredAttacks","deflection","matingPatterns"],puzzleCount:15,difficulty:"advanced"},{id:"taca_3",name:"Prophylactic Thinking",duration:12,type:"lesson",description:"Prevent opponent's ideas before they happen",skills:["defense","planning"],content:{introduction:"Prophylaxis means preventing your opponent's plans. Ask 'what does my opponent want to do?' before making your move.",exercises:[]}},{id:"taca_4",name:"Calculation Training",duration:15,type:"puzzles",description:"Deep calculation exercises",skills:["depth","accuracy","visualization"],puzzleCount:12,difficulty:"advanced"}]},modernConcepts:{id:"modernConcepts",name:"Modern Chess Thinking",level:"advanced",description:"How today's top players (Carlsen, Nakamura) break classical rules  and why",icon:"",estimatedTime:"4-5 hours",prerequisites:["fundamentals"],sessions:[{id:"modern_1",name:"Why Rules Get Broken",duration:12,type:"lesson",description:"Understanding the purpose behind classical principles",skills:["planning"],content:{introduction:`Classical chess rules like "castle early" or "don't move the same piece twice" are training wheels, not laws. They exist because they work MOST of the time. 

Modern top players understand WHY each rule exists, which lets them know WHEN to break it. The goal isn't to memorize rules  it's to understand chess deeply enough to make good decisions in any position.

Magnus Carlsen often plays "boring" openings to avoid opponent preparation and reach unique middlegames where understanding beats memorization. Hikaru Nakamura plays incredibly fast because he understands patterns, not because he memorized more lines.

Key insight: Rules teach you what usually works. Understanding teaches you what actually works in THIS position.`,keyPoints:["Classical rules are guidelines based on what usually works","Understanding WHY lets you know WHEN to deviate","Top players seek unique positions, not theoretical ones","Memorization loses to understanding in unfamiliar territory"],exercises:[]}},{id:"modern_2",name:"The Engine Revolution",duration:12,type:"lesson",description:"How computers changed our understanding of chess",skills:["planning"],content:{introduction:`Before engines, humans decided what was "good chess." Many ideas were accepted simply because great players used them. Engines revealed uncomfortable truths:

1. Many "bad" positions are actually fine
2. Many "good" moves are second-best  
3. Defense is far more resilient than we thought
4. Concrete calculation beats general principles

What this means for you: Don't reject a move just because it "looks wrong." If you can't find a concrete problem with it, it might be perfectly playable. Engines taught us to be less dogmatic and more objective.

However, engines also showed that for most positions, classical principles DO lead to good moves. The difference is knowing which positions are exceptions.`,keyPoints:["Engines revealed many 'ugly' positions are objectively fine","Concrete analysis beats abstract rules","Defense is stronger than classical players believed","Classical principles still work  they're just not absolute"],exercises:[]}},{id:"modern_3",name:"Breaking the Opening Rules",duration:15,type:"lesson",description:"Early queen moves, delayed castling, and other modern ideas",skills:["development","centerControl","kingSafety"],content:{introduction:`Classical opening rules you learned  and when modern players break them:

"Don't bring the queen out early"
 BROKEN: The Scandinavian (1.e4 d5 2.exd5 Qxd5) is fully playable. The queen develops with tempo when attacked. What matters is whether opponent can PUNISH it, not whether it violates a rule.

"Don't move the same piece twice"  
 BROKEN: If your piece is attacked or can reach a much better square, move it again. Time is relative  a well-placed piece is worth "losing" a tempo.

"Castle early (by move 10)"
 BROKEN: In many modern lines, players castle on move 15-20 or not at all. The key is: Is your king safe WHERE IT IS? Sometimes the center is safest.

"Control the center with pawns"
 MODIFIED: Hypermodern openings (King's Indian, Grnfeld) control the center with pieces first, then undermine opponent's pawn center later.

The lesson: Each rule has a PURPOSE. Know the purpose, and you'll know when it doesn't apply.`,keyPoints:["Early queen moves are fine if opponent can't punish them","Moving a piece twice is fine if it improves significantly","Castling can wait if king is already safe","Center control with pieces (hypermodern) is equally valid"],exercises:[{type:"quiz",question:"In the Scandinavian Defense, Black moves the queen early. Why is this acceptable?",answer:"The queen develops while being attacked, gaining time, and it's hard for White to actually punish the queen"},{type:"quiz",question:"When might you delay castling past move 15?",answer:"When the center is closed, your king is safe, or castling would walk into an attack"}]}},{id:"modern_4",name:"Practical Chess (The Carlsen Method)",duration:12,type:"lesson",description:"Playing for positions, not evaluations",skills:["planning","pieceActivity"],content:{introduction:`Magnus Carlsen revolutionized top-level chess by prioritizing PRACTICAL chances over computer evaluations.

His approach:
1. Avoid sharp theory where opponent has prepared deeply
2. Reach complex middlegames where understanding beats preparation  
3. Keep pieces on the board  more pieces = more chances for opponent to err
4. Play "boring" positions excellently  small edges, ground out over 60 moves
5. Trust your opponent to make mistakes (they will)

What this means for improving players: A position that's "equal" on the computer might be much easier to play for one side. Choose positions YOU understand, even if the engine says something else is "better."

The best move is often the one your opponent is most likely to go wrong against  not the one the engine prefers.`,keyPoints:["Practical chances matter more than computer evaluations","Complex positions with more pieces = more opponent mistakes","Choose positions you understand over 'objectively best' ones","Small, lasting advantages can be converted over many moves","Your opponent WILL make mistakes  give them the opportunity"],exercises:[]}},{id:"modern_5",name:"Speed Chess Principles (The Nakamura Method)",duration:12,type:"lesson",description:"Pattern recognition and time management",skills:["depth","accuracy"],content:{introduction:`Hikaru Nakamura is one of the greatest blitz players ever. His success comes from:

1. PATTERN RECOGNITION over calculation
   - He's seen similar positions thousands of times
   - He doesn't calculate everything  he recognizes what works
   
2. "GOOD ENOUGH" moves played FAST
   - A 2nd-best move played quickly beats the best move played slowly
   - Time is a resource, just like material
   
3. Keeping the position COMPLICATED
   - More complexity = more chance for opponent to err under time pressure
   - Simplification helps the player with less time
   
4. INTUITION trained by thousands of games
   - His "gut feeling" is backed by massive pattern database in his brain

For you: Play lots of games (especially blitz) to build pattern recognition. When in doubt, develop a piece, improve your worst piece, or create a threat. Don't agonize over perfection.`,keyPoints:["Pattern recognition > raw calculation in fast games","A good move now beats a perfect move too late","Time on the clock is a resource like material","Complexity favors the better player; simplification favors who's ahead","Intuition comes from playing thousands of games"],exercises:[]}},{id:"modern_6",name:"Playing Real Chess",duration:10,type:"lesson",description:"Thinking for yourself instead of following trends",skills:["planning"],content:{introduction:`The danger of modern chess: Blindly copying top player moves without understanding WHY.

When you play 1.e4 e5 2.Nf3 Nc6 3.Bb5 because "Magnus plays it," you're not playing chess  you're performing memorized theater. The moment your opponent deviates, you're lost.

How to play REAL chess:
1. Learn the IDEAS behind openings, not just moves
2. Ask "what's the point of this move?" for every move you learn
3. Be willing to play "inferior" lines you understand deeply
4. Study complete games, not just opening databases
5. Analyze your own games  YOUR mistakes teach more than GM games

The goal: Develop your OWN chess understanding. Use engine analysis to check your thinking, not replace it. The best players aren't the ones who memorized the most  they're the ones who understand the most.

When you truly understand chess, you'll naturally find good moves in any position  whether it's a known theoretical line or something completely new.`,keyPoints:["Copying moves without understanding is memorization, not chess","Learn IDEAS behind openings, not just move sequences","Your own analysis teaches more than watching GMs","Engines should check your thinking, not replace it","Deep understanding in fewer openings beats shallow knowledge in many"],exercises:[]}},{id:"modern_7",name:"Practical Applications",duration:15,type:"game",description:"Apply modern concepts in actual play",skills:["planning","development","pieceActivity"],content:{introduction:"Let's play a game where you practice modern concepts: seek unique positions, prioritize understanding over memorization, and make practical decisions.",exercises:[]}}]},antiTheory:{id:"antiTheory",name:"Anti-Theory Openings",level:"intermediate",description:"Solid openings that prioritize understanding over memorization",icon:"",estimatedTime:"3-4 hours",prerequisites:["openings"],sessions:[{id:"anti_1",name:"The London System",duration:12,type:"lesson",description:"A solid, flexible system for White",skills:["development","planning"],content:{introduction:`The London System (1.d4 and 2.Bf4) is Carlsen-approved for a reason:

- Same setup against almost anything Black plays
- Easy to learn, hard to prepare against
- Solid pawn structure, clear plans
- Gets you to a middlegame where understanding > memorization

Key ideas:
1. Develop bishop to f4 BEFORE playing e3
2. Build a pyramid: pawns on d4, e3, c3
3. Knight to d2, then to f3 (or e5)
4. Castle kingside, then play for e4 or c4 break

This isn't about getting an "advantage"  it's about getting a playable position YOU understand better than your opponent.`,exercises:[]}},{id:"anti_2",name:"The Caro-Kann Defense",duration:12,type:"lesson",description:"A rock-solid response to 1.e4",skills:["development","pawnStructure"],content:{introduction:`The Caro-Kann (1.e4 c6) is the "boring but solid" choice against 1.e4:

- Sound pawn structure (no weak pawns)
- Clear development scheme
- Less theory than Sicilian or French
- Black often gets endgame with slight pressure

Main line ideas:
1. 1.e4 c6 2.d4 d5  challenge the center immediately
2. Develop light-squared bishop BEFORE playing e6
3. Aim for ...c5 break to challenge White's center
4. Solid but not passive  look for counterplay

Many GMs use the Caro-Kann when they want a solid game without memorizing 30 moves of theory.`,exercises:[]}},{id:"anti_3",name:"Systems Over Lines",duration:10,type:"lesson",description:"Why setups beat memorization",skills:["planning"],content:{introduction:`A SYSTEM is a setup you can use regardless of opponent's moves.
A LINE is a specific sequence that requires memorization.

Examples of systems:
- London System (White)
- King's Indian Attack (White)  
- Hippo/Hedgehog setups (Black)
- Stonewall formations (both colors)

Why systems work:
1. You play YOUR game, not your opponent's
2. Preparation is harder for opponents
3. Understanding transfers across many games
4. Less memorization, more chess

The tradeoff: Systems usually aim for equality or small advantages, not crushing attacks. But equality in a position you understand is better than an "advantage" in something you don't.`,exercises:[]}},{id:"anti_4",name:"Sideline Weapons",duration:12,type:"lesson",description:"Surprise openings that avoid main theory",skills:["development","openingTraps"],content:{introduction:`Sometimes the best preparation is to avoid the opponent's preparation entirely.

Useful sidelines:
- 1.b3 (Larsen's Opening)  flexible, transpositional
- 1.Nf3 followed by g3, Bg2, 0-0 (King's Indian Attack)
- 1.e4 e5 2.Nf3 Nc6 3.Bc4 (Italian) instead of the Ruy Lopez
- 1.d4 d5 2.Bf4 (London) instead of mainline Queen's Gambit

Against 1.e4 as Black:
- 1...e5 2...Nf6 (Petroff)  super solid
- 1...d6 followed by ...Nf6, ...g6 (Pirc)  flexible
- 1...Nc6 (Nimzowitsch)  rare and tricky

The point isn't that these are "better"  they're different. Your opponent's 20 moves of Sicilian preparation becomes useless.`,exercises:[]}}]}};function F5(){return Object.values(Ko)}function U5(t){return Object.values(Ko).filter(e=>e.level===t)}function vu(t,e){const n=Ko[t];if(!n)return 0;const i=n.sessions.filter(r=>e.includes(r.id)).length;return Math.round(i/n.sessions.length*100)}const e0={pieceValues:{title:"Understanding Piece Values",objectives:["Know the point value of each piece","Understand when to trade pieces","Recognize good vs bad trades"],steps:[{type:"explanation",title:"The Point System",content:`Chess pieces have relative values that help you decide when to trade:

**Pawn = 1 point**  The basic unit of measurement
**Knight = 3 points**  Equal to 3 pawns
**Bishop = 3 points**  Also equal to 3 pawns (some say 3.25)
**Rook = 5 points**  Worth more than a minor piece + pawn
**Queen = 9 points**  The most powerful piece
**King = Priceless**  Can't be traded!`,fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",highlights:[]},{type:"explanation",title:"Why These Values?",content:`These values come from centuries of chess experience:

**Pawns** move slowly and can only go forward
**Knights** can jump but are short-range
**Bishops** control long diagonals but only one color
**Rooks** control entire files and ranks
**Queen** combines rook + bishop powers`,fen:"8/8/8/3Q4/8/8/8/8 w - - 0 1",highlights:["d5"],arrows:[["d5","a8"],["d5","h1"],["d5","d8"],["d5","a5"]]},{type:"exercise",title:"Practice: Good Trade?",content:"White can capture the knight with the rook. Is Rxc6 a good trade?",fen:"r1bqkb1r/pppp1ppp/2n2n2/4p3/2B1P3/5N2/PPPP1PPP/RNBQR1K1 w kq - 0 5",question:"Should White play Rxc6?",options:[{text:"Yes, win a piece",correct:!1},{text:"No, rook (5) for knight (3) is bad",correct:!0},{text:"It doesn't matter",correct:!1}],explanation:"Trading a rook (5 points) for a knight (3 points) loses 2 points of material. Only trade down when you get something else in return!"},{type:"exercise",title:"Find the Best Capture",content:"Multiple captures are possible. Find the one that wins the most material.",fen:"r1bqkb1r/pppp1ppp/2n2n2/4N3/2B1P3/8/PPPP1PPP/RNBQK2R w KQkq - 0 5",moveToFind:"Nxf7",hint:"What's the most valuable piece you can take?",explanation:"Nxf7! forks the queen and rook. After Kxf7, you'll win the queen with Bxd5+. This wins the queen (9) for a knight (3) and bishop (3)."},{type:"quiz",title:"Quick Check",questions:[{question:"You have a chance to trade your bishop for two pawns. Is this good?",options:["Yes, 2 > 1","No, bishop (3) > 2 pawns (2)","It depends"],correct:1,explanation:"A bishop (3 points) is worth more than two pawns (2 points). Generally avoid this trade unless the pawns are very advanced."},{question:"What is worth more: Rook + Pawn or Queen?",options:["Rook + Pawn (6 points)","Queen (9 points)","They're equal"],correct:1,explanation:"Queen (9) beats Rook + Pawn (6). But Rook + Rook (10) beats Queen (9)!"}]},{type:"summary",title:"Key Takeaways",points:["Q=9, R=5, B=3, N=3, P=1","Trade pieces of equal or lesser value","Two minor pieces (6) roughly equal a rook + pawn (6)","Material advantage usually wins with good technique"]}],skillsImproved:["materialAwareness","calculation"]},centerControl:{title:"Controlling the Center",objectives:["Understand why the center matters","Learn to fight for central squares","Recognize strong vs weak center control"],steps:[{type:"explanation",title:"The Four Key Squares",content:`The center of the board consists of four key squares: **e4, d4, e5, d5**

Why does the center matter?
 Pieces in the center **control more squares**
 Central pieces can **reach any part of the board quickly**
 Control of the center **restricts your opponent's pieces**`,fen:"8/8/8/3xx3/3xx3/8/8/8 w - - 0 1",highlights:["e4","d4","e5","d5"]},{type:"explanation",title:"Knight Comparison",content:`Look at the difference in power:

**Knight on e4**: Controls 8 squares, can reach anywhere
**Knight on a1**: Controls only 2 squares, trapped in corner

A centralized knight is worth significantly more than a knight on the edge!`,fen:"8/8/8/8/4N3/8/8/N7 w - - 0 1",highlights:["e4","a1"],arrows:[["e4","f6"],["e4","g5"],["e4","g3"],["e4","f2"],["e4","d2"],["e4","c3"],["e4","c5"],["e4","d6"]]},{type:"exercise",title:"Best Opening Move",content:"What's the best first move for White? Think about center control.",fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",moveToFind:"e4",alternativeMoves:["d4"],hint:"Which pawn move controls the most central squares?",explanation:"1.e4 or 1.d4 are the best opening moves. They immediately occupy a central square and open lines for your pieces. 1.e4 controls d5 and f5, while opening the diagonal for your bishop."},{type:"explanation",title:"Classical vs Hypermodern",content:`There are two main approaches to the center:

**Classical** (1.e4, 1.d4): Occupy the center with pawns immediately
**Hypermodern** (1.Nf3, 1.g3): Control the center with pieces, attack opponent's center later

Both are valid! Classical is easier to learn.`,fen:"rnbqkb1r/pppppppp/5n2/8/4P3/8/PPPP1PPP/RNBQKBNR w KQkq - 1 2",highlights:["e4"]},{type:"exercise",title:"Maintain the Center",content:"Black just played ...d5. How should White respond to maintain central control?",fen:"rnbqkbnr/ppp1pppp/8/3p4/4P3/8/PPPP1PPP/RNBQKBNR w KQkq d6 0 2",moveToFind:"exd5",alternativeMoves:["e5","Nc3"],hint:"Should you capture, advance, or defend?",explanation:"All three moves are playable! exd5 trades but keeps an open game. e5 gains space but creates a target. Nc3 defends e4 and develops. In practice, exd5 (Scandinavian) or e5 (Advance French) are both common."},{type:"summary",title:"Key Takeaways",points:["Control e4, d4, e5, d5  the four central squares","Centralized pieces are more powerful","Fight for the center with pawns and pieces","Don't let your opponent dominate the center unopposed"]}],skillsImproved:["centerControl","openingPrinciples"]},development:{title:"Developing Your Pieces",objectives:["Get all pieces into the game efficiently","Understand piece coordination","Avoid common development mistakes"],steps:[{type:"explanation",title:"What is Development?",content:`**Development** means moving your pieces from their starting squares to active positions where they control key squares and work together.

**Well-developed position**: All pieces active, working together
**Poorly developed position**: Pieces still on starting squares or poorly placed`,fen:"r1bqkb1r/pppp1ppp/2n2n2/4p3/2B1P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 4 4",highlights:["c4","f3","c6","f6"]},{type:"explanation",title:"Development Guidelines",content:`Follow these principles for good development:

1. **Knights before bishops**  Knights have fewer good squares
2. **Don't move the same piece twice**  Develop new pieces
3. **Don't bring the queen out early**  She can be chased
4. **Castle early**  Usually by move 10
5. **Connect your rooks**  The final development goal`,fen:"r1bqk2r/pppp1ppp/2n2n2/2b1p3/2B1P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 6 5"},{type:"exercise",title:"Best Developing Move",content:"White has played e4 and Nf3. What's the best next move?",fen:"rnbqkbnr/pppp1ppp/8/4p3/4P3/5N2/PPPP1PPP/RNBQKB1R w KQkq - 2 3",moveToFind:"Bc4",alternativeMoves:["Nc3","Bb5","d4"],hint:"Develop a new piece to an active square.",explanation:"Bc4 develops the bishop to an active diagonal, targeting f7. Nc3 is also excellent, developing and controlling d5. Bb5 (Ruy Lopez) and d4 (Scotch) are also strong opening choices."},{type:"exercise",title:"Punish Poor Development",content:"Black has moved the queen early and it's being attacked. What does White play?",fen:"rnb1kbnr/pppp1ppp/8/4p3/4P2q/2N2N2/PPPP1PPP/R1BQKB1R w KQkq - 4 4",moveToFind:"Nc3-d5",hint:"Attack the queen while developing!",explanation:"The queen came out too early! Now White can play Nd5 or g3, gaining time by attacking the queen while developing. Black's queen will have to retreat, wasting moves."},{type:"quiz",title:"Development Check",questions:[{question:"On move 5, you have a choice: develop your last minor piece or capture a pawn. What's usually better?",options:["Capture the pawn for material","Develop the piece","It depends on the position"],correct:1,explanation:"Development usually trumps grabbing pawns early. A fully developed army can launch attacks that win back much more than a pawn."},{question:"Why is it bad to move the same piece twice in the opening?",options:["It's illegal","You fall behind in development","The piece gets tired"],correct:1,explanation:"Each turn spent moving the same piece is a turn not spent developing a new piece. Your opponent will have more pieces in the game."}]},{type:"summary",title:"Key Takeaways",points:["Develop all pieces before attacking","Knights before bishops, castle early","Don't move the same piece twice unnecessarily","Don't bring the queen out too early","Connect your rooks as the final development goal"]}],skillsImproved:["development","openingPrinciples"]},kingSafety:{title:"King Safety and Castling",objectives:["Understand why king safety matters","Know when and how to castle","Recognize dangerous king positions"],steps:[{type:"explanation",title:"The King's Vulnerability",content:`Your king is the most important piece  if it's checkmated, you lose!

In the opening and middlegame, the king is vulnerable in the center:
 Open files allow rooks to attack
 Diagonals expose it to bishops
 It blocks your rooks from connecting`,fen:"rnbqkbnr/pppp1ppp/8/4p3/4P3/8/PPPP1PPP/RNBQKBNR w KQkq - 0 2",highlights:["e1","e8"]},{type:"explanation",title:"Castling Explained",content:`**Castling** does three things at once:
1. Moves your king to safety
2. Develops your rook
3. Connects your rooks

**Kingside castling (O-O)**: King goes g1, rook goes f1
**Queenside castling (O-O-O)**: King goes c1, rook goes d1`,fen:"r3k2r/pppppppp/8/8/8/8/PPPPPPPP/R3K2R w KQkq - 0 1",arrows:[["e1","g1"],["h1","f1"]]},{type:"explanation",title:"Castling Requirements",content:`You can only castle if:
 King has never moved
 Rook has never moved
 No pieces between king and rook
 King is not in check
 King doesn't pass through check
 King doesn't land in check`,fen:"r3k2r/pppppppp/8/8/8/8/PPPPPPPP/R3K2R w KQkq - 0 1"},{type:"exercise",title:"Should You Castle?",content:"White can castle kingside. Is it a good idea here?",fen:"r1bqk2r/pppp1ppp/2n2n2/2b1p3/2B1P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 6 5",moveToFind:"O-O",hint:"Is your king safe in the center?",explanation:"Yes! O-O is excellent. The king is safe on g1, the rook becomes active on f1, and White completes development. Don't wait too long to castle!"},{type:"exercise",title:"Punish the Uncastled King",content:"Black hasn't castled. Find the crushing move.",fen:"rn1qkb1r/pbpp1ppp/1p2pn2/8/2BP4/5N2/PPP2PPP/RNBQ1RK1 w kq - 0 6",moveToFind:"Bxe6",hint:"The f7 square is weak...",explanation:"Bxe6! wins a pawn and ruins Black's structure. After ...fxe6, Black's king is stuck in the center and e6 is a permanent weakness. This is why castling early matters!"},{type:"summary",title:"Key Takeaways",points:["Castle early (usually by move 10)","Kingside castling is more common and usually safer","The king in the center is a target","Look to punish opponents who delay castling","After castling, protect your king's pawn shield"]}],skillsImproved:["kingSafety","castlingDecisions"]}},t0={forks:{title:"The Fork: Attacking Two Things at Once",objectives:["Recognize fork patterns","Set up forks with preparation","Defend against forks"],steps:[{type:"explanation",title:"What is a Fork?",content:`A **fork** is when one piece attacks two (or more) enemy pieces at the same time.

Your opponent can only save one piece  you win the other!

Any piece can fork, but **knights** are especially good at forking because they attack in unusual patterns.`,fen:"8/8/8/4k3/8/3N4/8/4K3 w - - 0 1",highlights:["d3"],arrows:[["d3","e5"],["d3","c5"]]},{type:"explanation",title:"The Knight Fork",content:`Knights are forking machines because:
 They jump over pieces
 Their L-shaped movement is hard to see
 They can attack pieces that can't attack back

**Royal fork**: Attacks king and queen
**Family fork**: Attacks king, queen, and rook`,fen:"4k3/8/8/2N5/8/8/8/4K2q w - - 0 1",highlights:["c5"],arrows:[["c5","e6"]]},{type:"exercise",title:"Find the Fork",content:"White to move. Find the knight fork!",fen:"r3k2r/ppp2ppp/2n5/3q4/4P3/2N5/PPP2PPP/R3K2R w KQkq - 0 1",moveToFind:"Nd5",hint:"Where can the knight attack two pieces?",explanation:"Nd5! forks the queen on d5 and the rook on a8. Wait, the queen IS on d5... Actually Nc3-b5! attacks c7 threatening royal fork on c7. Or Ne4 attacks the queen and threatens Nc5/Ng5."},{type:"exercise",title:"Set Up the Fork",content:"The fork isn't there yet, but you can create it. Find the preparation!",fen:"r1bqkb1r/pppp1ppp/2n2n2/4p3/2B1P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 4 4",moveToFind:"Ng5",hint:"Target the weak f7 square...",explanation:"Ng5! threatens Nxf7, forking the queen and rook. This is a key attacking idea in the Italian Game. Black must be careful!"},{type:"explanation",title:"Queen and Bishop Forks",content:`The queen can fork along ranks, files, AND diagonals  she's the ultimate forking piece!

Bishops can fork along diagonals. Look for pieces on the same diagonal color.`,fen:"r1bqk2r/pppp1ppp/2n2n2/2b1p3/2B1P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 6 5",arrows:[["c4","f7"],["c4","g8"]]},{type:"exercise",title:"Queen Fork",content:"Find the queen fork that wins material.",fen:"r1b1k2r/pppp1ppp/2n2n2/4N3/1bB1P3/8/PPPP1PPP/RNBQK2R w KQkq - 0 1",moveToFind:"Qh5",hint:"Where can the queen attack two pieces?",explanation:"Qh5! attacks f7 (threatening mate) and threatens Qxb4 winning the bishop. Black can't defend both."},{type:"summary",title:"Key Takeaways",points:["Forks attack two pieces at once  you win one","Knights are especially good at forking","Look for loose (undefended) pieces to fork","Sometimes you need to prepare the fork with another move","Defend against forks by keeping pieces protected"]}],skillsImproved:["forks","tactics","patternRecognition"]},pins:{title:"The Pin: Freezing Pieces in Place",objectives:["Understand absolute vs relative pins","Create and exploit pins","Escape from pins"],steps:[{type:"explanation",title:"What is a Pin?",content:`A **pin** is when a piece cannot move (or shouldn't move) because it would expose a more valuable piece behind it.

**Absolute pin**: The piece behind is the king  illegal to move
**Relative pin**: The piece behind is valuable  unwise to move`,fen:"r1bqk2r/pppp1ppp/2n2n2/4p3/1bB1P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 6 5",arrows:[["b4","e1"]],highlights:["d2"]},{type:"explanation",title:"Absolute Pin Example",content:`The knight on f6 is **absolutely pinned**  it cannot move because the bishop on g5 would take the queen!

When a piece is absolutely pinned to the king, it's completely frozen.`,fen:"rnbqk2r/pppp1ppp/5n2/4p1B1/4P3/8/PPPP1PPP/RN1QKBNR b KQkq - 0 1",arrows:[["g5","d8"]],highlights:["f6"]},{type:"exercise",title:"Exploit the Pin",content:"The knight is pinned. How do you win it?",fen:"rnbqk2r/pppp1ppp/5n2/4p1B1/4P3/3P4/PPP2PPP/RN1QKBNR w KQkq - 0 1",moveToFind:"e5",hint:"Attack the pinned piece again!",explanation:"e5! attacks the pinned knight. It cannot move, so White wins it. Always look to pile up on pinned pieces!"},{type:"exercise",title:"Create a Pin",content:"Find a move that pins an enemy piece.",fen:"r1bqkb1r/pppp1ppp/2n2n2/4p3/2B1P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 4 4",moveToFind:"Bg5",hint:"Which piece can you pin to the queen?",explanation:"Bg5! pins the knight to the queen. Now if Black plays ...d6, White can win with Bxf6 Qxf6, and the knight on c6 is loose."},{type:"explanation",title:"Breaking a Pin",content:`You can break a pin several ways:
 **Block**: Put a piece between the attacker and target
 **Move the back piece**: Get the valuable piece out
 **Attack the pinning piece**: Force it to move
 **Counterattack**: Create a bigger threat`,fen:"rnbqk2r/pppp1ppp/5n2/4p1B1/1b2P3/2N2N2/PPPP1PPP/R2QKB1R w KQkq - 0 1"},{type:"exercise",title:"Break the Pin",content:"White's knight is pinned. Find the best way to break it.",fen:"rnbqk2r/pppp1ppp/5n2/4p3/1b2P3/2N2N2/PPPP1PPP/R1BQKB1R w KQkq - 0 1",moveToFind:"Bd2",alternativeMoves:["a3"],hint:"How can you block or chase the bishop?",explanation:"Bd2! blocks the pin and develops a piece. The knight is free to move again. a3 also works but Bd2 is more active."},{type:"summary",title:"Key Takeaways",points:["Pins freeze pieces in place","Absolute pins (to the king) are illegal to break","Pile up attacks on pinned pieces","Look for pin opportunities when pieces line up","Break pins by blocking, moving, or counterattacking"]}],skillsImproved:["pins","tactics","patternRecognition"]},backRankMate:{title:"Back Rank Mate Patterns",objectives:["Recognize back rank weaknesses","Execute back rank mates","Prevent back rank threats"],steps:[{type:"explanation",title:"The Back Rank Weakness",content:`A **back rank mate** happens when a rook or queen checkmates the king on the first rank because the king is trapped by its own pawns.

This is one of the most common tactical patterns  even grandmasters miss it!`,fen:"6k1/5ppp/8/8/8/8/5PPP/R5K1 w - - 0 1",arrows:[["a1","a8"]],highlights:["g8","f7","g7","h7"]},{type:"exercise",title:"Find the Back Rank Mate",content:"White to move and checkmate!",fen:"6k1/5ppp/8/8/8/8/5PPP/4R1K1 w - - 0 1",moveToFind:"Re8#",hint:"The king can't escape!",explanation:"Re8# is checkmate! The king is trapped by its own pawns on f7, g7, h7. This is the most basic back rank mate pattern."},{type:"explanation",title:"Setting Up Back Rank Mates",content:`To execute a back rank mate:
1. Get your rook(s) on an open file
2. Make sure opponent's king is trapped
3. Remove or distract defenders
4. Deliver the blow!`,fen:"2r3k1/5ppp/8/8/8/8/5PPP/1R4K1 w - - 0 1"},{type:"exercise",title:"Deflect the Defender",content:"The rook on c8 defends. Find the way to deflect it!",fen:"2r3k1/5ppp/8/8/1Q6/8/5PPP/1R4K1 w - - 0 1",moveToFind:"Qc4",alternativeMoves:["Qf4","Qe7"],hint:"Attack the rook!",explanation:"Qc4! attacks the rook. If ...Rxc4, then Rb8# is mate! If the rook moves along the c-file, White still plays Rb8#. The queen deflected the defender."},{type:"exercise",title:"Two Rooks",content:"White has two rooks. Find the winning combination.",fen:"3r2k1/5ppp/8/8/8/8/5PPP/1RR3K1 w - - 0 1",moveToFind:"Rxd8+",hint:"Trade first, then checkmate!",explanation:"Rxd8+! Rxd8, Rxd8# is checkmate! The first rook removes the defender, the second delivers mate."},{type:"explanation",title:"Preventing Back Rank Mates",content:`Protect yourself from back rank mates:
 **Make luft**: Push h3 (or h6) to give your king an escape
 **Keep a rook on the back rank** as a defender
 **Don't leave your king trapped** behind unmoved pawns`,fen:"6k1/5pp1/7p/8/8/7P/5PP1/R5K1 w - - 0 1",highlights:["h6","h3"]},{type:"summary",title:"Key Takeaways",points:["Back rank mates trap the king with its own pawns","Rooks and queens deliver back rank mates","Deflect or eliminate defenders","Make 'luft' (h3 or a3) to prevent back rank threats","Keep aware of back rank weaknesses in both positions"]}],skillsImproved:["backRankMate","matingPatterns","tactics"]}},n0={pawnStructure:{title:"Pawn Structure Basics",objectives:["Identify strong and weak pawn structures","Understand isolated, doubled, and backward pawns","Create and exploit pawn weaknesses"],steps:[{type:"explanation",title:"Why Pawn Structure Matters",content:`Pawns can't move backward  every pawn move creates a permanent change!

**Good structure**: Pawns protect each other, control key squares
**Bad structure**: Weak pawns that need constant defense

Pawn structure often determines the plans for the entire game.`,fen:"8/pp3ppp/2p5/3p4/3P4/2P5/PP3PPP/8 w - - 0 1"},{type:"explanation",title:"Isolated Pawns",content:`An **isolated pawn** has no pawns on adjacent files to protect it.

Weaknesses:
 Must be defended by pieces (ties them down)
 The square in front is a great outpost for opponent

Strengths:
 Open files for rooks
 Dynamic piece play`,fen:"8/pp3ppp/8/3p4/3P4/8/PP3PPP/8 w - - 0 1",highlights:["d4","d5"]},{type:"explanation",title:"Doubled Pawns",content:`**Doubled pawns** are two pawns on the same file.

Often a weakness because:
 They can't protect each other
 The front pawn blocks the back pawn
 Creates holes on adjacent squares

Sometimes acceptable for open files or central control.`,fen:"8/pp3ppp/8/8/2P5/2P5/PP3PPP/8 w - - 0 1",highlights:["c3","c4"]},{type:"exercise",title:"Find the Weakness",content:"Black's structure has a weakness. What is it?",fen:"8/ppp2ppp/3p4/4p3/4P3/3P4/PPP2PPP/8 w - - 0 1",question:"What is Black's main structural weakness?",options:[{text:"The d6 pawn is backward",correct:!0},{text:"The e5 pawn is isolated",correct:!1},{text:"Black has doubled pawns",correct:!1}],explanation:"The d6 pawn is backward  it can't be defended by other pawns and the d5 square is a great outpost for White pieces."},{type:"summary",title:"Key Takeaways",points:["Every pawn move is permanent  choose carefully","Isolated pawns need piece defense","Doubled pawns can't protect each other","Backward pawns create outpost squares for opponent","Sometimes pawn weaknesses give dynamic compensation"]}],skillsImproved:["pawnStructure","planning","strategicThinking"]}},O5={forks:{beginner:[{fen:"r1bqkb1r/pppp1ppp/2n2n2/4p2Q/2B1P3/8/PPPP1PPP/RNB1K1NR w KQkq - 4 4",solution:["Qxf7#"],hint:"The queen can attack f7 and deliver checkmate!",explanation:"This is Scholar's Mate - Qxf7 is checkmate because the king can't escape and nothing can block.",tags:["queen","checkmate","opening-trap"]},{fen:"r1bqkbnr/pppp1ppp/2n5/4p3/2B1P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 4 4",solution:["Ng5"],hint:"Where can the knight go to attack two things?",explanation:"Ng5 attacks the weak f7 square and threatens Qxf7+ fork of king and rook.",tags:["knight","attack","f7-weakness"]},{fen:"rnbqkbnr/ppp2ppp/8/3pp3/4P3/5N2/PPPP1PPP/RNBQKB1R w KQkq - 0 3",solution:["Nxe5"],hint:"The knight can capture and fork!",explanation:"Nxe5 wins a pawn and attacks the queen if she defends d5.",tags:["knight","pawn-win"]},{fen:"r1bqkb1r/pppp1ppp/2n2n2/4p3/2B1P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 4 4",solution:["Ng5"],hint:"The knight can attack f7!",explanation:"Ng5 creates a double attack on f7, threatening Nxf7 winning the rook.",tags:["knight","double-attack"]},{fen:"rnbqkbnr/pppp1ppp/8/4p3/4P3/5N2/PPPP1PPP/RNBQKB1R b KQkq - 1 2",solution:["Nc6"],hint:"Develop with a threat!",explanation:"Nc6 develops and defends e5 - a good developing move.",tags:["development","defense"]}],intermediate:[{fen:"r1b1k2r/ppppqppp/2n2n2/2b1p3/2B1P3/3P1N2/PPP2PPP/RNBQK2R w KQkq - 4 5",solution:["Bg5","Nxe4"],hint:"Pin the knight, then win it!",explanation:"Bg5 pins the knight to the queen. After h6, Bxf6 Qxf6, you've won a piece.",tags:["pin","piece-win"]},{fen:"r1bqkb1r/ppp2ppp/2np1n2/4p3/2B1P3/2NP1N2/PPP2PPP/R1BQK2R w KQkq - 0 5",solution:["Nd5"],hint:"The knight can jump to a powerful square!",explanation:"Nd5 attacks the knight on f6 and threatens Nxc7+ forking king and rook.",tags:["knight","outpost","fork-threat"]},{fen:"r2qk2r/ppp1bppp/2np1n2/4p1B1/2B1P3/2NP1N2/PPP2PPP/R2QK2R w KQkq - 5 7",solution:["Nd5"],hint:"Occupy the powerful central square!",explanation:"Nd5 attacks the bishop on e7 and knight on f6 simultaneously.",tags:["knight","central-outpost"]}],advanced:[{fen:"r1bq1rk1/ppp2ppp/2np1n2/2b1p3/2B1P3/2NP1N2/PPP2PPP/R1BQ1RK1 w - - 6 7",solution:["Nd5","Nxf6+"],hint:"The knight can create multiple threats!",explanation:"Nd5 prepares Nxf6+ which forks king and queen after Bxf6.",tags:["knight","combination","fork"]}]},pins:{beginner:[{fen:"rnbqkbnr/ppp2ppp/3p4/4p3/4P3/5N2/PPPP1PPP/RNBQKB1R w KQkq - 0 3",solution:["Bb5+"],hint:"Check and pin the knight!",explanation:"Bb5+ pins the knight on c6 (once it blocks) to the king.",tags:["bishop","absolute-pin"]},{fen:"r1bqkbnr/pppp1ppp/2n5/4p3/2B1P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 4 4",solution:["Bb5"],hint:"Pin the knight to the king!",explanation:"Bb5 creates a pin - the knight on c6 cannot move without exposing the king.",tags:["bishop","pin"]},{fen:"rn1qkb1r/pbpp1ppp/1p2pn2/8/2PP4/2N2N2/PP2PPPP/R1BQKB1R w KQkq - 2 5",solution:["Bg5"],hint:"Pin the knight to the queen!",explanation:"Bg5 pins the knight on f6 to the queen. This is a relative pin.",tags:["bishop","relative-pin"]}],intermediate:[{fen:"r1bqk2r/pppp1ppp/2n2n2/2b1p3/2B1P3/2N2N2/PPPP1PPP/R1BQK2R w KQkq - 6 5",solution:["Bg5","Nd5"],hint:"Pin first, then exploit!",explanation:"Bg5 pins the knight, then Nd5 attacks the pinned piece.",tags:["bishop","pin","attack-pinned-piece"]},{fen:"r2qkb1r/ppp2ppp/2np1n2/4pb2/2B1P3/2N2N2/PPPP1PPP/R1BQK2R w KQkq - 0 6",solution:["Bg5"],hint:"Create a pin on the f6 knight!",explanation:"Bg5 pins the knight. If Bxe4 then Bxf6 wins the pinned knight.",tags:["bishop","pin","trap"]}]},skewers:{beginner:[{fen:"6k1/5ppp/8/8/8/8/5PPP/4R1K1 w - - 0 1",solution:["Re8+"],hint:"Check the king, win the piece behind!",explanation:"Re8+ forces the king to move, then you capture whatever's behind it.",tags:["rook","skewer","check"]},{fen:"4r1k1/5ppp/8/8/8/4B3/5PPP/6K1 w - - 0 1",solution:["Bc5+"],hint:"The bishop can skewer!",explanation:"Bc5+ attacks the king, and when it moves, we capture the rook.",tags:["bishop","skewer"]}],intermediate:[{fen:"r3k2r/ppp2ppp/2n2n2/8/1bB5/2N2N2/PPPQ1PPP/R3K2R w KQkq - 0 10",solution:["Qa5+"],hint:"Attack the king and bishop!",explanation:"Qa5+ skewers the king and bishop on b4.",tags:["queen","skewer","check"]}]},discoveredAttacks:{beginner:[{fen:"r1bqkb1r/pppp1ppp/2n2n2/4p3/2B1P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 4 4",solution:["Nxe5"],hint:"Take and discover an attack!",explanation:"Nxe5 wins a pawn and discovers an attack on f7 from the bishop.",tags:["knight","discovered-attack"]},{fen:"r1bqk2r/pppp1ppp/2n2n2/2b1p3/2B1P3/2NP1N2/PPP2PPP/R1BQK2R w KQkq - 0 5",solution:["Bxf7+","Kxf7","Ng5+"],hint:"Sacrifice to discover an attack!",explanation:"Bxf7+ Kxf7 Ng5+ forks king and queen (discovered check from queen).",tags:["sacrifice","discovered-check"]}],intermediate:[{fen:"r1bqk2r/pppp1ppp/2n2n2/2b1p3/2B1P3/3P1N2/PPP2PPP/RNBQK2R w KQkq - 0 5",solution:["Ng5"],hint:"Attack f7 and threaten discovery!",explanation:"Ng5 threatens Bxf7+ discovered attack winning material.",tags:["knight","threat","discovery-threat"]}]},backRank:{beginner:[{fen:"6k1/5ppp/8/8/8/8/5PPP/4R1K1 w - - 0 1",solution:["Re8#"],hint:"The king is trapped on the back rank!",explanation:"Re8# is checkmate - the king has no escape squares (blocked by its own pawns).",tags:["rook","back-rank-mate"]},{fen:"3r2k1/5ppp/8/8/8/8/5PPP/3R2K1 w - - 0 1",solution:["Rd8+","Rxd8#"],hint:"Force the rook trade, then mate!",explanation:"Rd8+ forces Rxd8, and after Rxd8# it's checkmate on the back rank.",tags:["rook","back-rank","exchange"]}],intermediate:[{fen:"r4rk1/ppp2ppp/8/8/8/8/PPP2PPP/R4RK1 w - - 0 1",solution:["Rae1"],hint:"Double your rooks to threaten the back rank!",explanation:"Rae1 doubles rooks and threatens Re8+ with a devastating attack.",tags:["rook","doubling","back-rank-threat"]},{fen:"2r3k1/5ppp/8/8/8/8/5PPP/1R4K1 w - - 0 1",solution:["Rb8+","Rxb8#"],hint:"Force the trade and mate!",explanation:"Rb8+ forces Rxb8, allowing Rxb8# - back rank checkmate.",tags:["rook","back-rank-mate","deflection"]}]},matingPatterns:{beginner:[{fen:"k7/8/1K6/8/8/8/8/R7 w - - 0 1",solution:["Ra8#"],hint:"Deliver checkmate with the rook!",explanation:"Ra8# is a simple back rank checkmate. The king has nowhere to go.",tags:["rook","checkmate","basic-mate"]},{fen:"k7/8/2K5/8/8/8/8/7Q w - - 0 1",solution:["Qa8#"],hint:"The queen can mate in one!",explanation:"Qa8# delivers checkmate. The queen covers all escape squares.",tags:["queen","checkmate","basic-mate"]},{fen:"k7/2K5/8/8/8/8/8/R7 w - - 0 1",solution:["Ra8#"],hint:"Checkmate with the rook!",explanation:"Ra8# - the king supports the rook and there's no escape.",tags:["rook","king","checkmate"]}],intermediate:[{fen:"r1bqkb1r/pppp1Qpp/2n2n2/4p3/2B1P3/8/PPPP1PPP/RNB1K1NR b KQkq - 0 4",solution:[],isCheckmate:!0,hint:"This position is already checkmate!",explanation:"This is Scholar's Mate - Qxf7# has just been played.",tags:["checkmate","scholar's-mate"]},{fen:"6k1/5ppp/6N1/8/8/8/5PPP/6K1 w - - 0 1",solution:["Nf8"],hint:"Set up a smothered mate threat!",explanation:"Nf8! threatens Nh7# (smothered mate). The king is trapped by its own pawns.",tags:["knight","smothered-mate","threat"]},{fen:"r1bqk2r/pppp1Npp/2n2n2/2b1p3/2B1P3/8/PPPP1PPP/RNBQK2R b KQkq - 0 5",solution:[],isCheckmate:!1,hint:"White has a deadly threat!",explanation:"Nxh8 wins the rook, or Ng5 threatens Qxf7#.",tags:["knight","threat","material"]}],advanced:[{fen:"r1bqk2r/pppp1ppp/2n2n2/2b1p2Q/2B1P3/8/PPPP1PPP/RNB1K1NR w KQkq - 6 5",solution:["Qxf7+","Ke7","Qxe5+"],hint:"Start a forcing sequence!",explanation:"Qxf7+ Ke7 Qxe5+ wins massive material and keeps attacking.",tags:["queen","attack","forcing"]}]},deflection:{beginner:[{fen:"r1bqk2r/pppp1ppp/2n2n2/2b1p3/2B1P3/2NP1N2/PPP2PPP/R1BQK2R w KQkq - 0 5",solution:["Bxf7+"],hint:"Deflect the king from defending!",explanation:"Bxf7+ forces the king to move, allowing tactical ideas.",tags:["bishop","sacrifice","deflection"]}],intermediate:[{fen:"r1bqk2r/ppp2ppp/2n1pn2/3p4/1bPP4/2N1PN2/PP3PPP/R1BQKB1R w KQkq - 0 6",solution:["Qa4"],hint:"Attack the pinned knight and bishop!",explanation:"Qa4 attacks both the bishop on b4 and threatens the knight on c6.",tags:["queen","double-attack","pin-exploitation"]}]}};function z5(t,e="beginner"){const n=O5[t];return n?n[e]||[]:[]}const j5={correct:["Excellent! You found it! ","Perfect! That's exactly right!","Great pattern recognition!","Well done! You're getting stronger!"],incorrect:["Not quite - let's look at this together.","Good try! Here's a hint...","That's a reasonable idea, but there's something better.","Close! Think about what piece is undefended."],hint:["Take your time and look for forcing moves.","Check all captures first.","What pieces are undefended?","Is there a way to attack two things at once?"]};function i0(t){const e=j5[t];return e[Math.floor(Math.random()*e.length)]}function W5({session:t,module:e,userSkills:n,voice:i,onComplete:r,onBack:s}){const[a,l]=N.useState("intro"),[c,d]=N.useState(0),[h,f]=N.useState({correct:0,total:0}),[p,m]=N.useState(""),[y,x]=N.useState(!1),[g,u]=N.useState([]),[v,b]=N.useState(null),[w,R]=N.useState(null),[C,A]=N.useState(null),[B,S]=N.useState(0);_u.useEffect(()=>{p&&(i!=null&&i.isEnabled)&&i.speak(p)},[p]),_u.useEffect(()=>{if(t.type==="puzzles"){const F=[],de=t.skills||[],Te=t.difficulty||"beginner";de.forEach(Re=>{const Q=k(Re);if(Q){const ae=z5(Q,Te);F.push(...ae.map(Me=>({...Me,category:Q})))}});const le=F.sort(()=>Math.random()-.5).slice(0,t.puzzleCount||10);if(u(le),le.length>0){b(le[0]);const Re=new Bt(le[0].fen);R(Re),A(le[0].fen)}}},[t]);function k(F){return{forks:"forks",pins:"pins",skewers:"skewers",discoveredAttacks:"discoveredAttacks",backRank:"backRank",matingPatterns:"matingPatterns",deflection:"deflection"}[F]||null}const U=()=>{var F;t.type==="lesson"?(l("content"),m(((F=t.content)==null?void 0:F.introduction)||"Let's learn about "+t.name)):t.type==="puzzles"?(l("puzzle"),m("Let's practice! Find the best move in each position.")):t.type==="game"&&(l("game"),m("Time to put your skills to the test! Play a game and we'll analyze it together."))},O=N.useCallback(F=>{if(!(!v||!w))try{const de=w.move(F);if(de){A(w.fen());const Te=v.solution[0];de.san===Te||F.from+F.to===(Te==null?void 0:Te.toLowerCase().replace(/[+#x]/g,""))?(f(le=>({correct:le.correct+1,total:le.total+1})),m(i0("correct")),setTimeout(()=>{const le=g.indexOf(v)+1;if(le<g.length){const Re=g[le];b(Re);const Q=new Bt(Re.fen);R(Q),A(Re.fen),x(!1),S(0),m("Good! Here's the next one.")}else l("complete")},1500)):(w.undo(),A(w.fen()),S(le=>le+1),B>=2?(m(`The answer was ${Te}. ${v.hint}`),f(le=>({...le,total:le.total+1})),setTimeout(()=>{const le=g.indexOf(v)+1;if(le<g.length){const Re=g[le];b(Re);const Q=new Bt(Re.fen);R(Q),A(Re.fen),x(!1),S(0),m("Let's try another one!")}else l("complete")},2500)):m(i0("incorrect")))}}catch(de){console.error("Invalid move:",de)}},[v,w,g,B]),X=()=>{v!=null&&v.hint&&(x(!0),m(`Hint: ${v.hint}`))},K=()=>{const F=h.total>0?Math.round(h.correct/h.total*100):100,de={};(t.skills||[]).forEach(Te=>{var ae,Me;const xe=((ae=n[Te])==null?void 0:ae.level)||1,le=F>=80?20:F>=60?10:5,Re=(((Me=n[Te])==null?void 0:Me.xp)||0)+le,Q=Re>=100?Math.min(xe+1,5):xe;de[Te]={level:Q,xp:Re>=100?Re-100:Re}}),r({accuracy:F,score:h,skillUpdates:de})},$=()=>o.jsxs("div",{style:{textAlign:"center",padding:40},children:[o.jsx("div",{style:{fontSize:64,marginBottom:24},children:(e==null?void 0:e.icon)||""}),o.jsx("h2",{style:{margin:"0 0 12px 0"},children:t.name}),o.jsx("p",{style:{opacity:.8,marginBottom:8},children:t.description}),o.jsxs("div",{style:{opacity:.6,marginBottom:32},children:[" ",t.duration," minutes"]}),o.jsx("button",{onClick:U,style:{padding:"16px 48px",background:"#4CAF50",color:"white",border:"none",borderRadius:12,fontSize:18,fontWeight:600,cursor:"pointer"},children:"Start Session "})]}),q=()=>{var F;return o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[o.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(76,175,80,0.2) 0%, rgba(33,150,243,0.2) 100%)",borderRadius:12,padding:20,display:"flex",gap:16,alignItems:"flex-start"},children:[o.jsx("span",{style:{fontSize:40},children:""}),o.jsx("div",{style:{flex:1},children:o.jsx("div",{style:{fontSize:15,lineHeight:1.7},children:p})})]}),o.jsx("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:12,padding:24},children:o.jsx("p",{style:{fontSize:15,lineHeight:1.8,margin:0},children:((F=t.content)==null?void 0:F.introduction)||t.description})}),o.jsx("div",{style:{textAlign:"center"},children:o.jsx("button",{onClick:()=>l("complete"),style:{padding:"14px 32px",background:"#4CAF50",color:"white",border:"none",borderRadius:8,fontSize:16,fontWeight:600,cursor:"pointer"},children:"Continue "})})]})},J=()=>{if(!v||!w)return o.jsx("div",{children:"Loading puzzles..."});const F=w.turn()==="w"?"White":"Black";return o.jsxs("div",{style:{display:"flex",gap:24},children:[o.jsx("div",{style:{flex:"0 0 auto"},children:o.jsx(Gr,{chess:w,fen:C,orientation:w.turn(),interactive:!0,onMove:O,size:420})}),o.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:16},children:[o.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:12,padding:16},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[o.jsx("span",{style:{fontSize:13,opacity:.7},children:"Progress"}),o.jsxs("span",{style:{fontSize:13},children:[g.indexOf(v)+1," / ",g.length]})]}),o.jsx("div",{style:{height:8,background:"rgba(255,255,255,0.1)",borderRadius:4,overflow:"hidden"},children:o.jsx("div",{style:{height:"100%",width:`${(g.indexOf(v)+1)/g.length*100}%`,background:"#4CAF50",transition:"width 0.3s"}})})]}),o.jsxs("div",{style:{padding:12,background:"rgba(255,255,255,0.05)",borderRadius:8,textAlign:"center"},children:[o.jsx("strong",{children:F})," to move"]}),o.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(76,175,80,0.15) 0%, rgba(33,150,243,0.15) 100%)",borderRadius:12,padding:16,display:"flex",gap:12,alignItems:"flex-start"},children:[o.jsx("span",{style:{fontSize:28},children:""}),o.jsx("div",{style:{fontSize:14,lineHeight:1.6},children:p})]}),!y&&o.jsx("button",{onClick:X,style:{padding:"12px 20px",background:"rgba(255,255,255,0.1)",border:"none",borderRadius:8,color:"#fff",cursor:"pointer"},children:" Show Hint"}),o.jsxs("div",{style:{marginTop:"auto",padding:16,background:"rgba(0,0,0,0.2)",borderRadius:12,display:"flex",justifyContent:"space-around"},children:[o.jsxs("div",{style:{textAlign:"center"},children:[o.jsx("div",{style:{fontSize:24,fontWeight:700,color:"#4CAF50"},children:h.correct}),o.jsx("div",{style:{fontSize:12,opacity:.7},children:"Correct"})]}),o.jsxs("div",{style:{textAlign:"center"},children:[o.jsx("div",{style:{fontSize:24,fontWeight:700},children:h.total}),o.jsx("div",{style:{fontSize:12,opacity:.7},children:"Attempted"})]}),o.jsxs("div",{style:{textAlign:"center"},children:[o.jsxs("div",{style:{fontSize:24,fontWeight:700,color:"#FFC107"},children:[h.total>0?Math.round(h.correct/h.total*100):0,"%"]}),o.jsx("div",{style:{fontSize:12,opacity:.7},children:"Accuracy"})]})]})]})]})},V=()=>o.jsxs("div",{style:{textAlign:"center",padding:40},children:[o.jsx("div",{style:{fontSize:64,marginBottom:24},children:""}),o.jsx("h3",{children:"Practice Game"}),o.jsxs("p",{style:{opacity:.7,marginBottom:24},children:["Play a game against the ",t.opponent||"bot"," and we'll analyze it together."]}),o.jsx("p",{style:{fontSize:14,opacity:.6,marginBottom:32},children:"(Game integration coming soon - for now, mark as complete)"}),o.jsx("button",{onClick:()=>l("complete"),style:{padding:"14px 32px",background:"#4CAF50",color:"white",border:"none",borderRadius:8,fontSize:16,fontWeight:600,cursor:"pointer"},children:"Complete Session "})]}),ue=()=>{const F=h.total>0?Math.round(h.correct/h.total*100):100;return o.jsxs("div",{style:{textAlign:"center",padding:40},children:[o.jsx("div",{style:{fontSize:72,marginBottom:24},children:F>=80?"":F>=60?"":""}),o.jsx("h2",{style:{margin:"0 0 12px 0"},children:"Session Complete!"}),h.total>0&&o.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:32,marginBottom:32},children:[o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:36,fontWeight:700,color:"#4CAF50"},children:h.correct}),o.jsx("div",{style:{fontSize:14,opacity:.7},children:"Correct"})]}),o.jsxs("div",{children:[o.jsxs("div",{style:{fontSize:36,fontWeight:700},children:[F,"%"]}),o.jsx("div",{style:{fontSize:14,opacity:.7},children:"Accuracy"})]})]}),o.jsx("p",{style:{opacity:.8,marginBottom:32,maxWidth:400,margin:"0 auto 32px"},children:F>=80?"Excellent work! You're really getting the hang of this.":F>=60?"Good effort! Keep practicing and you'll master these patterns.":"Don't worry - these patterns take time. Review and try again!"}),o.jsx("button",{onClick:K,style:{padding:"16px 48px",background:"#4CAF50",color:"white",border:"none",borderRadius:12,fontSize:18,fontWeight:600,cursor:"pointer"},children:"Continue "})]})};return o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:24},children:[o.jsx("button",{onClick:s,style:{padding:"8px 16px",background:"rgba(255,255,255,0.1)",border:"none",borderRadius:8,color:"#fff",cursor:"pointer"},children:" Back"}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:12,opacity:.6},children:e==null?void 0:e.name}),o.jsx("div",{style:{fontWeight:600},children:t.name})]})]}),o.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:16,padding:24,minHeight:400},children:[a==="intro"&&$(),a==="content"&&q(),a==="puzzle"&&J(),a==="game"&&V(),a==="complete"&&ue()]})]})}const r0={good:-10,excellent:-50};function s0(t){const e={p:100,n:320,b:330,r:500,q:900,k:0};let n=0;const i=t.board();for(let r=0;r<8;r++)for(let s=0;s<8;s++){const a=i[r][s];if(a){const l=e[a.type];n+=a.color==="w"?l:-l}}return n}function G5(t,e,n){const i=n==="w"?e-t:t-e;return i<=-200?{type:"blunder",symbol:"??",color:"#f44336"}:i<=-100?{type:"mistake",symbol:"?",color:"#ff9800"}:i<=-50?{type:"inaccuracy",symbol:"?!",color:"#ffc107"}:i>=r0.excellent?{type:"excellent",symbol:"!!",color:"#4caf50"}:i>=r0.good?{type:"good",symbol:"!",color:"#8bc34a"}:{type:"normal",symbol:"",color:"#fff"}}function H5(t,e,n){return e.type==="blunder"?t.captured?"This capture lost significant material. Before capturing, always check if your piece will be safe.":"This was a serious mistake that significantly worsened your position. Take more time on critical moves.":e.type==="mistake"?"This move gave away some advantage. Try to think about your opponent's responses before committing.":e.type==="inaccuracy"?"A small slip here. The position is still playable, but there was a better option.":e.type==="excellent"?"Excellent move! You found the best continuation.":e.type==="good"?"Good move! This improves your position.":null}function V5({game:t,userSkills:e,voice:n,onBack:i,onSkillUpdate:r}){const[s,a]=N.useState((t==null?void 0:t.pgn)||""),[l,c]=N.useState(new Bt),[d,h]=N.useState([]),[f,p]=N.useState(-1),[m,y]=N.useState(null),[x,g]=N.useState(!1),[u,v]=N.useState(null),[b,w]=N.useState(!(t!=null&&t.pgn)),[R,C]=N.useState(null);N.useEffect(()=>{u&&(n!=null&&n.isEnabled)&&n.speak(u)},[u]),N.useRef(null);const A=N.useCallback(K=>{try{const $=new Bt;$.loadPgn(K);const q=$.history({verbose:!0});return $.reset(),c($),h(q),p(-1),a(K),w(!1),y(null),C(null),!0}catch($){return console.error("Invalid PGN:",$),!1}},[]),B=N.useCallback(async()=>{if(d.length===0)return;g(!0);const K=[],$=new Bt;for(let de=0;de<d.length;de++){const Te=d[de],xe=$.turn(),le=s0($);$.move(Te);const Re=s0($),Q=G5(le,Re,xe),ae=H5(Te,Q);K.push({move:Te,fen:$.fen(),evalBefore:le,evalAfter:Re,classification:Q,feedback:ae,turn:xe})}y(K);const q=K.filter(de=>de.classification.type==="blunder"),J=K.filter(de=>de.classification.type==="mistake"),V=K.filter(de=>de.classification.type==="inaccuracy"),ue=K.filter(de=>de.classification.type==="excellent"),F=Math.round((K.length-q.length*3-J.length*2-V.length)/K.length*100);C({totalMoves:d.length,blunders:q.length,mistakes:J.length,inaccuracies:V.length,excellent:ue.length,accuracy:Math.max(0,Math.min(100,F)),keyMoments:[...q.slice(0,3),...J.slice(0,2)]}),g(!1)},[d]),S=N.useCallback(K=>{const $=new Bt;for(let q=0;q<=K;q++)q<d.length&&$.move(d[q]);c($),p(K),m&&K>=0&&m[K]?v(m[K]):v(null)},[d,m]),k=()=>S(-1),U=()=>S(Math.max(-1,f-1)),O=()=>S(Math.min(d.length-1,f+1)),X=()=>S(d.length-1);return N.useEffect(()=>{const K=$=>{$.key==="ArrowLeft"&&U(),$.key==="ArrowRight"&&O(),$.key==="Home"&&k(),$.key==="End"&&X()};return window.addEventListener("keydown",K),()=>window.removeEventListener("keydown",K)},[f,d.length]),b?o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:24},children:[o.jsx("button",{onClick:i,style:{padding:"8px 16px",background:"rgba(255,255,255,0.1)",border:"none",borderRadius:8,color:"#fff",cursor:"pointer"},children:" Back"}),o.jsx("h2",{style:{margin:0},children:" Game Analysis"})]}),o.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:16,padding:24},children:[o.jsx("h3",{style:{marginTop:0},children:"Paste Your Game (PGN)"}),o.jsx("p",{style:{opacity:.7,marginBottom:16},children:"Copy a game from Chess.com, Lichess, or any chess app and paste it below."}),o.jsx("textarea",{value:s,onChange:K=>a(K.target.value),placeholder:`[Event "My Game"]
[Date "2024.01.18"]
[White "Me"]
[Black "Opponent"]
[Result "*"]

1. e4 e5 2. Nf3 Nc6 3. Bb5 ...`,style:{width:"100%",height:200,padding:16,background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:8,color:"#fff",fontFamily:"monospace",fontSize:14,resize:"vertical"}}),o.jsx("button",{onClick:()=>A(s),disabled:!s.trim(),style:{marginTop:16,padding:"14px 32px",background:s.trim()?"#4CAF50":"#555",color:"white",border:"none",borderRadius:8,fontSize:16,fontWeight:600,cursor:s.trim()?"pointer":"not-allowed"},children:"Load Game "}),o.jsx("button",{onClick:()=>{a(`[Event "Casual Game"]
[Site "Chess.com"]
[Date "2024.01.18"]
[White "Player1"]
[Black "Player2"]
[Result "1-0"]

1. e4 e5 2. Nf3 Nc6 3. Bb5 a6 4. Ba4 Nf6 5. O-O Be7 6. Re1 b5 7. Bb3 d6 8. c3 O-O 9. h3 Na5 10. Bc2 c5 11. d4 Qc7 12. Nbd2 cxd4 13. cxd4 Nc6 14. Nb3 a5 15. Be3 a4 16. Nbd2 Bd7 17. Rc1 Qb8 18. Nf1 exd4 19. Bxd4 Nxd4 20. Qxd4 Bc6 21. Ng3 Rd8 22. Bb1 d5 23. exd5 Nxd5 24. Qd3 g6 25. Rcd1 Bf6 26. Qe4 Qb6 27. Nh5 Bg7 28. Qg4 Nf6 29. Nxg7 Nxg4 30. Nh5 Rxd1 31. Rxd1 Nxf2 32. Kxf2 gxh5 33. Rd6 Qc5+ 34. Kf1 Re8 35. Rxc6 Qf5 36. Rc7 Re1+ 37. Kxe1 Qxb1+ 38. Nd2 1-0`)},style:{marginTop:16,marginLeft:12,padding:"14px 24px",background:"rgba(255,255,255,0.1)",color:"white",border:"none",borderRadius:8,fontSize:14,cursor:"pointer"},children:"Load Sample Game"})]})]}):o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:24},children:[o.jsx("button",{onClick:()=>w(!0),style:{padding:"8px 16px",background:"rgba(255,255,255,0.1)",border:"none",borderRadius:8,color:"#fff",cursor:"pointer"},children:" New Game"}),o.jsx("h2",{style:{margin:0},children:" Game Analysis"}),!m&&o.jsx("button",{onClick:B,disabled:x,style:{marginLeft:"auto",padding:"10px 20px",background:"#4CAF50",color:"white",border:"none",borderRadius:8,fontWeight:600,cursor:x?"not-allowed":"pointer"},children:x?"Analyzing...":" Analyze Game"})]}),o.jsxs("div",{style:{display:"flex",gap:24},children:[o.jsxs("div",{style:{flex:"0 0 auto"},children:[o.jsx(Gr,{chess:l,fen:l.fen(),orientation:"w",interactive:!1,size:420}),o.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:8,marginTop:16},children:[o.jsx(Dl,{onClick:k,disabled:f<0,children:""}),o.jsx(Dl,{onClick:U,disabled:f<0,children:""}),o.jsx(Dl,{onClick:O,disabled:f>=d.length-1,children:""}),o.jsx(Dl,{onClick:X,disabled:f>=d.length-1,children:""})]})]}),o.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:16},children:[R&&o.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:12,padding:16},children:[o.jsx("div",{style:{fontWeight:600,marginBottom:12},children:"Game Summary"}),o.jsxs("div",{style:{display:"flex",gap:16,marginBottom:12},children:[o.jsx(Ll,{label:"Accuracy",value:`${R.accuracy}%`,color:"#4CAF50"}),o.jsx(Ll,{label:"Blunders",value:R.blunders,color:"#f44336"}),o.jsx(Ll,{label:"Mistakes",value:R.mistakes,color:"#ff9800"}),o.jsx(Ll,{label:"Inaccuracies",value:R.inaccuracies,color:"#ffc107"})]})]}),u&&o.jsxs("div",{style:{background:`${u.classification.color}15`,borderRadius:12,padding:16,border:`1px solid ${u.classification.color}40`},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:8},children:[o.jsxs("span",{style:{fontSize:24,fontWeight:700,color:u.classification.color},children:[u.move.san,u.classification.symbol]}),o.jsx("span",{style:{padding:"4px 12px",background:u.classification.color,borderRadius:12,fontSize:12,fontWeight:600,textTransform:"uppercase"},children:u.classification.type})]}),u.feedback&&o.jsxs("div",{style:{display:"flex",gap:12,alignItems:"flex-start"},children:[o.jsx("span",{style:{fontSize:24},children:""}),o.jsx("p",{style:{margin:0,fontSize:14,lineHeight:1.6,opacity:.9},children:u.feedback})]})]}),o.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:12,padding:16,flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},children:[o.jsx("div",{style:{fontWeight:600,marginBottom:12},children:"Moves"}),o.jsx("div",{style:{flex:1,overflowY:"auto",display:"flex",flexWrap:"wrap",gap:4,alignContent:"flex-start"},children:d.map((K,$)=>{const q=m==null?void 0:m[$],J=$===f;return o.jsxs("span",{children:[$%2===0&&o.jsxs("span",{style:{opacity:.5,marginRight:4},children:[Math.floor($/2)+1,"."]}),o.jsxs("span",{onClick:()=>S($),style:{padding:"2px 6px",borderRadius:4,cursor:"pointer",background:J?"rgba(76,175,80,0.3)":"transparent",color:(q==null?void 0:q.classification.color)||"#fff",fontWeight:(q==null?void 0:q.classification.type)==="blunder"?700:400},children:[K.san,q==null?void 0:q.classification.symbol]})]},$)})})]}),R&&R.keyMoments.length>0&&o.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:12,padding:16},children:[o.jsx("div",{style:{fontWeight:600,marginBottom:12},children:"Key Moments"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:R.keyMoments.map((K,$)=>o.jsxs("div",{onClick:()=>S(d.indexOf(K.move)),style:{padding:"8px 12px",background:`${K.classification.color}15`,borderRadius:8,cursor:"pointer",display:"flex",alignItems:"center",gap:12},children:[o.jsxs("span",{style:{fontWeight:700,color:K.classification.color},children:[K.move.san,K.classification.symbol]}),o.jsxs("span",{style:{fontSize:13,opacity:.7},children:["Move ",d.indexOf(K.move)+1]})]},$))})]})]})]})]})}function Dl({onClick:t,disabled:e,children:n}){return o.jsx("button",{onClick:t,disabled:e,style:{width:48,height:40,background:e?"rgba(255,255,255,0.05)":"rgba(255,255,255,0.1)",border:"none",borderRadius:8,color:e?"rgba(255,255,255,0.3)":"#fff",fontSize:18,cursor:e?"not-allowed":"pointer"},children:n})}function Ll({label:t,value:e,color:n}){return o.jsxs("div",{style:{textAlign:"center"},children:[o.jsx("div",{style:{fontSize:20,fontWeight:700,color:n},children:e}),o.jsx("div",{style:{fontSize:11,opacity:.7},children:t})]})}function K5({skills:t,completedSessions:e,estimatedRating:n,onBack:i}){const[r,s]=N.useState(null),a=Object.values(id),c=Object.values(Ko).reduce((g,u)=>g+u.sessions.length,0),d=(e==null?void 0:e.length)||0,h=Math.round(d/c*100),f=g=>{const v=Object.keys(g.skills).map(b=>{var w;return((w=t[b])==null?void 0:w.level)||1});return v.reduce((b,w)=>b+w,0)/v.length},p=()=>oc().map(u=>{var v;return{...u,level:((v=t[u.id])==null?void 0:v.level)||1}}).sort((u,v)=>u.level-v.level).slice(0,5),m=()=>oc().map(u=>{var v;return{...u,level:((v=t[u.id])==null?void 0:v.level)||1}}).sort((u,v)=>v.level-u.level).slice(0,5),y=p(),x=m();return o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:24},children:[o.jsx("button",{onClick:i,style:{padding:"8px 16px",background:"rgba(255,255,255,0.1)",border:"none",borderRadius:8,color:"#fff",cursor:"pointer"},children:" Back"}),o.jsx("h2",{style:{margin:0},children:" Progress Dashboard"})]}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:16,marginBottom:24},children:[o.jsx(Fl,{title:"Estimated Rating",value:n||"?",subtitle:"Based on assessment",icon:"",color:"#4CAF50"}),o.jsx(Fl,{title:"Sessions Completed",value:d,subtitle:`of ${c} total`,icon:"",color:"#2196F3"}),o.jsx(Fl,{title:"Overall Progress",value:`${h}%`,subtitle:"Curriculum completion",icon:"",color:"#FF9800"}),o.jsx(Fl,{title:"Skills Leveled",value:Object.keys(t).length,subtitle:`of ${oc().length} total`,icon:"",color:"#9C27B0"})]}),o.jsxs("div",{style:{display:"flex",gap:24},children:[o.jsx("div",{style:{flex:1},children:o.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:16,padding:20},children:[o.jsx("h3",{style:{marginTop:0,marginBottom:16},children:"Skill Categories"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:a.map(g=>{const u=f(g),v=(r==null?void 0:r.id)===g.id;return o.jsxs("div",{onClick:()=>s(v?null:g),style:{padding:16,background:v?`${g.color}20`:"rgba(255,255,255,0.03)",borderRadius:12,cursor:"pointer",border:v?`1px solid ${g.color}`:"1px solid transparent",transition:"all 0.15s"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[o.jsx("span",{style:{fontSize:24},children:g.icon}),o.jsxs("div",{children:[o.jsx("div",{style:{fontWeight:600},children:g.name}),o.jsxs("div",{style:{fontSize:12,opacity:.6},children:[Object.keys(g.skills).length," skills"]})]})]}),o.jsx("div",{style:{fontSize:24,fontWeight:700,color:g.color},children:u.toFixed(1)})]}),o.jsx("div",{style:{height:8,background:"rgba(255,255,255,0.1)",borderRadius:4,overflow:"hidden"},children:o.jsx("div",{style:{height:"100%",width:`${u/5*100}%`,background:g.color,borderRadius:4,transition:"width 0.3s"}})})]},g.id)})})]})}),o.jsx("div",{style:{flex:1},children:r?o.jsx(Q5,{category:r,skills:t}):o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[o.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:16,padding:20},children:[o.jsxs("h3",{style:{marginTop:0,marginBottom:16,display:"flex",alignItems:"center",gap:8},children:[o.jsx("span",{children:""}),o.jsx("span",{children:"Focus Areas"})]}),o.jsx("p",{style:{fontSize:13,opacity:.7,marginBottom:16},children:"These skills need the most work. Focus your training here!"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:y.map(g=>o.jsx(a0,{skill:g,color:g.categoryColor},g.id))})]}),o.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:16,padding:20},children:[o.jsxs("h3",{style:{marginTop:0,marginBottom:16,display:"flex",alignItems:"center",gap:8},children:[o.jsx("span",{children:""}),o.jsx("span",{children:"Strengths"})]}),o.jsx("p",{style:{fontSize:13,opacity:.7,marginBottom:16},children:"Your best-developed skills. Keep building on these!"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:x.map(g=>o.jsx(a0,{skill:g,color:g.categoryColor},g.id))})]})]})})]}),o.jsxs("div",{style:{marginTop:24,background:"linear-gradient(135deg, rgba(76,175,80,0.1) 0%, rgba(33,150,243,0.1) 100%)",borderRadius:16,padding:24},children:[o.jsx("h3",{style:{marginTop:0},children:"Rating Projection"}),o.jsx("p",{style:{opacity:.8,marginBottom:20},children:"Based on your skill levels, here's how you compare to typical players:"}),o.jsx(q5,{skills:t,estimatedRating:n})]})]})}function Fl({title:t,value:e,subtitle:n,icon:i,color:r}){return o.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:12,padding:20,textAlign:"center"},children:[o.jsx("div",{style:{fontSize:28,marginBottom:8},children:i}),o.jsx("div",{style:{fontSize:28,fontWeight:700,color:r,marginBottom:4},children:e}),o.jsx("div",{style:{fontSize:12,opacity:.6},children:t}),o.jsx("div",{style:{fontSize:11,opacity:.5,marginTop:4},children:n})]})}function Q5({category:t,skills:e}){const n=Object.values(t.skills);return o.jsxs("div",{style:{background:`${t.color}10`,borderRadius:16,padding:20,border:`1px solid ${t.color}30`},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:16},children:[o.jsx("span",{style:{fontSize:32},children:t.icon}),o.jsxs("div",{children:[o.jsx("h3",{style:{margin:0},children:t.name}),o.jsx("p",{style:{margin:"4px 0 0",fontSize:13,opacity:.7},children:t.description})]})]}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:n.map(i=>{var l,c,d;const r=((l=e[i.id])==null?void 0:l.level)||1,s=((c=e[i.id])==null?void 0:c.xp)||0,a=i.levels[r-1];return o.jsxs("div",{style:{padding:16,background:"rgba(0,0,0,0.2)",borderRadius:12},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[o.jsx("div",{style:{fontWeight:600},children:i.name}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("span",{style:{fontSize:12,opacity:.6},children:"Level"}),o.jsx("span",{style:{fontWeight:700,fontSize:18,color:t.color},children:r})]})]}),o.jsxs("div",{style:{fontSize:12,opacity:.7,marginBottom:8},children:[a==null?void 0:a.name,": ",a==null?void 0:a.description]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("div",{style:{flex:1,height:6,background:"rgba(255,255,255,0.1)",borderRadius:3,overflow:"hidden"},children:o.jsx("div",{style:{height:"100%",width:`${s}%`,background:t.color,borderRadius:3}})}),o.jsxs("span",{style:{fontSize:11,opacity:.5},children:[s,"/100 XP"]})]}),r<5&&o.jsxs("div",{style:{fontSize:11,opacity:.5,marginTop:8},children:["Next: ",(d=i.levels[r])==null?void 0:d.name]})]},i.id)})})]})}function a0({skill:t,color:e}){return o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"8px 12px",background:"rgba(255,255,255,0.03)",borderRadius:8},children:[o.jsxs("div",{style:{flex:1},children:[o.jsx("div",{style:{fontSize:13,marginBottom:4},children:t.name}),o.jsx("div",{style:{height:6,background:"rgba(255,255,255,0.1)",borderRadius:3,overflow:"hidden"},children:o.jsx("div",{style:{height:"100%",width:`${t.level/5*100}%`,background:e,borderRadius:3}})})]}),o.jsx("div",{style:{fontSize:16,fontWeight:700,color:e,minWidth:24,textAlign:"right"},children:t.level})]})}function q5({skills:t,estimatedRating:e}){const i=oc().map(d=>{var h;return((h=t[d.id])==null?void 0:h.level)||1}),r=i.reduce((d,h)=>d+h,0)/i.length,s=L5(Math.round(r)),a=[{label:"Beginner",min:0,max:800,color:"#4CAF50"},{label:"Casual",min:800,max:1200,color:"#8BC34A"},{label:"Club Player",min:1200,max:1600,color:"#FFC107"},{label:"Advanced",min:1600,max:2e3,color:"#FF9800"},{label:"Expert",min:2e3,max:2400,color:"#f44336"}],l=e||s,c=Math.min(100,l/2400*100);return o.jsxs("div",{children:[o.jsx("div",{style:{display:"flex",height:40,borderRadius:8,overflow:"hidden",marginBottom:8},children:a.map(d=>o.jsx("div",{style:{flex:d.max-d.min,background:d.color,display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,fontWeight:600,color:d.color==="#FFC107"?"#000":"#fff"},children:d.label},d.label))}),o.jsx("div",{style:{position:"relative",height:24},children:o.jsxs("div",{style:{position:"absolute",left:`${c}%`,transform:"translateX(-50%)",textAlign:"center"},children:[o.jsx("div",{style:{fontSize:16},children:""}),o.jsxs("div",{style:{fontSize:14,fontWeight:700,background:"rgba(0,0,0,0.3)",padding:"4px 12px",borderRadius:12},children:["~",l]})]})}),o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:8,fontSize:11,opacity:.5},children:[o.jsx("span",{children:"0"}),o.jsx("span",{children:"800"}),o.jsx("span",{children:"1200"}),o.jsx("span",{children:"1600"}),o.jsx("span",{children:"2000"}),o.jsx("span",{children:"2400"})]})]})}const _r={mobile:768,tablet:1024};function rd(){const[t,e]=N.useState(()=>{const n=typeof window<"u"?window.innerWidth:1200,i=typeof window<"u"?window.innerHeight:800;return{width:n,height:i,isMobile:n<_r.mobile,isTablet:n>=_r.mobile&&n<_r.tablet,isDesktop:n>=_r.tablet,isLandscape:n>i}});return N.useEffect(()=>{let n;const i=()=>{clearTimeout(n),n=setTimeout(()=>{const r=window.innerWidth,s=window.innerHeight;e({width:r,height:s,isMobile:r<_r.mobile,isTablet:r>=_r.mobile&&r<_r.tablet,isDesktop:r>=_r.tablet,isLandscape:r>s})},100)};return window.addEventListener("resize",i),()=>{clearTimeout(n),window.removeEventListener("resize",i)}},[]),t}function $5(t){return t.isMobile?{xs:4,sm:8,md:12,lg:16,xl:24}:t.isTablet?{xs:6,sm:10,md:16,lg:20,xl:32}:{xs:8,sm:12,md:20,lg:28,xl:40}}const X5=[{id:"m1_001",fen:"r1bqkb1r/pppp1ppp/2n2n2/4p2Q/2B1P3/8/PPPP1PPP/RNB1K1NR w KQkq - 4 4",solution:["Qxf7#"],playerToMove:"white",theme:"mate-in-1",difficulty:1,title:"Scholar's Mate",hint:"The f7 square is only defended by the king...",explanation:"This is the famous Scholar's Mate pattern. The f7 pawn (f2 for White) is only defended by the king at the start of the game, making it a natural target. When the queen captures on f7, the king cannot escape because it's blocked by its own pieces. Always watch for attacks on f7/f2 in the opening!",keyIdea:"Target f7 - the weakest square in Black's position"},{id:"m1_002",fen:"rnb1kbnr/pppp1ppp/8/4p3/6Pq/5P2/PPPPP2P/RNBQKBNR b KQkq - 0 3",solution:["Qxh2#"],playerToMove:"black",theme:"mate-in-1",difficulty:1,title:"Fool's Mate Pattern",hint:"The king has no escape squares...",explanation:"This is related to the Fool's Mate, the fastest possible checkmate. White's pawn moves (f3 and g4) have fatally weakened the king's diagonal. The queen delivers checkmate on h2 because the king has no escape squares - blocked by its own pawns. Lesson: Don't move pawns in front of your castled king without good reason!",keyIdea:"Weakened king diagonal leads to disaster"},{id:"m1_003",fen:"6k1/5ppp/8/8/8/8/8/3R2K1 w - - 0 1",solution:["Rd8#"],playerToMove:"white",theme:"mate-in-1",difficulty:1,title:"Rook Delivers",hint:"The king can't escape the back rank!",explanation:"Rd8 is checkmate! The Black king is trapped on g8 with no escape - f8, g7, h8 are all blocked or controlled. This is another classic back rank mate. The lesson: never leave your back rank undefended!",keyIdea:"Back rank mates are the most common pattern"},{id:"m1_004",fen:"6k1/5ppp/8/8/8/8/5PPP/4R1K1 w - - 0 1",solution:["Re8#"],playerToMove:"white",theme:"mate-in-1",difficulty:1,title:"Back Rank Mate",hint:"The king is trapped on the back rank!",explanation:"The back rank mate is one of the most common tactical patterns. Black's king is trapped behind its own pawns with no escape squares. The rook simply slides to e8, delivering checkmate. To prevent this, always give your king 'luft' (breathing room) with h6/h3 or similar pawn moves.",keyIdea:"Trapped king + open file = back rank mate"},{id:"m1_005",fen:"6k1/5ppp/8/8/8/8/5PPP/R3R1K1 w - - 0 1",solution:["Re8#","Rae8#"],playerToMove:"white",theme:"mate-in-1",difficulty:1,title:"Doubled Rooks",hint:"Either rook can deliver the blow!",explanation:"With two rooks aimed at the back rank, Black is helpless. Either Re8# or Rae8# is checkmate - the king is trapped by its own pawns on f7, g7, h7 and the rook controls the entire 8th rank. Doubled rooks on an open file are incredibly powerful!",keyIdea:"Doubled rooks dominate open files"},{id:"m1_006",fen:"8/8/8/8/4r3/8/5PPP/6K1 b - - 0 1",solution:["Re1#"],playerToMove:"black",theme:"mate-in-1",difficulty:1,title:"Black's Back Rank Mate",hint:"White's king is trapped by its own pawns!",explanation:"Re1# is checkmate! White's king is trapped behind its own pawns on f2, g2, h2. The rook controls the entire first rank, leaving no escape. Back rank mates work for both sides - always check if your opponent's back rank is weak!",keyIdea:"Back rank threats work both ways"},{id:"tac_001",fen:"r1bqkbnr/pppp1ppp/2n5/4p3/3PP3/5N2/PPP2PPP/RNBQKB1R b KQkq - 0 3",solution:["exd4"],playerToMove:"black",theme:"capture",difficulty:1,title:"Capture the Pawn",hint:"Free pawn!",explanation:"Material advantage wins games! The d4 pawn is undefended, so Black simply captures it. Always scan the board for undefended pieces (called 'hanging' pieces). Even a single pawn advantage can be decisive in the endgame.",keyIdea:"Capture undefended pieces"},{id:"tac_002",fen:"r1bqkb1r/ppppnppp/5n2/4p2Q/2B1P3/8/PPPP1PPP/RNB1K1NR w KQkq - 4 4",solution:["Qxe5+"],playerToMove:"white",theme:"capture",difficulty:1,title:"Win the Pawn with Check",hint:"Take and give check at the same time!",explanation:"When you can capture material AND give check, it's usually correct! Here Qxe5+ wins the pawn for free because Black must deal with the check first. The check acts like a 'free move' because your opponent can't ignore it. Always look for captures with check!",keyIdea:"Captures with check are often free"},{id:"fork_001",fen:"r1bqkb1r/pppp1ppp/2n5/4p3/2B1n3/5N2/PPPP1PPP/RNBQK2R w KQkq - 0 4",solution:["Bxf7+"],playerToMove:"white",theme:"fork",difficulty:1,title:"Bishop Fork",hint:"Attack the king and win the knight!",explanation:"This is a classic bishop sacrifice on f7. After Bxf7+ Kxf7, Black has won a bishop but exposed the king. In this position, the knight on e4 becomes vulnerable. The key insight: sometimes sacrificing material to expose the enemy king leads to greater gains.",keyIdea:"Expose the king to win material back"},{id:"fork_002",fen:"r1bqkbnr/pppp1ppp/2n5/4p3/4P3/5N2/PPPP1PPP/RNBQKB1R w KQkq - 2 3",solution:["Nxe5"],playerToMove:"white",theme:"capture",difficulty:1,title:"Knight Takes",hint:"The pawn is free!",explanation:"The e5 pawn is defended only by the knight on c6. After Nxe5, if Black recaptures with Nxe5, White has d4 forking the knight. So White wins a pawn safely. Always calculate one move deeper - 'if they take, then what?'",keyIdea:"Calculate consequences of captures"},{id:"nf_001",fen:"r1bqk2r/pppp1ppp/2n2n2/2b1p3/2B1P3/3P1N2/PPP2PPP/RNBQK2R w KQkq - 0 5",solution:["Bxf7+","Kxf7","Ng5+"],playerToMove:"white",theme:"knight-fork",difficulty:2,title:"Classic Knight Fork Setup",hint:"Sacrifice the bishop to set up the fork!",explanation:"This is the famous 'Fried Liver' pattern! First Bxf7+ forces Kxf7. Then Ng5+ forks the king and queen! The bishop sacrifice is temporary - you get it back plus more. Look for ways to use piece sacrifices to set up knight forks, especially when the enemy king is exposed.",keyIdea:"Sacrifice to create a fork"},{id:"nf_002",fen:"r2qk2r/ppp2ppp/2n1bn2/3pp3/4P3/2N2N2/PPPP1PPP/R1BQKB1R w KQkq - 0 6",solution:["Nxd5"],playerToMove:"white",theme:"knight-fork",difficulty:2,title:"Knight Fork Coming",hint:"Take the pawn, attack two pieces!",explanation:"After Nxd5, the knight attacks both the queen on d8 and the bishop on e6 (and threatens Nxf6+). Black cannot save both pieces. Knights are excellent at creating forks because of their unique jumping ability. Centralized knights are especially dangerous!",keyIdea:"Centralized knights create fork threats"},{id:"nf_003",fen:"r1bqkb1r/pppp1ppp/2n5/4p3/2B1n3/5N2/PPPP1PPP/RNBQK2R w KQkq - 0 4",solution:["Bxf7+"],playerToMove:"white",theme:"knight-fork",difficulty:2,title:"Win the Knight",hint:"Check the king and pick up the piece!",explanation:"Bxf7+ is a forcing move - the king must respond to check. After Kxf7 or Ke7, the knight on e4 is left undefended and White wins material. When you have a chance to give check while attacking another piece, take it! The check forces your opponent's hand.",keyIdea:"Check + attack = free material"},{id:"pin_001",fen:"r1bqkb1r/pppp1ppp/2n2n2/4p3/2B1P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 4 4",solution:["Ng5"],playerToMove:"white",theme:"attack",difficulty:2,title:"Attack f7",hint:"Target the weak f7 pawn!",explanation:"Ng5 creates a double attack on f7 - both the knight and bishop target this weak square. Black must be very careful; if f7 falls, the king's position collapses. This is the starting position for the Fried Liver Attack. Two pieces attacking one point often wins!",keyIdea:"Concentrate force on weaknesses"},{id:"pin_002",fen:"r1bqkbnr/ppp2ppp/2np4/4p3/2B1P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 0 4",solution:["Ng5"],playerToMove:"white",theme:"attack",difficulty:2,title:"Double Attack on f7",hint:"Knight and bishop both target f7!",explanation:"Again Ng5 creates tremendous pressure on f7. The knight cannot be taken (bishop recaptures with devastating effect), and f7 is under assault. Black's d6 pawn blocks the bishop's defense. This shows how piece coordination creates overwhelming threats.",keyIdea:"Piece coordination creates threats"},{id:"pin_003",fen:"rnbqk2r/pppp1ppp/4pn2/8/1bPP4/2N5/PP2PPPP/R1BQKBNR w KQkq - 2 4",solution:["Qa4+"],playerToMove:"white",theme:"pin",difficulty:2,title:"Counter the Pin",hint:"Don't just defend - counter-attack!",explanation:"The bishop pins the knight to the queen, but Qa4+ is a powerful counter-attack! Black must deal with the check, and the bishop on b4 is now attacked. After Black blocks or moves the king, White can take the bishop or continue the initiative. When pinned, look for counter-threats instead of passive defense!",keyIdea:"Counter-attack beats passive defense"},{id:"skw_001",fen:"6k1/5p1p/6p1/8/8/8/1r3PPP/R5K1 b - - 0 1",solution:["Rb1+"],playerToMove:"black",theme:"skewer",difficulty:2,title:"Rook Skewer",hint:"Check the king, win the rook!",explanation:"A skewer is like a reverse pin - the more valuable piece is in front! After Rb1+, the White king must move (only legal moves), and then Black captures the rook on a1 with Rxb1. Skewers are most effective when you can attack the king first, forcing it to move and expose the piece behind it.",keyIdea:"Skewer: attack valuable piece, win the one behind"},{id:"skw_002",fen:"8/8/8/3k4/8/8/3K4/R7 w - - 0 1",solution:["Ra5+"],playerToMove:"white",theme:"skewer",difficulty:2,title:"Skewer the King",hint:"Line up the rook with both kings!",explanation:"Ra5+ creates a skewer along the 5th rank. After the Black king moves, the rook can give check again (if needed) or control key squares. In rook endgames, using the rook actively to check and cut off the enemy king is essential technique.",keyIdea:"Active rooks dominate endgames"},{id:"disc_001",fen:"r1bqkb1r/pppp1ppp/2n2n2/4p1B1/2B1P3/5N2/PPPP1PPP/RN1QK2R b KQkq - 5 4",solution:["h6"],playerToMove:"black",theme:"attack-bishop",difficulty:2,title:"Chase the Bishop",hint:"Kick the annoying bishop!",explanation:"The bishop on g5 is annoying, pinning the knight to the queen. Simply h6 forces it to decide: retreat, take the knight (and double Black's pawns), or go to h4 where it can be chased again with g5. Pawn moves that gain time by attacking pieces are valuable!",keyIdea:"Gain time by attacking pieces"},{id:"disc_002",fen:"rn1qkbnr/ppp2ppp/4p3/3pPb2/3P4/5N2/PPP2PPP/RNBQKB1R w KQkq - 0 5",solution:["Nh4"],playerToMove:"white",theme:"discovered-attack",difficulty:2,title:"Discover Attack on Bishop",hint:"Move the knight, reveal the attack!",explanation:"Nh4 attacks the bishop while simultaneously revealing an attack from White's queen on d1 (or preparing to). The knight threatens to trap the bishop with g4. Discovered attacks let you make two threats with one move - the moving piece attacks, and the revealed piece attacks something else!",keyIdea:"Discovered attacks create double threats"},{id:"m2_001",fen:"r1b1k2r/ppppqppp/2n2n2/2b1p3/2B1P3/3P1N2/PPP2PPP/RNBQK2R w KQkq - 4 5",solution:["Bxf7+","Qxf7","Ng5+"],playerToMove:"white",theme:"mate-in-2",difficulty:3,title:"Fried Liver Setup",hint:"Sacrifice to expose the king!",explanation:"The Fried Liver Attack in action! Bxf7+ forces Qxf7 (Kxf7 Ng5+ wins the queen), then Ng5 attacks the queen and threatens devastating discovered checks. Black's position collapses. This pattern has won countless games - memorize it!",keyIdea:"Classic sacrifice pattern against f7"},{id:"m2_002",fen:"6k1/5ppp/8/8/8/5Q2/5PPP/6K1 w - - 0 1",solution:["Qf6","Qg7#"],playerToMove:"white",theme:"mate-in-2",difficulty:3,title:"Queen Infiltration",hint:"Threaten mate, then deliver!",explanation:"Qf6 threatens Qg7# immediately. Black's only defense is to move a pawn (g6 or h6), but then Qxg7# or Qf8# follows. The queen is incredibly powerful in the endgame because it can control so many squares. Centralized queens near the enemy king are deadly.",keyIdea:"Queen near king = mating threats"},{id:"m2_003",fen:"r1bqk2r/pppp1ppp/2n2n2/2b1p2Q/2B1P3/8/PPPP1PPP/RNB1K1NR w KQkq - 6 5",solution:["Qxf7+","Kd8","Qxf8#"],playerToMove:"white",theme:"mate-in-2",difficulty:3,title:"Queen Rampage",hint:"Take with check, keep checking!",explanation:"Qxf7+ forces Kd8 (Ke7 allows Qxe5+ and more damage). Then Qxf8# is checkmate! The king is trapped by its own pieces on d8. This shows the power of continuous checks - the opponent never gets a chance to defend when you keep checking.",keyIdea:"Continuous checks prevent defense"},{id:"sac_001",fen:"r1bqk2r/pppp1ppp/2n2n2/2b1p3/2B1P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 4 4",solution:["Bxf7+"],playerToMove:"white",theme:"sacrifice",difficulty:3,title:"Greek Gift Prep",hint:"This sacrifice leads to a strong attack!",explanation:"Bxf7+ is a classic sacrifice that exposes Black's king. After Kxf7, White continues with Ng5+ and the attack writes itself. The 'Greek Gift' name comes from the Trojan Horse - the bishop looks like a gift but brings destruction. When the enemy king hasn't castled, look for f7 sacrifices!",keyIdea:"Sacrifice to expose the uncastled king"},{id:"sac_002",fen:"r1b1kb1r/ppppqppp/5n2/4n3/3PP3/5N2/PPP2PPP/RNBQKB1R w KQkq - 0 6",solution:["d5"],playerToMove:"white",theme:"pawn-push",difficulty:3,title:"Central Breakthrough",hint:"Push forward, gain space!",explanation:"d5! is a powerful pawn break that gains space and kicks the knight. If the knight retreats, White has a strong pawn center. Central pawn pushes often come with tempo (attacking pieces) and open lines for your pieces. Control the center, control the game!",keyIdea:"Central pawn pushes gain space and tempo"},{id:"cmb_001",fen:"r2qr1k1/ppp2ppp/2n5/3p4/3Pn1b1/2NBPN2/PPP2PPP/R2QK2R b KQ - 0 10",solution:["Nxd4"],playerToMove:"black",theme:"combination",difficulty:3,title:"Tactical Shot",hint:"The knight takes!",explanation:"Nxd4! wins material because of the pin on the e-file and the attack on the queen. If Nxd4 exd4, Black wins a pawn. If Qxd4, then Bxf3 wins a piece. Combinations work by creating multiple threats that can't all be met. Look for forcing moves!",keyIdea:"Multiple threats create winning combinations"},{id:"cmb_002",fen:"r1bq1rk1/ppp2ppp/2n2n2/3p4/1b1P4/2N1PN2/PP3PPP/R1BQKB1R w KQ - 0 7",solution:["e4"],playerToMove:"white",theme:"center-control",difficulty:3,title:"Seize the Center",hint:"Push e4 to challenge!",explanation:"e4! challenges Black's center and opens lines for White's pieces. After dxe4 Nxe4, White has active piece play. Sometimes the best tactic is strategic - improving your position with natural moves. Central pawn tension should usually be resolved in your favor.",keyIdea:"Challenge the center to activate pieces"},{id:"end_001",fen:"8/8/8/4k3/8/8/8/4K2R w - - 0 1",solution:["Rh5+"],playerToMove:"white",theme:"endgame",difficulty:2,title:"Cut Off the King",hint:"Use the rook to restrict the king!",explanation:"Rh5+! cuts off the Black king from the h-file and pushes it toward the edge. In rook endgames, cutting off the enemy king is the first step to delivering mate. The rook is most effective when it controls entire ranks or files, restricting the enemy king's movement.",keyIdea:"Cut off the king, then push it to the edge"},{id:"end_002",fen:"8/8/8/3k4/8/8/4K3/7R w - - 0 1",solution:["Rd1+"],playerToMove:"white",theme:"endgame",difficulty:2,title:"Push Back the King",hint:"Check forces the king back!",explanation:"Rd1+! forces the Black king to move toward the edge of the board. This is the technique of 'boxing in' the enemy king with your rook while your own king advances to help deliver mate. Patience and technique win endgames!",keyIdea:"Use checks to drive the king to the edge"},{id:"end_003",fen:"k7/8/1K6/8/8/8/8/7R w - - 0 1",solution:["Ra1#"],playerToMove:"white",theme:"endgame",difficulty:1,title:"Deliver the Mate",hint:"The king is trapped in the corner!",explanation:"Ra1# is checkmate! The Black king is trapped in the corner by the White king on b6, and the rook delivers the final blow. This is the basic king and rook checkmate pattern - the king helps trap the enemy king, and the rook delivers mate on the back rank.",keyIdea:"King and rook together deliver mate"},{id:"end_004",fen:"8/8/8/8/8/1k6/8/1K1R4 w - - 0 1",solution:["Rd3+"],playerToMove:"white",theme:"endgame",difficulty:2,title:"Opposition and Check",hint:"Check to gain the opposition!",explanation:"Rd3+! forces the Black king to move, and White can then take the opposition (kings facing each other with one square between). In king and pawn endgames, the opposition often decides the game. The rook helps by checking and controlling key squares.",keyIdea:"Use checks to gain the opposition"}];function o0(t){const e=[...t];for(let n=e.length-1;n>0;n--){const i=Math.floor(Math.random()*(n+1));[e[n],e[i]]=[e[i],e[n]]}return e}function Y5({difficulty:t="all",theme:e="all",count:n=10,voice:i,onComplete:r,onBack:s}){var ze,se,ke,Ge,Oe,Ve,Ze,Ue,tt,z,ht,Xe,Je;const{isMobile:a,isTablet:l,width:c,height:d}=rd(),[h,f]=N.useState([]),[p,m]=N.useState(0),[y,x]=N.useState(new Bt),[g,u]=N.useState(null),[v,b]=N.useState([]),[w,R]=N.useState("thinking"),[C,A]=N.useState(""),[B,S]=N.useState(!1),[k,U]=N.useState([]),[O,X]=N.useState(0),[K,$]=N.useState({correct:0,incorrect:0,hintsUsed:0}),[q,J]=N.useState(0),[V,ue]=N.useState([]),[F,de]=N.useState(0);N.useEffect(()=>{let ee=[...X5];t!=="all"&&(ee=ee.filter(_=>_.difficulty===t)),e!=="all"&&(ee=ee.filter(_=>{var W;return _.theme===e||((W=_.theme)==null?void 0:W.includes(e))}));const P=o0(ee).slice(0,n);f(P),P.length>0&&Te(P[0])},[t,e,n]);const Te=N.useCallback(ee=>{const P=new Bt(ee.fen);x(P),u(null),b([]),R("thinking"),S(!1),U([]),X(0);const _=P.turn()==="w"?"White":"Black";A(`${_} to move. ${ee.title}`),i!=null&&i.isEnabled&&setTimeout(()=>{i.speak(`${ee.title}. ${_} to move.`)},300)},[i]),xe=h[p];N.useCallback(ee=>{if(w==="correct"||w==="complete")return;const P=y.get(ee),_=y.turn();if(P&&P.color===_){u(ee);const W=y.moves({square:ee,verbose:!0});b(W.map(M=>M.to));return}g&&v.includes(ee)?le(g,ee):(u(null),b([]))},[y,g,v,w]);const le=N.useCallback((ee,P)=>{if(!xe)return;const _=xe.solution,W=_[O],M=y.move({from:ee,to:P,promotion:"q"});if(!M)return;const _e=M.san,ne=W.includes(_e)||W===_e||Array.isArray(W)&&W.includes(_e);if(U(Ie=>[...Ie,_e]),u(null),b([]),ne)if(O+1>=_.length){if(R("correct"),A("Correct! Well done! "),J(Ie=>Ie+1),$(Ie=>({...Ie,correct:Ie.correct+1})),ue(Ie=>[...Ie,{puzzle:xe,result:"correct",usedHint:B}]),i!=null&&i.isEnabled){const Ie=["Excellent!","Perfect!","Well done!","Great find!"];i.speak(Ie[Math.floor(Math.random()*Ie.length)])}}else X(Ie=>Ie+1),A("Good! Keep going..."),O+2<=_.length&&setTimeout(()=>{const Ie=_[O+1];if(Ie&&!Ie.includes("#"))try{y.move(Ie),X(ie=>ie+1),x(new Bt(y.fen()))}catch{}},500);else R("incorrect"),A("Not quite. Try again!"),J(0),$(Ie=>({...Ie,incorrect:Ie.incorrect+1})),i!=null&&i.isEnabled&&i.speak("Not quite. Try again!"),setTimeout(()=>{y.undo(),x(new Bt(y.fen())),R("thinking"),A(`Try again. ${xe.title}`)},1500)},[y,xe,O,i]),Re=N.useCallback(()=>{xe&&(S(!0),$(ee=>({...ee,hintsUsed:ee.hintsUsed+1})),A(xe.hint),i!=null&&i.isEnabled&&i.speak(xe.hint))},[xe,i]),Q=N.useCallback(()=>{p+1>=h.length?(R("complete"),A(`Training complete! ${K.correct}/${h.length} correct.`),i!=null&&i.isEnabled&&i.speak(`Training complete! You got ${K.correct} out of ${h.length} correct.`),r==null||r({correct:K.correct,incorrect:K.incorrect,hintsUsed:K.hintsUsed,total:h.length})):(m(ee=>ee+1),Te(h[p+1]))},[p,h,K,Te,r,i]),ae=N.useCallback(()=>{ue(ee=>[...ee,{puzzle:xe,result:"skipped",usedHint:B}]),$(ee=>({...ee,incorrect:ee.incorrect+1})),J(0),Q()},[Q,xe,B]),Me=N.useCallback(()=>{xe&&(R("showingSolution"),J(0),$(ee=>({...ee,incorrect:ee.incorrect+1})),ue(ee=>[...ee,{puzzle:xe,result:"missed",usedHint:B}]),i!=null&&i.isEnabled&&i.speak(`The solution was ${xe.solution.join(", then ")}`))},[xe,i,B]);if(h.length===0)return o.jsxs("div",{style:{padding:40,textAlign:"center"},children:[o.jsx("div",{style:{fontSize:48,marginBottom:16},children:""}),o.jsx("h2",{children:"No puzzles found"}),o.jsx("p",{style:{opacity:.7},children:"Try adjusting the difficulty or theme filters."}),o.jsx("button",{onClick:s,style:{marginTop:20,padding:"12px 24px",background:"#666",color:"#fff",border:"none",borderRadius:8,cursor:"pointer"},children:" Back"})]});if(w==="review"){const ee=V[F],P=new Bt(((ze=ee==null?void 0:ee.puzzle)==null?void 0:ze.fen)||""),_=V.filter(W=>W.result!=="correct");return o.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:a?"100vh":"auto",background:"#1a1a1a"},children:[o.jsxs("div",{style:{padding:a?"12px 16px":"16px 24px",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0},children:[o.jsx("button",{onClick:()=>R("complete"),style:{padding:"8px 16px",background:"transparent",color:"#fff",border:"1px solid rgba(255,255,255,0.2)",borderRadius:6,cursor:"pointer"},children:" Back to Results"}),o.jsxs("span",{style:{opacity:.7},children:["Review ",F+1," of ",V.length]}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{onClick:()=>de(W=>Math.max(0,W-1)),disabled:F===0,style:{padding:"8px 12px",background:F===0?"#333":"#555",color:"#fff",border:"none",borderRadius:6,cursor:F===0?"not-allowed":"pointer",opacity:F===0?.5:1},children:""}),o.jsx("button",{onClick:()=>de(W=>Math.min(V.length-1,W+1)),disabled:F===V.length-1,style:{padding:"8px 12px",background:F===V.length-1?"#333":"#555",color:"#fff",border:"none",borderRadius:6,cursor:F===V.length-1?"not-allowed":"pointer",opacity:F===V.length-1?.5:1},children:""})]})]}),o.jsxs("div",{style:{flex:1,display:"flex",flexDirection:a?"column":"row",gap:24,padding:a?16:24,overflow:"auto"},children:[o.jsx("div",{style:{flexShrink:0,display:"flex",justifyContent:"center"},children:o.jsx(Gr,{chess:P,interactive:!1,orientation:((se=ee==null?void 0:ee.puzzle)==null?void 0:se.playerToMove)==="black"?"b":"w",size:a?Math.min(c-32,320):360})}),o.jsxs("div",{style:{flex:1,maxWidth:a?"100%":400,display:"flex",flexDirection:"column",gap:16},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[o.jsx("span",{style:{padding:"6px 12px",borderRadius:20,fontSize:13,fontWeight:600,background:(ee==null?void 0:ee.result)==="correct"?"rgba(76, 175, 80, 0.2)":(ee==null?void 0:ee.result)==="missed"?"rgba(244, 67, 54, 0.2)":"rgba(255, 152, 0, 0.2)",color:(ee==null?void 0:ee.result)==="correct"?"#4CAF50":(ee==null?void 0:ee.result)==="missed"?"#f44336":"#ff9800"},children:(ee==null?void 0:ee.result)==="correct"?" Solved":(ee==null?void 0:ee.result)==="missed"?" Missed":" Skipped"}),(ee==null?void 0:ee.usedHint)&&o.jsx("span",{style:{fontSize:12,opacity:.6},children:" Used hint"})]}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:12,opacity:.5,textTransform:"uppercase",marginBottom:4},children:(Ge=(ke=ee==null?void 0:ee.puzzle)==null?void 0:ke.theme)==null?void 0:Ge.replace(/-/g," ")}),o.jsx("h2",{style:{margin:0,fontSize:22},children:(Oe=ee==null?void 0:ee.puzzle)==null?void 0:Oe.title})]}),o.jsxs("div",{style:{background:"rgba(76, 175, 80, 0.1)",border:"1px solid rgba(76, 175, 80, 0.3)",borderRadius:8,padding:16},children:[o.jsx("div",{style:{fontSize:12,opacity:.7,marginBottom:8},children:"SOLUTION"}),o.jsx("div",{style:{fontSize:18,fontWeight:600,color:"#4CAF50"},children:(Ze=(Ve=ee==null?void 0:ee.puzzle)==null?void 0:Ve.solution)==null?void 0:Ze.join("  ")})]}),((Ue=ee==null?void 0:ee.puzzle)==null?void 0:Ue.keyIdea)&&o.jsxs("div",{style:{background:"rgba(255, 152, 0, 0.1)",border:"1px solid rgba(255, 152, 0, 0.3)",borderRadius:8,padding:16},children:[o.jsx("div",{style:{fontSize:12,opacity:.7,marginBottom:8},children:" KEY IDEA"}),o.jsx("div",{style:{fontSize:15,fontWeight:500,color:"#ff9800"},children:(tt=ee==null?void 0:ee.puzzle)==null?void 0:tt.keyIdea})]}),((z=ee==null?void 0:ee.puzzle)==null?void 0:z.explanation)&&o.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",borderRadius:8,padding:16},children:[o.jsx("div",{style:{fontSize:12,opacity:.7,marginBottom:8},children:" WHY IT WORKS"}),o.jsx("div",{style:{fontSize:14,lineHeight:1.6,opacity:.9},children:(ht=ee==null?void 0:ee.puzzle)==null?void 0:ht.explanation})]}),_.length>0&&(ee==null?void 0:ee.result)!=="correct"&&o.jsxs("div",{style:{marginTop:8},children:[o.jsx("div",{style:{fontSize:12,opacity:.5,marginBottom:8},children:"Jump to missed puzzles:"}),o.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:V.map((W,M)=>W.result!=="correct"&&o.jsxs("button",{onClick:()=>de(M),style:{padding:"4px 10px",background:F===M?"#f44336":"rgba(244, 67, 54, 0.2)",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontSize:12},children:["#",M+1]},M))})]})]})]})]})}if(w==="complete"){const ee=Math.round(K.correct/h.length*100),P=V.filter(_=>_.result!=="correct");return o.jsxs("div",{style:{padding:a?20:40,textAlign:"center",maxHeight:"100vh",overflow:"auto"},children:[o.jsx("div",{style:{fontSize:64,marginBottom:16},children:ee>=80?"":ee>=60?"":""}),o.jsx("h2",{style:{marginBottom:8},children:"Training Complete!"}),o.jsxs("div",{style:{fontSize:48,fontWeight:700,color:"#4CAF50",marginBottom:16},children:[ee,"%"]}),o.jsxs("div",{style:{display:"flex",gap:24,justifyContent:"center",marginBottom:32,fontSize:15},children:[o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:24,fontWeight:700,color:"#4CAF50"},children:K.correct}),o.jsx("div",{style:{opacity:.7},children:"Correct"})]}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:24,fontWeight:700,color:"#f44336"},children:K.incorrect}),o.jsx("div",{style:{opacity:.7},children:"Incorrect"})]}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:24,fontWeight:700,color:"#ff9800"},children:K.hintsUsed}),o.jsx("div",{style:{opacity:.7},children:"Hints"})]})]}),o.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",borderRadius:12,padding:20,marginBottom:24,maxWidth:500,margin:"0 auto 24px"},children:[o.jsx("h3",{style:{margin:"0 0 16px",fontSize:16},children:"Puzzle Summary"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:V.map((_,W)=>{var M,_e,ne;return o.jsxs("div",{onClick:()=>{de(W),R("review")},style:{display:"flex",alignItems:"center",gap:12,padding:"10px 12px",background:_.result==="correct"?"rgba(76, 175, 80, 0.1)":_.result==="missed"?"rgba(244, 67, 54, 0.1)":"rgba(255, 152, 0, 0.1)",borderRadius:8,cursor:"pointer",transition:"all 0.2s"},children:[o.jsx("span",{style:{width:24,height:24,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:600,background:_.result==="correct"?"#4CAF50":_.result==="missed"?"#f44336":"#ff9800",color:"#fff"},children:_.result==="correct"?"":_.result==="missed"?"":""}),o.jsx("span",{style:{flex:1,textAlign:"left",fontSize:14},children:(M=_.puzzle)==null?void 0:M.title}),o.jsx("span",{style:{fontSize:12,opacity:.5},children:(ne=(_e=_.puzzle)==null?void 0:_e.theme)==null?void 0:ne.replace(/-/g," ")})]},W)})})]}),o.jsxs("div",{style:{display:"flex",gap:12,justifyContent:"center",flexWrap:"wrap"},children:[P.length>0&&o.jsxs("button",{onClick:()=>{de(0),R("review")},style:{padding:"12px 24px",background:"#2196F3",color:"#fff",border:"none",borderRadius:8,cursor:"pointer",fontWeight:600},children:[" Review All (",V.length,")"]}),o.jsx("button",{onClick:()=>{m(0),$({correct:0,incorrect:0,hintsUsed:0}),J(0),ue([]),f(o0(h)),Te(h[0])},style:{padding:"12px 24px",background:"#4CAF50",color:"#fff",border:"none",borderRadius:8,cursor:"pointer",fontWeight:600},children:" Try Again"}),o.jsx("button",{onClick:s,style:{padding:"12px 24px",background:"#666",color:"#fff",border:"none",borderRadius:8,cursor:"pointer"},children:" Back"})]})]})}return o.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:a?"100vh":"auto",background:"#1a1a1a"},children:[o.jsxs("div",{style:{padding:a?"12px 16px":"16px 24px",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0},children:[o.jsx("button",{onClick:s,style:{padding:a?"8px 12px":"8px 16px",background:"transparent",color:"#fff",border:"1px solid rgba(255,255,255,0.2)",borderRadius:6,cursor:"pointer",fontSize:a?13:14,minHeight:a?40:"auto"},children:a?"":" Back"}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:a?8:16},children:[o.jsx("span",{style:{opacity:.7,fontSize:a?12:14},children:a?`${p+1}/${h.length}`:`Puzzle ${p+1} of ${h.length}`}),q>1&&o.jsxs("span",{style:{background:"#ff9800",padding:a?"3px 8px":"4px 12px",borderRadius:12,fontWeight:600,fontSize:a?11:13},children:[" ",q]})]}),o.jsxs("div",{style:{display:"flex",gap:a?6:8,fontSize:a?12:14},children:[o.jsxs("span",{style:{color:"#4CAF50"},children:[" ",K.correct]}),o.jsxs("span",{style:{color:"#f44336"},children:[" ",K.incorrect]})]})]}),o.jsxs("div",{style:{flex:1,display:"flex",flexDirection:a?"column":"row",alignItems:"center",justifyContent:"center",gap:a?20:40,padding:a?16:24,overflow:"auto"},children:[o.jsx("div",{style:{flexShrink:0},children:o.jsx(Gr,{chess:y,interactive:w!=="correct"&&w!=="complete"&&w!=="showingSolution",onMove:ee=>le(ee.from,ee.to),orientation:(xe==null?void 0:xe.playerToMove)==="black"?"b":"w",size:a?Math.min(c-32,360):l?Math.min(400,d-300):Math.min(480,d-250)})}),o.jsxs("div",{style:{width:a?"100%":320,display:"flex",flexDirection:"column",gap:a?12:16,maxHeight:a?"none":"100%",overflow:a?"visible":"auto"},children:[o.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",borderRadius:12,padding:20},children:[o.jsx("div",{style:{fontSize:12,opacity:.5,marginBottom:4,textTransform:"uppercase"},children:(Xe=xe==null?void 0:xe.theme)==null?void 0:Xe.replace(/-/g," ")}),o.jsx("h3",{style:{margin:"0 0 12px",fontSize:18},children:xe==null?void 0:xe.title}),o.jsx("div",{style:{padding:12,background:w==="correct"?"rgba(76, 175, 80, 0.2)":w==="incorrect"||w==="showingSolution"?"rgba(244, 67, 54, 0.2)":"rgba(255,255,255,0.05)",borderRadius:8,fontSize:14,lineHeight:1.5},children:w==="showingSolution"?`Solution: ${(Je=xe==null?void 0:xe.solution)==null?void 0:Je.join("  ")}`:C})]}),w==="showingSolution"&&o.jsxs(o.Fragment,{children:[(xe==null?void 0:xe.keyIdea)&&o.jsxs("div",{style:{background:"rgba(255, 152, 0, 0.1)",border:"1px solid rgba(255, 152, 0, 0.3)",borderRadius:8,padding:12},children:[o.jsx("div",{style:{fontSize:11,opacity:.7,marginBottom:6},children:" KEY IDEA"}),o.jsx("div",{style:{fontSize:14,fontWeight:500,color:"#ff9800"},children:xe.keyIdea})]}),(xe==null?void 0:xe.explanation)&&o.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",borderRadius:8,padding:12,maxHeight:a?"none":200,overflow:"auto"},children:[o.jsx("div",{style:{fontSize:11,opacity:.7,marginBottom:6},children:" WHY IT WORKS"}),o.jsx("div",{style:{fontSize:13,lineHeight:1.6,opacity:.9},children:xe.explanation})]})]}),B&&(xe==null?void 0:xe.hint)&&w!=="showingSolution"&&o.jsxs("div",{style:{background:"rgba(255, 152, 0, 0.1)",border:"1px solid rgba(255, 152, 0, 0.3)",borderRadius:8,padding:12,fontSize:14},children:[" ",xe.hint]}),o.jsx("div",{style:{display:"flex",flexDirection:a?"row":"column",gap:8,flexWrap:"wrap"},children:w==="correct"||w==="showingSolution"?o.jsx("button",{onClick:Q,style:{padding:a?"14px 16px":"14px 20px",background:w==="correct"?"#4CAF50":"#2196F3",color:"#fff",border:"none",borderRadius:8,cursor:"pointer",fontWeight:600,fontSize:a?14:15,flex:a?1:"none",minHeight:a?48:"auto"},children:p+1>=h.length?"See Results ":"Next Puzzle "}):o.jsxs(o.Fragment,{children:[!B&&o.jsx("button",{onClick:Re,style:{padding:a?"12px 14px":"12px 20px",background:"rgba(255, 152, 0, 0.2)",color:"#ff9800",border:"1px solid rgba(255, 152, 0, 0.3)",borderRadius:8,cursor:"pointer",fontSize:a?13:14,flex:a?1:"none",minHeight:a?48:"auto"},children:" Hint"}),o.jsx("button",{onClick:Me,style:{padding:a?"12px 14px":"12px 20px",background:"transparent",color:"#fff",border:"1px solid rgba(255,255,255,0.2)",borderRadius:8,cursor:"pointer",fontSize:a?13:14,flex:a?1:"none",minHeight:a?48:"auto"},children:"Show Solution"}),o.jsx("button",{onClick:ae,style:{padding:a?"12px 14px":"12px 20px",background:"transparent",color:"rgba(255,255,255,0.5)",border:"none",borderRadius:8,cursor:"pointer",fontSize:a?13:14,flex:a?1:"none",minHeight:a?48:"auto"},children:"Skip "})]})}),o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:a?"center":"flex-start",gap:8,opacity:.5,fontSize:a?12:13},children:[o.jsx("span",{children:"Difficulty:"}),[1,2,3].map(ee=>o.jsx("span",{style:{color:ee<=((xe==null?void 0:xe.difficulty)||1)?"#ff9800":"#444"},children:""},ee))]})]})]})]})}function Z5({lesson:t,voice:e,onComplete:n,onBack:i}){const{isMobile:r,isTablet:s,width:a}=rd(),[l,c]=N.useState(0),[d,h]=N.useState(new Bt),[f,p]=N.useState(null),[m,y]=N.useState([]),[x,g]=N.useState("waiting"),[u,v]=N.useState({}),[b,w]=N.useState(!1),[R,C]=N.useState(0),[A,B]=N.useState({correctExercises:0,totalExercises:0,quizScore:0,quizTotal:0}),[S,k]=N.useState(0),U=(t==null?void 0:t.steps)||[],O=U[l],X=U.length,K=(l+1)/X*100;N.useEffect(()=>{if(O!=null&&O.fen){const le=new Bt(O.fen);h(le)}p(null),y([]),g("waiting"),w(!1),C(0),k(0),v({})},[l,O==null?void 0:O.fen]),N.useEffect(()=>{if(e!=null&&e.isEnabled&&O)if(O.type==="explanation"&&O.content){const le=O.content.replace(/\*\*/g,"").replace(/\n/g," ").slice(0,200);e.speak(O.title+". "+le)}else O.type==="exercise"&&e.speak(O.title+". "+O.content)},[l]),N.useCallback(le=>{if((O==null?void 0:O.type)!=="exercise"||x!=="waiting")return;const Re=d.get(le),Q=d.turn();if(Re&&Re.color===Q){p(le);const ae=d.moves({square:le,verbose:!0});y(ae.map(Me=>Me.to));return}f&&m.includes(le)?$(f,le):(p(null),y([]))},[d,f,m,O,x]);const $=N.useCallback((le,Re)=>{if(!(O!=null&&O.moveToFind))return;const Q=d.move({from:le,to:Re,promotion:"q"});if(!Q)return;const ae=Q.san,Me=O.moveToFind,ze=O.alternativeMoves||[];ae===Me||ae.replace(/[+#]/g,"")===Me.replace(/[+#]/g,"")||ze.includes(ae)||ze.includes(ae.replace(/[+#]/g,""))?(g("correct"),B(ke=>({...ke,correctExercises:ke.correctExercises+1,totalExercises:ke.totalExercises+1})),w(!0),e!=null&&e.isEnabled&&e.speak("Excellent! That's correct!")):(C(ke=>ke+1),d.undo(),h(new Bt(d.fen())),R>=2?(g("revealed"),B(ke=>({...ke,totalExercises:ke.totalExercises+1})),w(!0),e!=null&&e.isEnabled&&e.speak(`The answer was ${Me}.`)):(g("incorrect"),e!=null&&e.isEnabled&&e.speak(R===0?"Not quite, try again!":"One more try."),setTimeout(()=>g("waiting"),1500))),p(null),y([])},[d,O,R,e]),q=(le,Re)=>{if(u[le]!==void 0)return;const Q=O.questions[le],ae=Re===Q.correct;v(Me=>({...Me,[le]:Re})),B(ae?Me=>({...Me,quizScore:Me.quizScore+1,quizTotal:Me.quizTotal+1}):Me=>({...Me,quizTotal:Me.quizTotal+1}))},J=le=>{O.options[le].correct?(g("correct"),B(Q=>({...Q,correctExercises:Q.correctExercises+1,totalExercises:Q.totalExercises+1})),w(!0),e!=null&&e.isEnabled&&e.speak("Correct!")):(C(Q=>Q+1),R>=1?(g("revealed"),B(Q=>({...Q,totalExercises:Q.totalExercises+1})),w(!0)):(g("incorrect"),setTimeout(()=>g("waiting"),1500)))},V=()=>{l<X-1?c(le=>le+1):n==null||n({...A,completed:!0})},ue=()=>{l>0&&c(le=>le-1)},F=()=>{O!=null&&O.hint&&(e!=null&&e.isEnabled)&&e.speak(O.hint)};function de(le){return le?le.split(/\*\*(.+?)\*\*/g).map((Q,ae)=>ae%2===1?o.jsx("strong",{style:{color:"#4CAF50"},children:Q},ae):Q):null}const Te=()=>{var le;return O?O.type==="explanation"||O.type==="summary"?!0:O.type==="exercise"?O.options||O.moveToFind?x==="correct"||x==="revealed":!0:O.type==="quiz"?(le=O.questions)==null?void 0:le.every((Re,Q)=>u[Q]!==void 0):!0:!1},xe=()=>{var Q,ae,Me;if(!O)return null;const le=r?Math.min(a-48,320):s?320:340,Re=r?Math.min(a-48,340):s?340:380;switch(O.type){case"explanation":return o.jsxs("div",{style:{display:"flex",flexDirection:r?"column":"row",gap:r?20:32,alignItems:r?"center":"flex-start"},children:[O.fen&&o.jsx("div",{style:{flexShrink:0},children:o.jsx(Gr,{chess:d,interactive:!1,highlights:O.highlights,size:le})}),o.jsxs("div",{style:{flex:1,width:r?"100%":"auto"},children:[o.jsx("h3",{style:{margin:"0 0 16px",fontSize:r?18:20},children:O.title}),o.jsx("div",{style:{fontSize:r?14:15,lineHeight:1.8,whiteSpace:"pre-wrap",color:"rgba(255,255,255,0.9)"},children:de(O.content)})]})]});case"exercise":return o.jsxs("div",{style:{display:"flex",flexDirection:r?"column":"row",gap:r?20:32,alignItems:r?"center":"flex-start"},children:[o.jsxs("div",{style:{flexShrink:0},children:[o.jsx(Gr,{chess:d,interactive:O.moveToFind&&x==="waiting",onMove:se=>$(se.from,se.to),highlights:O.highlights,size:Re}),O.moveToFind&&x==="waiting"&&o.jsxs("div",{style:{marginTop:12,textAlign:"center",fontSize:r?12:13,color:d.turn()==="w"?"#fff":"#888"},children:[d.turn()==="w"?"White":"Black"," to move"]})]}),o.jsxs("div",{style:{flex:1,width:r?"100%":"auto"},children:[o.jsx("h3",{style:{margin:"0 0 12px",fontSize:r?18:20},children:O.title}),o.jsx("p",{style:{fontSize:r?14:15,lineHeight:1.6,marginBottom:r?16:20},children:O.content}),O.options&&o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:r?8:10},children:O.options.map((se,ke)=>o.jsx("button",{onClick:()=>x==="waiting"&&J(ke),disabled:x!=="waiting",style:{padding:r?"12px 14px":"14px 18px",background:x!=="waiting"&&se.correct?"rgba(76, 175, 80, 0.3)":x!=="waiting"&&!se.correct?"rgba(244, 67, 54, 0.2)":"rgba(255,255,255,0.1)",border:se.correct&&x!=="waiting"?"2px solid #4CAF50":"1px solid rgba(255,255,255,0.2)",borderRadius:8,color:"#fff",fontSize:r?13:14,textAlign:"left",cursor:x==="waiting"?"pointer":"default",minHeight:r?48:"auto"},children:se.text},ke))}),O.moveToFind&&x==="waiting"&&O.hint&&o.jsx("button",{onClick:F,style:{marginTop:16,padding:"10px 16px",background:"rgba(255, 152, 0, 0.2)",border:"1px solid rgba(255, 152, 0, 0.4)",borderRadius:8,color:"#ff9800",fontSize:14,cursor:"pointer"},children:" Show Hint"}),x==="correct"&&o.jsxs("div",{style:{marginTop:20,padding:16,background:"rgba(76, 175, 80, 0.2)",border:"1px solid rgba(76, 175, 80, 0.4)",borderRadius:8},children:[o.jsx("div",{style:{fontWeight:600,color:"#4CAF50",marginBottom:8},children:" Correct!"}),O.explanation&&o.jsx("div",{style:{fontSize:14,lineHeight:1.6},children:O.explanation})]}),x==="incorrect"&&o.jsx("div",{style:{marginTop:20,padding:16,background:"rgba(244, 67, 54, 0.2)",border:"1px solid rgba(244, 67, 54, 0.4)",borderRadius:8},children:o.jsx("div",{style:{fontWeight:600,color:"#f44336"},children:"Not quite  try again!"})}),x==="revealed"&&o.jsxs("div",{style:{marginTop:20,padding:16,background:"rgba(255, 152, 0, 0.2)",border:"1px solid rgba(255, 152, 0, 0.4)",borderRadius:8},children:[o.jsxs("div",{style:{fontWeight:600,color:"#ff9800",marginBottom:8},children:["Answer: ",O.moveToFind]}),O.explanation&&o.jsx("div",{style:{fontSize:14,lineHeight:1.6},children:O.explanation})]})]})]});case"quiz":const ze=(Q=O.questions)==null?void 0:Q.every((se,ke)=>u[ke]!==void 0);return o.jsxs("div",{style:{maxWidth:600},children:[o.jsx("h3",{style:{margin:"0 0 24px",fontSize:20},children:O.title}),(ae=O.questions)==null?void 0:ae.map((se,ke)=>o.jsxs("div",{style:{marginBottom:32},children:[o.jsxs("div",{style:{fontWeight:600,marginBottom:12,fontSize:15},children:[ke+1,". ",se.question]}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:se.options.map((Ge,Oe)=>{const Ve=u[ke]!==void 0,Ze=u[ke]===Oe,Ue=Oe===se.correct;return o.jsxs("button",{onClick:()=>q(ke,Oe),disabled:Ve,style:{padding:"12px 16px",background:Ve&&Ue?"rgba(76, 175, 80, 0.3)":Ve&&Ze&&!Ue?"rgba(244, 67, 54, 0.3)":"rgba(255,255,255,0.05)",border:Ve&&Ue?"2px solid #4CAF50":"1px solid rgba(255,255,255,0.2)",borderRadius:8,color:"#fff",fontSize:14,textAlign:"left",cursor:Ve?"default":"pointer"},children:[Ge,Ve&&Ue&&" ",Ve&&Ze&&!Ue&&" "]},Oe)})}),u[ke]!==void 0&&se.explanation&&o.jsx("div",{style:{marginTop:12,padding:12,background:"rgba(255,255,255,0.05)",borderRadius:8,fontSize:13,lineHeight:1.5},children:se.explanation})]},ke)),ze&&o.jsxs("div",{style:{padding:16,background:"rgba(76, 175, 80, 0.2)",borderRadius:8,textAlign:"center"},children:["Quiz complete! Score: ",A.quizScore,"/",A.quizTotal]})]});case"summary":return o.jsxs("div",{style:{maxWidth:600},children:[o.jsxs("h3",{style:{margin:"0 0 20px",fontSize:20},children:[" ",O.title]}),o.jsx("div",{style:{background:"rgba(255,255,255,0.05)",borderRadius:12,padding:24},children:(Me=O.points)==null?void 0:Me.map((se,ke)=>o.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:12,marginBottom:ke<O.points.length-1?16:0},children:[o.jsx("span",{style:{color:"#4CAF50",fontSize:18},children:""}),o.jsx("span",{style:{fontSize:15,lineHeight:1.5},children:se})]},ke))})]});default:return o.jsxs("div",{children:["Unknown step type: ",O.type]})}};return t?o.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",minHeight:r?"100vh":"auto",background:"#1a1a1a"},children:[o.jsxs("div",{style:{padding:r?"12px 16px":"16px 24px",borderBottom:"1px solid rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0},children:[o.jsx("button",{onClick:i,style:{padding:r?"8px 12px":"8px 16px",background:"transparent",color:"#fff",border:"1px solid rgba(255,255,255,0.2)",borderRadius:6,cursor:"pointer",fontSize:r?13:14,minHeight:r?40:"auto"},children:r?"":" Back"}),o.jsxs("div",{style:{textAlign:"center",flex:1,padding:"0 12px"},children:[o.jsx("div",{style:{fontWeight:600,fontSize:r?14:16},children:t.title}),o.jsxs("div",{style:{fontSize:r?11:12,opacity:.6},children:["Step ",l+1," of ",X]})]}),o.jsxs("div",{style:{minWidth:r?40:80,textAlign:"right",fontSize:r?12:13,opacity:.7},children:[Math.round(K),"%"]})]}),o.jsx("div",{style:{height:3,background:"rgba(255,255,255,0.1)",flexShrink:0},children:o.jsx("div",{style:{height:"100%",width:`${K}%`,background:"linear-gradient(90deg, #4CAF50, #8BC34A)",transition:"width 0.3s ease"}})}),o.jsx("div",{style:{flex:1,overflow:"auto",padding:r?16:32},children:xe()}),o.jsxs("div",{style:{padding:r?"12px 16px":"16px 24px",paddingBottom:r?"calc(12px + env(safe-area-inset-bottom, 0))":"16px",borderTop:"1px solid rgba(255,255,255,0.1)",display:"flex",justifyContent:"space-between",alignItems:"center",gap:r?8:16,flexShrink:0},children:[o.jsx("button",{onClick:ue,disabled:l===0,style:{padding:r?"12px 16px":"12px 24px",background:l===0?"rgba(255,255,255,0.05)":"rgba(255,255,255,0.1)",border:"none",borderRadius:8,color:l===0?"rgba(255,255,255,0.3)":"#fff",cursor:l===0?"default":"pointer",fontSize:r?13:14,minHeight:r?48:"auto",flex:r?1:"none"},children:r?"":" Previous"}),!r&&o.jsx("div",{style:{fontSize:13,opacity:.5},children:(O==null?void 0:O.type)==="exercise"&&x==="waiting"&&O.moveToFind&&"Click pieces to make your move"}),o.jsx("button",{onClick:V,disabled:!Te(),style:{padding:r?"12px 16px":"12px 24px",background:Te()?"#4CAF50":"rgba(255,255,255,0.05)",border:"none",borderRadius:8,color:Te()?"#fff":"rgba(255,255,255,0.3)",cursor:Te()?"pointer":"default",fontSize:r?13:14,fontWeight:600,minHeight:r?48:"auto",flex:r?1:"none"},children:l===X-1?r?"Complete ":"Complete Lesson ":"Next "})]})]}):o.jsxs("div",{style:{padding:40,textAlign:"center"},children:[o.jsx("h2",{children:"Lesson not found"}),o.jsx("button",{onClick:i,children:" Back"})]})}const J5=["Google UK English Male","Google UK English Female","Google US English","Microsoft David","Microsoft Zira","Samantha","Daniel","Alex","en-US","en-GB"];function eR(){const[t,e]=N.useState(!1),[n,i]=N.useState(!1),[r,s]=N.useState(!1),[a,l]=N.useState([]),[c,d]=N.useState(null),[h,f]=N.useState(.95),[p,m]=N.useState(1),y=N.useRef(null);N.useEffect(()=>{if(typeof window<"u"&&"speechSynthesis"in window){e(!0);const A=()=>{const S=window.speechSynthesis.getVoices();if(S.length>0){l(S);const k=x(S);d(k)}};A(),window.speechSynthesis.onvoiceschanged=A;const B=localStorage.getItem("coachVoiceEnabled");B===null?(s(!0),localStorage.setItem("coachVoiceEnabled","true")):B==="true"&&s(!0)}},[]);function x(A){for(const S of J5){const k=A.find(U=>U.name.includes(S)||U.lang.startsWith(S));if(k)return k}const B=A.find(S=>S.lang.startsWith("en"));return B||A[0]}const g=N.useRef(null),u=N.useCallback(()=>{g.current&&clearInterval(g.current),g.current=setInterval(()=>{window.speechSynthesis.speaking&&!window.speechSynthesis.paused&&(window.speechSynthesis.pause(),window.speechSynthesis.resume())},1e4)},[]),v=N.useCallback(()=>{g.current&&(clearInterval(g.current),g.current=null)},[]),b=N.useCallback(A=>{if(!t||!r||!A)return;window.speechSynthesis.cancel(),v();const B=A.replace(/[]/g,"").replace(/\*\*/g,"").replace(/\n+/g," ").replace(/\s+/g," ").trim();B&&setTimeout(()=>{const S=new SpeechSynthesisUtterance(B);y.current=S,c&&(S.voice=c),S.rate=h,S.pitch=p,S.volume=1,S.onstart=()=>{i(!0),u()},S.onend=()=>{i(!1),v()},S.onerror=k=>{k.error!=="interrupted"&&console.warn("Speech error:",k.error),i(!1),v()},window.speechSynthesis.speak(S)},150)},[t,r,c,h,p,u,v]),w=N.useCallback(()=>{t&&(window.speechSynthesis.cancel(),v(),i(!1))},[t,v]);N.useEffect(()=>()=>{v(),window.speechSynthesis.cancel()},[v]);const R=N.useCallback(()=>{const A=!r;s(A),localStorage.setItem("coachVoiceEnabled",String(A)),A||w()},[r,w]),C=a.filter(A=>A.lang.startsWith("en"));return{isSupported:t,isEnabled:r,isSpeaking:n,speak:b,stop:w,toggleEnabled:R,voices:C,selectedVoice:c,setSelectedVoice:d,rate:h,setRate:f,pitch:p,setPitch:m}}function u1({voice:t,size:e=24}){return t.isSupported?o.jsxs("button",{onClick:t.toggleEnabled,style:{background:t.isEnabled?"#4CAF50":"#666",border:"none",borderRadius:8,padding:"8px 12px",cursor:"pointer",display:"flex",alignItems:"center",gap:8,color:"#fff",fontSize:14,transition:"background 0.2s"},title:t.isEnabled?"Voice On (click to mute)":"Voice Off (click to enable)",children:[t.isEnabled?o.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})}):o.jsx("svg",{width:e,height:e,viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"})}),t.isSpeaking?"Speaking...":t.isEnabled?"Voice On":"Voice Off"]}):null}function tR({voice:t}){var e;return t.isSupported?o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[o.jsx("label",{style:{minWidth:80},children:"Voice:"}),o.jsx(u1,{voice:t})]}),t.isEnabled&&o.jsxs(o.Fragment,{children:[t.voices.length>1&&o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[o.jsx("label",{style:{minWidth:80},children:"Voice:"}),o.jsx("select",{value:((e=t.selectedVoice)==null?void 0:e.name)||"",onChange:n=>{const i=t.voices.find(r=>r.name===n.target.value);i&&t.setSelectedVoice(i)},style:{padding:"8px 12px",borderRadius:6,border:"1px solid #444",background:"#333",color:"#fff",flex:1},children:t.voices.map(n=>o.jsxs("option",{value:n.name,children:[n.name," (",n.lang,")"]},n.name))})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[o.jsx("label",{style:{minWidth:80},children:"Speed:"}),o.jsx("input",{type:"range",min:"0.5",max:"1.5",step:"0.1",value:t.rate,onChange:n=>t.setRate(parseFloat(n.target.value)),style:{flex:1}}),o.jsxs("span",{style:{minWidth:40},children:[t.rate,"x"]})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[o.jsx("label",{style:{minWidth:80},children:"Pitch:"}),o.jsx("input",{type:"range",min:"0.5",max:"1.5",step:"0.1",value:t.pitch,onChange:n=>t.setPitch(parseFloat(n.target.value)),style:{flex:1}}),o.jsx("span",{style:{minWidth:40},children:t.pitch})]}),o.jsx("button",{onClick:()=>t.speak("Hello! I'm your chess coach. Let's improve your game together!"),disabled:t.isSpeaking,style:{padding:"10px 20px",background:t.isSpeaking?"#666":"#2196F3",color:"#fff",border:"none",borderRadius:8,cursor:t.isSpeaking?"not-allowed":"pointer",alignSelf:"flex-start"},children:t.isSpeaking?"Speaking...":"Test Voice"})]})]}):o.jsx("p",{style:{color:"#999"},children:"Voice not supported in this browser."})}const nR={welcome:["Welcome to Chess Training!  I'm your personal chess coach.","Ready to improve your chess? Let's figure out where you are and build from there.","Every grandmaster was once a beginner. Let's start your journey!"],encouragement:["Great work! You're making real progress.","That was a tricky one - you handled it well!","I can see you're getting stronger. Keep it up!","Excellent! Your pattern recognition is improving."],afterMistake:["No worries - mistakes are how we learn. Let's look at what happened.","Ah, I see what you were trying. Here's another way to think about it...","Good attempt! Let me show you a pattern that might help here."],sessionComplete:["Fantastic session! You've earned a rest.","Great work today! Your skills are definitely improving.","Session complete! I can see real progress in your game."]};function h1(t){const e=nR[t];return e[Math.floor(Math.random()*e.length)]}function iR(t,e,n){if(!(t!=null&&t.lastTrainingDate)&&e.length===0)return h1("welcome");const i=["Welcome back!","Hey, good to see you again!","Glad you're back!","Hey there, welcome back!"],r=i[Math.floor(Math.random()*i.length)];let s="";if(e.length>0){const c=e[e.length-1];for(const d of Object.values(Ko))if(d.sessions.find(f=>f.id===c)){s={fundamentals:"the fundamentals",tacticsBasics:"basic tactics",tacticsIntermediate:"intermediate tactics",tacticsAdvanced:"advanced tactics",openings:"opening principles",middlegame:"middlegame strategy",endgames:"endgame technique",modernConcepts:"modern chess concepts",antiTheory:"anti-theory openings"}[d.id]||d.name.toLowerCase();break}}let a="";if(Object.keys(n).length>0){const c={},d={tactics:"tactics",openings:"openings",middlegame:"middlegame strategy",endgame:"endgames",calculation:"calculation"};for(const[p,m]of Object.entries(n))for(const[y,x]of Object.entries(id))x.skills.some(g=>g.id===p)&&(c[y]||(c[y]=[]),c[y].push(m.level||1));let h=1/0,f=null;for(const[p,m]of Object.entries(c)){const y=m.reduce((x,g)=>x+g,0)/m.length;y<h&&(h=y,f=p)}f&&(a=d[f]||f)}let l=r;if(s){const c=[`Last time you were working on ${s}.`,`I see you've been focusing on ${s}.`,`Great progress on ${s} last session.`];l+=" "+c[Math.floor(Math.random()*c.length)]}if(a&&a!==s){const c=[`I think we should spend some time on ${a} today  that's an area where you could really level up.`,`How about we work on ${a}? A bit of practice there would really strengthen your game.`,`Want to focus on ${a} today? I've noticed that could use some attention.`,`Let's sharpen your ${a}. A little work there will pay off big time.`];l+=" "+c[Math.floor(Math.random()*c.length)]}else if(s){const c=["Want to keep building on that momentum?","Ready to continue where we left off?","Should we pick up where we left off, or try something new?"];l+=" "+c[Math.floor(Math.random()*c.length)]}if(!s&&!a){const c=["What would you like to work on today?","Ready to sharpen your skills?","Let's make today's training count!"];l+=" "+c[Math.floor(Math.random()*c.length)]}return l}function rR({userProfile:t,onUpdateProfile:e,onBack:n}){const[i,r]=N.useState("home"),[s,a]=N.useState(null),[l,c]=N.useState(null),[d,h]=N.useState(""),[f,p]=N.useState((t==null?void 0:t.skills)||{}),[m,y]=N.useState((t==null?void 0:t.completedSessions)||[]),[x,g]=N.useState((t==null?void 0:t.estimatedRating)||null),[u,v]=N.useState(!(t!=null&&t.estimatedRating)),[b,w]=N.useState(null),[R,C]=N.useState(!1),[A,B]=N.useState(!1),[S,k]=N.useState({difficulty:"all",theme:"all",count:10}),[U,O]=N.useState((t==null?void 0:t.puzzleStats)||{total:0,correct:0}),[X,K]=N.useState(null),[$,q]=N.useState((t==null?void 0:t.completedLessons)||[]),[J,V]=N.useState((t==null?void 0:t.lessonStats)||{completed:0,exercises:0}),ue=rd(),{isMobile:F,isTablet:de,isDesktop:Te}=ue,xe=eR();N.useEffect(()=>{if(!A){const se=setTimeout(()=>{const ke=iR(t,m,f);h(ke),B(!0)},500);return()=>clearTimeout(se)}},[]),N.useEffect(()=>{d&&xe.isEnabled&&xe.speak(d)},[d,xe.isEnabled]),N.useEffect(()=>{if(i==="home"&&A){const se=["Back to the training hub. What's next?","Ready for more? Let's pick something to work on.","Good stuff! What would you like to focus on now?"];h(se[Math.floor(Math.random()*se.length)])}},[i]);const le=N.useCallback(se=>{const ke={...t,skills:f,completedSessions:m,estimatedRating:x,lastTrainingDate:new Date().toISOString(),...se};e==null||e(ke)},[t,f,m,x,e]),Re=N.useCallback((se,ke)=>{const Ge=[...m,se];y(Ge),ke!=null&&ke.skillUpdates&&p(Oe=>({...Oe,...ke.skillUpdates})),h(h1("sessionComplete")),le({completedSessions:Ge}),r("training"),c(null)},[m,le]),Q=se=>{g(se),v(!1),le({estimatedRating:se}),h(`Based on our assessment, your estimated rating is around ${se}. Let's build from here!`),r("home")},ae=()=>o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:F?16:24},children:[o.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(76,175,80,0.2) 0%, rgba(33,150,243,0.2) 100%)",borderRadius:F?12:16,padding:F?16:24,display:"flex",flexDirection:F?"column":"row",gap:F?12:20,alignItems:F?"center":"flex-start",textAlign:F?"center":"left"},children:[o.jsx("div",{style:{fontSize:F?40:56},children:""}),o.jsxs("div",{style:{flex:1},children:[o.jsx("div",{style:{fontSize:F?18:22,fontWeight:700,marginBottom:8},children:"Chess Coach"}),o.jsx("div",{style:{fontSize:F?14:15,opacity:.9,lineHeight:1.6},children:d}),x&&o.jsxs("div",{style:{marginTop:12,display:"flex",gap:F?8:16,alignItems:"center",flexWrap:"wrap",justifyContent:F?"center":"flex-start"},children:[o.jsxs("div",{style:{padding:F?"6px 12px":"8px 16px",background:"rgba(255,255,255,0.1)",borderRadius:8,fontSize:F?12:14},children:["Rating: ",o.jsx("strong",{children:x})]}),U.total>0&&o.jsxs("div",{style:{padding:F?"6px 12px":"8px 16px",background:"rgba(76,175,80,0.2)",borderRadius:8,fontSize:F?12:14},children:["Puzzles: ",o.jsxs("strong",{children:[U.correct,"/",U.total]})," (",Math.round(U.correct/U.total*100),"%)"]})]})]})]}),o.jsx("div",{style:{background:"linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%)",borderRadius:F?12:16,padding:F?16:24,cursor:"pointer"},onClick:()=>{k({difficulty:"all",theme:"all",count:10}),r("puzzles")},children:o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:F?12:16},children:[o.jsx("div",{style:{fontSize:F?32:40},children:""}),o.jsxs("div",{style:{flex:1},children:[o.jsx("div",{style:{fontSize:F?16:18,fontWeight:700,marginBottom:4},children:"Start Tactical Training"}),o.jsx("div",{style:{opacity:.9,fontSize:F?12:14},children:"Solve real chess puzzles and improve your pattern recognition"})]}),o.jsx("div",{style:{fontSize:F?20:24},children:""})]})}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:F?10:16},children:[o.jsxs("div",{onClick:()=>{k({difficulty:1,theme:"all",count:10}),r("puzzles")},style:{background:"rgba(255,255,255,0.05)",borderRadius:F?10:12,padding:F?14:20,cursor:"pointer",border:"1px solid rgba(255,255,255,0.1)",transition:"all 0.2s"},children:[o.jsx("div",{style:{fontSize:F?22:28,marginBottom:F?6:8},children:""}),o.jsx("div",{style:{fontWeight:600,marginBottom:4,fontSize:F?13:14},children:"Beginner"}),o.jsx("div",{style:{fontSize:F?11:13,opacity:.7},children:"Mate in 1"})]}),o.jsxs("div",{onClick:()=>{k({difficulty:2,theme:"all",count:10}),r("puzzles")},style:{background:"rgba(255,255,255,0.05)",borderRadius:F?10:12,padding:F?14:20,cursor:"pointer",border:"1px solid rgba(255,255,255,0.1)",transition:"all 0.2s"},children:[o.jsx("div",{style:{fontSize:28,marginBottom:8},children:""}),o.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"Intermediate Puzzles"}),o.jsx("div",{style:{fontSize:13,opacity:.7},children:"Forks, pins, combinations"})]}),o.jsxs("div",{onClick:()=>{k({difficulty:3,theme:"all",count:10}),r("puzzles")},style:{background:"rgba(255,255,255,0.05)",borderRadius:12,padding:20,cursor:"pointer",border:"1px solid rgba(255,255,255,0.1)",transition:"all 0.2s"},children:[o.jsx("div",{style:{fontSize:28,marginBottom:8},children:""}),o.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"Advanced Puzzles"}),o.jsx("div",{style:{fontSize:13,opacity:.7},children:"Mate in 2, sacrifices"})]}),o.jsxs("div",{onClick:()=>{k({difficulty:"all",theme:"endgame",count:10}),r("puzzles")},style:{background:"rgba(255,255,255,0.05)",borderRadius:12,padding:20,cursor:"pointer",border:"1px solid rgba(255,255,255,0.1)",transition:"all 0.2s"},children:[o.jsx("div",{style:{fontSize:28,marginBottom:8},children:""}),o.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"Endgame Training"}),o.jsx("div",{style:{fontSize:13,opacity:.7},children:"Essential endgame technique"})]})]}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:16},children:[o.jsx(bu,{icon:"",title:"Lessons",description:"Structured curriculum",onClick:()=>r("training"),color:"#9C27B0"}),o.jsx(bu,{icon:"",title:"Game Analysis",description:"Review your games",onClick:()=>r("analyze"),color:"#2196F3"}),o.jsx(bu,{icon:"",title:"Progress",description:"Track your skills",onClick:()=>r("progress"),color:"#FF9800"})]}),o.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:12,padding:20},children:[o.jsx("div",{style:{fontSize:14,fontWeight:600,opacity:.7,marginBottom:16},children:" INTERACTIVE LESSONS"}),o.jsxs("div",{style:{marginBottom:20},children:[o.jsx("div",{style:{fontSize:13,opacity:.6,marginBottom:10,textTransform:"uppercase"},children:"Fundamentals"}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:10},children:Object.entries(e0).map(([se,ke])=>{var Ge;return o.jsxs("button",{onClick:()=>{K(ke),r("lesson")},style:{padding:"14px 16px",background:$.includes(se)?"rgba(76, 175, 80, 0.2)":"rgba(255,255,255,0.05)",border:$.includes(se)?"1px solid rgba(76, 175, 80, 0.4)":"1px solid rgba(255,255,255,0.1)",borderRadius:8,color:"#fff",textAlign:"left",cursor:"pointer"},children:[o.jsxs("div",{style:{fontWeight:600,fontSize:14,marginBottom:4},children:[$.includes(se)&&" ",ke.title]}),o.jsxs("div",{style:{fontSize:12,opacity:.6},children:[((Ge=ke.steps)==null?void 0:Ge.length)||0," steps"]})]},se)})})]}),o.jsxs("div",{style:{marginBottom:20},children:[o.jsx("div",{style:{fontSize:13,opacity:.6,marginBottom:10,textTransform:"uppercase"},children:"Tactics"}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:10},children:Object.entries(t0).map(([se,ke])=>{var Ge;return o.jsxs("button",{onClick:()=>{K(ke),r("lesson")},style:{padding:"14px 16px",background:$.includes(se)?"rgba(76, 175, 80, 0.2)":"rgba(255,255,255,0.05)",border:$.includes(se)?"1px solid rgba(76, 175, 80, 0.4)":"1px solid rgba(255,255,255,0.1)",borderRadius:8,color:"#fff",textAlign:"left",cursor:"pointer"},children:[o.jsxs("div",{style:{fontWeight:600,fontSize:14,marginBottom:4},children:[$.includes(se)&&" ",ke.title]}),o.jsxs("div",{style:{fontSize:12,opacity:.6},children:[((Ge=ke.steps)==null?void 0:Ge.length)||0," steps"]})]},se)})})]}),o.jsxs("div",{children:[o.jsx("div",{style:{fontSize:13,opacity:.6,marginBottom:10,textTransform:"uppercase"},children:"Strategy"}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:10},children:Object.entries(n0).map(([se,ke])=>{var Ge;return o.jsxs("button",{onClick:()=>{K(ke),r("lesson")},style:{padding:"14px 16px",background:$.includes(se)?"rgba(76, 175, 80, 0.2)":"rgba(255,255,255,0.05)",border:$.includes(se)?"1px solid rgba(76, 175, 80, 0.4)":"1px solid rgba(255,255,255,0.1)",borderRadius:8,color:"#fff",textAlign:"left",cursor:"pointer"},children:[o.jsxs("div",{style:{fontWeight:600,fontSize:14,marginBottom:4},children:[$.includes(se)&&" ",ke.title]}),o.jsxs("div",{style:{fontSize:12,opacity:.6},children:[((Ge=ke.steps)==null?void 0:Ge.length)||0," steps"]})]},se)})})]})]}),o.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:12,padding:20},children:[o.jsx("div",{style:{fontSize:14,fontWeight:600,opacity:.7,marginBottom:12},children:"TODAY'S RECOMMENDED TRAINING"}),o.jsx(oR,{completedSessions:m,estimatedRating:x,onStartSession:(se,ke)=>{a(se),c(ke),r("session")}})]}),o.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:12,padding:20},children:[o.jsxs("div",{style:{fontSize:14,fontWeight:600,opacity:.7,marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsx("span",{children:"SKILL OVERVIEW"}),o.jsx("button",{onClick:()=>r("progress"),style:{padding:"6px 12px",background:"rgba(255,255,255,0.1)",border:"none",borderRadius:6,color:"#fff",fontSize:12,cursor:"pointer"},children:"View All "})]}),o.jsx(aR,{skills:f})]}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:16},children:[o.jsxs("div",{style:{background:"rgba(76, 175, 80, 0.1)",borderRadius:12,padding:16,textAlign:"center"},children:[o.jsx("div",{style:{fontSize:28,fontWeight:700,color:"#4CAF50"},children:$.length}),o.jsx("div",{style:{fontSize:12,opacity:.7},children:"Lessons Completed"})]}),o.jsxs("div",{style:{background:"rgba(33, 150, 243, 0.1)",borderRadius:12,padding:16,textAlign:"center"},children:[o.jsx("div",{style:{fontSize:28,fontWeight:700,color:"#2196F3"},children:U.correct}),o.jsx("div",{style:{fontSize:12,opacity:.7},children:"Puzzles Solved"})]}),o.jsxs("div",{style:{background:"rgba(255, 152, 0, 0.1)",borderRadius:12,padding:16,textAlign:"center"},children:[o.jsxs("div",{style:{fontSize:28,fontWeight:700,color:"#ff9800"},children:[U.total>0?Math.round(U.correct/U.total*100):0,"%"]}),o.jsx("div",{style:{fontSize:12,opacity:.7},children:"Puzzle Accuracy"})]})]})]}),Me=()=>o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:8},children:[o.jsx("button",{onClick:()=>r("home"),style:{padding:"8px 16px",background:"rgba(255,255,255,0.1)",border:"none",borderRadius:8,color:"#fff",cursor:"pointer"},children:" Back"}),o.jsx("h2",{style:{margin:0,fontSize:24},children:" Training Modules"})]}),["beginner","intermediate","advanced"].map(se=>{const ke=U5(se),Ge=se==="advanced"&&x<1600;return o.jsxs("div",{style:{marginBottom:16},children:[o.jsxs("div",{style:{fontSize:14,fontWeight:600,textTransform:"uppercase",opacity:Ge?.5:.8,marginBottom:12,display:"flex",alignItems:"center",gap:8},children:[se==="beginner"&&"",se==="intermediate"&&"",se==="advanced"&&"",se," (",ke.length," modules)",Ge&&o.jsx("span",{style:{fontSize:12},children:" 1600+ required"})]}),o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:12},children:ke.map(Oe=>o.jsx(sR,{module:Oe,progress:vu(Oe.id,m),locked:Ge,onClick:()=>{Ge||(a(Oe),r("module"))}},Oe.id))})]},se)})]}),ze=()=>s?o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:20},children:[o.jsx("div",{style:{display:"flex",alignItems:"center",gap:12},children:o.jsx("button",{onClick:()=>{a(null),r("training")},style:{padding:"8px 16px",background:"rgba(255,255,255,0.1)",border:"none",borderRadius:8,color:"#fff",cursor:"pointer"},children:" Back"})}),o.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:16,padding:24},children:[o.jsxs("div",{style:{display:"flex",gap:16,alignItems:"flex-start",marginBottom:20},children:[o.jsx("span",{style:{fontSize:48},children:s.icon}),o.jsxs("div",{children:[o.jsx("h2",{style:{margin:"0 0 8px 0"},children:s.name}),o.jsx("p",{style:{margin:0,opacity:.8},children:s.description}),o.jsxs("div",{style:{marginTop:12,display:"flex",gap:12},children:[o.jsxs("span",{style:{padding:"4px 12px",background:"rgba(255,255,255,0.1)",borderRadius:12,fontSize:12},children:[" ",s.estimatedTime]}),o.jsxs("span",{style:{padding:"4px 12px",background:"rgba(255,255,255,0.1)",borderRadius:12,fontSize:12},children:[" ",s.sessions.length," sessions"]})]})]})]}),o.jsxs("div",{style:{marginBottom:20},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:6},children:[o.jsx("span",{style:{fontSize:13,opacity:.7},children:"Progress"}),o.jsxs("span",{style:{fontSize:13},children:[vu(s.id,m),"%"]})]}),o.jsx("div",{style:{height:8,background:"rgba(255,255,255,0.1)",borderRadius:4,overflow:"hidden"},children:o.jsx("div",{style:{height:"100%",width:`${vu(s.id,m)}%`,background:"#4CAF50",borderRadius:4,transition:"width 0.3s"}})})]}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:s.sessions.map((se,ke)=>{var Ve;const Ge=m.includes(se.id),Oe=!Ge&&(ke===0||m.includes((Ve=s.sessions[ke-1])==null?void 0:Ve.id));return o.jsxs("div",{onClick:()=>{c(se),r("session")},style:{padding:16,background:Ge?"rgba(76,175,80,0.15)":Oe?"rgba(255,255,255,0.08)":"rgba(255,255,255,0.03)",borderRadius:12,cursor:"pointer",display:"flex",alignItems:"center",gap:16,border:Oe?"1px solid #4CAF50":"1px solid transparent",transition:"all 0.15s"},children:[o.jsx("div",{style:{width:36,height:36,borderRadius:"50%",background:Ge?"#4CAF50":"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:600},children:Ge?"":ke+1}),o.jsxs("div",{style:{flex:1},children:[o.jsx("div",{style:{fontWeight:600,marginBottom:4},children:se.name}),o.jsx("div",{style:{fontSize:13,opacity:.7},children:se.description})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsxs("span",{style:{fontSize:12,opacity:.6},children:[se.duration," min"]}),o.jsxs("span",{style:{fontSize:16},children:[se.type==="lesson"&&"",se.type==="puzzles"&&"",se.type==="game"&&""]})]})]},se.id)})})]})]}):null;return o.jsxs("div",{style:{padding:F?16:de?20:24,maxWidth:900,margin:"0 auto",paddingBottom:F?"calc(16px + env(safe-area-inset-bottom, 0))":24},children:[i==="home"&&ae(),i==="training"&&Me(),i==="module"&&ze(),i==="session"&&l&&o.jsx(W5,{session:l,module:s,userSkills:f,voice:xe,onComplete:se=>Re(l.id,se),onBack:()=>{c(null),r("module")}}),i==="analyze"&&o.jsx(V5,{game:b,userSkills:f,voice:xe,onBack:()=>r("home"),onSkillUpdate:se=>p(ke=>({...ke,...se}))}),i==="progress"&&o.jsx(K5,{skills:f,completedSessions:m,estimatedRating:x,onBack:()=>r("home")}),i==="assess"&&o.jsx(lR,{onComplete:Q,onBack:()=>r("home")}),i==="puzzles"&&o.jsx(Y5,{difficulty:S.difficulty,theme:S.theme,count:S.count,voice:xe,onComplete:se=>{var Ge;const ke={total:U.total+se.total,correct:U.correct+se.correct};if(O(ke),le({puzzleStats:ke}),se.correct/se.total>=.7){const Oe={tactics:{level:Math.min(5,(((Ge=f.tactics)==null?void 0:Ge.level)||1)+.1)}};p(Ve=>({...Ve,...Oe}))}if(r("home"),xe!=null&&xe.isEnabled){const Oe=Math.round(se.correct/se.total*100);Oe>=80?h(`Excellent work! ${Oe}% accuracy. Your tactical vision is really improving!`):Oe>=60?h(`Good effort! ${Oe}% accuracy. Keep practicing and those patterns will become second nature.`):h(`You got ${Oe}% right. Don't worry, tactics take time. Let's try some easier puzzles to build your confidence.`)}},onBack:()=>r("home")}),i==="lesson"&&X&&o.jsx(Z5,{lesson:X,voice:xe,onComplete:se=>{var Ge;const ke=(Ge=Object.entries({...e0,...t0,...n0}).find(([Oe,Ve])=>Ve.title===X.title))==null?void 0:Ge[0];if(ke&&!$.includes(ke)){const Oe=[...$,ke];q(Oe);const Ve={completed:J.completed+1,exercises:J.exercises+(se.totalExercises||0)};if(V(Ve),X.skillsImproved){const Ze={};X.skillsImproved.forEach(Ue=>{var z,ht;const tt=((z=f[Ue])==null?void 0:z.level)||1;Ze[Ue]={level:Math.min(5,tt+.2),xp:(((ht=f[Ue])==null?void 0:ht.xp)||0)+50}}),p(Ue=>({...Ue,...Ze}))}le({completedLessons:Oe,lessonStats:Ve})}K(null),r("home"),xe!=null&&xe.isEnabled&&h("Great job completing that lesson! Your understanding is growing stronger.")},onBack:()=>{K(null),r("home")}}),i==="home"&&o.jsxs("div",{style:{position:"fixed",bottom:24,left:24,display:"flex",gap:12,alignItems:"center"},children:[o.jsx("button",{onClick:n,style:{padding:"12px 20px",background:"rgba(255,255,255,0.1)",border:"none",borderRadius:8,color:"#fff",cursor:"pointer",fontSize:14},children:" Back to App"}),o.jsx(u1,{voice:xe,size:20}),xe.isSupported&&o.jsx("button",{onClick:()=>C(!R),style:{background:"rgba(255,255,255,0.1)",border:"none",borderRadius:8,padding:10,cursor:"pointer",color:"#fff",display:"flex",alignItems:"center"},title:"Voice Settings",children:o.jsx("svg",{width:20,height:20,viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"})})})]}),R&&o.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>C(!1),children:o.jsxs("div",{style:{background:"#1e1e1e",borderRadius:16,padding:24,minWidth:350,maxWidth:450},onClick:se=>se.stopPropagation(),children:[o.jsx("h3",{style:{margin:"0 0 20px 0",color:"#fff"},children:" Coach Voice Settings"}),o.jsx(tR,{voice:xe}),o.jsx("button",{onClick:()=>C(!1),style:{marginTop:20,padding:"10px 20px",background:"#444",color:"#fff",border:"none",borderRadius:8,cursor:"pointer",width:"100%"},children:"Close"})]})})]})}function bu({icon:t,title:e,description:n,onClick:i,color:r}){return o.jsxs("div",{onClick:i,style:{padding:20,background:`${r}15`,borderRadius:12,cursor:"pointer",border:`1px solid ${r}40`,transition:"all 0.15s"},children:[o.jsx("div",{style:{fontSize:32,marginBottom:12},children:t}),o.jsx("div",{style:{fontWeight:600,marginBottom:6},children:e}),o.jsx("div",{style:{fontSize:13,opacity:.7},children:n})]})}function sR({module:t,progress:e,locked:n,onClick:i}){return o.jsxs("div",{onClick:i,style:{padding:16,background:n?"rgba(255,255,255,0.02)":"rgba(255,255,255,0.05)",borderRadius:12,cursor:n?"default":"pointer",opacity:n?.5:1,transition:"all 0.15s"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:12},children:[o.jsx("span",{style:{fontSize:28},children:t.icon}),o.jsxs("div",{style:{flex:1},children:[o.jsx("div",{style:{fontWeight:600,marginBottom:2},children:t.name}),o.jsxs("div",{style:{fontSize:12,opacity:.6},children:[t.sessions.length," sessions"]})]}),e===100&&o.jsx("span",{style:{fontSize:20},children:""})]}),o.jsx("div",{style:{fontSize:13,opacity:.75,marginBottom:12},children:t.description}),o.jsx("div",{style:{height:6,background:"rgba(255,255,255,0.1)",borderRadius:3,overflow:"hidden"},children:o.jsx("div",{style:{height:"100%",width:`${e}%`,background:e===100?"#4CAF50":"#FFC107",borderRadius:3}})})]})}function aR({skills:t}){const e=Object.values(id);return o.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:12},children:e.map(n=>{const r=Object.keys(n.skills).map(a=>{var l;return((l=t[a])==null?void 0:l.level)||1}),s=r.reduce((a,l)=>a+l,0)/r.length;return o.jsxs("div",{style:{textAlign:"center",padding:12,background:"rgba(255,255,255,0.05)",borderRadius:8},children:[o.jsx("div",{style:{fontSize:24,marginBottom:8},children:n.icon}),o.jsx("div",{style:{fontSize:11,opacity:.7,marginBottom:4},children:n.name}),o.jsx("div",{style:{fontSize:18,fontWeight:700,color:n.color},children:s.toFixed(1)})]},n.id)})})}function oR({completedSessions:t,estimatedRating:e,onStartSession:n}){const i=F5();for(const r of i)for(const s of r.sessions)if(!t.includes(s.id))return o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,padding:16,background:"rgba(76,175,80,0.1)",borderRadius:12,border:"1px solid rgba(76,175,80,0.3)"},children:[o.jsx("span",{style:{fontSize:36},children:r.icon}),o.jsxs("div",{style:{flex:1},children:[o.jsx("div",{style:{fontWeight:600,marginBottom:4},children:s.name}),o.jsxs("div",{style:{fontSize:13,opacity:.7},children:[r.name,"  ",s.duration," min"]})]}),o.jsx("button",{onClick:()=>n(r,s),style:{padding:"10px 20px",background:"#4CAF50",color:"white",border:"none",borderRadius:8,fontWeight:600,cursor:"pointer"},children:"Start "})]});return o.jsx("div",{style:{textAlign:"center",padding:20,opacity:.7},children:" All sessions complete! Check back for new content."})}function lR({onComplete:t,onBack:e}){const[n,i]=N.useState(0),[r,s]=N.useState([]),a=[{type:"choice",question:"How long have you been playing chess?",options:[{label:"Just started",value:0},{label:"Less than 1 year",value:200},{label:"1-3 years",value:400},{label:"3+ years",value:600}]},{type:"choice",question:"Do you know basic checkmate patterns (back rank, smothered mate)?",options:[{label:"No",value:0},{label:"Some of them",value:150},{label:"Yes, most of them",value:300}]},{type:"choice",question:"Can you consistently spot forks, pins, and skewers?",options:[{label:"Rarely",value:0},{label:"Sometimes",value:200},{label:"Usually",value:400},{label:"Almost always",value:600}]},{type:"choice",question:"Do you have a preferred opening repertoire?",options:[{label:"No, I play random moves",value:0},{label:"I know a few openings",value:150},{label:"Yes, I have studied openings",value:300}]},{type:"choice",question:"Can you win a King + Rook vs King endgame reliably?",options:[{label:"No",value:0},{label:"Usually",value:200},{label:"Yes, always",value:300}]}],l=d=>{const h=[...r,d];if(s(h),n<a.length-1)i(n+1);else{const p=400+h.reduce((m,y)=>m+y,0);t(Math.min(Math.max(p,400),2e3))}},c=a[n];return o.jsxs("div",{style:{maxWidth:600,margin:"0 auto"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:24},children:[o.jsx("button",{onClick:e,style:{padding:"8px 16px",background:"rgba(255,255,255,0.1)",border:"none",borderRadius:8,color:"#fff",cursor:"pointer"},children:" Back"}),o.jsx("h2",{style:{margin:0},children:" Skill Assessment"})]}),o.jsx("div",{style:{height:8,background:"rgba(255,255,255,0.1)",borderRadius:4,marginBottom:32,overflow:"hidden"},children:o.jsx("div",{style:{height:"100%",width:`${(n+1)/a.length*100}%`,background:"#4CAF50",transition:"width 0.3s"}})}),o.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",borderRadius:16,padding:32},children:[o.jsxs("div",{style:{fontSize:12,opacity:.6,marginBottom:12},children:["Question ",n+1," of ",a.length]}),o.jsx("div",{style:{fontSize:20,fontWeight:600,marginBottom:24},children:c.question}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:c.options.map((d,h)=>o.jsx("button",{onClick:()=>l(d.value),style:{padding:"16px 20px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:12,color:"#fff",textAlign:"left",fontSize:15,cursor:"pointer",transition:"all 0.15s"},children:d.label},h))})]})]})}const f1=[{id:"carlsen-anand-wc2013-g5",white:"Viswanathan Anand",black:"Magnus Carlsen",result:"0-1",year:2013,event:"World Championship Chennai",category:"carlsen",title:"Carlsen Clinches World Title",description:"The game that made Carlsen World Champion at 22. A masterclass in endgame technique.",pgn:"1. c4 e6 2. d4 d5 3. Nc3 c6 4. e4 dxe4 5. Nxe4 Bb4+ 6. Nc3 c5 7. a3 Ba5 8. Nf3 Nf6 9. Be3 Nc6 10. Qd3 cxd4 11. Nxd4 Ng4 12. O-O-O Nxe3 13. fxe3 Bc7 14. Nxc6 bxc6 15. Qxd8+ Bxd8 16. Be2 Ke7 17. Bf3 Bd7 18. Ne4 Bb6 19. c5 f5 20. cxb6 fxe4 21. b7 Rab8 22. Bxe4 Rxb7 23. Rhf1 Rb5 24. Rf4 g5 25. Rf3 h5 26. Rdf1 Be8 27. Bc2 Rc5 28. Rf6 h4 29. e4 a5 30. Kd2 Rb5 31. b3 Bh5 32. Kc3 Rc5+ 33. Kb2 Rd8 34. R1f2 Rd4 35. Rh6 Bf7 36. Rh7 Ke8 37. Ra7 Bg6 38. Kc3 Rdc4+ 39. Kb2 Rb4 40. Rf3 Ke7 41. Kc3 Rxe4 42. Rb7+ Ke8 43. Kd2 a4 44. bxa4 Ra5 45. Rb4 Rxa4 46. Rxa4 Rxa4 47. Rf2 Ke7 48. Rc2 Ra6 49. Ke3 e5 50. h3 Kd6 51. Bb3 Rb6 52. Rc3 Bf7 53. Ba4 Rb2 54. Rd3+ Ke6 55. Bc6 Rg2 56. a4 Rxg3+ 57. Ke4 Be8 58. Bb5 Rg4+ 0-1"},{id:"carlsen-anand-wc2014-g6",white:"Magnus Carlsen",black:"Viswanathan Anand",result:"1-0",year:2014,event:"World Championship Sochi",category:"carlsen",title:"The King's Endgame",description:"Carlsen's king march in the endgame became an instant classic.",pgn:"1. e4 e5 2. Nf3 Nc6 3. Bb5 Nf6 4. d3 Bc5 5. c3 O-O 6. O-O Re8 7. Re1 a6 8. Ba4 b5 9. Bb3 d6 10. Bg5 Be6 11. Nbd2 h6 12. Bh4 Bxb3 13. axb3 Nb8 14. h3 Nbd7 15. Nh2 Qe7 16. Ndf1 Bb6 17. Ne3 Qe6 18. b4 a5 19. bxa5 Bxa5 20. Nhg4 Bb6 21. Bxf6 Nxf6 22. Nxf6+ Qxf6 23. Qg4 Bxe3 24. fxe3 Qe7 25. Rf1 c5 26. Kh2 c4 27. d4 exd4 28. cxd4 Qe6 29. Qxe6 Rxe6 30. e5 dxe5 31. dxe5 Rxe5 32. Rxf7 Rc8 33. Rb7 Re2 34. Kh1 Rc6 35. Raa7 Rg6 36. Rxg7+ Rxg7 37. Rxg7+ Kf8 38. Rb7 Re5 39. b4 Kf7 40. b5 Kf6 41. b6 Ke6 42. b7 Rb5 43. Kh2 Kd6 44. Kg3 Kc6 45. Kg4 Rb1 46. Kg5 Rb5+ 47. Kh6 1-0"},{id:"carlsen-karjakin-wc2016-g10",white:"Sergey Karjakin",black:"Magnus Carlsen",result:"0-1",year:2016,event:"World Championship New York",category:"carlsen",title:"Breaking Karjakin's Defense",description:"After a tense match, Carlsen finally broke through Karjakin's solid defense.",pgn:"1. e4 e5 2. Nf3 Nc6 3. Bb5 Nf6 4. O-O Nxe4 5. Re1 Nd6 6. Nxe5 Be7 7. Bf1 Nxe5 8. Rxe5 O-O 9. d4 Bf6 10. Re1 Re8 11. Bf4 Rxe1 12. Qxe1 Ne8 13. c3 d5 14. Bd3 g6 15. Na3 Ng7 16. Qe2 c6 17. Re1 Bf5 18. Bxf5 Nxf5 19. Nc2 Ng7 20. Qd3 Ne6 21. Be3 Qc7 22. h3 Re8 23. Ne1 Kg7 24. Nf3 Qd7 25. Qb1 h6 26. b4 Rc8 27. Rc1 a6 28. a4 Rc7 29. Qb3 Bg5 30. Nxg5 Nxg5 31. a5 Ne6 32. Qd1 Rc8 33. Qg4 Kf6 34. Qd1 Nc7 35. Qf3+ Ke7 36. Qe2+ Kf6 37. Qf3+ Ke7 38. Qe2+ Kf8 39. Qd3 Nd5 40. c4 Nf6 41. Bd2 Ke7 42. c5 Qf5 43. Qxf5 gxf5 44. Kf1 Ra8 45. Rc3 Kd7 46. Ke2 Rg8 47. g3 Ra8 48. Kd3 Rg8 49. Ke2 h5 50. Kf1 Ra8 51. Ke2 Ke6 52. Kd3 h4 53. g4 fxg4 54. hxg4 Rg8 55. f3 Ra8 56. Ke2 Kd7 57. Kd3 Kc8 58. Kc2 Kb8 59. Kb3 Ka7 60. Ka4 Ka8 61. Kb3 Kb8 62. Be1 Kc8 63. Bd2 Kd7 64. Be1 Rg8 65. Bf2 Ra8 66. Be1 Ke6 67. Bf2 Rg8 68. Kc2 Nd7 69. Kd3 Rg6 70. Ke3 Nf6 71. Kf4 Kd7 72. Kf5 Ke7 73. Be3 Nd7 74. Bd2 Nf6 75. Be3 Nd7 0-1"},{id:"carlsen-topalov-2015",white:"Magnus Carlsen",black:"Veselin Topalov",result:"1-0",year:2015,event:"Gashimov Memorial",category:"carlsen",title:"Knight Dominates Bishop",description:"A classic demonstration of knight superiority over bishop in a closed position.",pgn:"1. e4 c6 2. d4 d5 3. e5 Bf5 4. Nf3 e6 5. Be2 c5 6. Be3 cxd4 7. Nxd4 Ne7 8. O-O Nbc6 9. Bb5 a6 10. Bxc6+ Nxc6 11. Nxf5 exf5 12. Qd2 Be7 13. c4 d4 14. Bf4 O-O 15. Rd1 Qb6 16. b3 Rfd8 17. Na3 Rd7 18. Nc2 Rad8 19. Qe2 g6 20. h3 a5 21. a4 Nb4 22. Nxb4 Bxb4 23. Qf3 Qe6 24. Rd2 Rc8 25. Rc1 Rdc7 26. Kh2 h5 27. Rd3 Kg7 28. Rb1 Bc5 29. g3 Bb4 30. Kg2 Qe8 31. Rbd1 Qe7 32. Qe2 Bc5 33. h4 Bb4 34. Qf3 Bc5 35. Rb1 f6 36. exf6+ Qxf6 37. Qxf5 Qxf5 38. Bxc7 Rxc7 39. Rxd4 Qc2 40. Rd5 Bf8 41. Rf1 b6 42. Rd8 Qe4+ 43. Rf3 Qe8 44. Rxe8 1-0"},{id:"carlsen-gelfand-2013",white:"Boris Gelfand",black:"Magnus Carlsen",result:"0-1",year:2013,event:"Zurich Chess Challenge",category:"carlsen",title:"Tactical Precision",description:"Carlsen shows brilliant tactical vision in a complex middlegame.",pgn:"1. d4 Nf6 2. c4 e6 3. Nc3 Bb4 4. Qc2 d5 5. a3 Bxc3+ 6. Qxc3 Ne4 7. Qc2 c5 8. dxc5 Nc6 9. e3 Qa5+ 10. Bd2 Nxd2 11. Qxd2 Qxc5 12. cxd5 exd5 13. Nf3 O-O 14. Be2 Bg4 15. O-O Rfe8 16. Rac1 Qe7 17. Nd4 Bxe2 18. Nxe2 Qe4 19. Nf4 Rad8 20. Qd3 Qxd3 21. Nxd3 Rd6 22. Rc5 Red8 23. Nb4 Nxb4 24. axb4 d4 25. exd4 Rxd4 26. Re1 Rb8 27. Rc7 Rd2 28. Ree7 Rxb2 29. Rxf7 Rxb4 30. Rxg7+ Kf8 31. Rgf7+ Kg8 32. Rg7+ Kh8 33. Rxh7+ Kg8 34. Rcg7+ Kf8 35. Rd7 Rg4 36. f3 Re4 37. Rdf7+ Ke8 38. Re7+ Kd8 39. Rxe4 Kxd7 40. Re5 a5 41. Kf2 Kc6 42. Ke3 b5 43. f4 b4 44. Kd4 a4 45. f5 a3 46. f6 Rb6 47. Re6+ Kd7 48. Rxb6 a2 49. Rb7+ Kc6 50. Ra7 a1=Q 51. Rxa1 b3 52. f7 b2 53. Rb1 Kc7 54. Kc5 Kd8 55. Rxb2 Ke7 56. Rb7+ Kf8 57. Kd6 1-0"},{id:"carlsen-aronian-2012",white:"Magnus Carlsen",black:"Levon Aronian",result:"1-0",year:2012,event:"Wijk aan Zee",category:"carlsen",title:"Positional Squeeze",description:"Carlsen slowly squeezes his opponent in a long endgame.",pgn:"1. d4 Nf6 2. c4 e6 3. Nc3 Bb4 4. e3 O-O 5. Bd3 c5 6. Nf3 d5 7. O-O dxc4 8. Bxc4 cxd4 9. exd4 b6 10. Bg5 Bb7 11. Qe2 Nbd7 12. Rac1 Rc8 13. Bd3 Bxc3 14. bxc3 Qc7 15. c4 Bxf3 16. Qxf3 Rfe8 17. Rfd1 h6 18. Bh4 Qd6 19. c5 bxc5 20. dxc5 Qc7 21. Bb5 Red8 22. Qe2 a6 23. Ba4 Qc6 24. Bb3 Ne4 25. Rxd8+ Nxd8 26. Rd1 Nc7 27. Bg3 Nf6 28. f3 Ncd5 29. Bf2 Qc7 30. Kh1 Kf8 31. Qe5 Qxe5 32. Bxe5 Nd7 33. Bd6+ Ke8 34. a4 f6 35. Bxd5 exd5 36. Rxd5 1-0"},{id:"carlsen-nepomniachtchi-wc2021-g6",white:"Magnus Carlsen",black:"Ian Nepomniachtchi",result:"1-0",year:2021,event:"World Championship Dubai",category:"carlsen",title:"The 136-Move Marathon",description:"The longest World Championship game in history. Carlsen's endgame technique at its finest.",pgn:"1. d4 Nf6 2. Nf3 d5 3. g3 e6 4. Bg2 Be7 5. O-O O-O 6. b3 c5 7. dxc5 Bxc5 8. c4 dxc4 9. Qc2 Qe7 10. Nbd2 Nc6 11. Nxc4 b5 12. Nce5 Nb4 13. Qb2 Bb7 14. a3 Nc6 15. Nd3 Bb6 16. Bg5 Rfd8 17. Bxf6 gxf6 18. Rac1 Nd4 19. Nxd4 Bxd4 20. Qa2 Bxg2 21. Kxg2 Qb7+ 22. Kg1 Qe4 23. Qc2 a5 24. Qxe4 1-0"},{id:"carlsen-praggnanandhaa-2024",white:"Magnus Carlsen",black:"R. Praggnanandhaa",result:"1-0",year:2024,event:"Norway Chess",category:"carlsen",title:"Teaching the Prodigy",description:"Carlsen gives a masterclass against the rising Indian star.",pgn:"1. c4 e5 2. g3 Nf6 3. Bg2 d5 4. cxd5 Nxd5 5. Nc3 Nb6 6. Nf3 Nc6 7. O-O Be7 8. d3 O-O 9. Be3 Be6 10. Na4 Nxa4 11. Qxa4 f6 12. Rfc1 Qd7 13. Qa3 Rfd8 14. Rc2 Bf8 15. Qb3 Qf7 16. Rac1 Nd4 17. Bxd4 exd4 18. Qxb7 Rab8 19. Qa6 Rb6 20. Qa4 a5 21. Nd2 Bf5 22. Nc4 Rb4 23. Qa3 Rd5 24. b3 Bc5 25. Na5 Rb7 26. Nc6 1-0"}],p1=[{id:"fischer-byrne-1956",white:"Donald Byrne",black:"Robert James Fischer",result:"0-1",year:1956,event:"Third Rosenwald Trophy",category:"fischer",title:"The Game of the Century",description:"13-year-old Fischer's queen sacrifice against one of America's top masters. Called 'The Game of the Century' by Hans Kmoch.",pgn:"1. Nf3 Nf6 2. c4 g6 3. Nc3 Bg7 4. d4 O-O 5. Bf4 d5 6. Qb3 dxc4 7. Qxc4 c6 8. e4 Nbd7 9. Rd1 Nb6 10. Qc5 Bg4 11. Bg5 Na4 12. Qa3 Nxc3 13. bxc3 Nxe4 14. Bxe7 Qb6 15. Bc4 Nxc3 16. Bc5 Rfe8+ 17. Kf1 Be6 18. Bxb6 Bxc4+ 19. Kg1 Ne2+ 20. Kf1 Nxd4+ 21. Kg1 Ne2+ 22. Kf1 Nc3+ 23. Kg1 axb6 24. Qb4 Ra4 25. Qxb6 Nxd1 26. h3 Rxa2 27. Kh2 Nxf2 28. Re1 Rxe1 29. Qd8+ Bf8 30. Nxe1 Bd5 31. Nf3 Ne4 32. Qb8 b5 33. h4 h5 34. Ne5 Kg7 35. Kg1 Bc5+ 36. Kf1 Ng3+ 37. Ke1 Bb4+ 38. Kd1 Bb3+ 39. Kc1 Ne2+ 40. Kb1 Nc3+ 41. Kc1 Rc2# 0-1"},{id:"fischer-spassky-1972-g6",white:"Robert James Fischer",black:"Boris Spassky",result:"1-0",year:1972,event:"World Championship Reykjavik",category:"fischer",title:"Fischer's Queen's Gambit Masterpiece",description:"Considered by many Fischer's finest game. A brilliant exchange sacrifice and queen maneuver.",pgn:"1. c4 e6 2. Nf3 d5 3. d4 Nf6 4. Nc3 Be7 5. Bg5 O-O 6. e3 h6 7. Bh4 b6 8. cxd5 Nxd5 9. Bxe7 Qxe7 10. Nxd5 exd5 11. Rc1 Be6 12. Qa4 c5 13. Qa3 Rc8 14. Bb5 a6 15. dxc5 bxc5 16. O-O Ra7 17. Be2 Nd7 18. Nd4 Qf8 19. Nxe6 fxe6 20. e4 d4 21. f4 Qe7 22. e5 Rb8 23. Bc4 Kh8 24. Qh3 Nf8 25. b3 a5 26. f5 exf5 27. Rxf5 Nh7 28. Rcf1 Qd8 29. Qg3 Re7 30. h4 Rbb7 31. e6 Rbc7 32. Qe5 Qe8 33. a4 Qd8 34. R1f2 Qe8 35. R2f3 Qd8 36. Bd3 Qe8 37. Qe4 Nf6 38. Rxf6 gxf6 39. Rxf6 Kg8 40. Bc4 Kh8 41. Qf4 1-0"},{id:"fischer-spassky-1972-g13",white:"Boris Spassky",black:"Robert James Fischer",result:"0-1",year:1972,event:"World Championship Reykjavik",category:"fischer",title:"The Alekhine's Defense Game",description:"Fischer surprises Spassky with the Alekhine's Defense for the first time in his career.",pgn:"1. e4 Nf6 2. e5 Nd5 3. d4 d6 4. Nf3 g6 5. Bc4 Nb6 6. Bb3 Bg7 7. Nbd2 O-O 8. h3 a5 9. a4 dxe5 10. dxe5 Na6 11. O-O Nc5 12. Qe2 Qe8 13. Ne4 Nbxa4 14. Bxa4 Nxa4 15. Re1 Nb6 16. Bd2 a4 17. Bg5 h6 18. Bh4 Bf5 19. g4 Be6 20. Nd4 Bc4 21. Qd2 Qd7 22. Rad1 Rfe8 23. f4 Bd5 24. Nc5 Qc8 25. Qc3 e6 26. Kh2 Nd7 27. Nd3 c5 28. Nb5 Qc6 29. Nd6 Qxd6 30. exd6 Bxc3 31. bxc3 f6 32. g5 hxg5 33. fxg5 f5 34. Bg3 Kf7 35. Ne5+ Nxe5 36. Bxe5 b5 37. Rf1 Rh8 38. Bf6 a3 39. Rf4 a2 40. c4 Bxc4 41. d7 Bd5 42. Kg3 Ra3+ 43. c3 Rha8 44. Rh4 e5 45. Rh7+ Ke6 46. Re7+ Kd6 47. Rxe5 Rxc3+ 48. Kf2 Rc2+ 49. Ke1 Kxd7 50. Rexd5+ Kc6 51. Rd6+ Kb7 52. Rd7+ Ka6 53. R7d2 Rxd2 54. Kxd2 b4 55. h4 Kb5 56. h5 c4 57. Ra1 gxh5 58. g6 h4 59. g7 h3 60. Be7 Rg8 61. Bf8 h2 62. Kc2 Kc6 63. Rd1 b3+ 64. Kc3 a1=Q 65. Rxa1 b2 66. Kxb2 c3+ 67. Kb1 h1=Q+ 68. Bc1 Qxd1 69. g8=Q Rxg8 70. Ba3 Rg1 71. Kxd1 c2+ 72. Kd2 c1=Q+ 73. Kxc1 0-1"},{id:"fischer-larsen-1971",white:"Robert James Fischer",black:"Bent Larsen",result:"1-0",year:1971,event:"Candidates Match Denver",category:"fischer",title:"Fischer Crushes Larsen 6-0",description:"The first game of Fischer's historic 6-0 demolition of the Danish grandmaster.",pgn:"1. e4 e5 2. Nf3 Nc6 3. Bb5 a6 4. Ba4 Nf6 5. O-O Be7 6. Re1 b5 7. Bb3 d6 8. c3 O-O 9. h3 Nb8 10. d4 Nbd7 11. Nbd2 Bb7 12. Bc2 Re8 13. Nf1 Bf8 14. Ng3 g6 15. Bg5 h6 16. Bd2 Bg7 17. a4 c5 18. d5 c4 19. b4 Nh7 20. Be3 h5 21. Qd2 Rf8 22. Ra3 Ndf6 23. Rea1 Qd7 24. axb5 axb5 25. Ra7 Rfc8 26. R1a3 Qe7 27. Nf1 Bc8 28. N1h2 Qe8 29. Qa2 Bf8 30. Qa6 Qd7 31. Nf1 Qe7 32. Ng3 Bd7 33. Bxc4 bxc4 34. Rxd7 Qxd7 35. Qxc8 Rxc8 36. Rxa8 Qc7 37. Rxc8 Qxc8 38. Nxe5 1-0"},{id:"fischer-taimanov-1971",white:"Robert James Fischer",black:"Mark Taimanov",result:"1-0",year:1971,event:"Candidates Match Vancouver",category:"fischer",title:"The Sicilian Slayer",description:"Fischer's dominant win in the first game of another 6-0 match victory.",pgn:"1. e4 c5 2. Nf3 Nc6 3. d4 cxd4 4. Nxd4 Qc7 5. Nc3 e6 6. g3 a6 7. Bg2 Nf6 8. O-O Be7 9. Re1 O-O 10. Nxc6 bxc6 11. e5 Nd5 12. Ne4 Rb8 13. Nd6 Rxb2 14. Bxd5 cxd5 15. Rb1 Rxb1 16. Qxb1 Ba3 17. Bg5 Bxg5 18. Qb8 Qxb8 19. Nxb8 f6 20. Nd7 Re8 21. exf6 gxf6 22. Nxf6+ Kf7 23. Nxe8 Kxe8 24. c3 Bf6 25. Rc1 Be5 26. Rb1 Kf7 27. Rb8 Bc7 28. Ra8 a5 29. f4 Bd8 30. Kf2 Bb7 31. Rh8 Kg6 32. g4 1-0"},{id:"fischer-petrosian-1971",white:"Robert James Fischer",black:"Tigran Petrosian",result:"1-0",year:1971,event:"Candidates Final Buenos Aires",category:"fischer",title:"Breaking the Iron Tiger",description:"Fischer breaks through Petrosian's legendary defensive skills.",pgn:"1. e4 c5 2. Nf3 e6 3. d4 cxd4 4. Nxd4 a6 5. Bd3 Nc6 6. Nxc6 bxc6 7. O-O d5 8. c4 Nf6 9. cxd5 cxd5 10. exd5 exd5 11. Nc3 Be7 12. Qa4+ Qd7 13. Qxd7+ Bxd7 14. Nb5 Bxb5 15. Bxb5+ Kd8 16. Bf4 Rc8 17. Bc7+ Ke8 18. Bd6 Bxd6 19. Bxa6 Ra8 20. Bb7 Rxa2 21. Bxd5 Nxd5 22. Rxa2 Kd7 23. Rd1 Rb8 24. b3 Kc6 25. Rad2 Bf4 26. Rd4 Be5 27. Rxd5 Rb4 28. Rd8 Rxb3 29. R1d5 Bf6 30. R8d6+ Kb5 31. Rxf6 gxf6 32. Rxf7 Kc4 33. Rxf6 1-0"},{id:"fischer-reshevsky-1961",white:"Robert James Fischer",black:"Samuel Reshevsky",result:"1-0",year:1961,event:"US Championship",category:"fischer",title:"The Rivalry Game",description:"Fischer defeats his longtime rival in a beautiful attacking game.",pgn:"1. e4 c5 2. Nf3 Nc6 3. d4 cxd4 4. Nxd4 g6 5. Nc3 Bg7 6. Be3 Nf6 7. Bc4 O-O 8. Bb3 Na5 9. f3 d6 10. Qd2 Bd7 11. O-O-O Rc8 12. g4 Nxb3+ 13. axb3 a6 14. h4 h5 15. gxh5 Nxh5 16. Rdg1 Kh7 17. Qg2 e6 18. Bh6 Bxh6+ 19. Qxh6+ Kg8 20. Qg5 b5 21. Nce2 Qf6 22. Qh6 Nf4 23. Nxf4 Qxf4+ 24. Kb1 Qf6 25. Nc6 Bxc6 26. Rxg6+ fxg6 27. Qxg6+ Qg7 28. Qxe6+ Kh8 29. Qxc6 1-0"},{id:"fischer-benko-1963",white:"Robert James Fischer",black:"Pal Benko",result:"1-0",year:1963,event:"US Championship",category:"fischer",title:"The Perfect Game",description:"Fischer's attacking masterpiece - considered one of his most brilliant games.",pgn:"1. e4 g6 2. d4 Bg7 3. Nc3 d6 4. f4 Nf6 5. Nf3 O-O 6. Bd3 Bg4 7. h3 Bxf3 8. Qxf3 Nc6 9. Be3 e5 10. dxe5 dxe5 11. f5 gxf5 12. Qxf5 Nd4 13. Qf2 Ne8 14. O-O Nd6 15. Qg3 Kh8 16. Qg4 c6 17. Qh5 Qe8 18. Bxd4 exd4 19. Rf6 Kg8 20. e5 h6 21. Ne2 Bxf6 22. Qxf6 Nf5 23. Bxf5 1-0"}],m1=[{id:"morphy-opera-1858",white:"Paul Morphy",black:"Duke of Brunswick & Count Isouard",result:"1-0",year:1858,event:"Paris Opera House",category:"morphy",title:"The Opera Game",description:"The most famous chess game ever played. Morphy sacrifices his queen to deliver a beautiful checkmate in just 17 moves.",pgn:"1. e4 e5 2. Nf3 d6 3. d4 Bg4 4. dxe5 Bxf3 5. Qxf3 dxe5 6. Bc4 Nf6 7. Qb3 Qe7 8. Nc3 c6 9. Bg5 b5 10. Nxb5 cxb5 11. Bxb5+ Nbd7 12. O-O-O Rd8 13. Rxd7 Rxd7 14. Rd1 Qe6 15. Bxd7+ Nxd7 16. Qb8+ Nxb8 17. Rd8# 1-0"},{id:"morphy-paulsen-1857",white:"Paul Morphy",black:"Louis Paulsen",result:"1-0",year:1857,event:"First American Chess Congress",category:"morphy",title:"Morphy's Congress Brilliancy",description:"A stunning queen sacrifice leads to an unstoppable mating attack.",pgn:"1. e4 e5 2. Nf3 Nc6 3. Bc4 Nf6 4. d4 exd4 5. O-O Nxe4 6. Re1 d5 7. Bxd5 Qxd5 8. Nc3 Qh5 9. Nxe4 Be6 10. Neg5 Bb4 11. Rxe6+ fxe6 12. Nxe6 Qf7 13. Nfg5 Qe7 14. Qe2 Bd6 15. Nxg7+ Kd7 16. Qg4+ Kd8 17. Nf7+ Qxf7 18. Bg5+ Be7 19. Ne6+ Kc8 20. Nc5+ Kb8 21. Nd7+ Kc8 22. Nb6+ Kb8 23. Qc8+ Rxc8 24. Nd7# 1-0"},{id:"morphy-anderssen-1858",white:"Paul Morphy",black:"Adolf Anderssen",result:"1-0",year:1858,event:"Casual Game, Paris",category:"morphy",title:"Morphy vs The Immortal Game Master",description:"Morphy defeats Anderssen, considered the world's best player before Morphy's arrival.",pgn:"1. e4 e5 2. Nf3 Nc6 3. Bc4 Bc5 4. b4 Bxb4 5. c3 Ba5 6. d4 exd4 7. O-O d3 8. Qb3 Qf6 9. e5 Qg6 10. Re1 Nge7 11. Ba3 b5 12. Qxb5 Rb8 13. Qa4 Bb6 14. Nbd2 Bb7 15. Ne4 Qf5 16. Bxd3 Qh5 17. Nf6+ gxf6 18. exf6 Rg8 19. Rad1 Qxf3 20. Rxe7+ Nxe7 21. Qxd7+ Kxd7 22. Bf5+ Ke8 23. Bd7+ Kf8 24. Bxe7# 1-0"},{id:"morphy-bird-1858",white:"Paul Morphy",black:"Henry Bird",result:"1-0",year:1858,event:"London",category:"morphy",title:"The Bird Catcher",description:"Morphy's brilliant attack features sacrifices on f7 and h7.",pgn:"1. e4 e5 2. Nf3 d6 3. d4 f5 4. Nc3 fxe4 5. Nxe4 d5 6. Ng3 e4 7. Ne5 Nf6 8. Bg5 Bd6 9. Nh5 O-O 10. Qd2 Qe8 11. g4 Nxg4 12. Nxg4 Qxh5 13. Ne5 Qh3 14. Bc4 dxc4 15. Bf6 Qf5 16. Qg5 Qxg5 17. Bxg5 Bxe5 18. dxe5 Rf5 19. f4 exf3 20. Rf1 Nd7 21. Rxf3 Rxf3 22. e6 Nf6 23. Bxf6 gxf6 24. e7 Re8 25. Kd2 Rf2+ 26. Kc3 Rxe7 27. Rxf2 1-0"},{id:"morphy-mongredien-1859",white:"Paul Morphy",black:"Augustus Mongredien",result:"1-0",year:1859,event:"Paris",category:"morphy",title:"Queen Sacrifice Elegance",description:"Another beautiful queen sacrifice leading to a forced mate.",pgn:"1. e4 e5 2. Nf3 Nc6 3. Bc4 Bc5 4. b4 Bxb4 5. c3 Ba5 6. d4 exd4 7. e5 d3 8. Qb3 Qe7 9. O-O Nh6 10. Ba3 c5 11. Rd1 Bb6 12. Rxd3 O-O 13. Nbd2 Qc7 14. Rae1 Ng4 15. h3 Ngxe5 16. Nxe5 Nxe5 17. Qxf7+ Nxf7 18. Re8# 1-0"},{id:"morphy-harrwitz-1858",white:"Paul Morphy",black:"Daniel Harrwitz",result:"1-0",year:1858,event:"Paris Match",category:"morphy",title:"The Paris Match Victory",description:"A key game from Morphy's match against the strong German master.",pgn:"1. e4 e5 2. Nf3 Nc6 3. d4 exd4 4. Bc4 Bb4+ 5. c3 dxc3 6. bxc3 Ba5 7. e5 d6 8. Qb3 Qe7 9. O-O dxe5 10. Ba3 Qf6 11. Rd1 Bb6 12. Rxd8+ Nxd8 13. Qc2 Bd7 14. Bb5 Bc6 15. Bxc6+ Nxc6 16. Nxe5 Nxe5 17. Qxe5+ Qxe5 18. Re1 Qxe1+ 19. Nxe1 Kd7 20. Nc2 Nf6 21. Bb4 Re8 22. a4 c5 23. Bc3 Re2 24. a5 Bc7 25. Bxf6 gxf6 26. Nb4 Rxf2 27. Nd5 Rf5 28. Nxc7 Kxc7 29. a6 b6 30. Kf2 Rf4 31. Ke3 Ra4 32. Kd3 Kd6 33. c4 Ke5 34. Kc3 f5 35. Kb3 Ra1 36. c3 f4 37. Kc2 f3 38. gxf3 Kf4 39. Kd3 Kxf3 40. c4 Kf4 41. Kc3 Ke4 42. Kb3 Ra5 1-0"},{id:"morphy-mcconnell-1850",white:"Paul Morphy",black:"James McConnell",result:"1-0",year:1850,event:"New Orleans",category:"morphy",title:"The Young Prodigy",description:"Morphy at age 12 defeats an experienced opponent with a brilliant attack.",pgn:"1. e4 e5 2. Nf3 Nc6 3. Bc4 Bc5 4. c3 d6 5. d4 exd4 6. cxd4 Bb6 7. h3 Nf6 8. Nc3 O-O 9. Be3 Ne7 10. Qd3 c6 11. O-O-O Ng6 12. g4 d5 13. exd5 cxd5 14. Bb5 a6 15. Bd3 Bc7 16. h4 b5 17. g5 Nd7 18. h5 Nf4 19. Bxf4 Bxf4+ 20. Kb1 Nb6 21. g6 fxg6 22. hxg6 h6 23. Qf5 Bxf5 24. Bxf5 Rf6 25. Rde1 Qd6 26. Re8+ Rxe8 27. Rh4 Bg3 28. Rg4 Bf4 29. Rxf4 1-0"},{id:"morphy-lowenthal-1858",white:"Paul Morphy",black:"Johann Lowenthal",result:"1-0",year:1858,event:"London Match",category:"morphy",title:"London Dominance",description:"Morphy demonstrates his superiority against the Hungarian master.",pgn:"1. e4 e5 2. Nf3 Nc6 3. Bc4 Bc5 4. b4 Bxb4 5. c3 Ba5 6. d4 exd4 7. O-O Nge7 8. cxd4 d5 9. exd5 Nxd5 10. Ba3 Be6 11. Bb5 Bb6 12. Qa4 O-O 13. Bxc6 bxc6 14. Qxc6 Bd7 15. Qd6 Bc8 16. Nc3 Nxc3 17. Qxd8 Rxd8 18. Rac1 Ne4 19. Rxc8 Rxc8 20. Bb4 a5 21. Bd6 Bxd4 22. Nxd4 Nxd6 23. Nb5 Nxb5 24. Rxb5 Rd8 25. Rxb5 1-0"}],cR={carlsen:f1,fischer:p1,morphy:m1};function dR(){return[...f1,...p1,...m1]}function l0(t){return cR[t]||[]}const c0=[{id:"morphy-opera-1858",white:"Paul Morphy",black:"Duke of Brunswick & Count Isouard",result:"1-0",year:1858,event:"Paris Opera House",category:"morphy",title:"The Opera Game",description:"Perhaps the most famous chess game ever played. Morphy sacrifices both rooks and his queen to deliver a beautiful checkmate.",pgn:"1. e4 e5 2. Nf3 d6 3. d4 Bg4 4. dxe5 Bxf3 5. Qxf3 dxe5 6. Bc4 Nf6 7. Qb3 Qe7 8. Nc3 c6 9. Bg5 b5 10. Nxb5 cxb5 11. Bxb5+ Nbd7 12. O-O-O Rd8 13. Rxd7 Rxd7 14. Rd1 Qe6 15. Bxd7+ Nxd7 16. Qb8+ Nxb8 17. Rd8# 1-0"},{id:"morphy-paulsen-1857",white:"Paul Morphy",black:"Louis Paulsen",result:"1-0",year:1857,event:"First American Chess Congress",category:"morphy",title:"Morphy's Brilliancy",description:"A stunning queen sacrifice leads to an unstoppable attack.",pgn:"1. e4 e5 2. Nf3 Nc6 3. Bc4 Nf6 4. d4 exd4 5. O-O Nxe4 6. Re1 d5 7. Bxd5 Qxd5 8. Nc3 Qh5 9. Nxe4 Be6 10. Neg5 Bb4 11. Rxe6+ fxe6 12. Nxe6 Qf7 13. Nfg5 Qe7 14. Qe2 Bd6 15. Nxg7+ Kd7 16. Qg4+ Kd8 17. Nf7+ Qxf7 18. Bg5+ Be7 19. Ne6+ Kc8 20. Nc5+ Kb8 21. Nd7+ Kc8 22. Nb6+ Kb8 23. Qc8+ Rxc8 24. Nd7# 1-0"},{id:"steinitz-bardeleben-1895",white:"Wilhelm Steinitz",black:"Curt von Bardeleben",result:"1-0",year:1895,event:"Hastings",category:"steinitz",title:"Steinitz's Immortal",description:"Von Bardeleben left the board without resigning, seeing the forced mate. Steinitz demonstrated the winning line to spectators.",pgn:"1. e4 e5 2. Nf3 Nc6 3. Bc4 Bc5 4. c3 Nf6 5. d4 exd4 6. cxd4 Bb4+ 7. Nc3 d5 8. exd5 Nxd5 9. O-O Be6 10. Bg5 Be7 11. Bxd5 Bxd5 12. Nxd5 Qxd5 13. Bxe7 Nxe7 14. Re1 f6 15. Qe2 Qd7 16. Rac1 c6 17. d5 cxd5 18. Nd4 Kf7 19. Ne6 Rhc8 20. Qg4 g6 21. Ng5+ Ke8 22. Rxe7+ Kf8 23. Rf7+ Kg8 24. Rg7+ Kh8 25. Rxh7+ 1-0"},{id:"lasker-capablanca-1914",white:"Emanuel Lasker",black:"Jose Raul Capablanca",result:"1-0",year:1914,event:"St. Petersburg",category:"lasker",title:"Lasker's Tournament Victory",description:"Lasker defeats Capablanca in their first serious encounter, showing his legendary fighting spirit.",pgn:"1. e4 e5 2. Nf3 Nc6 3. Bb5 a6 4. Bxc6 dxc6 5. d4 exd4 6. Qxd4 Qxd4 7. Nxd4 Bd6 8. Nc3 Ne7 9. O-O O-O 10. f4 Re8 11. Nb3 f6 12. f5 b6 13. Bf4 Bb7 14. Bxd6 cxd6 15. Nd4 Rad8 16. Ne6 Rd7 17. Rad1 Nc8 18. Rf2 b5 19. Rfd2 Rde7 20. b4 Kf7 21. a3 Ba8 22. Kf2 Ra7 23. g4 h6 24. Rd3 a5 25. h4 axb4 26. axb4 Rae7 27. Kf3 Rg8 28. Kf4 g6 29. Rg3 g5+ 30. Kf3 Nb6 31. hxg5 hxg5 32. Rh3 Rd7 33. Kg3 Ke8 34. Rdh1 Bb7 35. e5 dxe5 36. Ne4 Nd5 37. N6c5 Bc8 38. Nxd7 Bxd7 39. Rh7 Rf8 40. Ra1 Kd8 41. Ra8+ Bc8 42. Nc5 1-0"},{id:"capablanca-marshall-1918",white:"Jose Raul Capablanca",black:"Frank Marshall",result:"1-0",year:1918,event:"New York",category:"capablanca",title:"Marshall Attack Debut",description:"Marshall unveils his famous gambit, prepared for years. Capablanca defends brilliantly over the board.",pgn:"1. e4 e5 2. Nf3 Nc6 3. Bb5 a6 4. Ba4 Nf6 5. O-O Be7 6. Re1 b5 7. Bb3 O-O 8. c3 d5 9. exd5 Nxd5 10. Nxe5 Nxe5 11. Rxe5 Nf6 12. Re1 Bd6 13. h3 Ng4 14. Qf3 Qh4 15. d4 Nxf2 16. Re2 Bg4 17. hxg4 Bh2+ 18. Kf1 Bg3 19. Rxf2 Qh1+ 20. Ke2 Bxf2 21. Bd2 Bh4 22. Qh3 Rae8+ 23. Kd3 Qf1+ 24. Kc2 Bf2 25. Qf3 Qg1 26. Bd5 c5 27. dxc5 Bxc5 28. b4 Bd6 29. a4 a5 30. axb5 axb4 31. Ra6 bxc3 32. Nxc3 Bb4 33. b6 Bxc3 34. Bxc3 h6 35. b7 Re3 36. Bxf7+ 1-0"},{id:"alekhine-reti-1925",white:"Alexander Alekhine",black:"Richard Reti",result:"1-0",year:1925,event:"Baden-Baden",category:"alekhine",title:"Alekhine's Immortal",description:"A cascade of sacrifices leads to a beautiful finish against the founder of hypermodern chess.",pgn:"1. e4 e5 2. Nf3 Nc6 3. Bb5 a6 4. Ba4 Nf6 5. O-O Be7 6. Re1 b5 7. Bb3 d6 8. c3 Na5 9. Bc2 c5 10. d4 Qc7 11. Nbd2 O-O 12. Nf1 Nc6 13. Ne3 Bd7 14. dxe5 dxe5 15. Nh4 g6 16. Nhf5 Rfe8 17. Qf3 Be6 18. Ng7 Bf8 19. N7xe6 fxe6 20. Bxg6 hxg6 21. Nxg6 Ng4 22. Nxf8+ Kxf8 23. Qh3 Qf7 24. Qh7 Qf6 25. Bh6+ Ke7 26. Qxg4 Rg8 27. Qh4 Qxh4 28. Bxh4+ Kd6 29. f3 Ne7 30. Rad1+ Kc7 31. Bf2 Rad8 32. Rxd8 Rxd8 33. Bxc5 Nc6 34. b4 a5 35. a3 axb4 36. axb4 Ra8 37. Rd1 Nd8 38. Be3 Nf7 39. Rd7+ Kc6 40. Rxf7 1-0"},{id:"tal-larsen-1965",white:"Mikhail Tal",black:"Bent Larsen",result:"1-0",year:1965,event:"Candidates Match",category:"tal",title:"Tal's Dazzling Attack",description:"Tal sacrifices a piece for a long-term attack that proves irresistible.",pgn:"1. e4 c5 2. Nf3 Nc6 3. d4 cxd4 4. Nxd4 e6 5. Nc3 d6 6. Be3 Nf6 7. f3 Be7 8. Qd2 O-O 9. O-O-O a6 10. g4 Nxd4 11. Bxd4 b5 12. g5 Nd7 13. h4 b4 14. Na4 Bb7 15. Nb6 Nxb6 16. Bxb6 Qc8 17. Bd3 a5 18. h5 Bc6 19. g6 fxg6 20. hxg6 h6 21. Qe3 Rf6 22. Qe1 Qb7 23. Bc4 Bd8 24. Bxd8 Rxd8 25. Rxd6 Rdxd6 26. Qxa5 Qd7 27. Bxe6+ Rxe6 28. Qxf6 gxf6 29. Rh1 Qf7 30. gxf7+ Kxf7 31. Rxh6 1-0"},{id:"tal-miller-1988",white:"Mikhail Tal",black:"Johann Hjartarson",result:"1-0",year:1987,event:"Reykjavik",category:"tal",title:"The Sorcerer's Magic",description:"Classic Tal - sacrificing material for a devastating attack.",pgn:"1. e4 c5 2. Nf3 e6 3. d4 cxd4 4. Nxd4 Nc6 5. Nc3 Qc7 6. Be3 a6 7. Bd3 Nf6 8. O-O Nxd4 9. Bxd4 Bc5 10. Bxc5 Qxc5 11. Kh1 b5 12. f4 Bb7 13. e5 Nd5 14. Nxd5 Bxd5 15. c3 O-O 16. Qh5 g6 17. Qh6 f5 18. Rf3 Rf7 19. Rh3 Qe7 20. Qxg6+ Rg7 21. Qxe6+ Qxe6 22. Re1 Qc8 23. Rxe5 1-0"},{id:"byrne-fischer-1956",white:"Donald Byrne",black:"Robert James Fischer",result:"0-1",year:1956,event:"Rosenwald Memorial",category:"fischer",title:"The Game of the Century",description:"13-year-old Fischer plays one of the most brilliant games ever, sacrificing his queen for a winning attack.",pgn:"1. Nf3 Nf6 2. c4 g6 3. Nc3 Bg7 4. d4 O-O 5. Bf4 d5 6. Qb3 dxc4 7. Qxc4 c6 8. e4 Nbd7 9. Rd1 Nb6 10. Qc5 Bg4 11. Bg5 Na4 12. Qa3 Nxc3 13. bxc3 Nxe4 14. Bxe7 Qb6 15. Bc4 Nxc3 16. Bc5 Rfe8+ 17. Kf1 Be6 18. Bxb6 Bxc4+ 19. Kg1 Ne2+ 20. Kf1 Nxd4+ 21. Kg1 Ne2+ 22. Kf1 Nc3+ 23. Kg1 axb6 24. Qb4 Ra4 25. Qxb6 Nxd1 26. h3 Rxa2 27. Kh2 Nxf2 28. Re1 Rxe1 29. Qd8+ Bf8 30. Nxe1 Bd5 31. Nf3 Ne4 32. Qb8 b5 33. h4 h5 34. Ne5 Kg7 35. Kg1 Bc5+ 36. Kf1 Ng3+ 37. Ke1 Bb4+ 38. Kd1 Bb3+ 39. Kc1 Ne2+ 40. Kb1 Nc3+ 41. Kc1 Ra1# 0-1"},{id:"fischer-spassky-1972-g6",white:"Robert James Fischer",black:"Boris Spassky",result:"1-0",year:1972,event:"World Championship, Reykjavik",category:"fischer",title:"WC 1972 Game 6",description:"Fischer's masterpiece - a flawless positional crush with the Queen's Gambit that stunned the chess world.",pgn:"1. c4 e6 2. Nf3 d5 3. d4 Nf6 4. Nc3 Be7 5. Bg5 O-O 6. e3 h6 7. Bh4 b6 8. cxd5 Nxd5 9. Bxe7 Qxe7 10. Nxd5 exd5 11. Rc1 Be6 12. Qa4 c5 13. Qa3 Rc8 14. Bb5 a6 15. dxc5 bxc5 16. O-O Ra7 17. Be2 Nd7 18. Nd4 Qf8 19. Nxe6 fxe6 20. e4 d4 21. f4 Qe7 22. e5 Rb8 23. Bc4 Kh8 24. Qh3 Nf8 25. b3 a5 26. f5 exf5 27. Rxf5 Nh7 28. Rcf1 Qd8 29. Qg3 Re7 30. h4 Rbb7 31. e6 Rbc7 32. Qe5 Qe8 33. a4 Qd8 34. R1f2 Qe8 35. R2f3 Qd8 36. Bd3 Qe8 37. Qe4 Nf6 38. Rxf6 gxf6 39. Rxf6 Kg8 40. Bc4 Kh8 41. Qf4 1-0"},{id:"fischer-spassky-1992",white:"Robert James Fischer",black:"Boris Spassky",result:"1-0",year:1992,event:"Rematch, Sveti Stefan",category:"fischer",title:"Fischer Returns",description:"After 20 years away from chess, Fischer returns to defeat Spassky again.",pgn:"1. e4 e5 2. Nf3 Nc6 3. Bb5 a6 4. Ba4 Nf6 5. O-O Be7 6. Re1 b5 7. Bb3 d6 8. c3 O-O 9. h3 Nb8 10. d4 Nbd7 11. Nbd2 Bb7 12. Bc2 Re8 13. Nf1 Bf8 14. Ng3 g6 15. Bg5 h6 16. Bd2 Bg7 17. a4 c5 18. d5 c4 19. b4 Nh7 20. Be3 h5 21. Qd2 Rf8 22. Ra3 Ndf6 23. Rea1 Qd7 24. R1a2 Rfc8 25. Qc1 Bf8 26. Qa1 Qe8 27. Nf1 Be7 28. N1h2 Bd8 29. axb5 axb5 30. Ra8 Rxa8 31. Rxa8 Qxa8 32. Qxa8 Rxa8 33. Nc7 Ra1+ 34. Kh2 Ng4+ 35. hxg4 hxg4 36. Ng5 g3+ 37. fxg3 Bc8 38. Nxf7 1-0"},{id:"kasparov-topalov-1999",white:"Garry Kasparov",black:"Veselin Topalov",result:"1-0",year:1999,event:"Wijk aan Zee",category:"kasparov",title:"Kasparov's Immortal",description:"One of the greatest games ever played. Kasparov sacrifices rook after rook in a breathtaking attack.",pgn:"1. e4 d6 2. d4 Nf6 3. Nc3 g6 4. Be3 Bg7 5. Qd2 c6 6. f3 b5 7. Nge2 Nbd7 8. Bh6 Bxh6 9. Qxh6 Bb7 10. a3 e5 11. O-O-O Qe7 12. Kb1 a6 13. Nc1 O-O-O 14. Nb3 exd4 15. Rxd4 c5 16. Rd1 Nb6 17. g3 Kb8 18. Na5 Ba8 19. Bh3 d5 20. Qf4+ Ka7 21. Rhe1 d4 22. Nd5 Nbxd5 23. exd5 Qd6 24. Rxd4 cxd4 25. Re7+ Kb6 26. Qxd4+ Kxa5 27. b4+ Ka4 28. Qc3 Qxd5 29. Ra7 Bb7 30. Rxb7 Qc4 31. Qxf6 Kxa3 32. Qxa6+ Kxb4 33. c3+ Kxc3 34. Qa1+ Kd2 35. Qb2+ Kd1 36. Bf1 Rd2 37. Rd7 Rxd7 38. Bxc4 bxc4 39. Qxh8 Rd3 40. Qa8 c3 41. Qa4+ Ke1 42. f4 f5 43. Kc1 Rd2 44. Qa7 1-0"},{id:"kasparov-karpov-1985-g16",white:"Garry Kasparov",black:"Anatoly Karpov",result:"1-0",year:1985,event:"World Championship, Game 16",category:"kasparov",title:"Kasparov Becomes Champion",description:"The game that made Kasparov the youngest World Champion in history at 22.",pgn:"1. e4 c5 2. Nf3 e6 3. d4 cxd4 4. Nxd4 Nc6 5. Nb5 d6 6. c4 Nf6 7. N1c3 a6 8. Na3 d5 9. cxd5 exd5 10. exd5 Nb4 11. Be2 Bc5 12. O-O O-O 13. Bf3 Bf5 14. Bg5 Re8 15. Qd2 b5 16. Rad1 Nd3 17. Nab1 h6 18. Bh4 b4 19. Na4 Bd6 20. Bg3 Rc8 21. b3 g5 22. Bxd6 Qxd6 23. g3 Nd7 24. Bg2 Qf6 25. a3 a5 26. axb4 axb4 27. Qa2 Bg6 28. d6 g4 29. Qd2 Kg7 30. f3 Qxd6 31. fxg4 Qd4+ 32. Kh1 Nf6 33. Rf4 Ne4 34. Qxd3 Nf2+ 35. Rxf2 Bxd3 36. Rfd2 Qe3 37. Rxd3 Rc1 38. Nb2 Qf2 39. Nd2 Rxd1+ 40. Nxd1 Re1+ 1-0"},{id:"kasparov-anand-1995",white:"Garry Kasparov",black:"Viswanathan Anand",result:"1-0",year:1995,event:"World Championship, Game 10",category:"kasparov",title:"WC 1995 - Kasparov's Dragon Slayer",description:"Kasparov crushes Anand's Dragon Sicilian with spectacular tactics.",pgn:"1. e4 c5 2. Nf3 d6 3. d4 cxd4 4. Nxd4 Nf6 5. Nc3 g6 6. Be3 Bg7 7. f3 O-O 8. Qd2 Nc6 9. Bc4 Bd7 10. h4 Rc8 11. Bb3 Ne5 12. O-O-O Nc4 13. Bxc4 Rxc4 14. h5 Nxh5 15. g4 Nf6 16. Nde2 Qa5 17. Bh6 Bxh6 18. Qxh6 Rfc8 19. Rd3 R4c5 20. g5 Rxg5 21. Rd5 Rxd5 22. Nxd5 Re8 23. Nef4 Bc6 24. e5 Bxd5 25. Nxd5 Qa6 26. Nxf6+ exf6 27. Qxf6 Kf8 28. Qh6+ 1-0"},{id:"karpov-kasparov-1984-g9",white:"Anatoly Karpov",black:"Garry Kasparov",result:"1-0",year:1984,event:"World Championship, Game 9",category:"karpov",title:"Karpov's Squeeze",description:"Classic Karpov - slowly improving his position until resistance is futile.",pgn:"1. e4 c5 2. Nf3 e6 3. d4 cxd4 4. Nxd4 Nc6 5. Nb5 d6 6. c4 Nf6 7. N1c3 a6 8. Na3 Be7 9. Be2 O-O 10. O-O b6 11. Be3 Bb7 12. Rc1 Rc8 13. Qb3 Na5 14. Qa4 Nc6 15. Qb3 Na5 16. Qa4 Nc6 17. Rfd1 Ne5 18. Qb3 Qc7 19. f3 Rfd8 20. Nc2 Ng6 21. Bf2 Bf8 22. Bf1 Be7 23. Be1 Bd8 24. Qd3 Qc5+ 25. Bf2 Qc7 26. Be3 Ne5 27. Qe2 Ng6 28. b3 Qc5 29. Bf2 Qc7 30. Na4 bxa4 31. Rxc7 Rxc7 32. bxa4 Ne5 33. Rb1 Bc8 34. Rb6 Nfd7 35. Rxa6 Nc5 36. Ra8 Rc8 37. Na3 Be7 38. Qa2 Nd7 39. Bd4 Nc5 40. Nb5 Na6 41. Bxe5 dxe5 42. Qd2 Bf8 43. Qd6 Nb4 44. Qxe5 f6 45. Qb2 Rc6 46. Qe2 Bd7 47. Nd4 Rd6 48. Nb5 Rc6 49. a5 1-0"},{id:"kramnik-kasparov-2000-g2",white:"Vladimir Kramnik",black:"Garry Kasparov",result:"1-0",year:2e3,event:"World Championship, London",category:"kramnik",title:"Dethroning Kasparov",description:"Kramnik's Berlin Defense preparation shocked Kasparov and changed opening theory forever.",pgn:"1. e4 e5 2. Nf3 Nc6 3. Bb5 Nf6 4. O-O Nxe4 5. d4 Nd6 6. Bxc6 dxc6 7. dxe5 Nf5 8. Qxd8+ Kxd8 9. Nc3 Ke8 10. h3 h5 11. Bf4 Be7 12. Rad1 Be6 13. Ng5 Rh6 14. g3 Bxg5 15. Bxg5 Rg6 16. h4 f6 17. exf6 gxf6 18. Bf4 Nxh4 19. f3 Rd8 20. Kf2 Rxd1 21. Nxd1 Nf5 22. Rh1 Bxa2 23. Rxh5 Be6 24. g4 Nd6 25. Rh7 Nf7 26. Ne3 Kd8 27. Nf5 c5 28. Ng3 Ne5 29. Rh8+ Rg8 30. Bxe5 fxe5 31. Rh5 Kc8 32. Rxe5 Bf7 33. Nf5 1-0"},{id:"kramnik-topalov-2006-g2",white:"Vladimir Kramnik",black:"Veselin Topalov",result:"1-0",year:2006,event:"World Championship, Elista",category:"kramnik",title:"Unified Championship",description:"Kramnik unifies the world championship with a dominant performance.",pgn:"1. d4 d5 2. c4 c6 3. Nf3 Nf6 4. Nc3 e6 5. e3 Nbd7 6. Bd3 dxc4 7. Bxc4 b5 8. Bd3 Bb7 9. a3 b4 10. Ne4 Nxe4 11. Bxe4 bxa3 12. O-O Bd6 13. bxa3 Qc7 14. Bd2 e5 15. Rc1 O-O 16. dxe5 Bxe4 17. exd6 Qxd6 18. Qc2 Bxf3 19. gxf3 Qg6+ 20. Kh1 Qf5 21. Qb3 Qf4 22. Kg2 Rab8 23. Qd3 Rb2 24. Qxa6 Qxf3+ 25. Kh3 Rxd2 26. Rc4 Qf5+ 27. Kg2 Qf3+ 28. Kh3 Ne5 29. Rh4 Qf5+ 30. Rg4+ Nxg4 31. Qe6 Qxe6 32. fxe6 Nxe3 1-0"},{id:"kramnik-aronian-2018",white:"Vladimir Kramnik",black:"Levon Aronian",result:"1-0",year:2018,event:"Candidates Tournament",category:"kramnik",title:"Kramnik's Last Hurrah",description:"A beautiful attacking game from the twilight of Kramnik's career.",pgn:"1. Nf3 d5 2. g3 Nf6 3. Bg2 e6 4. O-O Be7 5. c4 O-O 6. b3 c5 7. cxd5 Nxd5 8. Bb2 Nc6 9. d4 b6 10. Nc3 Nxc3 11. Bxc3 Bb7 12. Rc1 Rc8 13. dxc5 bxc5 14. Qd6 Bf6 15. Rfd1 Qe7 16. Qxe7 Bxe7 17. Ne5 Nxe5 18. Bxe5 Bxg2 19. Kxg2 Bf6 20. Bf4 Rfd8 21. Kf3 Rxd1 22. Rxd1 Rd8 23. Rxd8+ Bxd8 24. Ke4 Kf8 25. Kd5 Ke8 26. Kc6 f6 27. Kb7 1-0"},{id:"anand-topalov-2005",white:"Viswanathan Anand",black:"Veselin Topalov",result:"1-0",year:2005,event:"Sofia MTel",category:"anand",title:"Anand's Lightning Attack",description:"Anand demonstrates his legendary speed with a crushing kingside attack.",pgn:"1. e4 c5 2. Nf3 d6 3. d4 cxd4 4. Nxd4 Nf6 5. Nc3 a6 6. Be3 e6 7. f3 b5 8. g4 h6 9. Qd2 Nbd7 10. O-O-O Bb7 11. h4 b4 12. Na4 Qa5 13. b3 Nc5 14. a3 Nxa4 15. axb4 Qxd2+ 16. Rxd2 Nc3 17. Bxa6 Bxa6 18. Nb5 Bxb5 19. bxc5 Na4 20. cxd6 Bxd6 21. Kb1 Ke7 22. Ra2 Rhc8 23. c4 Rxc4 24. bxc4 Bxc4 25. Ra3 Nc5 26. Kc2 Bd3+ 27. Kd2 Bxe4 28. Rc3 Nd7 29. Kc2 Bxf3 30. Rxf3 Rxa2+ 31. Kb3 Ra6 32. Kc4 Nc5 33. Kd4 Rd6+ 34. Ke3 Rd7 35. Bf4 Ne4 36. Be5 f6 37. Bxf6+ gxf6 38. Rxf6 Nd2 39. Kf2 Rc7 40. Rf3 Nc4 41. g5 hxg5 42. hxg5 Be5 43. Rh3 Nd6 44. Rh7+ Kf8 45. Rxc7 Bxc7 46. Ke3 Kg7 47. Ke4 Nc4 48. Kd5 1-0"},{id:"anand-carlsen-2013-g5",white:"Viswanathan Anand",black:"Magnus Carlsen",result:"0-1",year:2013,event:"World Championship, Chennai",category:"anand",title:"Changing of the Guard",description:"Carlsen breaks through to win his first World Championship game against Anand.",pgn:"1. c4 e6 2. d4 d5 3. Nc3 c6 4. e4 dxe4 5. Nxe4 Bb4+ 6. Nc3 c5 7. a3 Ba5 8. Nf3 Nf6 9. Be3 Nc6 10. Qd3 cxd4 11. Nxd4 Ng4 12. O-O-O Nxe3 13. fxe3 Bc7 14. Nxc6 bxc6 15. Qxd8+ Bxd8 16. Be2 Ke7 17. Bf3 Bd7 18. Ne4 Bb6 19. c5 f5 20. cxb6 fxe4 21. b7 Rab8 22. Bxe4 Rxb7 23. Rhf1 Rb5 24. Rf4 g5 25. Rf3 h5 26. Rdf1 Be8 27. Bc2 Rc5 28. Rf6 h4 29. e4 a5 30. Kd2 Rb5 31. b3 Bh5 32. Kc3 Rc8+ 33. Kd4 Rb4+ 34. Ke3 Rxe4+ 35. Kf2 Rf8 36. Rxf8 Kxf8 37. Bd3 Rd4 38. Bc2 Ke7 39. Ke3 Rd6 40. Rf5 Bf7 41. Rf2 Rd5 42. Ke4 Rb5 43. Rf3 Be6 44. Bd3 Rb6 45. Rf2 a4 46. bxa4 Ra6 47. Kd4 Rxa4+ 48. Kc5 Ra3 0-1"},{id:"carlsen-anand-2013-g9",white:"Magnus Carlsen",black:"Viswanathan Anand",result:"1-0",year:2013,event:"World Championship, Chennai",category:"carlsen",title:"Carlsen Becomes Champion",description:"The clinching game where Carlsen wins his first World Championship title.",pgn:"1. d4 Nf6 2. c4 e6 3. Nc3 Bb4 4. f3 d5 5. a3 Bxc3+ 6. bxc3 c5 7. cxd5 exd5 8. e3 c4 9. Ne2 Nc6 10. g4 O-O 11. Bg2 Na5 12. O-O Nb3 13. Ra2 b5 14. Ng3 a5 15. g5 Ne8 16. e4 Nxc1 17. Qxc1 Ra6 18. e5 Nc7 19. f4 b4 20. axb4 axb4 21. Rxa6 Nxa6 22. f5 b3 23. Qf4 Nc7 24. f6 g6 25. Qh4 Ne8 26. Qh6 b2 27. Rf4 b1=Q+ 28. Nf1 Qe1 0-1"},{id:"carlsen-caruana-2018-g6",white:"Magnus Carlsen",black:"Fabiano Caruana",result:"1/2-1/2",year:2018,event:"World Championship, London",category:"carlsen",title:"The Greatest Escape",description:"Carlsen escapes from a lost position against Caruana in an epic WC game.",pgn:"1. e4 c5 2. Nf3 Nc6 3. Bb5 g6 4. Bxc6 dxc6 5. d3 Bg7 6. h3 Nf6 7. Nc3 Nd7 8. Be3 e5 9. O-O O-O 10. Nh2 b6 11. f4 exf4 12. Bxf4 Be5 13. Ng4 Bxf4 14. Rxf4 f5 15. exf5 Nf6 16. Nxf6+ Qxf6 17. fxg6 Qxf4 18. gxh7+ Kh8 19. Qf1 Qxf1+ 20. Rxf1 Rxf1+ 21. Kxf1 Bb7 22. Nd1 Rf8+ 23. Ke2 Kg7 24. Nf2 Kxh7 25. g4 Kg6 26. Ke3 Bg2 27. h4 Rf7 28. Ng4 Re7+ 29. Kf4 Rf7+ 30. Ke3 Re7+ 31. Kf4 Rf7+ 32. Ke3 Bc6 33. Ne5+ Kg7 34. Nxf7 Kxf7 35. d4 cxd4+ 36. Kxd4 Ke6 37. c4 Be8 38. Ke4 Bf7 39. b3 c5 40. h5 Bg8 41. Kf4 Bf7 42. Ke4 Bg8 43. Kd3 Kd6 44. Ke4 Ke6 45. Kf4 Bf7 46. Ke4 Bg8 47. Kf4 Bf7 48. Ke4 1/2-1/2"},{id:"carlsen-karjakin-2016-g10",white:"Magnus Carlsen",black:"Sergey Karjakin",result:"1-0",year:2016,event:"World Championship, New York",category:"carlsen",title:"Carlsen's Rook Endgame Masterclass",description:"A demonstration of Carlsen's legendary endgame technique.",pgn:"1. e4 e5 2. Nf3 Nc6 3. Bb5 Nf6 4. O-O Nxe4 5. Re1 Nd6 6. Bxc6 dxc6 7. Rxe5+ Be7 8. Nc3 O-O 9. Nd5 Bf5 10. d4 Bf6 11. Re1 Ne4 12. c3 Re8 13. Bf4 c5 14. Rxe4 Bxe4 15. Nxf6+ Qxf6 16. dxc5 Rad8 17. Qb3 Qe7 18. Be3 Qxc5 19. Nd4 Bd3 20. Rd1 Qe5 21. Qc3 Qf5 22. b3 h5 23. h3 Re4 24. Qc1 Rde8 25. Qd2 Be2 26. Rxe2 Rxe2 27. Qxe2 Rxe2 28. Nxe2 Qb1+ 29. Kh2 Qxa2 30. Ng3 h4 31. Nf1 b5 32. Bd4 c5 33. Bc3 Qc4 34. Nd2 Qc2 35. Nf3 Qd3 36. Nxh4 Qxb3 37. Nf3 Qc4 38. Bd2 a5 39. Ba5 Qd5 40. Ng5 Qf5 41. Nxf7 Qxf7 42. Bc7 a4 43. Bd6 Qf4+ 44. Kg1 Qc1+ 45. Kh2 Qf4+ 46. Kg1 Qc1+ 47. Kh2 Qf4+ 48. g3 Qd2 49. Bxc5 a3 50. Bf2 Qc2 51. Kg1 b4 52. cxb4 Qb1+ 53. Kh2 Qxb4 54. Kg2 Kf7 55. Bc5 Qc4 56. Bxa3 Qb3 57. Bc5 Kg6 58. f3 Kh5 59. Kh2 Qb5 60. Be3 Kg6 61. Bf4 Qb2+ 62. Kg1 Qe2 63. Bc1 Kf6 64. Bb2 Ke6 65. Bc3 Kf5 66. Bd2 Kf6 67. h4 Qd1+ 68. Kf2 Qd5 69. Be3 Qc4 70. Bd4+ Ke6 71. Kg2 Qa2+ 72. Kh3 Qa4 73. Kh2 Qa2+ 74. Kg1 Qa1+ 75. Kf2 Qb2+ 1-0"},{id:"carlsen-nepomniachtchi-2021-g6",white:"Magnus Carlsen",black:"Ian Nepomniachtchi",result:"1-0",year:2021,event:"World Championship, Dubai",category:"carlsen",title:"The 136-Move Marathon",description:"The longest game in World Championship history. Carlsen's endgame wizardry breaks Nepo.",pgn:"1. d4 Nf6 2. Nf3 d5 3. g3 e6 4. Bg2 Be7 5. O-O O-O 6. b3 c5 7. dxc5 Bxc5 8. c4 dxc4 9. Qc2 Qe7 10. Nbd2 Nc6 11. Nxc4 b5 12. Nce5 Nb4 13. Qb2 Bb7 14. a3 Nc6 15. Nd3 Bb6 16. Bg5 Rfd8 17. Bxf6 gxf6 18. Rac1 Nd4 19. Nxd4 Bxd4 20. Qa2 Bxg2 21. Kxg2 Qb7+ 22. Kg1 Qe4 23. Qc2 a5 24. Qxe4 1/2-1/2"},{id:"caruana-carlsen-2018-g1",white:"Fabiano Caruana",black:"Magnus Carlsen",result:"1/2-1/2",year:2018,event:"World Championship, London",category:"caruana",title:"The Opening Salvo",description:"Caruana puts massive pressure on Carlsen in game 1 of their championship match.",pgn:"1. e4 c5 2. Nf3 Nc6 3. Bb5 g6 4. Bxc6 dxc6 5. d3 Bg7 6. O-O Qc7 7. Re1 e5 8. a3 Nf6 9. b4 O-O 10. Nbd2 Bg4 11. h3 Bxf3 12. Nxf3 cxb4 13. axb4 a5 14. bxa5 Rxa5 15. Bd2 Raa8 16. Qb1 Nd7 17. Qb4 Rfe8 18. Bc3 b5 19. Rxa8 Rxa8 20. Ra1 Rxa1+ 21. Bxa1 Qa7 22. Bc3 Qa2 23. Qb2 Qxb2 24. Bxb2 f6 25. Kf1 Kf7 26. Ke2 Nf8 27. Bc3 Ne6 28. g3 Bf8 29. Nd2 Ng5 30. h4 Ne6 31. Nb3 h5 32. Bd2 Bd6 33. c3 Nc7 34. Be3 Nb5 35. Kd1 Nc7 36. Kc2 Ne8 37. Bc1 Nc7 38. Kb2 Nb5 39. Na1 Ke6 40. Nc2 Nd4 41. Nb4 Bxb4 42. cxb4 Kd6 43. Be3 Nf3 44. Kc3 Kc6 45. Bc1 Ne1 46. Kd2 Nd3 47. Bg5 Nxf2 48. Bxf6 Kd6 49. Ke3 Nd1+ 50. Kd2 Nb2 51. Bg5 Ke6 52. Kc3 Nc4 53. d4 exd4+ 54. Kxd4 Nd6 55. e5 Nb7 56. Be3 Kd7 57. Kd5 Kc7 58. Bc1 Na5 59. Bg5 Nb3 60. Bf4 Na5 61. Bd2 Nb3 62. Bc3 Na5 63. Bb4 Nb7 64. Kc5 Nd8 65. Bd6+ Kb7 66. Kd5 Nc6 67. Bc5 Ne7+ 68. Kd6 Nf5+ 69. Ke6 Kc6 70. Be3 Nh6 71. Kf6 Kd5 72. Kxg6 Nf5 73. Bf2 Kxe5 74. Kxh5 Nd4 75. Kg5 Ke4 76. h5 Nf3+ 77. Kg6 Kf4 78. Bc5 Ne5+ 79. Kf6 Nf3 80. h6 Kg4 81. h7 Nh4 82. Bf8 Kg3 83. Ke5 Nf3+ 84. Kd5 Nd2 85. Kc5 Nc4 1/2-1/2"},{id:"ding-nepomniachtchi-2023-g4",white:"Ding Liren",black:"Ian Nepomniachtchi",result:"1-0",year:2023,event:"World Championship, Astana",category:"ding",title:"Ding's First WC Win",description:"Ding Liren wins his first classical game in the 2023 World Championship match.",pgn:"1. d4 Nf6 2. c4 e6 3. Nf3 d5 4. h3 dxc4 5. e3 c5 6. Bxc4 a6 7. O-O Nc6 8. Nc3 b5 9. Bd3 Bb7 10. a4 b4 11. Ne4 Na5 12. Nxf6+ gxf6 13. e4 c4 14. Bc2 Qc7 15. Bd2 Rg8 16. Rc1 O-O-O 17. Bd3 Kb8 18. Qe2 Bd6 19. Bxc4 Nxc4 20. Rxc4 Qb6 21. Rfc1 Rc8 22. d5 Rxc4 23. Rxc4 exd5 24. exd5 Bc8 25. Qe4 f5 26. Qb1 Be7 27. Be3 Qb5 28. Qd3 Bd6 29. Bc5 Re8 30. Bxd6+ Qxd6 31. Qb3 Re2 32. Rd4 Qe7 33. Nd4 Re1+ 34. Kh2 Bd7 35. d6 Qe5+ 36. Nf3 Qxd6+ 37. Rxd6 Re2 38. Rd2 Re4 39. g3 Bxa4 40. Qd3 Bc6 41. Nd4 Re8 42. Kg2 Bd7 43. f4 Kc7 44. Kf3 Rb8 45. Re2 a5 46. Re7 Rd8 47. Qa6 Kb8 48. Nc6+ 1-0"},{id:"ivanchuk-yusupov-1991",white:"Vassily Ivanchuk",black:"Artur Yusupov",result:"1-0",year:1991,event:"Brussels Candidates",category:"modern",title:"Ivanchuk's Brilliancy Prize",description:"A stunning attacking game showcasing Ivanchuk's creative genius.",pgn:"1. c4 e5 2. g3 d6 3. Bg2 g6 4. d4 Nd7 5. Nc3 Bg7 6. Nf3 Ngf6 7. O-O O-O 8. Qc2 Re8 9. Rd1 c6 10. b3 Qe7 11. Ba3 e4 12. Ng5 e3 13. f4 Nf8 14. b4 Bf5 15. Qb3 h6 16. Nf3 Ng4 17. b5 g5 18. bxc6 bxc6 19. Ne5 gxf4 20. Nxc6 Qg5 21. Bxd6 Ng6 22. Nd5 Qh5 23. h4 Nxh4 24. gxh4 Qxh4 25. Nde7+ Kh8 26. Nxf5 Qh2+ 27. Kf1 Re6 28. Qb7 Rg6 29. Qxa8+ Kh7 30. Qg8+ 1-0"},{id:"short-timman-1991",white:"Nigel Short",black:"Jan Timman",result:"1-0",year:1991,event:"Tilburg",category:"modern",title:"Short's King Walk",description:"Short's king marches up the board in one of chess's most spectacular games.",pgn:"1. e4 Nf6 2. e5 Nd5 3. d4 d6 4. Nf3 g6 5. Bc4 Nb6 6. Bb3 Bg7 7. Qe2 Nc6 8. O-O O-O 9. h3 a5 10. a4 dxe5 11. dxe5 Nd4 12. Nxd4 Qxd4 13. Re1 e6 14. Nd2 Nd5 15. Nf3 Qc5 16. Qe4 Qb4 17. Bc4 Nb6 18. b3 Nxc4 19. bxc4 Re8 20. Rd1 Qc5 21. Qh4 b6 22. Be3 Qc6 23. Bh6 Bh8 24. Rd8 Bb7 25. Rad1 Bg7 26. R8d7 Rf8 27. Bxg7 Kxg7 28. R1d4 Rae8 29. Qf6+ Kg8 30. h4 h5 31. Kh2 Rc8 32. Kg3 Rce8 33. Kf4 Bc8 34. R7d6 Bb7 35. Kg5 1-0"}],uR={morphy:{name:"Paul Morphy",era:"1837-1884",count:"12+ games"},steinitz:{name:"Wilhelm Steinitz",era:"1836-1900"},lasker:{name:"Emanuel Lasker",era:"1868-1941"},capablanca:{name:"Jose Raul Capablanca",era:"1888-1942"},alekhine:{name:"Alexander Alekhine",era:"1892-1946"},tal:{name:"Mikhail Tal",era:"1936-1992"},fischer:{name:"Bobby Fischer",era:"1943-2008",count:"12+ games"},kasparov:{name:"Garry Kasparov",era:"1963-"},karpov:{name:"Anatoly Karpov",era:"1951-"},kramnik:{name:"Vladimir Kramnik",era:"1975-"},anand:{name:"Viswanathan Anand",era:"1969-"},carlsen:{name:"Magnus Carlsen",era:"1990-",count:"12+ games"},caruana:{name:"Fabiano Caruana",era:"1992-"},ding:{name:"Ding Liren",era:"1992-"},modern:{name:"Modern Classics",era:"1990+"}};function g1(){const t=dR(),e=new Set(c0.map(i=>i.id)),n=t.filter(i=>!e.has(i.id));return[...c0,...n]}function hR(t){return g1().filter(e=>e.category===t)}function fR(t){const e=t.toLowerCase();return g1().filter(n=>{var i,r,s;return n.white.toLowerCase().includes(e)||n.black.toLowerCase().includes(e)||((i=n.title)==null?void 0:i.toLowerCase().includes(e))||((r=n.event)==null?void 0:r.toLowerCase().includes(e))||((s=n.description)==null?void 0:s.toLowerCase().includes(e))})}const pR="3.5.0",Ul={light:{id:"light",name:"Light",bg:"#FAFAF8",bgAlt:"#F5F5F3",card:"rgba(255, 255, 255, 0.95)",cardHover:"#fff",ink:"#1a1a1a",inkMuted:"#666",inkFaint:"#999",accent:"#1a1a1a",accentSoft:"rgba(26,26,26,0.08)",success:"#2E7D32",error:"#C62828",border:"rgba(0,0,0,0.08)",borderStrong:"rgba(0,0,0,0.15)",shadow:"0 4px 24px rgba(0,0,0,0.06)",shadowStrong:"0 12px 48px rgba(0,0,0,0.12)"},dark:{id:"dark",name:"Dark",bg:"#141416",bgAlt:"#1c1c20",card:"rgba(28,28,32,0.95)",cardHover:"rgba(36,36,42,1)",ink:"#FAFAF8",inkMuted:"#a0a0a0",inkFaint:"#666",accent:"#D4AF37",accentSoft:"rgba(212,175,55,0.12)",success:"#4CAF50",error:"#EF5350",border:"rgba(255,255,255,0.06)",borderStrong:"rgba(255,255,255,0.12)",shadow:"0 4px 24px rgba(0,0,0,0.4)",shadowStrong:"0 12px 48px rgba(0,0,0,0.6)"},sepia:{id:"sepia",name:"Sepia",bg:"#F5F0E6",bgAlt:"#EDE5D8",card:"rgba(255,252,245,0.95)",cardHover:"#FFFCF5",ink:"#3D3429",inkMuted:"#6B5D4D",inkFaint:"#998B7A",accent:"#8B4513",accentSoft:"rgba(139,69,19,0.1)",success:"#558B2F",error:"#BF360C",border:"rgba(61,52,41,0.1)",borderStrong:"rgba(61,52,41,0.2)",shadow:"0 4px 24px rgba(61,52,41,0.08)",shadowStrong:"0 12px 48px rgba(61,52,41,0.15)"},midnight:{id:"midnight",name:"Midnight",bg:"#0D1B2A",bgAlt:"#1B263B",card:"rgba(27,38,59,0.95)",cardHover:"rgba(35,48,72,1)",ink:"#E0E1DD",inkMuted:"#8D99AE",inkFaint:"#5C677D",accent:"#00B4D8",accentSoft:"rgba(0,180,216,0.12)",success:"#06D6A0",error:"#EF476F",border:"rgba(224,225,221,0.06)",borderStrong:"rgba(224,225,221,0.12)",shadow:"0 4px 24px rgba(0,0,0,0.5)",shadowStrong:"0 12px 48px rgba(0,0,0,0.7)"},"classic-dark":{id:"classic-dark",name:"Classic Dark",bg:"#0C0C0E",bgAlt:"#141416",card:"#141416",cardHover:"#1A1A1E",ink:"#F5F5F3",inkMuted:"#A8A8A6",inkFaint:"#6B6B69",accent:"#C9A227",accentSoft:"rgba(201, 162, 39, 0.15)",success:"#3D8B40",error:"#C23B22",border:"rgba(255, 255, 255, 0.08)",borderStrong:"rgba(255, 255, 255, 0.15)",shadow:"0 2px 8px rgba(0, 0, 0, 0.4)",shadowStrong:"0 8px 32px rgba(0, 0, 0, 0.6)",isClassic:!0},"classic-light":{id:"classic-light",name:"Classic Light",bg:"#FAFAF8",bgAlt:"#F5F5F3",card:"#FFFFFF",cardHover:"#F5F5F3",ink:"#1A1A1A",inkMuted:"#5C5C5A",inkFaint:"#8C8C8A",accent:"#8B5A2B",accentSoft:"rgba(139, 90, 43, 0.1)",success:"#2E7D32",error:"#C62828",border:"rgba(0, 0, 0, 0.08)",borderStrong:"rgba(0, 0, 0, 0.15)",shadow:"0 2px 8px rgba(0, 0, 0, 0.06)",shadowStrong:"0 8px 32px rgba(0, 0, 0, 0.12)",isClassic:!0},gallery:{id:"gallery",name:"Gallery",bg:"#0C0C0C",bgAlt:"#141414",card:"#141414",cardHover:"#1A1A1A",ink:"#FFFFFF",inkMuted:"#666666",inkFaint:"#444444",accent:"#FF5C00",accentSoft:"rgba(255, 92, 0, 0.15)",success:"#4CAF50",error:"#EF5350",border:"rgba(255, 255, 255, 0.08)",borderStrong:"rgba(255, 255, 255, 0.15)",shadow:"0 4px 24px rgba(0, 0, 0, 0.5)",shadowStrong:"0 12px 48px rgba(0, 0, 0, 0.7)",themeClass:"gallery"},"gallery-light":{id:"gallery-light",name:"Gallery Light",bg:"#F5F5F5",bgAlt:"#EBEBEB",card:"#FFFFFF",cardHover:"#F5F5F5",ink:"#0C0C0C",inkMuted:"#666666",inkFaint:"#999999",accent:"#FF5C00",accentSoft:"rgba(255, 92, 0, 0.1)",success:"#2E7D32",error:"#C62828",border:"rgba(0, 0, 0, 0.08)",borderStrong:"rgba(0, 0, 0, 0.15)",shadow:"0 2px 8px rgba(0, 0, 0, 0.08)",shadowStrong:"0 8px 32px rgba(0, 0, 0, 0.12)",themeClass:"gallery"},typographic:{id:"typographic",name:"Typographic",bg:"#1A1A1A",bgAlt:"#242424",card:"#242424",cardHover:"#2E2E2E",ink:"#F0EDE6",inkMuted:"#999999",inkFaint:"#666666",accent:"#FF4D00",accentSoft:"rgba(255, 77, 0, 0.15)",success:"#4CAF50",error:"#EF5350",border:"rgba(255, 255, 255, 0.1)",borderStrong:"rgba(255, 255, 255, 0.2)",shadow:"0 4px 24px rgba(0, 0, 0, 0.5)",shadowStrong:"0 12px 48px rgba(0, 0, 0, 0.7)",themeClass:"typographic"},"typographic-light":{id:"typographic-light",name:"Typographic Light",bg:"#F0EDE6",bgAlt:"#E5E2DB",card:"#FFFFFF",cardHover:"#F0EDE6",ink:"#1A1A1A",inkMuted:"#666666",inkFaint:"#999999",accent:"#FF4D00",accentSoft:"rgba(255, 77, 0, 0.1)",success:"#2E7D32",error:"#C62828",border:"rgba(0, 0, 0, 0.1)",borderStrong:"rgba(0, 0, 0, 0.2)",shadow:"0 2px 8px rgba(0, 0, 0, 0.08)",shadowStrong:"0 8px 32px rgba(0, 0, 0, 0.12)",themeClass:"typographic"},editorial:{id:"editorial",name:"Editorial",bg:"#0A0A0B",bgAlt:"#111112",card:"#111112",cardHover:"#181819",ink:"#F5F5F3",inkMuted:"#888886",inkFaint:"#555553",accent:"#C9A227",accentSoft:"rgba(201, 162, 39, 0.15)",success:"#3D8B40",error:"#C23B22",border:"rgba(255, 255, 255, 0.08)",borderStrong:"rgba(255, 255, 255, 0.15)",shadow:"0 4px 24px rgba(0, 0, 0, 0.5)",shadowStrong:"0 12px 48px rgba(0, 0, 0, 0.7)",themeClass:"editorial"},"editorial-light":{id:"editorial-light",name:"Editorial Light",bg:"#FAFAF8",bgAlt:"#F5F5F3",card:"#FFFFFF",cardHover:"#F5F5F3",ink:"#1A1A1A",inkMuted:"#666664",inkFaint:"#999997",accent:"#8B6914",accentSoft:"rgba(139, 105, 20, 0.1)",success:"#2E7D32",error:"#C62828",border:"rgba(0, 0, 0, 0.08)",borderStrong:"rgba(0, 0, 0, 0.15)",shadow:"0 2px 8px rgba(0, 0, 0, 0.06)",shadowStrong:"0 8px 32px rgba(0, 0, 0, 0.12)",themeClass:"editorial"}},mR={classics:{id:"classics",name:"Classics",icon:"",classicIcon:""},masters:{id:"masters",name:"Masters",icon:"",classicIcon:""},lichess:{id:"lichess",name:"Lichess",icon:"",classicIcon:""},chesscom:{id:"chesscom",name:"Chess.com",icon:"",classicIcon:""},imported:{id:"imported",name:"My Games",icon:"",classicIcon:""}},gR=[{username:"DrNykterstein",name:"Magnus Carlsen"},{username:"Hikaru",name:"Hikaru Nakamura"},{username:"Firouzja2003",name:"Alireza Firouzja"}],xR=[{username:"MagnusCarlsen",name:"Magnus Carlsen"},{username:"Hikaru",name:"Hikaru Nakamura"},{username:"GothamChess",name:"Levy Rozman"}],qi="all 0.25s cubic-bezier(0.4, 0, 0.2, 1)",Ci={display:'"Playfair Display", Georgia, serif',body:'"Inter", -apple-system, sans-serif',mono:'"SF Mono", monospace'};function yR(){const[t,e]=N.useState(()=>localStorage.getItem("cm-theme")||"gallery"),[n,i]=N.useState(()=>localStorage.getItem("cm-board-theme")||"classic_wood"),[r,s]=N.useState(!1),a=rd(),{isMobile:l,isTablet:c,isDesktop:d}=a;$5(a);const[h,f]=N.useState(null),[p,m]=N.useState(!0),[y,x]=N.useState(!1),[g,u]=N.useState("login"),[v,b]=N.useState(""),[w,R]=N.useState(""),[C,A]=N.useState(null),[B,S]=N.useState("library"),[k,U]=N.useState(!1),[O,X]=N.useState(!1),[K,$]=N.useState(!1),[q,J]=N.useState(!1),[V,ue]=N.useState(null),[F,de]=N.useState("masters"),[Te,xe]=N.useState(""),[le,Re]=N.useState([]),[Q,ae]=N.useState(null),[Me,ze]=N.useState(null),[se,ke]=N.useState([]),[Ge,Oe]=N.useState([]),[Ve,Ze]=N.useState(!1),[Ue,tt]=N.useState({}),[z,ht]=N.useState({}),[Xe,Je]=N.useState([]),[ee,P]=N.useState(!1),[_,W]=N.useState(null),[M,_e]=N.useState(null),[ne,Ie]=N.useState(null),[ie,Se]=N.useState(null),[we]=N.useState(()=>new Bt),[ve,Ee]=N.useState(new Bt().fen()),[he,Z]=N.useState(0),[me,Ke]=N.useState([]),[G,Be]=N.useState("w"),[Pe,je]=N.useState(!1),[Ae,fe]=N.useState(""),[Fe,nt]=N.useState([]),[yt,mt]=N.useState(!1),[E,be]=N.useState("carlsen"),[qe,at]=N.useState("select"),I=Ul[t]||Ul.dark,St=_a[E]||_a.carlsen,Le=I.isClassic===!0,Ft=I.themeClass==="gallery"?"gallery":I.themeClass==="typographic"?"typographic":I.themeClass==="editorial"?"editorial":I.isClassic?"classic":"modern",kt=N.useMemo(()=>{const D={};return Object.entries(bi).forEach(([oe,ye])=>{const L=Ue[oe]||{};D[oe]={...ye,imageUrl:L.customImageUrl||ye.imageUrl,bio:L.customBio||ye.bio,fullName:L.fullName||ye.fullName,born:L.born||ye.born,died:L.died||ye.died,nationality:L.nationality||ye.nationality,peakRating:L.peakRating||ye.peakRating,worldChampion:L.worldChampion||ye.worldChampion,playingStyle:L.playingStyle||ye.playingStyle}}),D},[Ue]),En=async(D,oe)=>{},di=D=>{e(D),localStorage.setItem("cm-theme",D),h&&En(h.id)},$e=D=>{i(D),localStorage.setItem("cm-board-theme",D),h&&En(h.id)};N.useEffect(()=>{localStorage.setItem("cm-theme",t),document.body.style.background=I.bg,document.body.style.color=I.ink,document.body.classList.remove("theme-gallery","theme-typographic","theme-editorial","theme-classic","theme-modern"),document.body.classList.remove("light","dark"),I.themeClass?document.body.classList.add(`theme-${I.themeClass}`):I.isClassic?document.body.classList.add("theme-classic"):document.body.classList.add("theme-modern");const D=t.includes("light")||t==="sepia";document.body.classList.add(D?"light":"dark")},[t,I]),N.useEffect(()=>{(async()=>{{m(!1);return}})()},[]);const dr=async D=>{D.preventDefault(),A(null);try{const{error:oe}=await Yg.signIn(v,w);if(oe)throw oe;x(!1),b(""),R("")}catch(oe){A(oe.message)}},Jn=async D=>{D.preventDefault(),A(null);try{const{error:oe}=await Yg.signUp(v,w);if(oe)throw oe;A("Check your email for confirmation!")}catch(oe){A(oe.message)}},Cn=async D=>{if(D.trim()){P(!0),W(null),Je([]);try{const oe=await fetch(`https://lichess.org/api/games/user/${encodeURIComponent(D)}?max=20&pgnInJson=true`,{headers:{Accept:"application/x-ndjson"}});if(!oe.ok)throw new Error("Player not found");const L=(await oe.text()).trim().split(`
`).filter(Boolean).map(H=>{var ge,De,Ye,xt,pt,et;const j=JSON.parse(H);return{id:j.id,white:((Ye=(De=(ge=j.players)==null?void 0:ge.white)==null?void 0:De.user)==null?void 0:Ye.name)||"?",black:((et=(pt=(xt=j.players)==null?void 0:xt.black)==null?void 0:pt.user)==null?void 0:et.name)||"?",result:j.status==="draw"?"-":j.winner==="white"?"1-0":j.winner==="black"?"0-1":"*",date:new Date(j.createdAt).toLocaleDateString(),event:j.speed||"Game",pgn:j.pgn,url:`https://lichess.org/${j.id}`}});Je(L),_e(D)}catch(oe){W(oe.message)}P(!1)}},ur=async D=>{if(D.trim()){P(!0),W(null),Je([]);try{const oe=await fetch(`https://api.chess.com/pub/player/${D.toLowerCase()}/games/archives`);if(!oe.ok)throw new Error("Player not found");const{archives:ye}=await oe.json();if(!(ye!=null&&ye.length))throw new Error("No games");const L=await fetch(ye[ye.length-1]),{games:H}=await L.json(),j=H.slice(-20).reverse().map(ge=>{var De,Ye,xt,pt;return{id:ge.uuid,white:((De=ge.white)==null?void 0:De.username)||"?",black:((Ye=ge.black)==null?void 0:Ye.username)||"?",result:(xt=ge.pgn)!=null&&xt.includes("1-0")?"1-0":(pt=ge.pgn)!=null&&pt.includes("0-1")?"0-1":"-",date:new Date(ge.end_time*1e3).toLocaleDateString(),event:ge.time_class||"Game",pgn:ge.pgn,url:ge.url}});Je(j),_e(D)}catch(oe){W(oe.message)}P(!1)}},Rs=()=>{F==="classics"?(Re(fR(Te)),ae(null)):F==="lichess"?Cn(Te):F==="chesscom"&&ur(Te)},Na=D=>{ae(D),Re([]),Je(hR(D))},Es=async()=>{Ze(!0);try{const{data:D,error:oe}=await Bn.getCustomPlayers();if(oe)throw oe;Oe(D||[]);const ye=[...Object.keys(bi),...(D||[]).map(H=>H.id)],L={};for(const H of ye){const{count:j}=await Bn.getMasterGameCount(H);j>0&&(L[H]=j)}ht(L)}catch(D){console.error("Error loading custom players:",D)}Ze(!1)},qr=async()=>{try{const{data:D,error:oe}=await Bn.getAllPlayerOverrides();if(oe)throw oe;if(D){const ye={};D.forEach(L=>{ye[L.player_id]={customImageUrl:L.custom_image_url,customBio:L.custom_bio,fullName:L.full_name,born:L.born,died:L.died,nationality:L.nationality,peakRating:L.peak_rating,worldChampion:L.world_champion,playingStyle:L.playing_style}}),tt(ye),console.log("Loaded player overrides:",Object.keys(ye).length)}}catch(D){console.error("Error loading player overrides:",D)}};N.useEffect(()=>{F==="masters"&&(Es(),qr())},[F]),N.useEffect(()=>{(async()=>{try{const oe=Object.keys(bi),ye={};for(const L of oe){const{count:H}=await Bn.getMasterGameCount(L);H>0&&(ye[L]=H)}ht(L=>({...L,...ye}))}catch(oe){console.error("Error loading game counts:",oe)}})()},[]);const Mi=async D=>{ze(D),P(!0),W(null);try{const{data:oe,error:ye,count:L}=await Bn.getMasterGames(D,200,0);if(!ye&&oe&&oe.length>0){const j=oe.map(ge=>({id:ge.game_id||ge.id,white:ge.white,black:ge.black,whiteElo:ge.white_elo,blackElo:ge.black_elo,result:ge.result,year:ge.year,event:ge.event,site:ge.site,round:ge.round,eco:ge.eco,pgn:ge.pgn,title:ge.title||`${ge.white} vs ${ge.black}`,description:ge.description}));ke(j),Je(j),P(!1);return}const H=_5[D];if(H!=null&&H.file){const j=await fetch(H.file);if(!j.ok)throw new Error("Failed to load PGN");const ge=await j.text(),De=d1(ge);ke(De),Je(De)}else{const j=l0(D);j&&j.length>0?(ke(j),Je(j)):(Je([]),ke([]))}}catch(oe){console.error("Error loading master games:",oe),W("Failed to load games"),Je([])}P(!1)};N.useEffect(()=>{F==="classics"?(Je([]),Re([]),ae(null)):F==="masters"?(Je([]),ke([]),ze(null)):Je(F==="imported"?Fe:[]),_e(null)},[F,Fe]);const Ba=N.useCallback(D=>{var oe,ye;if(Ie(D),!(D!=null&&D.pgn)){console.warn("Game has no PGN data:",(D==null?void 0:D.title)||(D==null?void 0:D.id)),Ke([]),Ee(new Bt().fen()),Z(0);return}try{we.reset();let L=we.loadPgn(D.pgn,{strict:!1}),H=we.history();if(H.length===0&&D.pgn){we.reset();const j=D.pgn.replace(/\[[^\]]*\]/g,"").replace(/\{[^}]*\}/g,"").replace(/\d+\.\s*/g,"").replace(/1-0|0-1|1\/2-1\/2|\*/g,"").trim().split(/\s+/).filter(ge=>ge&&/^[KQRBNP]?[a-h]?[1-8]?x?[a-h][1-8](=[QRBN])?[+#]?$|^O-O(-O)?[+#]?$/i.test(ge));for(const ge of j)try{we.move(ge,{sloppy:!0})}catch{break}H=we.history()}Ke(H),we.reset(),Ee(we.fen()),Z(0),H.length===0&&D.pgn&&console.warn("Could not extract moves from PGN:",(oe=D.pgn)==null?void 0:oe.slice(0,200))}catch(L){console.error("Error loading PGN:",L,(ye=D.pgn)==null?void 0:ye.slice(0,200)),Ke([]),Ee(new Bt().fen()),Z(0)}},[we]),T=N.useCallback(D=>{const oe=Math.max(0,Math.min(D,me.length));Z(oe),we.reset();for(let ye=0;ye<oe;ye++)try{we.move(me[ye])}catch{break}Ee(we.fen())},[me,we]),Y=N.useMemo(()=>{const D={w:{p:8,n:2,b:2,r:2,q:1},b:{p:8,n:2,b:2,r:2,q:1}},oe={w:{p:0,n:0,b:0,r:0,q:0},b:{p:0,n:0,b:0,r:0,q:0}};return we.board().flat().filter(Boolean).forEach(ye=>{oe[ye.color][ye.type]!==void 0&&oe[ye.color][ye.type]++}),{byWhite:Object.entries(D.b).flatMap(([ye,L])=>Array(L-oe.b[ye]).fill(ye)),byBlack:Object.entries(D.w).flatMap(([ye,L])=>Array(L-oe.w[ye]).fill(ye))}},[ve]),pe=async()=>{if(!(!Ae.trim()||!h)){mt(!0);try{const oe=Ae.split(/\n\n(?=\[Event)/).map(H=>{const j=new Bt;try{j.loadPgn(H,{strict:!1})}catch{return null}const ge=j.header();return{white:ge.White||"?",black:ge.Black||"?",result:ge.Result||"*",date:ge.Date,event:ge.Event||"Imported",pgn:H}}).filter(Boolean);if(!oe.length)throw new Error("No valid PGN");const{data:ye,error:L}=await Bn.saveImportedGames(h.id,oe);if(L)throw L;ye&&nt(H=>[...ye.map(j=>({id:j.id,white:j.white,black:j.black,result:j.result,date:j.date,event:j.event,pgn:j.pgn})),...H]),je(!1),fe("")}catch(D){W(D.message)}mt(!1)}},ce=async D=>{try{const{error:oe}=await Bn.deleteImportedGame(D);if(oe)throw oe;nt(ye=>ye.filter(L=>L.id!==D)),(ne==null?void 0:ne.id)===D&&Ie(null)}catch(oe){W(oe.message)}},te=F==="classics"&&le.length>0?le:Xe,We=`${Le?"theme-classic":"theme-modern"} ${t.includes("light")?"light":"dark"}`;return o.jsxs("div",{className:`app ${We}`,style:{minHeight:"100vh",background:I.bg,color:I.ink,fontFamily:Ci.body,transition:qi,paddingBottom:l?"calc(80px + env(safe-area-inset-bottom, 0))":0},children:[l&&o.jsxs("header",{style:{position:"sticky",top:0,zIndex:100,background:"rgba(26, 26, 26, 0.95)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",padding:"12px 16px",paddingTop:"calc(12px + env(safe-area-inset-top, 0))",display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:`1px solid ${I.border}`},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[o.jsx("span",{style:{fontSize:24},children:""}),o.jsx("span",{style:{fontWeight:600,fontSize:16},children:"ChessGrandmaster"})]}),o.jsx("button",{onClick:()=>U(!k),style:{background:"transparent",border:"none",color:I.ink,padding:8,cursor:"pointer",fontSize:20},children:"Settings"})]}),!l&&o.jsx("header",{className:"header",style:{position:"sticky",top:0,zIndex:100,background:Le?I.bg:`linear-gradient(to bottom, ${I.bg} 0%, ${I.bg}ee 100%)`,backdropFilter:Le?"none":"blur(12px)",borderBottom:`1px solid ${I.border}`},children:o.jsxs("div",{className:"header-inner",style:{maxWidth:1400,margin:"0 auto",padding:Le?c?"20px 24px":"24px 40px":c?"14px 24px":"16px 32px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsxs("div",{className:"logo",style:{display:"flex",alignItems:"center",gap:Le?16:12},children:[o.jsx("span",{className:"logo-icon",style:{fontSize:Le?c?32:36:c?28:32,color:Le?I.accent:"inherit"},children:""}),o.jsx("span",{className:"logo-text",style:{fontFamily:Ci.display,fontSize:Le?c?22:26:c?18:22,fontWeight:Le?400:500,letterSpacing:Le?"0.02em":"0"},children:"ChessGrandmaster"})]}),o.jsx("nav",{className:"nav",style:{display:"flex",gap:Le?c?32:48:c?20:32},children:[{id:"library",label:"Library"},{id:"play",label:"Play"},{id:"coach",label:"Learn"},{id:"training",label:"Focus"}].map(D=>o.jsxs("button",{className:`nav-item ${B===D.id?"active":""}`,onClick:()=>{D.id==="training"?X(!0):D.id==="coach"?J(!0):(S(D.id),D.id==="play"&&at("select"))},style:{background:"none",border:"none",fontFamily:Ci.body,fontSize:Le?c?13:14:c?11:12,fontWeight:Le?400:500,letterSpacing:Le?"0.08em":"0.1em",textTransform:"uppercase",color:I.ink,opacity:B===D.id?1:Le?.6:.5,cursor:"pointer",padding:Le?"12px 0":"8px 0",position:"relative",transition:qi},children:[D.label,B===D.id&&o.jsx("div",{className:"nav-indicator",style:{position:"absolute",bottom:0,left:0,right:0,height:Le?1:2,background:I.accent,borderRadius:1}})]},D.id))}),o.jsxs("div",{className:"header-actions",style:{display:"flex",alignItems:"center",gap:c?10:16},children:[o.jsxs("div",{style:{position:"relative"},children:[o.jsx("button",{onClick:()=>U(!k),style:{background:Le?"transparent":I.accentSoft,border:`1px solid ${I.border}`,borderRadius:Le?4:8,padding:Le?"10px 16px":"8px 14px",cursor:"pointer",color:I.ink,fontSize:Le?13:14,transition:qi,fontWeight:Le?400:"inherit",letterSpacing:Le?"0.05em":"0"},children:Le?"Settings":""}),k&&o.jsxs("div",{style:{position:"absolute",top:"100%",right:0,marginTop:8,background:I.card,border:`1px solid ${I.border}`,borderRadius:12,padding:16,boxShadow:I.shadowStrong,zIndex:200,minWidth:220},children:[o.jsx("p",{style:{fontSize:10,fontWeight:600,letterSpacing:"0.12em",color:I.inkMuted,marginBottom:12},children:"APP THEME"}),Object.values(Ul).map(D=>o.jsxs("button",{onClick:()=>{di(D.id),U(!1)},style:{width:"100%",padding:"10px 12px",borderRadius:8,border:"none",background:t===D.id?I.accentSoft:"transparent",color:I.ink,cursor:"pointer",textAlign:"left",fontSize:13,fontWeight:500,display:"flex",alignItems:"center",gap:10,marginBottom:4,transition:qi},children:[o.jsx("div",{style:{width:18,height:18,borderRadius:9,background:D.bg,border:`2px solid ${D.ink}`}}),D.name]},D.id)),o.jsx("p",{style:{fontSize:10,fontWeight:600,letterSpacing:"0.12em",color:I.inkMuted,marginBottom:12,marginTop:16},children:"BOARD THEME"}),o.jsx("select",{value:n,onChange:D=>{i(D.target.value),localStorage.setItem("cm-board-theme",D.target.value)},style:{width:"100%",padding:"10px 12px",borderRadius:8,border:`1px solid ${I.border}`,background:I.bg,color:I.ink,fontSize:13,cursor:"pointer",marginBottom:8},children:vh().map(D=>o.jsx("option",{value:D.id,children:D.name},D.id))}),o.jsx("div",{style:{borderTop:`1px solid ${I.border}`,marginTop:12,paddingTop:12},children:o.jsx("button",{onClick:()=>{$(!0),U(!1)},style:{width:"100%",padding:"10px 12px",borderRadius:8,border:`1px solid ${I.border}`,background:"transparent",color:I.ink,cursor:"pointer",textAlign:"left",fontSize:13,fontWeight:500,display:"flex",alignItems:"center",gap:10},children:"Admin Panel"})})]})]}),Ea]})]})}),l&&k&&o.jsx("div",{className:"overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",zIndex:200},onClick:()=>U(!1),children:o.jsxs("div",{className:"panel settings-panel",style:{position:"absolute",top:60,right:16,background:I.card,border:`1px solid ${I.border}`,borderRadius:12,padding:16,boxShadow:I.shadowStrong,minWidth:260,maxWidth:"calc(100vw - 32px)"},onClick:D=>D.stopPropagation(),children:[o.jsx("p",{className:"panel-label",style:{fontSize:10,fontWeight:600,letterSpacing:"0.12em",color:I.inkMuted,marginBottom:12},children:"APP THEME"}),o.jsx("div",{className:"theme-grid",style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:8,marginBottom:16},children:Object.values(Ul).map(D=>o.jsxs("button",{className:`theme-btn ${t===D.id?"active":""}`,onClick:()=>{di(D.id)},style:{padding:"12px",borderRadius:8,border:t===D.id?`2px solid ${I.accent}`:`1px solid ${I.border}`,background:t===D.id?I.accentSoft:"transparent",color:I.ink,cursor:"pointer",textAlign:"center",fontSize:12,fontWeight:500},children:[o.jsx("div",{className:"theme-swatch",style:{width:24,height:24,borderRadius:12,background:D.bg,border:`2px solid ${D.ink}`,margin:"0 auto 6px"}}),D.name]},D.id))}),o.jsx("p",{className:"panel-label",style:{fontSize:10,fontWeight:600,letterSpacing:"0.12em",color:I.inkMuted,marginBottom:8},children:"BOARD THEME"}),o.jsx("select",{className:"form-select",value:n,onChange:D=>{i(D.target.value),localStorage.setItem("cm-board-theme",D.target.value)},style:{width:"100%",padding:"12px",borderRadius:8,border:`1px solid ${I.border}`,background:I.bg,color:I.ink,fontSize:14,marginBottom:12},children:vh().map(D=>o.jsx("option",{value:D.id,children:D.name},D.id))}),o.jsx("button",{className:"btn",onClick:()=>{$(!0),U(!1)},style:{width:"100%",padding:"12px",borderRadius:8,border:`1px solid ${I.border}`,background:"transparent",color:I.ink,cursor:"pointer",fontSize:13,fontWeight:500,marginBottom:8},children:"Admin Panel"}),Ea]})}),l&&!O&&!q&&!K&&o.jsx("nav",{className:"mobile-nav",style:{position:"fixed",bottom:0,left:0,right:0,zIndex:100,background:Le?I.bg:"rgba(26, 26, 26, 0.98)",backdropFilter:Le?"none":"blur(20px)",WebkitBackdropFilter:Le?"none":"blur(20px)",borderTop:`1px solid ${I.border}`,padding:Le?"12px 8px":"8px 8px",paddingBottom:Le?"calc(12px + env(safe-area-inset-bottom, 0))":"calc(8px + env(safe-area-inset-bottom, 0))",display:"flex",justifyContent:"space-around"},children:[{id:"library",label:"Library",icon:"",classicIcon:""},{id:"play",label:"Play",icon:"",classicIcon:""},{id:"coach",label:Le?"Learn":"Coach",icon:"",classicIcon:""},{id:"zone",label:Le?"Focus":"Zone",icon:"",classicIcon:""}].map(D=>{const oe=B===D.id||D.id==="zone"&&O||D.id==="coach"&&q;return o.jsxs("button",{className:`mobile-nav-item ${oe?"active":""}`,onClick:()=>{D.id==="zone"?X(!0):D.id==="coach"?J(!0):(S(D.id),D.id==="play"&&at("select"))},style:{display:"flex",flexDirection:"column",alignItems:"center",gap:Le?6:4,padding:Le?"10px 20px":"8px 16px",background:"none",border:"none",color:oe?Le?I.accent:"#4CAF50":Le?I.inkMuted:"rgba(255,255,255,0.5)",cursor:"pointer"},children:[o.jsx("span",{className:"mobile-nav-icon",style:{fontSize:Le?18:22,fontWeight:Le?300:"normal"},children:Le?D.classicIcon:D.icon}),o.jsx("span",{className:"mobile-nav-label",style:{fontSize:Le?11:10,fontWeight:oe?600:Le?400:500,letterSpacing:Le?"0.05em":"0",textTransform:Le?"uppercase":"none"},children:D.label})]},D.id)})}),B==="library"&&o.jsxs("main",{className:"main library-view",style:{maxWidth:1400,margin:"0 auto",padding:l?16:c?24:Le?48:32},children:[Le&&!l&&o.jsx("h1",{className:"library-hero-title",style:{fontFamily:Ci.display,fontSize:32,fontWeight:400,marginBottom:32,color:I.ink,letterSpacing:"0.01em"},children:"Game Library"}),o.jsx("div",{className:"source-tabs",style:{display:"flex",gap:Le?16:8,marginBottom:l?16:Le?32:24,borderBottom:`1px solid ${I.border}`,paddingBottom:l?12:Le?20:16,overflowX:l?"auto":"visible",WebkitOverflowScrolling:"touch",msOverflowStyle:"none",scrollbarWidth:"none"},children:Object.values(mR).map(D=>o.jsxs("button",{className:`source-tab ${F===D.id?"active":""}`,onClick:()=>de(D.id),style:{padding:Le?l?"10px 16px":"12px 24px":l?"10px 16px":"10px 20px",borderRadius:Le?4:8,border:F===D.id?`1px solid ${I.accent}`:`1px solid ${Le?"transparent":I.border}`,background:F===D.id?I.accentSoft:"transparent",color:F===D.id?I.ink:I.inkMuted,cursor:"pointer",fontSize:Le?14:l?12:13,fontWeight:Le?400:500,display:"flex",alignItems:"center",gap:Le?10:8,transition:qi,whiteSpace:"nowrap",flexShrink:0,letterSpacing:Le?"0.03em":"0"},children:[o.jsx("span",{style:{fontSize:Le?16:"inherit"},children:Le?D.classicIcon:D.icon}),l&&!Le?null:D.name]},D.id))}),F!=="imported"&&F!=="masters"&&o.jsxs("div",{className:"search-bar",style:{display:"flex",gap:l?8:12,marginBottom:l?16:24,flexDirection:l?"column":"row"},children:[o.jsx("input",{type:"text",className:"search-input",placeholder:F==="classics"?"Search games...":"Enter username...",value:Te,onChange:D=>xe(D.target.value),onKeyDown:D=>D.key==="Enter"&&Rs(),style:{flex:1,padding:l?"12px 16px":"14px 20px",borderRadius:10,border:`1px solid ${I.border}`,background:I.card,color:I.ink,fontSize:14,outline:"none"}}),o.jsx("button",{className:"search-btn btn btn-primary",onClick:Rs,style:{padding:l?"12px 20px":"14px 28px",borderRadius:10,border:"none",background:I.accent,color:I.id==="light"?"#fff":I.bg,cursor:"pointer",fontWeight:600,fontSize:14},children:"Search"})]}),F==="classics"&&o.jsx("div",{className:"category-filters",style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:l?16:24,overflowX:l?"auto":"visible",WebkitOverflowScrolling:"touch",paddingBottom:l?8:0},children:Object.entries(uR).map(([D,oe])=>o.jsxs("button",{className:`category-btn ${Q===D?"active":""}`,onClick:()=>Na(D),style:{padding:l?"6px 12px":"8px 16px",borderRadius:20,border:Q===D?`1px solid ${I.accent}`:`1px solid ${I.border}`,background:Q===D?I.accentSoft:"transparent",color:I.ink,cursor:"pointer",fontSize:l?11:12,fontWeight:500,transition:qi,whiteSpace:"nowrap",flexShrink:0},children:[oe.icon," ",oe.name]},D))}),F==="masters"&&o.jsxs("div",{style:{marginBottom:24},children:[Ve&&o.jsx("div",{style:{padding:20,textAlign:"center",color:I.inkMuted},children:"Loading players..."}),Ft==="gallery"&&o.jsx(P5,{players:kt,customPlayers:Ge,selectedMaster:Me,onSelectMaster:Mi,onShowBiography:D=>Se(D),theme:I,dbGameCounts:z}),Ft==="typographic"&&o.jsx(N5,{players:kt,customPlayers:Ge,selectedMaster:Me,onSelectMaster:Mi,onShowBiography:D=>Se(D),theme:I,dbGameCounts:z}),Ft==="editorial"&&o.jsx(B5,{players:kt,customPlayers:Ge,selectedMaster:Me,onSelectMaster:Mi,onShowBiography:D=>Se(D),theme:I,dbGameCounts:z}),Ft==="classic"&&o.jsx(I5,{players:kt,customPlayers:Ge,selectedMaster:Me,onSelectMaster:Mi,onShowBiography:D=>Se(D),theme:I,dbGameCounts:z,isMobile:l,isTablet:c}),Ft==="modern"&&o.jsx(D5,{players:kt,customPlayers:Ge,selectedMaster:Me,onSelectMaster:Mi,onShowBiography:D=>Se(D),theme:I,dbGameCounts:z,isMobile:l,isTablet:c})]}),(F==="lichess"||F==="chesscom")&&o.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:24},children:[o.jsx("span",{style:{fontSize:12,color:I.inkMuted,alignSelf:"center",marginRight:8},children:"Quick:"}),(F==="lichess"?gR:xR).map(D=>o.jsx("button",{onClick:()=>{xe(D.username),F==="lichess"?Cn(D.username):ur(D.username)},style:{padding:"6px 12px",borderRadius:6,border:`1px solid ${I.border}`,background:"transparent",color:I.inkMuted,cursor:"pointer",fontSize:12},children:D.name},D.username))]}),F==="imported"&&o.jsx("div",{style:{marginBottom:24},children:h?o.jsx("button",{onClick:()=>je(!0),style:{padding:"14px 28px",borderRadius:10,border:`1px solid ${I.border}`,background:I.card,color:I.ink,cursor:"pointer",fontWeight:500,fontSize:14},children:"+ Import PGN"}):o.jsx("p",{style:{color:I.inkMuted},children:"Sign in to import games"})}),ee&&o.jsx("p",{style:{color:I.inkMuted},children:"Loading..."}),_&&o.jsx("p",{style:{color:I.error},children:_}),te.length>0&&o.jsxs("div",{className:"game-viewer-layout",style:{display:l?"flex":"grid",flexDirection:"column",gridTemplateColumns:c?"1fr 1fr":"220px 1fr 280px",gap:l?12:16},children:[o.jsxs("div",{className:"game-list panel",style:{background:I.card,borderRadius:l?12:16,border:`1px solid ${I.border}`,overflow:"hidden",order:l?2:1},children:[o.jsx("div",{className:"panel-header",style:{padding:l?"10px 14px":"12px 16px",borderBottom:`1px solid ${I.border}`,fontSize:10,fontWeight:600,letterSpacing:"0.12em",color:I.inkMuted,display:"flex",justifyContent:"space-between",alignItems:"center"},children:o.jsxs("span",{children:["GAMES (",te.length,")"]})}),o.jsx("div",{className:"game-list-scroll",style:{maxHeight:l?200:600,overflowY:"auto",overflowX:l?"auto":"hidden",display:l?"flex":"block",flexDirection:l?"row":"column",gap:l?8:0,padding:l?8:0},children:te.map((D,oe)=>{var ye;return o.jsxs("div",{className:`game-card ${(ne==null?void 0:ne.id)===D.id?"active":""}`,onClick:()=>Ba(D),style:{padding:l?"10px 12px":"12px 16px",borderBottom:l?"none":`1px solid ${I.border}`,borderRadius:l?8:0,border:l?`1px solid ${I.border}`:"none",cursor:"pointer",background:(ne==null?void 0:ne.id)===D.id?I.accentSoft:l?I.bgAlt:"transparent",transition:qi,minWidth:l?180:"auto",flexShrink:0},children:[o.jsx("div",{className:"game-title",style:{display:"flex",justifyContent:"space-between",marginBottom:2},children:o.jsx("span",{style:{fontWeight:600,fontSize:l?11:12,lineHeight:1.3},children:D.title||`${D.white} vs ${D.black}`})}),o.jsxs("div",{className:"game-meta",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsxs("span",{style:{fontSize:l?10:11,color:I.inkMuted},children:[(ye=D.event)==null?void 0:ye.slice(0,l?15:20)," ",D.year||D.date]}),o.jsx("span",{className:"game-result",style:{fontSize:l?10:11,fontWeight:600,color:D.result==="1-0"?I.success:D.result==="0-1"?I.error:I.inkMuted},children:D.result})]}),!D.pgn&&o.jsx("span",{style:{fontSize:10,color:I.error},children:" No moves"}),F==="imported"&&!l&&o.jsx("button",{className:"btn btn-small",onClick:L=>{L.stopPropagation(),ce(D.id)},style:{marginTop:6,padding:"3px 6px",fontSize:10,borderRadius:4,border:`1px solid ${I.border}`,background:"transparent",color:I.inkMuted,cursor:"pointer"},children:"Delete"})]},D.id||oe)})})]}),o.jsxs("div",{className:"board-panel panel",style:{background:I.card,borderRadius:l?12:16,border:`1px solid ${I.border}`,padding:l?12:16,display:"flex",flexDirection:"column",alignItems:"center",order:l?1:2,gridColumn:c?"span 2":"auto"},children:[o.jsx("div",{style:{height:24,marginBottom:8,display:"flex",gap:2,alignItems:"center",width:"100%",justifyContent:"center"},children:Y.byBlack.map((D,oe)=>o.jsx("img",{src:`/pieces/classic/w${D.toUpperCase()}.svg`,alt:"",style:{width:l?16:20,height:l?16:20,opacity:.7}},oe))}),o.jsx("div",{style:{maxWidth:"100%",overflow:"hidden"},children:o.jsx(Gr,{fen:ve,orientation:G,onMove:()=>{},interactive:!1,size:l?Math.min(a.width-56,360):c?400:420})}),o.jsx("div",{style:{height:24,marginTop:8,display:"flex",gap:2,alignItems:"center",width:"100%",justifyContent:"center"},children:Y.byWhite.map((D,oe)=>o.jsx("img",{src:`/pieces/classic/b${D.toUpperCase()}.svg`,alt:"",style:{width:l?16:20,height:l?16:20,opacity:.7}},oe))}),o.jsx("div",{style:{display:"flex",justifyContent:"center",gap:l?6:8,marginTop:l?12:16,flexWrap:"wrap"},children:[{l:"",a:()=>T(0),d:he===0},{l:"",a:()=>T(he-1),d:he===0},{l:"",a:()=>T(he+1),d:he>=me.length},{l:"",a:()=>T(me.length),d:he>=me.length},{l:"",a:()=>Be(D=>D==="w"?"b":"w")}].map((D,oe)=>o.jsx("button",{onClick:D.a,disabled:D.d,style:{padding:l?"10px 14px":"8px 14px",borderRadius:8,border:`1px solid ${I.border}`,background:I.bgAlt,color:I.ink,cursor:D.d?"default":"pointer",opacity:D.d?.4:1,fontSize:l?16:14,transition:qi,minHeight:l?44:"auto"},children:D.l},oe))}),ne&&o.jsx("button",{onClick:()=>X(!0),style:{width:"100%",marginTop:l?12:16,padding:l?"16px":"14px",borderRadius:10,border:"none",background:I.accent,color:I.id==="light"?"#fff":I.bg,cursor:"pointer",fontWeight:600,fontSize:l?15:14,minHeight:l?48:"auto"},children:"Enter Focus Mode"})]}),o.jsx("div",{style:{background:I.card,borderRadius:l?12:16,border:`1px solid ${I.border}`,padding:l?12:16,display:"flex",flexDirection:"column",maxHeight:l?300:700,order:3,gridColumn:c?"span 2":"auto"},children:ne?o.jsxs(o.Fragment,{children:[o.jsx("h2",{style:{fontFamily:Ci.display,fontSize:l?15:16,marginBottom:4,lineHeight:1.3},children:ne.title||`${ne.white} vs ${ne.black}`}),ne.description&&!l&&o.jsx("p",{style:{fontSize:12,color:I.inkMuted,lineHeight:1.5,marginBottom:10},children:ne.description}),o.jsxs("div",{style:{display:"flex",gap:4,flexWrap:"wrap",marginBottom:l?8:12},children:[o.jsx("span",{style:{fontSize:l?9:10,padding:"3px 8px",background:I.accentSoft,borderRadius:4},children:ne.event}),o.jsx("span",{style:{fontSize:l?9:10,padding:"3px 8px",background:I.accentSoft,borderRadius:4},children:ne.result}),ne.year&&o.jsx("span",{style:{fontSize:l?9:10,padding:"3px 8px",background:I.accentSoft,borderRadius:4},children:ne.year})]}),o.jsxs("div",{style:{fontSize:10,fontWeight:600,letterSpacing:"0.12em",color:I.inkMuted,marginBottom:6},children:["MOVES (",he,"/",me.length,")"]}),o.jsx("div",{style:{flex:1,overflowY:"auto",background:I.bgAlt,borderRadius:10,padding:l?8:10},children:me.length>0?o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:l?2:3},children:me.map((D,oe)=>o.jsxs("span",{onClick:()=>T(oe+1),style:{padding:l?"4px 6px":"5px 8px",borderRadius:5,background:oe+1===he?I.accent:"transparent",color:oe+1===he?I.id==="light"?"#fff":I.bg:I.ink,cursor:"pointer",fontSize:l?11:12,transition:qi},children:[oe%2===0&&o.jsxs("span",{style:{opacity:.5,marginRight:2},children:[Math.floor(oe/2)+1,"."]}),D]},oe))}):o.jsxs("div",{style:{textAlign:"center",padding:l?16:20,color:I.inkMuted},children:[o.jsx("p",{style:{fontSize:24,marginBottom:8},children:""}),o.jsx("p",{style:{fontSize:12},children:"No moves available"})]})})]}):o.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",color:I.inkMuted,flexDirection:"column"},children:[o.jsx("p",{style:{fontSize:32,marginBottom:8},children:""}),o.jsx("p",{style:{fontSize:13},children:"Select a game"})]})})]}),te.length===0&&!ee&&!_&&F==="classics"&&!Q&&o.jsxs("div",{style:{textAlign:"center",padding:"60px 20px"},children:[o.jsx("p",{style:{fontSize:48,marginBottom:16},children:""}),o.jsx("p",{style:{fontSize:18,fontWeight:500,marginBottom:8},children:"Explore Classic Games"}),o.jsx("p",{style:{color:I.inkMuted},children:"Select a player above or search"})]})]}),B==="play"&&qe==="select"&&o.jsx("main",{style:{maxWidth:1100,margin:"0 auto",padding:32},children:o.jsx("div",{style:{background:I.card,borderRadius:16,border:`1px solid ${I.border}`,padding:24},children:o.jsx(_2,{selectedBotId:E,onSelect:be,onPlay:()=>at("playing")})})}),B==="play"&&qe==="playing"&&St&&o.jsx("main",{style:{maxWidth:900,margin:"0 auto",padding:32},children:o.jsx(S2,{profile:St,onBack:()=>at("select")})}),y&&o.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:o.jsxs("div",{style:{background:I.card,borderRadius:16,padding:32,width:400,border:`1px solid ${I.border}`,position:"relative"},children:[o.jsx("button",{onClick:()=>x(!1),style:{position:"absolute",top:16,right:16,background:"none",border:"none",color:I.inkMuted,cursor:"pointer",fontSize:20},children:""}),o.jsx("h2",{style:{fontFamily:Ci.display,fontSize:24,marginBottom:24},children:g==="login"?"Welcome Back":"Create Account"}),o.jsxs("form",{onSubmit:g==="login"?dr:Jn,children:[o.jsx("input",{type:"email",placeholder:"Email",value:v,onChange:D=>b(D.target.value),style:{width:"100%",padding:"14px",marginBottom:12,borderRadius:8,border:`1px solid ${I.border}`,background:I.bgAlt,color:I.ink,fontSize:14}}),o.jsx("input",{type:"password",placeholder:"Password",value:w,onChange:D=>R(D.target.value),style:{width:"100%",padding:"14px",marginBottom:16,borderRadius:8,border:`1px solid ${I.border}`,background:I.bgAlt,color:I.ink,fontSize:14}}),C&&o.jsx("p",{style:{color:C.includes("Check")?I.success:I.error,fontSize:13,marginBottom:12},children:C}),o.jsx("button",{type:"submit",style:{width:"100%",padding:"14px",borderRadius:8,border:"none",background:I.accent,color:I.id==="light"?"#fff":I.bg,cursor:"pointer",fontWeight:600,marginBottom:12},children:g==="login"?"Sign In":"Create Account"})]}),o.jsxs("p",{style:{textAlign:"center",fontSize:13,color:I.inkMuted},children:[g==="login"?"Don't have an account? ":"Already have an account? ",o.jsx("button",{onClick:()=>u(g==="login"?"signup":"login"),style:{background:"none",border:"none",color:I.accent,cursor:"pointer",fontWeight:600},children:g==="login"?"Sign up":"Sign in"})]})]})}),Pe&&o.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:o.jsxs("div",{style:{background:I.card,borderRadius:16,padding:32,width:500,border:`1px solid ${I.border}`},children:[o.jsx("h2",{style:{fontFamily:Ci.display,fontSize:24,marginBottom:16},children:"Import PGN"}),o.jsx("textarea",{placeholder:"Paste PGN...",value:Ae,onChange:D=>fe(D.target.value),style:{width:"100%",height:200,padding:16,borderRadius:8,border:`1px solid ${I.border}`,background:I.bgAlt,color:I.ink,fontSize:13,fontFamily:Ci.mono,resize:"none",marginBottom:16}}),o.jsxs("div",{style:{display:"flex",gap:12},children:[o.jsx("button",{onClick:()=>je(!1),style:{flex:1,padding:"14px",borderRadius:8,border:`1px solid ${I.border}`,background:"transparent",color:I.ink,cursor:"pointer"},children:"Cancel"}),o.jsx("button",{onClick:pe,disabled:yt||!Ae.trim(),style:{flex:1,padding:"14px",borderRadius:8,border:"none",background:I.accent,color:I.id==="light"?"#fff":I.bg,cursor:"pointer",fontWeight:600,opacity:yt?.5:1},children:yt?"...":"Import"})]})]})}),O&&o.jsx(f5,{initialGame:ne,onClose:()=>X(!1),theme:I,themeId:t,onThemeChange:di,boardThemeId:n,onBoardThemeChange:$e}),q&&o.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:I.bg,zIndex:1e3,overflow:"auto"},children:o.jsx(rR,{userProfile:V,onUpdateProfile:ue,onBack:()=>J(!1)})}),K&&o.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:20,backdropFilter:"blur(4px)"},onClick:()=>$(!1),children:o.jsx("div",{style:{width:"100%",maxWidth:1200,height:"90vh",backgroundColor:I.bg,borderRadius:16,overflow:"hidden",boxShadow:I.shadowStrong},onClick:D=>D.stopPropagation(),children:o.jsx(T5,{theme:I,onClose:()=>$(!1),onPlayersUpdated:()=>{Es(),qr()}})})}),ie&&o.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:20,backdropFilter:"blur(4px)"},onClick:()=>Se(null),children:o.jsx("div",{style:{width:"100%",maxWidth:1100,maxHeight:"90vh",backgroundColor:I.bg,borderRadius:16,overflow:"hidden",boxShadow:I.shadowStrong},onClick:D=>D.stopPropagation(),children:o.jsx(m5,{playerId:ie,theme:I.id,gameCount:z[ie]||l0(ie).length,onClose:()=>Se(null),onSelectGame:D=>{Se(null)},onViewGames:D=>{de("masters"),ze(D),Se(null)}})})}),o.jsxs("div",{style:{position:"fixed",bottom:8,right:12,fontSize:10,color:I.inkFaint,fontFamily:Ci.mono,opacity:.6,pointerEvents:"none",zIndex:50},children:["v",pR]})]})}Sy(document.getElementById("root")).render(o.jsx(yR,{}));
